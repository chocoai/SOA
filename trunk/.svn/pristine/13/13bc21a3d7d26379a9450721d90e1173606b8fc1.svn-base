Object.create||(Object.create=function(f){function l(){}l.prototype=f;return new l});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")});var js={};
(function(f){f.$public={};f.$protected={};f.$static={};f.next_class_id=0;f.classPrototypeMap={};f.classPrototypeMap.Object={};f.override=function(a,b,c,d){var e=function(){if(b.$$protected&&null==this.$caller)throw Error('\u4e0d\u80fd\u8c03\u7528\u53d7\u4fdd\u62a4\u7684\u65b9\u6cd5:"'+a+'".');var c=this.$caller;this.$caller={$name:a,$superclass:d};var e;try{e=b.apply(this,arguments)}catch(f){throw f;}finally{this.$caller=c}return e};!0==c&&(b.$$protected=!0);e.$name=a;e.$superclass=d;return e};f.callInternal=
function(a,b,c){var d=a.$caller;a.$caller={$name:"callInternal"};var e;try{e=b.apply(a,c)}catch(g){throw g;}finally{this.$caller=d}return e};f.$super=function(){if(!this.$caller)throw Error('\u4e0d\u80fd\u8c03\u7528"$super"\u65b9\u6cd5.');var a=this.$caller.$name,b=this.$caller.$superclass||this.$superclass,c=b?b[a]:null;if(!c)throw Error('\u7236\u7c7b\u4e2d\u627e\u4e0d\u5230"'+a+'"\u65b9\u6cd5.');a=this.$caller.$superclass;this.$caller.$superclass=b.$superclass;b=c.apply(this,arguments);this.$caller.$superclass=
a;return b};f.instanceOf=function(a,b){if(null==a||void 0==a||null==b||void 0==b)return!1;if("Interface"==b.$type){if(a.$implements)for(var c=0;c<a.$implements.length;c++)if(a.$implements[c]==b)return!0;return a.$superclass?f.instanceOf(a.$superclass,b):!1}return a instanceof b};f.type=function(a){return null==a?"null":void 0==a?"undefined":"Interface"==a.$type||"Class"==a.$type?a.$typename:null==a?"null":a instanceof Date?"date":a instanceof Array?"array":typeof a};f.isClass=function(a){return a&&
"Class"==a.$type?!0:!1};f.getClass=function(a){return f.isNull(a)||f.isNull(a.$class)?null:a.$class};f.findClass=function(a){if("string"!=f.type(a))return null;a=a.split(".");if(0==a.length)return null;for(var b=window,c=0;c<a.length;c++)if(b=b[a[c]],void 0===b||null===b)return null;return f.isClass(b)?b:null};f.isInterface=function(a){return a&&"Interface"==a.$type?!0:!1};f.newInstance=function(a){var b=f.type(a),b="string"==b?a.split("."):b.split(".");if(0==b.length)return null;for(var c=window,
d=0;d<b.length;d++)if(c=c[b[d]],void 0===c||null===c)throw Error(a+" is not defined.");if(f.isClass(c)){var e=Array.prototype.slice.call(arguments,1),b=function(){return c.apply(this,e)};b.prototype=c.prototype;return new b}throw Error(a+" is not a class.");};f.checkAbstractClass=function(a){for(var b=[],c=a;c;){if(c.$implements)for(var d=0;d<c.$implements.length;d++)b.push(c.$implements[d]);c=c.$superclass}for(var c="",e=[],d=0;d<b.length;d++){e.length=0;for(var g in b[d])"$"!=g.charAt(0)&&typeof a.prototype[g]!=
typeof b[d][g]&&e.push(g);0<e.length&&(c+=b[d].$typename+":"+e.join(",")+";")}0<c.length?(a.prototype.$isAbstractClass=!0,a.$isAbstractClass=!0,a.prototype.$unimplements=c,a.$unimplements=c):(a.$isAbstractClass=!1,a.prototype.$isAbstractClass=!1)};f.Interface=function(a,b){f.$public={};var c=new b,d,e;for(e in f.$public)d=f.$public[e],c[e]=d;c.$typename=a;c.$type="Interface";return c};f._init_construct=function(a,b){for(var c=[];null!==b&&void 0!==b;)c.push(b),b=b.$superclass;for(var d=c.length-1;0<=
d;d--)if(b=c[d],null!==b.$init_obj&&void 0!==b.$init_obj)for(var e in b.$init_obj)a[e]=f.clone(b.$init_obj[e])};f.Class=function(){var a,b,c,d;if(0==arguments.length)throw Error("\u7f3a\u5c11\u7c7b\u5b9a\u4e49\u3002");d=arguments[arguments.length-1];if("function"!=typeof d)throw Error("\u7c7b\u5b9a\u4e49\u5fc5\u987b\u662f\u4e00\u4e2aFunction\u3002");for(var e=0;e<arguments.length-1;e++)"string"==typeof arguments[e]?a=arguments[e]:"function"==typeof arguments[e]?b=arguments[e]:arguments[e]instanceof
Array&&(c=arguments[e]);b=b||f.classPrototypeMap.Object;b.$classId&&f.classPrototypeMap[b.$classId]&&(b=f.classPrototypeMap[b.$classId]);d.prototype=b;var g={},k=function(){if(1==arguments.length&&"$create class prototype"===arguments[0])return this.$init_obj=k.$init_obj=g,this;if(!0==this.$isAbstractClass)throw Error('\u4e0d\u80fd\u5b9e\u4f8b\u5316\u7eaf\u865a\u7c7b"'+this.$typename+'", \u5c1a\u672a\u5b9e\u73b0\u4ee5\u4e0b\u63a5\u53e3"'+this.$unimplements);f._init_construct(this,k);this.$class=k;
var a=this.$caller;this.$caller={$name:"initialize",$superclass:b};var c=this.initialize?this.initialize.apply(this,arguments)||this:this;this.$caller=a;return c};f.$public={};f.$protected={};f.$static={};f.classname="";d=new d;for(var m in d)e=d[m],"function"!==typeof e&&d.hasOwnProperty(m)&&(g[m]=d[m],delete d[m]);d.$superclass=b;for(m in f.$public)e=f.$public[m],"function"==typeof e?d[m]=f.override(m,f.$public[m],!1,b):g[m]=e;for(m in f.$protected)e=f.$protected[m],"function"==typeof e?d[m]=f.override(m,
f.$protected[m],!0,b):g[m]=e;for(m in f.$static)k[m]=f.$static[m];k.prototype=d;k.prototype.$super=f.$super;k.$classId="class"+f.next_class_id;f.next_class_id++;a&&(k.prototype.$typename=a,k.$typename=a);k.prototype.$type="Class";k.$type="Class";k.prototype.$superclass=b;k.$superclass=b;c&&(k.prototype.$implements=c,k.$implements=c);f.checkAbstractClass(k);f.classPrototypeMap[k.$classId]=new k("$create class prototype");f.$public={};f.$protected={};f.$static={};return k};f.$class=function(){function a(){return f.Class.apply(this,
c)}var b=arguments[0],c=Array.prototype.slice.call(arguments,0);a.prototype=f.Class.prototype;var d=new a,b=b.split(".");if(0==b.length)return null;for(var e=window,g=0;g<b.length-1;g++)e[b[g]]||(e[b[g]]={}),e=e[b[g]];e[b[b.length-1]]=d};f.$interface=function(){function a(){return f.Interface.apply(this,c)}var b=arguments[0],c=Array.prototype.slice.call(arguments,0);a.prototype=f.Class.prototype;var d=new a,b=b.split(".");if(0==b.length)return null;for(var e=window,g=0;g<b.length-1;g++)e[b[g]]||(e[b[g]]=
{}),e=e[b[g]];e[b[b.length-1]]=d};(function(a){RegExp.prototype.clone=function(b){b+""!==b&&(b=b?(b.ignoreCase?"i":"")+(b.global?"g":"")+(b.multiline?"m":"")+(b.sticky?"y":""):(this+"").replace(/[\s\S]+\//,""));return RegExp(this.source,b.replace("y",a))}})("sticky"in/s/?"y":"");f.clone=function(a){if(null==a||"object"!=typeof a)return a;if("function"==f.type(a.clone))return a.clone();if(a instanceof Date){var b=new Date;b.setTime(a.getTime());return b}if(a instanceof Array){for(var b=[],c=a.length,
d=0;d<c;d++)b[d]=f.clone(a[d]);return b}if(void 0!==a.__$cloning_obj&&null!=a.__$cloning_obj)return a.__$cloning_obj;if(a instanceof Object){b=new a.constructor;"Class"==a.$type&&(b=new a.$class);a.__$cloning_obj=b;for(c in a)"__$cloning_obj"!=c&&a.hasOwnProperty(c)&&(b[c]=f.clone(a[c]));delete a.__$cloning_obj;return b}throw Error("Unable to copy obj! Its type isn't supported.");};f.copy=function(a,b){var c,d;for(d in a)c=a[d],b.hasOwnProperty(d)&&"object"==f.type(c)&&"object"==f.type(b[d])?f.copy(c,
b[d]):b[d]=c};f.equals=function(a,b){if(a===b)return!0;if(!(a instanceof Object&&b instanceof Object)||a.prototype!==b.prototype)return!1;for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]&&("object"!==typeof a[c]||!f.equals(a[c],b[c]))))return!1;for(c in b)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(c))return!1;return!0};f.param=function(a,b){return"undefined"===typeof a?b:a};f.$param=f.param;f.isNull=function(a){return null===a||void 0===a?!0:!1};var l=Object.prototype.hasOwnProperty;
f.isEmpty=function(a){if(null==a||void 0==a)return!0;if(0<a.length)return!1;for(var b in a)if(l.call(a,b))return!1;return!0};f.$namespace=function(a){if(!a||!a.length)return null;a=a.split(".");for(var b=window,c=0;c<a.length;c++)b[a[c]]=b[a[c]]||{},b=b[a[c]];return b};f.$import=function(a,b){if(a&&a.length){b=f.param(b,window);for(var c=window,d=a.split("."),e=0;e<d.length;e++)if(c=c[d[e]],null===c||void 0===c)return;if("Class"===c.$type||"Interface"===c.$type)b[d[d.length-1]]=c;else for(var g in c)c.hasOwnProperty(g)&&
(b[g]=c[g])}}})(js);var qs={};
(function(f){qs.UID_PROPERTY="qs_internal_uid";qs._uid_count=0;qs.uid=function(a){return a[qs.UID_PROPERTY]||(a[qs.UID_PROPERTY]=++qs._uid_count)};qs.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(qs.UID_PROPERTY);try{delete a[qs.UID_PROPERTY]}catch(c){}};qs.type=function(a){return null==a?"null":a instanceof Date?"date":a instanceof Array?"array":a.$type?a.$type:typeof a};qs.hash=function(a){var c=qs.type(a);return"object"==c&&a||"function"==c||"Class"==c?"o"+qs.uid(a):"date"==c?
"d"+a.getTime():c.substr(0,1)+a};qs.setRuntime=function(a){qs.runtime=a;qs.baseUrl=$base_url("qs.js").replace("//","/");a=window.location.pathname;var c=a.indexOf("/applications",0);-1!=c&&(a=a.substring(0,c),"/"!=a.charAt(0)&&(a="/"+a),qs.root=a)};qs.invoke=function(a){for(var c=[],d=0;d<arguments.length-1;d++)c[d]=arguments[d+1];c=qs.runtime.js_call_json(a,JSON.stringify(c));return null==c||void 0==c||""==c?null:JSON.parse(c)};qs.$import=function(a){var c=document.getElementsByTagName("head")[0];
if(StringUtil.endWith(a,".css")){var d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=a;d.media="screen";c.appendChild(d)}else StringUtil.endWith(a,".js")&&(d=document.createElement("script"),d.type="text/javascript",d.src=a,c.appendChild(d))};var l,a;f.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||
[];return{browser:a[1]||"",version:a[2]||"0"}};l=f.uaMatch(navigator.userAgent);a={};l.browser&&(a[l.browser]=!0,a.version=l.version);l=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)&&(a=parseFloat(RegExp.$1))}else"Netscape"==navigator.appName&&(c=navigator.userAgent,d=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(a=parseFloat(RegExp.$1)));return a}();0<l&&(a.mozilla=!1,a.msie=!0,a.version=
l);!0==a.msie&&9>=a.version&&(l=document.createElement("div"),l.innerHTML="\x3c!--[if IE]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e",1!=l.getElementsByTagName("i").length&&(a.msie=!1));a.chrome?a.webkit=!0:a.webkit&&(a.safari=!0);f.browser=a})(jQuery);
function runtime_invoke_json(f,l){var a=JSON.parse(l);null!=a&&a instanceof Array||(a=[]);if("window.open"==f)window.open(a[0]);else{var b=null,c=f.split(".");if(1==c.length){b=eval(f);if(null==b)return null;b=b.apply(null,a)}else{var d=eval(c[0]);null!=d&&null!=d[c[1]]&&(b=d[c[1]].apply(d,a))}return JSON.stringify(b)}}
function invoke_runtime(f,l){for(var a=[],b=0;b<arguments.length-2;b++)a[b]=arguments[b+2];a=f.js_call_json(l,JSON.stringify(a));return null==a||void 0==a||""==a?null:JSON.parse(a)};(function(f,l){f.events={transitionEnd:"oTransitionEnd MSTransitionEnd webkitTransitionEnd transitionEnd"};f.events.eventInfos={};f.events.register=function(a,b){var c=f.events.eventInfos[a];if(void 0===c||null===c)c={clazz:[]},f.events.eventInfos[a]=c;b&&c.clazz.push(b)};f.events.isEventType=function(a){a=f.events.eventInfos[a];return void 0===a||null===a?!1:!0};f.events.hasEvent=function(a,b){var c=f.events.eventInfos[b];if(void 0===c||null===c)return!1;c=c.clazz;if(void 0===c||null===c)return!1;
for(var d=0;d<c.length;d++)if(js.type(c[d])===a)return!0;return!1};js.$class("qs.events.Event",function(){this.initialize=function(a,b){this._name=a;this._target=b;this._preventDefault=this._isImmediatePropagationStopped=this._isPropagationStopped=!1};js.$public.name=function(){return this._name};js.$public.target=function(a){if(void 0===a)return this._target;this._target=a};js.$public.currentTarget=function(a){if(void 0===a)return this._currentTarget;this._currentTarget=a};js.$public.stopPropagation=
function(){this._isPropagationStopped=!0};js.$public.isPropagationStopped=function(){return this._isPropagationStopped};js.$public.stopImmediatePropagation=function(){this._isImmediatePropagationStopped=!0};js.$public.isImmediatePropagationStopped=function(){return this._isImmediatePropagationStopped};js.$public.preventDefault=function(){this._preventDefault=!0};js.$public.isDefaultPrevented=function(){return this._preventDefault}});js.$class("qs.events.EventDispatcher",function(){this.initialize=
function(){this._eventHandlers=[]};js.$public.addEventListener=function(a,b,c){c=js.param(c,this);this._eventHandlers.push({event:a,handler:b,scope:c});return this};js.$public.removeEventListener=function(a,b){for(var c=this._eventHandlers.length;c--;)if(this._eventHandlers[c].event===a){b&&this._eventHandlers[c].handler!==b||this._eventHandlers.splice(c,1);return}return this};js.$public.removeAllEventListener=function(){for(var a=this._eventHandlers.length;a--;)this._eventHandlers[a]=null;this._eventHandlers.length=
0;return this};js.$public.dispatchEvent=function(a,b){var c="";if("string"==f.type(a))c=a,a=new f.events.Event(c,this);else if(js.instanceOf(a,f.events.Event))c=a.name(),a.target()||a.target(this);else return;a.currentTarget(this);for(var d,e=this._eventHandlers.length-1;0<=e&&!a.isImmediatePropagationStopped();e--)this._eventHandlers[e].event===c&&(d=this._eventHandlers[e].scope||this,!1==this._eventHandlers[e].handler.call(d,a,b)&&(a.preventDefault(),a.stopPropagation()))}})})(qs,jQuery);var __base_url__="";function $base_url(f){if(!f)return __base_url__;var l,a="",b=document.getElementsByTagName("script");for(l=0;l<b.length;l++)if(b[l].src.match(f)){a=b[l].src.replace(f,"");break}f=a.indexOf("js");-1!=f&&(a=a.substring(0,f));__base_url__=a.replace("//","/");return a}function $import(f,l){document.write('\x3cscript src\x3d"'+f+l+'"\x3e\x3c/script\x3e')}var __include_path__={};
function $include(f){if(!__include_path__[f]){var l=null;if(window.XMLHttpRequest)l=new XMLHttpRequest,l.overrideMimeType&&l.overrideMimeType("text/xml");else if(window.ActiveXObject)try{l=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{l=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}if(l){l.open("GET",f,!1);l.send(null);var c=document.getElementsByTagName("head").item(0),d=document.createElement("script");d.type="text/javascript";d.text=l.responseText;c.appendChild(d);__include_path__[f]=!0}}}
function json_invoke(f,l){var a=JSON.decode(l);null!=a&&a instanceof Array||(a=[]);var b=null,c=f.split(".");if(1==c.length){b=eval(f);if(null==b)return null;b=b.apply(null,a)}else{var d=eval(c[0]);null!=d&&null!=d[c[1]]&&(b=d[c[1]].apply(d,a))}return JSON.encode(b)}
Util={getURLAttribute:function(f){var l=window.location.search;return eval("/"+f+"\x3d([^\x26]*)/").test(l)?RegExp.$1:""},getURLHeader:function(){return location.protocol+"//"+location.host},getURL:function(){return window.location.search},codes2string:function(f){for(var l="",a=0;a<f.length;a++)l+=String.fromCharCode(f[a]);return l},createUUID:function(){for(var f=[],l=0;36>l;l++)f[l]=Math.floor(16*Math.random());f[14]=4;f[19]=f[19]&3|8;for(l=0;36>l;l++)f[l]="0123456789ABCDEF".charAt(f[l]);f[8]=
f[13]=f[18]=f[23]="-";return f.join("")},clone:function(f){var l=f instanceof Array?[]:{};for(i in f)"clone"!=i&&(l[i]=f[i]&&"object"==typeof f[i]?f[i].clone():f[i]);return l}};
(function(){var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(l,a){var b=[],c;a=a||f.length;if(l)for(c=0;c<l;c++)b[c]=f[0|Math.random()*a];else{var d;b[8]=b[13]=b[18]=b[23]="-";b[14]="4";for(c=0;36>c;c++)b[c]||(d=0|16*Math.random(),b[c]=f[19==c?d&3|8:d])}return b.join("")};Math.uuidFast=function(){for(var l=Array(36),a=0,b,c=0;36>c;c++)8==c||13==c||18==c||23==c?l[c]="-":14==c?l[c]="4":(2>=a&&(a=33554432+16777216*Math.random()|0),b=a&15,a>>=4,l[c]=
f[19==c?b&3|8:b]);return l.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var a=16*Math.random()|0;return("x"==f?a:a&3|8).toString(16)})}})();var _DOMDocument="Msxml2.DOMDocument.6.0 Msxml2.DOMDocument.5.0 Msxml2.DOMDocument.4.0 Msxml2.DOMDocument.3.0 MSXML2.DOMDocument MSXML.DOMDocument Microsoft.XMLDOM".split(" ");function newActiveXObject(f){for(var l=null,a=0;a<f.length;a++)try{l=new ActiveXObject(f[a]);break}catch(b){}return l}
var XMLUtil={parseXML:function(f){var l;if(window.DOMParser){l=(new DOMParser).parseFromString(f,"text/xml");if(!l.documentElement||"parsererror"==l.documentElement.tagName)throw f=l.documentElement.firstChild.data,f+="\n"+l.documentElement.firstChild.nextSibling.firstChild.data,f;return l}if(window.ActiveXObject)return l=newActiveXObject(_DOMDocument),l.loadXML(f),l.documentElement?l:null;l=document.createElement("div");l.innerHTML=f;return l},toJSON:function(f,l){if(null==f)return null;var a={},
b,c;if(f.attributes)for(var d=0;d<f.attributes.length;d++)b=f.attributes.item(d),c=b.nodeName,b=b.nodeValue,a[c]=b;f.text&&(a.text=f.text);a.xmlName=f.nodeName;if(f.childNodes)for(d=0;d<f.childNodes.length;d++)c=f.childNodes.item(d),"#text"==c.nodeName?a.text=c.nodeValue:(b=XMLUtil.toJSON(c,l),l?(null==a[l]&&(a[l]=[]),a[l].push(b)):null==a[c.nodeName]?a[c.nodeName]=b:(a[c.nodeName]=[a[c.nodeName]],a[c.nodeName].push(b)));return a}},ALink={toString:function(f,l,a){return a?"alink://"+f+"/"+l+"?"+JSON.stringify(a):
"alink://"+f+"/"+l+"?{}"}},StringUtil={join:function(){return Array.prototype.slice.call(arguments,0).join("")},isEmpty:function(f){return null==f||void 0==f||0==f.length?!0:!1}},NumberUtil={isNumber:function(f){var l=typeof f;if("number"==l)return!0;if("string"==l&&0<f.length){for(var a=0;a<f.length;a++)if(l=f.charAt(a),("0">l||"9"<l)&&"."!=l)return!1;return!0}return!1},toNumber:function(f){return parseFloat(f,10)||0},toInt:function(f){return parseInt(f,10)||0},toColorString:function(f){f-=0;f=(f&
16711680|f&65280|f&255).toString(16);f="#000000".substring(0,7-f.length)+f;return f.toUpperCase()},toScale:function(f,l){var a=0;try{a=f.toString().split(".")[0].length}catch(b){}return Number(f).toPrecision(a+l)}},DateUtil={};_Util_Date_strZf=function(f,l){return _Util_Date_strString("0",l-f.length)+f};_Util_Date_strString=function(f,l){for(var a="",b=0;b++<l;)a+=f;return a};_Util_Date_numZf=function(f,l){return _Util_Date_strZf(f.toString(),l)};
DateUtil.format=function(f,l){return f.valueOf()?l.replace(/(yyyy|YYYY|yy|YY|MM|mm|MI|dd|DD|HH|hh|ss|SS|E|a\/p)/gi,function(a){switch(a){case "yyyy":case "YYYY":return _Util_Date_numZf(f.getFullYear(),4);case "yy":case "YY":return _Util_Date_numZf(f.getFullYear(),4).substr(2,2);case "MM":return _Util_Date_numZf(f.getMonth()+1,2);case "dd":case "DD":return _Util_Date_numZf(f.getDate(),2);case "E":return(qs.I18N.getObject("qs.ui.calendar.weekdays_sn")||"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""))[f.getDay()];
case "HH":return _Util_Date_numZf(f.getHours(),2);case "hh":return _Util_Date_numZf((h=f.getHours()%12)?h:12,2);case "mm":case "MI":return _Util_Date_numZf(f.getMinutes(),2);case "ss":case "SS":return _Util_Date_numZf(f.getSeconds(),2);case "a/p":return a=qs.I18N.getObject("qs.ui.calendar.ap")||["\u4e0a\u5348","\u4e0b\u5348"],12>f.getHours()?a[0]:a[1]}}):""};
DateUtil.parse=function(f,l){for(var a=RegExp("yyyy|YYYY|yy|YY|MM|mm|MI|dd|DD|HH|hh|ss|SS|a/p","gi"),b,c=0,d=0,e=0,g=0,k=0,m=0,n=0;null!=(b=a.exec(l));)switch(b[0]){case "yyyy":case "YYYY":c=parseInt(f.substr(b.index,4));break;case "yy":case "YY":c=parseInt("20"+f.substr(b.index,2));break;case "MM":d=parseInt(f.substr(b.index,2));break;case "dd":case "DD":e=parseInt(f.substr(b.index,2));break;case "HH":g=parseInt(f.substr(b.index,2));break;case "hh":g=n+parseInt(f.substr(b.index,2));break;case "mm":case "MI":k=
parseInt(f.substr(b.index,2));break;case "ss":case "SS":m=parseInt(f.substr(b.index,2));break;case "a/p":n=qs.I18N.getObject("qs.ui.calendar.ap")||["\u4e0a\u5348","\u4e0b\u5348"],f.substr(b.index,2)==n[1]&&(n=12,g+=12)}return new Date(c,d-1,e,g,k,m)};Array.prototype.forEach||(Array.prototype.forEach=function(f,l){var a,b;a=0;for(b=this.length;a<b&&!(a in this&&!1===f.call(l,this[a],a,this));++a);});
Array.prototype.indexOf||(Array.prototype.indexOf=function(f,l){var a;a=l?l:0;var b;if(!this)throw new TypeError;b=this.length;if(0===b||a>=b)return-1;for(0>a&&(a=b-Math.abs(a));a<b;a++)if(this[a]===f)return a;return-1});
var ArrayUtil={sortOn:function(f){var l=f.slice();if(1==arguments.length)return l.sort();var a=Array.prototype.slice.call(arguments,1);return l.sort(function(b,c){for(var d=a.slice(),e=d.shift();b[e]==c[e]&&d.length;)e=d.shift();return b[e]==c[e]?0:b[e]>c[e]?1:-1})}},SQLUtil={_safeRegExp:RegExp("'","g"),filter:function(f){return f.replace(this._safeRegExp,"")}};Util.formatDate=DateUtil.format;(function(f,l){js.$class("qs.ArrayList",function(){this._data=null;this.initialize=function(){null!=arguments&&0<arguments.length&&this.addAll(arguments[0]);this._data=[]};js.$public.add=function(a){this._data.push(a);return!0};js.$public.addAt=function(a,b){if(!(0<=a&&a<this._data.length))throw Error("IndexOutOfBoundsException");this._data.splice(a,0,b)};js.$public.addAll=function(a){if(js.instanceOf(a,f.ArrayList))for(var b=0;b<a.size();b++)this.add(a.get(b));else if("array"==f.type(arg))for(b=
0;b<a.length;b++)this.add(a[b])};js.$public.addAllAt=function(a,b){if(js.instanceOf(b,f.ArrayList))for(var c=0;c<b.size();c++)this.addAt(a+c,b.get(c));else if("array"==f.type(arg))for(c=0;c<b.length;c++)this.addAt(a+c,b[c])};js.$public.clear=function(){this._data.length=0};js.$public.indexOf=function(a,b){var c=this._data.length,d=Number(b)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=c);d<c;d++)if(d in this._data&&this._data[d]===a)return d;return-1};js.$public.contains=function(a){return 0<=
this.indexOf(a)};js.$public.get=function(a){if(!(0<=a&&a<this._data.length))throw Error("IndexOutOfBoundsException");return this._data[a]};js.$public.isEmpty=function(){return 0==this._data.length};js.$public.lastIndexOf=function(a,b){var c=this._data.length,d=Number(b);isNaN(d)?d=c-1:(d=0>d?Math.ceil(d):Math.floor(d),0>d?d+=c:d>=c&&(d=c-1));for(;-1<d;d--)if(d in this&&this[d]===a)return d;return-1};js.$public.forEach=function(a,b){var c=this._data.length;if("function"!=typeof a)throw new TypeError;
for(var d=0;d<c&&!(d in this._data&&!1===a.call(b,this._data[d],d,this._data));d++);};js.$public.some=function(a,b){var c=this._data.length;if("function"!=typeof a)throw new TypeError;for(var d=0;d<c;d++)if(d in this._data&&a.call(b,this._data[d],d,this._data))return!0;return!1};js.$public.map=function(a,b){var c=this._data.length;if("function"!=typeof a)throw new TypeError;for(var d=new f.ArrayList,e=0;e<c;e++)e in this._data&&d.add(a.call(b,this._data[e],e,this._data));return d};js.$public.filter=
function(a,b){var c=this._data.length;if("function"!=typeof a)throw new TypeError;for(var d=new f.ArrayList,e=0;e<c;e++)if(e in this._data){var g=this._data[e];a.call(b,g,e,this._data)&&d.add(g)}return d};js.$public.every=function(a,b){var c=this._data.length;if("function"!=typeof a)throw new TypeError;for(var d=0;d<c;d++)if(d in this._data&&!a.call(b,this._data[d],d,this._data))return!1;return!0};js.$public.remove=function(a){a=this.indexOf(a);return 0<=a?(this._data.splice(a,1),a):-1};js.$public.removeAt=
function(a){if(!(0<=a&&a<this._data.length))throw Error("IndexOutOfBoundsException");var b=this._data[a];this._data.splice(a,1);return b};js.$public.removeRange=function(a,b){if(!(0<=a&&a<this._data.length))throw Error("IndexOutOfBoundsException");if(!(0<=b&&b<this._data.length))throw Error("IndexOutOfBoundsException");this._data.splice(a,b-a)};js.$public.set=function(a,b){if(!(0<=a&&a<this._data.length))throw Error("IndexOutOfBoundsException");var c=this._data[a];this._data[a]=b;return c};js.$public.length=
function(){return this._data.length};js.$public.size=function(){return this._data.length};js.$public.toArray=function(){return this._data}});js.$class("qs.Map",function(){this.initialize=function(){this._map={};this._size=0};js.$public.clear=function(){for(var a in this._map)delete this._map[a];this._map={};this._size=0};js.$public.containsKey=function(a){a=f.hash(a);return this._map[a]?!0:!1};js.$public.containsValue=function(a){for(var b in this._map)if(this._map[b].value===a)return!0;return!1};
js.$public.get=function(a){a=f.hash(a);return(a=this._map[a])?a.value:null};js.$public.isEmpty=function(){return 0==_size};js.$public.keyList=function(){var a=new f.ArrayList,b;for(b in this._map)a.add(this._map[b].key);return a};js.$public.put=function(a,b){var c=f.hash(a),d=this._map[c];this._map[c]={key:a,value:b};if(d)return d;this._size++;return null};js.$public.putAll=function(a){if(!js.instanceOf(a,f.Map))throw new TypeError;a.forEach(function(a,c){this.put(a,c)},this)};js.$public.remove=function(a){a=
f.hash(a);var b=this._map[a];return b?(this._size--,delete this._map[a],b.value):null};js.$public.size=function(){return this._size};js.$public.values=function(){var a=new f.ArrayList,b;for(b in this._map)a.add(this._map[b].value);return a};js.$public.forEach=function(a,b){if("function"!=typeof a)throw new TypeError;var c,d;for(d in this._map)c=this._map[d],a.call(b,c.key,c.value,this._map)}})})(qs,jQuery);(function(f,l){function a(a){return a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName}var b="Msxml2.DOMDocument.6.0 Msxml2.DOMDocument.5.0 Msxml2.DOMDocument.4.0 Msxml2.DOMDocument.3.0 MSXML2.DOMDocument MSXML.DOMDocument Microsoft.XMLDOM".split(" "),c=!1,d;if(!0==l.browser.msie)d=function(a){var c;c=null;for(var d=0;d<b.length;d++)try{c=new ActiveXObject(b[d]);break}catch(e){}c.loadXML(a);if(0!=c.parseError)throw Error("XML \u89e3\u6790\u9519\u8bef\uff1a"+c.parseError.reason);
return c.documentElement?c:null},c=!0;else if("undefined"!=typeof window.DOMParser){var e=new window.DOMParser;d=function(a){a=e.parseFromString(a,"text/xml");var c=a.getElementsByTagName("parsererror");if(c.length)throw Error("XML \u89e3\u6790\u9519\u8bef\uff1a"+c[0].textContent);return a}}else throw Error("No XML parser found");f.Xml=function(c,b){b=js.param(b,null);if("string"==typeof c)this._node=d(c).documentElement;else if(a(c))this._node=c;else throw Error("\u65e0\u6548\u53c2\u6570");this._document=
this._node.ownerDocument;this._queryDocument=this._node.ownerDocument.evaluate?this._node.ownerDocument:document;this._children=null;this._parent=b;this.attributes=this._node.attributes;return this};f.Xml.prototype.copy=function(){return new f.Xml(this._node.cloneNode(!0))};f.Xml.prototype.clone=function(){return new f.Xml(this._node.cloneNode(!0))};f.Xml.prototype.node=function(){return this._node};f.Xml.prototype.attr=function(a,c){if(void 0===c)return this._node.getAttribute(a)||"";null==c||""==
c?this._node.removeAttribute(a):this._node.setAttribute(a,c);return this};f.Xml.prototype.has=function(a){return c?(a=this._node.getAttribute(a),null==a||""==a||void 0==a?!1:!0):this._node.hasAttribute(a)};f.Xml.prototype.append=function(c){this._children=null;if("string"==typeof c)return c=this._document.createElement(c),this._node.appendChild(c),new f.Xml(c,this);if(c instanceof f.Xml)return this._node.appendChild(c._node),c;if(a(c))return this._node.appendChild(c),new f.Xml(c,this);throw Error("\u65e0\u6548\u53c2\u6570");
};f.Xml.prototype.insertBefore=function(c,b){b instanceof f.Xml&&(b=b._node);this._children=null;if("string"==typeof c){var d=this._document.createElement(c);this._node.insertBefore(d,b);return new f.Xml(d,this)}if(c instanceof f.Xml)return this._node.insertBefore(c._node,b),c;if(a(c))return this._node.insertBefore(c,b),new f.Xml(c,this);throw Error("\u65e0\u6548\u53c2\u6570");};f.Xml.prototype.insertAfter=function(c,b){if(!(b instanceof f.Xml))throw Error("\u65e0\u6548\u53c2\u6570");if("string"==
typeof c){var d=this._document.createElement(c);c=new f.Xml(d,this)}else if(a(c))c=new f.Xml(c,this);else if(!(c instanceof f.Xml))throw Error("\u65e0\u6548\u53c2\u6570");var d=this.children(),e=d.indexOf(b);-1==e||e==d.length-1?this.append(c):this.insertBefore(c,d[e+1])};f.Xml.prototype.create=function(a){a=this._document.createElement(a);return new f.Xml(a)};f.Xml.prototype.remove=function(){if(c||"function"!=js.type(this._node.remove)){var a=this._node.parentNode;null!=a&&void 0!=a&&a.removeChild(this._node)}else this._node.remove();
js.isNull(this._parent)||(null!=this._parent._children&&(a=this._parent._children.indexOf(this),-1!=a&&this._parent._children.splice(a,1)),this._parent=null)};f.Xml.prototype.parent=function(){js.instanceOf(this._parent,f.Xml)||(this._parent=new f.Xml(this._node.parentNode));return this._parent};f.Xml.prototype.children=function(a){if(void 0===a&&null!=this._children)return this._children;for(var b,d,e=[],l=0;l<this._node.childNodes.length;l++)b=this._node.childNodes[l],4!==b.nodeType&&3!==b.nodeType&&
1===b.nodeType&&(void 0===a?e.push(new f.Xml(b,this)):(d=c?b.baseName:b.localName,a==d&&e.push(new f.Xml(b,this))));void 0===a&&(this._children=e);return e};f.Xml.prototype.xpath=function(a){if(c){a=this._node.selectNodes(a);for(var b=[],d;null!=(d=a.nextNode());)b.push(new f.Xml(d))}else for(a=this._queryDocument.evaluate(a,this._node,null,0,null),b=[],d=a.iterateNext();d;)b.push(new f.Xml(d)),d=a.iterateNext();return b};f.Xml.prototype.name=function(a){if(void 0===a)return js.isNull(this._name)?
c?this._node.baseName:this._node.localName:this._name;this._name=a};f.Xml.prototype.nsURI=function(){return this._node.namespaceURI};f.Xml.prototype.text=function(a){if(void 0===a)return c?this._node.text:this._node.textContent;c?this._node.text=a:this._node.textContent=a};f.Xml.prototype._fetch=function(){var a;this._text="";this._children=[];for(var c=0;c<this._node.childNodes.length;c++)a=this._node.childNodes[c],4===a.nodeType?this._text+=a.nodeValue:3===a.nodeType?this._text+=a.nodeValue.trim():
1===a.nodeType&&this._children.push(new f.Xml(a,this))};f.Xml.prototype.toString=function(){return c?this._node.xml:(new XMLSerializer).serializeToString(this._node)};f.Xml.prototype.toJSON=function(a){a=l.extend({deep:!0,childArray:!1},a);for(var c={},b,d=0;d<this.attributes.length;d++)b=this.attributes[d],"xmlns"!=b.prefix&&(c[b.name]=b.value);if(!a.deep)return c;b=this.children();for(var e,f,d=0;d<b.length;d++)e=b[d],f=e.name(),void 0===c[f]?c[f]=a.childArray?[e.toJSON(a)]:e.toJSON(a):("array"!=
js.type(c[f])&&(c[f]=[c[f]]),c[f].push(e.toJSON(a)));return c}})(qs,jQuery);(function(f,l){js.$class("qs.Timer",f.events.EventDispatcher,function(){f.events.register("timer",this);js.$static.TIMER="timer";this._dely=1E3;this._timerId=0;this.initialize=function(a){this.$super();this._dely=a};js.$public.dely=function(a){if(void 0===a)return this._dely;this._dely=a};js.$public.start=function(){var a=this;this._timerId=window.setTimeout(function(){a.dispatchEvent(f.Timer.TIMER)},this._dely)};js.$public.stop=function(){0!=this._timerId&&window.clearTimeout(this._timerId)};js.$static.callLater=
function(a,b,c){a=js.param(a,1);var d=Array.prototype.slice.call(arguments,3);window.setTimeout(function(){b.apply(c,d)},a)}})})(qs,jQuery);(function(f,l){var a={cookie:{},initCookie:function(){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("\x3d");if(null==a.cookie[d[0]]||void 0==a.cookie[d[0]])a.cookie[d[0]]=unescape(d[1])}},getCookie:function(b){return a.cookie[b]},setCookie:function(b,c){a.cookie[b]=c;var d=arguments,e=arguments.length,g=2<e?d[2]:null,f=3<e?d[3]:null,m=4<e?d[4]:null,d=5<e?d[5]:!1;null==f&&(f=new Date(3E3,1,1));document.cookie=b+"\x3d"+escape(c)+(null==f?"":"; expires\x3d"+f.toGMTString())+
(null==g?"":"; path\x3d"+g)+(null==m?"":"; domain\x3d"+m)+(!0==d?"; secure":"")},deleteCookie:function(b){document.cookie=b+"\x3dnull; expires\x3dFri, 31 Dec 1099 23:59:59 GMT;";delete a.cookie[b]},get:function(b){var c;window.localStorage&&(c=window.localStorage[b]);c||"null"==c||(c=a.getCookie(b));return c},set:function(b,c){window.localStorage&&(window.localStorage[b]=c);a.setCookie(b,c)},del:function(b){window.localStorage&&delete window.localStorage[b];a.deleteCookie(b)}};a.initCookie();f.Storage=
a})(qs,jQuery);(function(f,l){var a="zh_CN",b={},c={};js.$class("qs.I18N",function(){this.initialize=function(){};js.$static.setLocale=function(c){a=c};js.$static.addResource=function(a,c){var g=b[a];void 0===g&&(g={},b[a]=g);for(var f in c)g[f]=c[f]};js.$static.getString=function(c){var e=b[a];if(void 0===e)return c;e=e[c];if(void 0===e)return c;for(var g=1;g<arguments.length;g++)void 0!=arguments[g]&&(e=e.replace(RegExp("({)"+(g-1)+"(})","g"),arguments[g]));return e};js.$static.getObject=function(d){var e=b[a];
if(void 0===e)return null;e=e[d];if(void 0===e)return null;if(c[a]&&c[a][d])return c[a][d];e=JSON.parse(e);c[a]||(c[a]={});return c[a][d]=e}})})(qs,jQuery);(function(f,l){function a(a){return{$element:function(){return a},minContentSize:function(){return a.minSize()},maxContentSize:function(){return a.maxSize()},minSize:function(){var b=a.minContentSize(),e=a.bording(),g=a.margin(),f=a.padding(),m=g.top+g.bottom+e.top+e.bottom+f.top+f.bottom;b.width+=g.left+g.right+e.left+e.right+f.left+f.right;b.height+=m;return b},maxSize:function(){var b=a.maxContentSize(),e=a.bording(),g=a.margin(),f=a.padding(),m=g.top+g.bottom+e.top+e.bottom+f.top+f.bottom;b.width+=
g.left+g.right+e.left+e.right+f.left+f.right;b.height+=m;return b},contentSize:function(b){if(void 0===b)return{width:a.width(),height:a.height()};void 0!==b.width&&a.width(b.width);void 0!==b.height&&a.height(b.height)},outerSize:function(){return{width:a.outerWidth(!0),height:a.outerHeight(!0)}},padding:function(){return a.padding()},preferredSize:function(b,e){var g={width:a.outerWidth(!0),height:a.outerHeight(!0)},f=a.minSize(),m=a.maxSize();g.width=Math.min(Math.max(f.width,g.width),m.width);
g.height=Math.min(Math.max(f.height,g.height),m.height);return g},visible:function(){return a.isVisible()},data:function(b){return a.data(b)}}}f.layout={};js.$class("qs.layout.Layout",function(){this.initialize=function(a){this._children=new f.ArrayList;this.container(a)};js.$public.children=function(){return this._children};js.$public.container=function(c){if(void 0===c)return this._container;this._container=c instanceof f.ui.Control?c:c instanceof jQuery?a(c):a(l(c))};js.$public.addChild=function(c){c instanceof
f.ui.Control?this._children.contains(c)||this._children.add(c):(c=c instanceof jQuery?c[0]:c,this._children.forEach(function(a){a.$element()}),this._children.add(a(l(c))))};js.$public.removeChild=function(a){if(a instanceof f.ui.Control)this._children.remove(a);else{var b;b=a instanceof jQuery?a[0]:a;this._children.forEach(function(a,c){a.$element()[0]==b&&this._children.removeAt(c)},this)}};js.$public.removeAllChildren=function(){this._children.clear()};js.$public.doLayout=function(){};this.getChildLayout=
function(a){a=a.data("layout");var b=this._container.data("layout");return"object"!=js.type(b.innerLayout)?a:a=l.extend({},b.innerLayout,a)};js.$public.getWidthRatio=function(a){a=this.getChildLayout(a);var b=-1;return a&&a.width&&-1!=(b=String(a.width).indexOf("*"))?parseInt(String(a.width).substring(0,b))||1:a&&a.width&&-1!=(b=String(a.width).indexOf("%"))?parseInt(String(a.width).substring(0,b))||1:-1};js.$public.getHeightRatio=function(a){a=this.getChildLayout(a);var b=-1;return a&&a.height&&
-1!=(b=String(a.height).indexOf("*"))?parseInt(String(a.height).substring(0,b))||1:a&&a.height&&-1!=(b=String(a.height).indexOf("%"))?parseInt(String(a.height).substring(0,b))||1:-1};js.$public.getLayoutWidth=function(a,b){var e=this.getChildLayout(a);if(e&&e.width){if("100%"===e.width)return b;if(-1!=String(e.width).indexOf("%")){if(e=String(e.width),e=parseInt(e.substring(0,e.length-1)),!isNaN(e))return Math.round(b*e/100)}else if(NumberUtil.isNumber(e.width))return e.width}return NaN};js.$public.getLayoutHeight=
function(a,b){var e=this.getChildLayout(a);if(e&&e.height){if("100%"===e.height)return b;if(-1!=String(e.height).indexOf("%")){if(e=String(e.height),e=parseInt(e.substring(0,e.length-1)),!isNaN(e))return Math.round(b*e/100)}else if(NumberUtil.isNumber(e.height))return e.height}return NaN};js.$public.doContainerSize=function(a,b){var e=this._container.data("layout"),g=this._container.minContentSize(),f=this._container.maxContentSize();void 0!==e&&("auto"===e.width||void 0===e.width)&&isNaN(this._container.width())&&
0<a&&(a=Math.min(Math.max(g.width,a),f.width),this._container.$element().width(a));void 0!==e&&("auto"===e.height||void 0===e.height)&&isNaN(this._container.height())&&0<b&&(b=Math.min(Math.max(g.height,b),f.height),this._container.$element().height(b))}});var b=function(a){return parseInt(a,10)||0};l.each(["min","max"],function(a,d){l.fn[d+"Size"]=function(a){var c;if(a)return void 0!==a.width&&this.css(d+"-width",a.width),void 0!==a.height&&this.css(d+"-height",a.height),this;a=this.css(d+"-width");
c=this.css(d+"-height");return{width:"max"===d&&(void 0===a||"none"===a||-1===b(a))&&Number.MAX_VALUE||b(a),height:"max"===d&&(void 0===c||"none"===c||-1===b(c))&&Number.MAX_VALUE||b(c)}}});l.fn.isVisible=function(){return this.is(":visible")};l.each(["border","margin","padding"],function(a,d){l.fn[d]=function(a){return a?(void 0!==a.top&&this.css(d+"-top"+("border"===d?"-width":""),a.top),void 0!==a.bottom&&this.css(d+"-bottom"+("border"===d?"-width":""),a.bottom),void 0!==a.left&&this.css(d+"-left"+
("border"===d?"-width":""),a.left),void 0!==a.right&&this.css(d+"-right"+("border"===d?"-width":""),a.right),this):{top:b(this.css(d+"-top"+("border"===d?"-width":""))),bottom:b(this.css(d+"-bottom"+("border"===d?"-width":""))),left:b(this.css(d+"-left"+("border"===d?"-width":""))),right:b(this.css(d+"-right"+("border"===d?"-width":"")))}}})})(qs,jQuery);(function(f,l){js.$class("qs.layout.FlowLayout",f.layout.Layout,function(){this.initialize=function(a){this.$super(a)};js.$static.type=function(){return"flow"};this.alignRow=function(a,b,c,d,e,g,k,m){m=b.x;var n=b.y,l=0,q=a.length;switch(e){case "center":m+=(k+d.width-c.width)/2;break;case "right":m+=d.width-c.width+k}for(var s;l<q;l+=1){n=b.y;a[l].left(m);e=(d=a[l].data("layout"))&&d.vAlign?d.vAlign:g;s=a[l].outerSize();switch(e){case "middle":a[l].top(n+(c.height-s.height)/2);break;case "bottom":a[l].top(n+
(c.height-s.height));break;default:a[l].top(n)}m+=s.width+k;"function"==f.type(a[l].doLayout)&&d&&"auto"!=d.width&&"auto"!=d.height&&a[l].doLayout()}};js.$public.doLayout=function(){var a=this._container.contentSize(),b=this._container.padding(),c={x:b.left,y:b.top},b=b.left;this._container instanceof f.ui.Control&&(c={x:0,y:0},b=0);var d,e,g=0,k=0,k=[],m={width:0,height:0};d=this._container.data("layout");var n=0,l=0,q="left",s="top";void 0!==d&&null!==d&&(d.hGap&&(n=NumberUtil.toInt(d.hGap)),d.vGap&&
(l=NumberUtil.toInt(d.vGap)),d.hAlign&&(q=d.hAlign),d.vAlign&&(s=d.vAlign),d.innerLayout&&(d.innerLayout.hAlign&&(q=d.innerLayout.hAlign),d.innerLayout.vAlign&&(s=d.innerLayout.vAlign)));for(var r=0;r<this._children.size();r++)if(d=this._children.get(r),d.visible()){e={};if(isNaN(d.width())){var t=this.getLayoutWidth(d,a.width);isNaN(t)||(e.width=t)}isNaN(d.height())&&(t=this.getLayoutHeight(d,a.height),isNaN(t)||(e.height=t));d.outerSize(e);"function"==f.type(d.doLayout)&&((e=d.data("layout"))&&
"auto"==e.width||"auto"==e.height)&&d.doLayout();e=d.preferredSize(a.width,a.height);d.outerSize(e);0<k.length&&m.width+e.width>a.width&&(this.alignRow(k,c,m,a,q,s,n,l),g=Math.max(g,m.width+e.width),k=[],c.y+=m.height+l,c.x=b,m.width=0,m.height=0);m.height=Math.max(m.height,e.height);m.width+=e.width+n;k.push(d)}this.alignRow(k,c,m,a,q,s,n,l);k=c.y+m.height;this.doContainerSize(g,k)}})})(qs,jQuery);(function(f,l){js.$class("qs.layout.HLayout",f.layout.Layout,function(){this.initialize=function(a){this.$super(a)};js.$static.type=function(){return"horizontal"};js.$public.doLayout=function(){var a=this._container.contentSize(),b=this._container.padding(),c=b.left,d=b.top;this._container instanceof f.ui.Control&&(d=c=0);var e,g,k=b=0,m=[],n=[];e=this._container.data("layout");var l=0,q="left",s="top";void 0!==e&&null!==e&&(e.hGap&&(l=NumberUtil.toInt(e.hGap)),e.hAlign&&(q=e.hAlign),e.vAlign&&(s=
e.vAlign),e.innerLayout&&(e.innerLayout.hAlign&&(q=e.innerLayout.hAlign),e.innerLayout.vAlign&&(s=e.innerLayout.vAlign)));for(var r,t=0,v=0;v<this._children.size();v++)e=this._children.get(v),e.visible()&&(g={},r=this.getWidthRatio(e),0<r?(n.push(e),m[v]={item:e,ratio:r},t+=r):(isNaN(e.width())&&(r=this.getLayoutWidth(e,a.width),isNaN(r)||(g.width=r)),isNaN(e.height())&&(r=this.getLayoutHeight(e,a.height),isNaN(r)||(g.height=r)),e.outerSize(g),"function"==f.type(e.doLayout)&&((g=e.data("layout"))&&
"auto"==g.width||"auto"==g.height)&&e.doLayout(),g=e.preferredSize(a.width,a.height),m[v]={size:g,item:e},k=Math.max(k,g.height),b+=g.width+l));n=Math.max(0,a.width-b)-Math.max(0,n.length-1)*l;if(0==t)switch(q){case "center":c+=Math.max(0,(l+a.width-b)/2);break;case "right":c+=Math.max(0,a.width-b+l)}for(v=0;v<this._children.size();v++)if(m[v]){q=m[v].item;0<m[v].ratio&&(g=q.outerSize(),g.width=n/t*m[v].ratio,isNaN(q.height())&&(r=this.getLayoutHeight(q,a.height),isNaN(r)||(g.height=r)),q.outerSize(g),
m[v].size=g);q.left(c);r=(e=q.data("layout"))&&e.vAlign?e.vAlign:s;g=m[v].size;switch(r){case "middle":q.top(d+Math.max(0,(a.height-g.height)/2));break;case "bottom":q.top(d+Math.max(0,a.height-g.height));break;default:q.top(d)}c+=g.width+l;"function"==f.type(q.doLayout)&&e&&"auto"!=e.width&&"auto"!=e.height&&q.doLayout()}this.doContainerSize(b,k)}})})(qs,jQuery);(function(f,l){js.$class("qs.layout.VLayout",f.layout.Layout,function(){this.initialize=function(a){this.$super(a)};js.$static.type=function(){return"vertical"};js.$public.doLayout=function(){var a=this._container.contentSize(),b=this._container.padding(),c=b.left,d=b.top;this._container instanceof f.ui.Control&&(d=c=0);var e,g,k=b=0,m=[],n=[];e=this._container.data("layout");var l=0,q="left",s="top";void 0!==e&&null!==e&&(e.vGap&&(l=NumberUtil.toInt(e.vGap)),e.hAlign&&(q=e.hAlign),e.vAlign&&(s=e.vAlign),
e.innerLayout&&(e.innerLayout.hAlign&&(q=e.innerLayout.hAlign),e.innerLayout.vAlign&&(s=e.innerLayout.vAlign)));for(var r,t=0,v=0;v<this._children.size();v++)e=this._children.get(v),e.visible()&&(g={},r=this.getHeightRatio(e),0<r?(n.push(e),m[v]={item:e,ratio:r},t+=r):(isNaN(e.width())&&(r=this.getLayoutWidth(e,a.width),isNaN(r)||(g.width=r)),isNaN(e.height())&&(r=this.getLayoutHeight(e,a.height),isNaN(r)||(g.height=r)),e.outerSize(g),"function"==f.type(e.doLayout)&&((g=e.data("layout"))&&"auto"==
g.width||"auto"==g.height)&&e.doLayout(),g=e.preferredSize(a.width,a.height),m[v]={size:g,item:e},b=Math.max(b,g.width),k+=g.height+l));n=Math.max(0,a.height-k)-Math.max(0,n.length-1)*l;if(0==t)switch(s){case "middle":d+=Math.max(0,(l+a.height-k)/2);break;case "bottom":d+=Math.max(0,a.height-k+l)}for(v=0;v<this._children.size();v++)if(m[v]){s=m[v].item;0<m[v].ratio&&(g=s.outerSize(),g.height=n/t*m[v].ratio,isNaN(s.width())&&(r=this.getLayoutWidth(s,a.width),isNaN(r)||(g.width=r)),s.outerSize(g),m[v].size=
g);s.top(d);r=(e=s.data("layout"))&&e.hAlign?e.hAlign:q;g=m[v].size;switch(r){case "center":s.left(c+Math.max(0,(a.width-g.width)/2));break;case "right":s.left(c+Math.max(0,a.width-g.width));break;default:s.left(c)}d+=g.height+l;"function"==f.type(s.doLayout)&&e&&"auto"!=e.width&&"auto"!=e.height&&s.doLayout()}this.doContainerSize(b,k)}})})(qs,jQuery);(function(f,l){js.$class("qs.layout.GridLayout",f.layout.Layout,function(){this.initialize=function(a){this.$super(a)};js.$static.type=function(){return"grid"};this.applyDefinition=function(a){this.vGap=this.hGap=0;this.hAlign="left";this.vAlign="top";this.columns=[];this.rows=[];void 0!==a&&null!==a&&(a.hGap&&(this.hGap=NumberUtil.toInt(a.hGap)),a.vGap&&(this.vGap=NumberUtil.toInt(a.vGap)),a.hAlign&&(this.hAlign=a.hAlign),a.vAlign&&(this.vAlign=a.vAlign),a.innerLayout&&(a.innerLayout.hAlign&&(this.hAlign=
a.innerLayout.hAlign),a.innerLayout.vAlign&&(this.vAlign=a.innerLayout.vAlign)),a.columns&&(this.columns=a.columns),a.rows&&(this.rows=a.rows))};this.getRatio=function(a){var b=-1;return-1!=(b=String(a).indexOf("*"))?parseInt(String(a).substring(0,b))||1:-1};this.getLayoutValue=function(a,b){if("100%"===a)return b;if(-1!=String(a).indexOf("%")){var c=String(a),c=parseInt(c.substring(0,c.length-1));if(!isNaN(c))return b*c/100}else if(NumberUtil.isNumber(a))return Number(a);return NaN};js.$public.doLayout=
function(){this._maxHeight=this._maxWidth=0;var a=this._container.contentSize(),b=this._container.data("layout");this.applyDefinition(b);var c=this._container.padding(),b=c.left,c=c.top;this._container instanceof f.ui.Control&&(c=b=0);var d,e,g=e=0,k,m=0,n=0,l=[],q=[],s=!1,r=a.height;d=r;if(0<this.rows.length){d=r=a.height-(this.rows.length-1)*this.vGap;for(var t=0;t<this.rows.length;t++)k=this.rows[t],l[t]={},"object"===f.type(k)?(g=this.getLayoutValue(k.height,r),k.vAlign&&(l[t].vAlign=k.vAlign)):
g=this.getLayoutValue(k,r),isNaN(g)?-1!=(k=this.getRatio(this.rows[t]))?(l[t].ratio=k,n+=k):(l[t].height=0,s=l[t].auto=!0):(l[t].height=g,d-=g);e=c;for(t=0;t<l.length;t++)0<l[t].ratio&&(l[t].height=Math.round(d/n*l[t].ratio)),l[t].y=e,e+=l[t].height+this.vGap}else l[0]={y:c,height:a.height};d=g=a.width;if(0<this.columns.length){d=g=a.width-(this.columns.length-1)*this.hGap;for(t=0;t<this.columns.length;t++)q[t]={},k=this.columns[t],"object"===f.type(k)?(e=this.getLayoutValue(k.width,g),k.hAlign&&
(q[t].hAlign=k.hAlign)):e=this.getLayoutValue(k,g),isNaN(e)?-1!=(k=this.getRatio(this.columns[t]))?(q[t].ratio=k,m+=k):(q[t].width=0,s=q[t].auto=!0):(q[t].width=e,d-=e);e=b;for(t=0;t<q.length;t++)0<q[t].ratio&&(q[t].width=Math.round(d/m*q[t].ratio)),q[t].x=e,e+=q[t].width+this.hGap}else q[0]={x:b,width:a.width};k=[];for(var v,t=0;t<this._children.size();t++)d=this._children.get(t),d.visible()&&(v=this.getGridData(d),k[t]=v,s?((!0==l[v.rowIndex].auto||!0==q[v.colIndex].auto&&js.instanceOf(d,f.ui.Container))&&
d.invalidateSize(!0),e=d.preferredSize(a.width,a.height),0<e.width||(e.width=0),0<e.height||(e.height=0),1==v.rowSpan&&!0==l[v.rowIndex].auto&&(l[v.rowIndex].height=Math.max(l[v.rowIndex].height,e.height)),1==v.colSpan&&!0==q[v.colIndex].auto&&(q[v.colIndex].width=Math.max(q[v.colIndex].width,e.width)),v.size=e):(e=this.getGridSize(l,q,v),this.doChildSize(d,e,v,l,q)));if(s){e=c;d=r;for(t=0;t<l.length;t++)l[t].ratio||(d-=l[t].height);for(t=0;t<l.length;t++)0<l[t].ratio&&(l[t].height=Math.round(d/n*
l[t].ratio)),l[t].y=e,e+=l[t].height+this.vGap;e=b;d=g;for(t=0;t<q.length;t++)q[t].ratio||(d-=q[t].width);for(t=0;t<q.length;t++)0<q[t].ratio&&(q[t].width=Math.round(d/m*q[t].ratio)),q[t].x=e,e+=q[t].width+this.hGap;for(t=0;t<this._children.size();t++)d=this._children.get(t),d.visible()&&(v=k[t],e=this.getGridSize(l,q,v),this.doChildSize(d,e,v,l,q))}this.doContainerSize(this._maxWidth,this._maxHeight)};this.doChildSize=function(a,b,c,d,e){var g=0,f=0,g=e[c.colIndex].x,f=d[c.rowIndex].y,m=b.width,
n=b.height,l=a.data("layout"),q;q=l&&l.vAlign?l.vAlign:d[c.rowIndex].vAlign?d[c.rowIndex].vAlign:this.vAlign;if(!0==d[c.rowIndex].auto||"auto"==c.height){switch(q){case "middle":f+=Math.max((n-c.size.height)/2,0);break;case "bottom":f+=Math.max(n-c.size.height,0)}n=c.size.height}else switch(n=this.getLayoutValue(c.height,b.height),isNaN(n)&&(n=b.height),q){case "middle":f+=Math.max((b.height-n)/2,0);break;case "bottom":f+=Math.max(b.height-n,0)}q=l&&l.hAlign?l.hAlign:e[c.colIndex].hAlign?e[c.colIndex].hAlign:
this.hAlign;if(!0==e[c.colIndex].auto||"auto"==c.width){switch(q){case "center":g+=Math.max((m-c.size.width)/2,0);break;case "right":g+=Math.max(m-c.size.width,0)}m=c.size.width}else switch(m=this.getLayoutValue(c.width,b.width),isNaN(m)&&(m=b.width),q){case "center":g+=Math.max((b.width-m)/2,0);break;case "right":g+=Math.max(b.width-m,0)}a.left(g);a.top(f);a.outerSize({width:m,height:n});this._maxWidth=Math.max(this._maxWidth,g+m);this._maxHeight=Math.max(this._maxHeight,f+n)};this.getGridSize=function(a,
b,c){for(var d={width:0,height:0},e=0;e<c.colSpan;e++)d.width+=b[c.colIndex+e].width;d.width+=(c.colSpan-1)*this.hGap;for(e=0;e<c.rowSpan;e++)d.height+=a[c.rowIndex+e].height;d.height+=(c.rowSpan-1)*this.vGap;return d};this.getGridData=function(a){var b=a.data("layout");if(void 0===b||null===b)b={};var c={rowIndex:0,colIndex:0,rowSpan:1,colSpan:1};b&&b.rowIndex&&NumberUtil.isNumber(b.rowIndex)&&(c.rowIndex=Math.max(0,Math.min(b.rowIndex,this.rows.length-1)));b&&b.colIndex&&NumberUtil.isNumber(b.colIndex)&&
(c.colIndex=Math.max(0,Math.min(b.colIndex,this.columns.length-1)));b&&b.rowSpan&&NumberUtil.isNumber(b.rowSpan)&&(c.rowSpan=Math.max(1,Math.min(b.rowSpan,this.rows.length-c.rowIndex)));b&&b.colSpan&&NumberUtil.isNumber(b.colSpan)&&(c.colSpan=Math.max(1,Math.min(b.colSpan,this.columns.length-c.colIndex)));void 0!==b.width&&(c.width=b.width);isNaN(a.width())||(c.width=a.width());void 0!==b.height&&(c.height=b.height);isNaN(a.height())||(c.height=a.height());return c}})})(qs,jQuery);(function(){window.StringUtil||(window.StringUtil={});StringUtil.join=function(){return Array.prototype.slice.call(arguments,0).join("")};StringUtil.isEmpty=function(a){return null==a||void 0==a||0==a.length?!0:!1};StringUtil.format=function(a,b){var c=a||"";if(1<arguments.length)if(2==arguments.length&&"object"==typeof b)for(var d in b){if(void 0!=b[d])var e=RegExp("({"+d+"})","g"),c=c.replace(e,b[d])}else for(d=1;d<arguments.length;d++)void 0!=arguments[d]&&(e=RegExp("({)"+d+"(})","g"),c=c.replace(e,
arguments[d]));return c};StringUtil.equalsIgnoreCase=function(a,b){return a.toLowerCase()==b.toLowerCase()};StringUtil.equals=function(a,b){return a==b};StringUtil.isEmail=function(a){if(null==a)return!1;a=StringUtil.trim(a);return null==/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.exec(a)?!1:!0};StringUtil.isNumber=function(a){return null==a?!1:!isNaN(Number(a))};StringUtil.isDouble=function(a){a=StringUtil.trim(a);return null==/^[-\+]?\d+(\.\d+)?$/.exec(a)?!1:!0};StringUtil.isInteger=
function(a){if(null==a)return!1;a=StringUtil.trim(a);return null==/^[-\+]?\d+$/.exec(a)?!1:!0};StringUtil.isEnglish=function(a){if(null==a)return!1;a=StringUtil.trim(a);return null==/^[A-Za-z]+$/.exec(a)?!1:!0};StringUtil.isChinese=function(a){if(null==a)return!1;a=StringUtil.trim(a);return null==/^[\u0391-\uFFE5]+$/.exec(a)?!1:!0};StringUtil.isDoubleChar=function(a){if(null==a)return!1;a=StringUtil.trim(a);return null==/^[^\x00-\xff]+$/.exec(a)?!1:!0};StringUtil.hasChineseChar=function(a){if(null==
a)return!1;a=StringUtil.trim(a);return null==/[^\x00-\xff]/.exec(a)?!1:!0};StringUtil.isURL=function(a){if(null==a)return!1;a=StringUtil.trim(a).toLowerCase();return null==/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/.exec(a)?!1:!0};StringUtil.isWhitespace=function(a){switch(a){case " ":case "\t":case "\r":case "\n":case "\f":return!0;default:return!1}};StringUtil.trim=function(a){return null==a?null:a.replace(/(^\s*)|(\s*$)/g,"")};StringUtil.ltrim=function(a){return null==
a?null:a.replace(/^\s*/,"")};StringUtil.rtrim=function(a){return null==a?null:a.replace(/\s*$/,"")};StringUtil.beginWith=function(a,b){return b==a.substring(0,b.length)};StringUtil.endWith=function(a,b){return b==a.substring(a.length-b.length)};StringUtil.remove=function(a,b){return StringUtil.replace(a,b,"")};StringUtil.replace=function(a,b,c){return a.split(b).join(c)};StringUtil.utf16to8=function(a){for(var b=[],c=a.length,d=0;d<c;d++){var e=a.charCodeAt(d);b[d]=1<=e&&127>=e?a.charAt(d):2047<e?
String.fromCharCode(224|e>>12&15,128|e>>6&63,128|e>>0&63):String.fromCharCode(192|e>>6&31,128|e>>0&63)}return b.join("")};StringUtil.utf8to16=function(a){for(var b=[],c=a.length,d=0,e,g;d<c;){var f=a.charCodeAt(d++);switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b[b.length]=a.charAt(d-1);break;case 12:case 13:e=a.charCodeAt(d++);b[b.length]=String.fromCharCode((f&31)<<6|e&63);break;case 14:e=a.charCodeAt(d++),g=a.charCodeAt(d++),b[b.length]=String.fromCharCode((f&15)<<12|(e&
63)<<6|(g&63)<<0)}}return b.join("")};StringUtil.upcaseRMB=function(a){var b=["\u5706","\u89d2","\u5206","\u5398","\u6beb"],c=[" ","\u62fe","\u4f70","\u4edf"];c[0]="";var d=[" ","\u4e07","\u4ebf","\u5146"];d[0]="";var e="\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396".split(""),g=String(a),f=g.indexOf("."),m=["",""],m=0<=f?[g.substr(0,f),g.substr(f+1)]:[g,""],g=[];if(16<m[0].length)throw Error("\u91d1\u989d\u592a\u5927:"+a);var n,l,q,s,r,t,v=-1;if(m[0])for(a=m[0],l=a.length,s=l-1,r=
0,t=d.length;0<=s;)q=parseInt(a.substr(s,1)),f=l-s-1,n="",0<f&&0==f%4&&(n=d[++r%t],0<v&&1<f-v&&(n+="\u96f6"),v=-1),0!=q?0<v&&1<f-v?g.push(e[q]+c[f%4]+n+"\u96f6"):g.push(e[q]+c[f%4]+n):g.push(n),0!=q&&(v=f),s--;g.reverse();0<g.join("").length&&g.push("\u5706");if(m[1])for(a=m[1],s=0,l=a.length,l>b.length-1&&(l=b.length-1);s<l;)q=parseInt(a.substr(s,1)),g.push(e[q]+b[s+1]),s++;else g.push("\u6574");return g.join("").replace(/\u96f6{2,}/g,"\u96f6")};var f="zero one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen  twenty thirty forty fifty sixty seventy eighty ninety hundred  thousand million billion trillion quadrillion quintillion".split(" "),
l=[];StringUtil.toEnglish=function(a){var b;if(0==l.length)for(b=0;1E3>b;b++)l[b]=20>b?f[b]:100>b?f[19+Math.floor(b/10)]+(0==b%10?"":"-"+l[b%10]):f[Math.floor(b/100)]+" "+f[29]+(0==b%100?"":" and "+l[b%100]);var c="";a=String(a);var d,e;with(a.split(".")[0].split(",").join(""))for(intSec=[],b=0;b<Math.ceil(length/3);b++)e=3,d=length-3*b-3,0>d&&(e+=d,d=0),intSec[b]=substr(d,e),c=(0==b&&0<parseFloat(intSec[b])&&100>parseFloat(intSec[b])&&0<parseInt(substr(0,length-3),10)?" and ":"")+(0==parseFloat(intSec[b])&&
(0<b||0!=toString())?"":l[parseFloat(intSec[b])])+(0==parseFloat(intSec[b])?"":" "+("undefined"==typeof f[30+b]?"":f[30+b]))+(0==b||0==parseFloat(intSec[b])||0<parseFloat(intSec[b])&&""==c?"":", ")+c;if(-1!=a.indexOf("."))with(a.split(".")[1].split(",").join(""))for(decSec=[],b=0;b<length;b++)decSec[b]=substr(b,1),c+=(0==b?(""==c?f[0]:"")+" point ":"")+(0==parseFloat(decSec[b])&&0!=b&&0<!parseFloat(substr(b+1))?"":l[parseFloat(decSec[b])]+" ");return c}})();(function(f,l){f.ui={};f.ui.theme={scrollbar_width:14,scrollbar_capOverlap:12,scrollbar_tailOverlap:9,slider_height:3};var a=l(window);f.ui.windowWidth=function(){return a.width()};f.ui.windowHeight=function(){return a.height()};f.ui.Mouse={};l(document).mousemove(function(a){f.ui.Mouse.x=a.pageX;f.ui.Mouse.y=a.pageY});js.$interface("qs.ui.IContentControl",function(){js.$public.content=function(a){}});js.$interface("qs.ui.ITabView",function(){js.$public.items=function(a){};js.$public.addItem=function(a){};
js.$public.removeItem=function(a){};js.$public.selectedItem=function(a){}});var b=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,d=navigator.userAgent,e={};e.apple={phone:/iPhone/i.test(d),ipod:/iPod/i.test(d),tablet:/iPad/i.test(d)};e.android={phone:b.test(d),tablet:!b.test(d)&&c.test(d)};e.windows={phone:/IEMobile/i.test(d),tablet:/(?=.*\bWindows\b)(?=.*\bARM\b)/i.test(d)};e.other={blackberry:/BlackBerry/i.test(d),opera:/Opera Mini/i.test(d),firefox:/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i.test(d)};
e.isMobile=!1;e.os="unknow";if(e.apple.phone||e.apple.ipod||e.apple.tablet)e.os="iOS",e.isMobile=!0;if(e.android.phone||e.android.tablet)e.os="android",e.isMobile=!0;if(e.windows.phone||e.windows.tablet)e.os="windows",e.isMobile=!0;e.isMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||
navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||
navigator.vendor||window.opera).substr(0,4));f.ui.device=e;l.fn.scrollTo=function(a,c,b){"function"==typeof c&&2==arguments.length&&(b=c,c=a);var d=l.extend({scrollTarget:a,offsetTop:50,duration:500,easing:"swing"},c);return this.each(function(){var a=l(this),c="number"==typeof d.scrollTarget?d.scrollTarget:l(d.scrollTarget),c="number"==typeof c?c:c.offset().top+a.scrollTop()-parseInt(d.offsetTop);a.animate({scrollTop:c},parseInt(d.duration),d.easing,function(){"function"==typeof b&&b.call(this)})})};
var g=1;l.ajaxUpload=function(a){function c(){e.each(function(a,c){var b=l(c);b.data("clone").replaceWith(b)});b.remove();d.one("load",function(){d.remove()});d.attr("src","javascript:false;")}var b,d,e;g++;a=l.extend({type:"POST"},a);return{send:function(){e=a.files;b=l('\x3cform style\x3d"display:none;"\x3e\x3c/form\x3e');d=l('\x3ciframe src\x3d"javascript:false" name\x3d"iframe-ajaxupload-'+g+'"\x3e\x3c/iframe\x3e');d.one("load",function(){l.isArray(a.paramName);d.one("load",function(){var b=(this.contentWindow?
this.contentWindow.document:this.contentDocument?this.contentDocument:this.document).body;c();"function"==js.type(a.complete)&&a.complete(b.textContent||b.innerText,b.innerHTML)});b.prop("target",d.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&l.each(a.formData,function(a,c){l('\x3cinput type\x3d"hidden"/\x3e').prop("name",c.name).val(c.value).appendTo(b)});e&&e.length&&(e.after(function(a){a=l(this);var c=a.clone().prop("disabled",!0);a.data("clone",c);return c}).next(),e.appendTo(b),
b.prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"));b.submit()});b.append(d).appendTo(document.body)},abort:function(){d&&d.unbind("load").prop("src","javascript:false");b&&b.remove()}}};l.fn.extend({getComputedStyle:function(){if(0==this.length)return{};var a=this[0];return window.getComputedStyle?window.getComputedStyle(a):a.currentStyle}})})(qs,jQuery);
(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):"object"===typeof exports?module.exports=f:f(jQuery)})(function(f){function l(a){var b=a||window.event,e=[].slice.call(arguments,1),n=0,l=0,q=0,s=0,s=0;a=f.event.fix(b);a.type="mousewheel";b.wheelDelta&&(n=b.wheelDelta);b.detail&&(n=-1*b.detail);q=n;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(q=0,l=-1*n);b.deltaY&&(n=q=-1*b.deltaY);b.deltaX&&(l=b.deltaX,n=-1*l);void 0!==b.wheelDeltaY&&(q=b.wheelDeltaY);void 0!==b.wheelDeltaX&&
(l=-1*b.wheelDeltaX);s=Math.abs(n);if(!c||s<c)c=s;s=Math.max(Math.abs(q),Math.abs(l));if(!d||s<d)d=s;b=0<n?"floor":"ceil";n=Math[b](n/c);l=Math[b](l/d);q=Math[b](q/d);e.unshift(a,n,l,q);return(f.event.dispatch||f.event.handle).apply(this,e)}var a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],b="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c,d;if(f.event.fixHooks)for(var e=a.length;e;)f.event.fixHooks[a[--e]]=f.event.mouseHooks;
f.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],l,!1);else this.onmousewheel=l},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],l,!1);else this.onmousewheel=null}};f.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});
(function(f){f.fn.caret=function(f){var a=this[0],b="true"===a.contentEditable;if(0==arguments.length){if(window.getSelection){if(b){a.focus();var c=window.getSelection().getRangeAt(0),b=c.cloneRange();b.selectNodeContents(a);b.setEnd(c.endContainer,c.endOffset);return b.toString().length}return a.selectionStart}if(document.selection){a.focus();if(b)return c=document.selection.createRange(),b=document.body.createTextRange(),b.moveToElementText(a),b.setEndPoint("EndToEnd",c),b.text.length;f=0;c=a.createTextRange();
b=document.selection.createRange().duplicate();a=b.getBookmark();for(c.moveToBookmark(a);0!==c.moveStart("character",-1);)f++;return f}return 0}-1==f&&(f=this[b?"text":"val"]().length);window.getSelection?b?(a.focus(),window.getSelection().collapse(a.firstChild,f)):a.setSelectionRange(f,f):document.body.createTextRange&&(c=document.body.createTextRange(),c.moveToElementText(a),c.moveStart("character",f),c.collapse(!0),c.select());b||a.focus();return f};f.fn.setSelectionRange=function(f,a){this.focus();
var b=this[0];b.setSelectionRange?b.setSelectionRange(f,a):b.createTextRange&&(b=b.createTextRange(),b.collapse(!0),b.moveEnd("character",a),b.moveStart("character",f),b.select())}})(jQuery);(function(f,l){function a(a,c){for(var b={},d=a.split("."),e=b,g=1;g<d.length-1;g++)e[d[g]]={},e=e[d[g]];e[d[d.length-1]]=c;return b}function b(){for(var a,c,b,d=0;d<B.length;d++)a=B[d],b=a.handler,c=js.type(b),"string"==c?(b=this[a.handler],"function"==js.type(b)&&("qs.events"===a.type?a.target.addEventListener(a.name,b,this):"js.events"===a.type&&this.bindEvent(a.name,b,a.target.$element()))):"function"==c&&"function"==js.type(b)&&("qs.events"===a.type?a.target.addEventListener(a.name,b,a.target):
"js.events"===a.type&&a.target.bindEvent(a.name,b));B.length=0}function c(c,b){for(var d,e,g,k=js.type(c),m=js.instanceOf(c,f.ui.Control),n=0;n<b.attributes.length;n++)if(e=b.attributes[n],"xmlns"!=e.prefix){d=e.name;e=String(e.value).trim();if(m)if(f.events.isEventType(d)&&f.events.hasEvent(k,d)){B.push({name:d,handler:e,target:c,type:"qs.events"});continue}else if(void 0!==z[d]){B.push({name:d,handler:e,target:c,type:"js.events"});continue}if(StringUtil.beginWith(e,"{")&&StringUtil.endWith(e,"}")||
StringUtil.beginWith(e,"[")&&StringUtil.endWith(e,"]"))try{e=JSON.parse(e)}catch(p){throw Error("\u5c5e\u6027\u7c7b\u578b\u683c\u5f0f\u9519\u8bef:"+p.message);}else"true"===e?e=!0:"false"===e?e=!1:NumberUtil.isNumber(e)&&(e=NumberUtil.toNumber(e));g=d.indexOf(".");if(-1!=g)e=a(d,e),d=d.substr(0,g),"layout"==d&&m?(d=c.data("layout"),js.isNull(d)&&(d={}),js.copy(e,d),c.data("layout",d)):(g={},"function"==f.type(c[d])?(g=c[d](),js.isNull(g)&&(g={}),c[d](l.extend(g,e))):(g=c[d],js.isNull(g)&&(g={}),c[d]=
l.extend(g,e)));else if("layout"==d&&m)c.data("layout",e);else if("function"==f.type(c[d]))c[d](e);else c[d]=e}}function d(a,b){for(var d=b.children(),m,l,q=[],r=0;r<d.length;r++)if(m=d[r],l=m.name(),l=l.split("."),2==l.length)switch(l[0]){case "prop":e.call(this,a,l[1],m);break;case "func":g.call(this,a,l[1],m);break;case "event":k.call(this,a,l[1],m)}else q.push(m);d=js.getClass(a);if(!js.isNull(d)&&"function"==js.type(d.QXMLParser))d.QXMLParser(a,b,q);else if(js.instanceOf(a,f.ui.IContentControl)){if(0!=
q.length){if(1<q.length)throw Error("ContentControl\u53ea\u80fd\u5305\u542b\u4e00\u4e2a\u5b50\u63a7\u4ef6\u3002");q=q[0];q=s(q)?t.apply(this,[q]):"qs.html"==q.nsURI()?p.apply(this,[q]):n.apply(this,[q]);a.content(q)}}else if(js.instanceOf(a,f.ui.Container))v.call(this,a,b,q);else if(js.instanceOf(a,f.ui.ITabView))for(m=d=0;m<q.length;m++)if(r=q[m],"TabItem"==r.name())l={},c.call(this,l,r),r=r.children()[0],js.isNull(r)||(l.content=n.call(this,r)),void 0===l.label&&(l.label="tab"+d++),a.addItem(l);
else if(l=r.name(),l=l.split("."),2==l.length)switch(l[0]){case "prop":e.call(this,a,l[1],r);break;case "func":g.call(this,a,l[1],r);break;case "event":k.call(this,a,l[1],r)}}function e(a,c,b){var d=null,d=b.children(),e;if(e=0<d.length){var g=d[0];e=g.name();g=g.nsURI();if(void 0===g||null===g||""===g)g=y;g=m(g);e="Class"==f.type(g[e])?g[e]:null;e=null!=e}d=e?n.call(this,d[0]):StringUtil.trim(b.text());if(""!=d){if("string"==f.type(d))if(StringUtil.beginWith(d,"{")&&StringUtil.endWith(d,"}")||StringUtil.beginWith(d,
"[")&&StringUtil.endWith(d,"]"))try{d=JSON.parse(d)}catch(k){throw Error("QXML \u5c5e\u6027\u7c7b\u578b\u683c\u5f0f\u9519\u8bef:"+k.message);}else"true"===d?d=!0:"false"===d?d=!1:NumberUtil.isNumber(d)&&(d=NumberUtil.toNumber(d));if("function"==f.type(a[c]))a[c](d);else a[c]=d}}function g(a,c,b){if("script"==c){if(this==a){c=js.getClass(a);js.$public={};js.$protected={};js.$static={};var d=null;b=StringUtil.join("cdef \x3d function(){",b.text(),"};\n","//@ sourceURL\x3d",js.type(a),":",a.name(),".script.js");
eval(b);var d=new cdef,e;for(e in d)a[e]=d[e];for(e in js.$public)val=js.$public[e],a[e]="function"==typeof val?js.override(e,js.$public[e],!1,c):val;for(e in js.$protected)val=js.$protected[e],"function"==typeof val?subclass_prototype[e]=js.override(e,js.$protected[e],!0,c):a[e]=val;for(e in js.$static)c[e]=js.$static[e]}}else{d=b.attr("def");b=b.text();try{eval(StringUtil.join("func \x3d ",d,"{\n",b,"\n}\n","//@ sourceURL\x3d",js.type(a),":",a.name(),".func(",c,").js")),"function"==js.type(func)&&
(a[c]=js.override(c,func,!1,js.getClass(a)))}catch(g){throw Error("QXML "+js.type(a)+"\u4e2d\u7684"+c+"\u65b9\u6cd5\u5b9a\u4e49\u9519\u8bef:"+g.message);}}}function k(a,c,b){var d=b.attr("def");b=b.text();try{if(eval(StringUtil.join("func \x3d ",d,"{\n",b,"\n}\n","//@ sourceURL\x3d",js.type(a),":",a.name(),".event(",c,").js")),"function"==js.type(func)){var e=js.type(a);if(f.events.isEventType(c)&&f.events.hasEvent(e,c))B.push({name:c,handler:func,target:a,type:"qs.events"});else if(void 0!==z[c])B.push({name:c,
handler:func,target:a,type:"js.events"});else throw Error("QXML"+c+"\u4e8b\u4ef6\u4e0d\u5b58\u5728");}}catch(g){throw Error("QXML "+js.type(a)+"\u4e2d\u7684"+c+"\u65b9\u6cd5\u5b9a\u4e49\u9519\u8bef:"+g.message);}}function m(a){a=a.split(".");for(var c=window,b=0;b<a.length;b++)if(c=c[a[b]],void 0===c||null===c)return null;return c}function n(a){var b=a.name(),e=a.nsURI();if(void 0===e||null===e||""===e)e=y;var g=m(e);if(null===g||"Class"!==f.type(g[b]))throw Error("\u627e\u4e0d\u5230\u63a7\u4ef6\u5b9a\u4e49:"+
e+"."+b);b=new g[b];e=l.extend(b.options(),u);b.options(e);c.apply(this,[b,a]);""==b.name()?b.name("control"+A++):this[b.name()]=b;d.apply(this,[b,a]);return b}function p(a){var c=l("\x3c"+a.name()+" /\x3e"),b=new f.ui.ContentControl,d=l.extend(b.options(),u);b.options(d);q.apply(this,[b,c,a]);a=c.attr("name");""!=a&&void 0!=a&&(this[c.attr("name")]=c);b.content(c);return b}function q(a,c,b){for(var d,e,g=js.type(a),k=0;k<b.attributes.length;k++)if(e=b.attributes[k],"xmlns"!=e.prefix)if(d=e.name,
e=String(e.value).trim(),f.events.isEventType(d)&&f.events.hasEvent(g,d))B.push({name:d,handler:e,target:a,type:"qs.events"});else if(void 0!==z[d])B.push({name:d,handler:e,target:a,type:"js.events"});else{if(StringUtil.beginWith(e,"{")&&StringUtil.endWith(e,"}")||StringUtil.beginWith(e,"[")&&StringUtil.endWith(e,"]"))try{e=JSON.parse(e)}catch(m){throw Error("\u5c5e\u6027\u7c7b\u578b\u683c\u5f0f\u9519\u8bef:"+m.message);}if("layout"==d&&js.instanceOf(a,f.ui.Control))a.data("layout",e);else if("class"==
d)c.addClass(e);else if("string"==f.type(e)&&c.attr(d,e),"function"==js.type(a[d]))a[d](e)}}function s(a){a=m("qs.layout")[a.name()];return js.isClass(a)?!0:!1}function r(c,b,d){for(var e,g,k,m=js.type(c),n={},p=0;p<d.attributes.length;p++)if(g=d.attributes[p],"xmlns"!=g.prefix)if(e=g.name,g=String(g.value).trim(),f.events.isEventType(e)&&f.events.hasEvent(m,e))B.push({name:e,handler:g,target:c,type:"qs.events"});else if(void 0!==z[e])B.push({name:e,handler:g,target:c,type:"js.events"});else{if(StringUtil.beginWith(g,
"{")&&StringUtil.endWith(g,"}")||StringUtil.beginWith(g,"[")&&StringUtil.endWith(g,"]"))try{g=JSON.parse(g)}catch(q){throw Error("\u5c5e\u6027\u7c7b\u578b\u683c\u5f0f\u9519\u8bef:"+q.message);}else"true"===g?g=!0:"false"===g?g=!1:NumberUtil.isNumber(g)&&(g=NumberUtil.toNumber(g));k=e.indexOf(".");if(-1!=k)g=a(e,g),e=e.substr(0,k),"layout"==e?n=l.extend(n,g):(k={},"function"==f.type(c[e])?(k=c[e](),js.isNull(k)&&(k={}),c[e](l.extend(k,g))):(k=c[e],js.isNull(k)&&(k={}),c[e]=l.extend(k,g)));else switch(e){case "layout":"object"==
js.type(g)&&(n=g);break;case "width":case "height":case "hAlign":case "vAlign":case "innerLayout":case "rowIndex":case "rowSpan":case "colIndex":case "colSpan":case "hGap":case "vGap":case "rows":case "columns":n[e]=g;break;default:if("function"==f.type(c[e]))c[e](g);else c[e]=g}}n.type=b;c.data("layout",n)}function t(a){var c=m("qs.layout"),b=new f.ui.Container,c=c[a.name()];r.apply(this,[b,c.type(),a]);""==b.name()?b.name("control"+A++):this[b.name()]=b;c=new c;b.layout(c);v.apply(this,[b,a,a.children()]);
return b}function v(a,b,d){if(0!=d.length){var e=m("qs.layout");b=d[0];var g=e[b.name()],e=0;js.isClass(g)&&(1==d.length?(d={type:g.type()},c.apply(this,[d,b]),d.name&&(a.name(d.name),this[d.name]=a),a.data("layout",d),d=new g,a.layout(d),d=b.children()):(e=t.apply(this,[b]),a.addChild(e,!1),e=1));for(b=e;b<d.length;b++)e=d[b],e=s(e)?t.apply(this,[e]):"qs.html"==e.nsURI()?p.apply(this,[e]):n.apply(this,[e]),a.addChild(e,!1)}}var z={blur:"blur",change:"change",click:"click",dblclick:"dblclick",focus:"focus",
focusin:"focusin",focusout:"focusout",keydown:"keydown",keypress:"keypress",keyup:"keyup",mousedown:"mousedown",mouseenter:"mouseenter",mouseleave:"mouseleave",mousemove:"mousemove",mouseout:"mouseout",mouseover:"mouseover",mouseup:"mouseup",scroll:"scroll"},A=0,B=[],y="qs.ui",u={};f.ui.qxml=function(a,e,g){g=l.extend({defaultNS:"qs.ui",defaultOptions:{},checkType:!0},g);y=g.defaultNS;u=g.defaultOptions;var f=a.name(),k=a.nsURI();if(void 0===k||null===k||""===k)k=y;if(!0==g.checkType&&!js.instanceOf(this,
js.findClass(k+"."+f)))throw Error("\u63a7\u4ef6\u7c7b\u578b\u5b9a\u4e49\u9519\u8bef : "+k+"."+f);B.length=0;c.apply(this,[this,a]);d.apply(this,[this,a]);b.call(this);this.isRendered()?this.invalidateSize(!0):(js.isNull(e)&&(e=l("\x3cdiv\x3e\x3c/div\x3e"),l("body").append(e)),this.render(e))};f.m&&(f.m._doAppNode=function(a,c,d){switch(a){case "prop":e.call(this,this,c,d);break;case "func":g.call(this,this,c,d);break;case "event":k.call(this,this,c,d),b.call(this)}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Control",f.events.EventDispatcher,function(){f.events.register("rendered",this);this.initialize=function(a){this.$super(a);this.options(a);this._name="";this._enabled=!0;this._height=this._width=this._bottom=this._right=this._top=this._left=NaN;this._padding=this._border=this._margin=null;this._toolTip="";this._visible=!0;this._parent=this._$styleElement=this._$element=null;this._data={};this._renderedCalls=[];a&&"object"==f.type(a.layout)&&this.data("layout",a.layout)};
js.$protected.dispose=function(){};js.$public.focusEnabled=function(a){if(void 0===a)return void 0==this._focusEnabled?!1:this._focusEnabled;this._focusEnabled=a};js.$public.focus=function(){f.ui.FocusManager.focus(this)};js.$public.dispatchEvent=function(a,b,c){c=js.param(c,!0);if("string"==f.type(a))a=new f.events.Event(a,this);else if(js.instanceOf(a,f.events.Event))a.name(),a.target()||a.target(this);else return;this.$super(a,b);if(null!==this._$element&&!0===c&&!a.isPropagationStopped()){c=this._$element.parent();
for(var d;null!==c&&0<c.length&&!a.isPropagationStopped()&&!a.isImmediatePropagationStopped();)d=c.data("control"),js.instanceOf(d,f.events.EventDispatcher)&&d.dispatchEvent(a,b,!1),c=c.parent()}};js.$public.findAncestor=function(a){if(null!==this._$element)for(var b=this._$element.parent(),c;null!==b&&0<b.length;){c=b.data("control");if(null!==c&&void 0!==c&&js.instanceOf(c,a))return c;b=b.parent()}return null};js.$static.findOwnerControl=function(a){a=l(a);for(var b;null!==a&&0<a.length;){b=a.data("control");
if(null!==b&&void 0!==b&&js.instanceOf(b,f.ui.Control))return b;a=a.parent()}return null};js.$public.name=function(a){if(void 0===a)return this._name;this._name=a};js.$public.toolTip=function(a){if(void 0===a)return this._toolTip;this._toolTip=a;this.callAfterRendered(function(){this._$element.attr("title",this._toolTip)})};js.$public.css=function(a){void 0!==a&&null!=a&&this.callAfterRendered(function(){this._$element.css(a)})};js.$public.visible=function(a){if(void 0===a)return null==this._$element?
!1:this._visible;var b=this._visible;this._visible=a;null!=this._$element&&(this._$element.css("display",this._visible?"":"none"),!1==b&&!0==this._visible&&this.invalidateSize(!0))};js.$public.tabIndex=function(a){if(void 0===a)return void 0===this._tabIndex?0:this._tabIndex;this._tabIndex=a;this.callAfterRendered(function(){this._$element.attr("tabIndex",this._tabIndex)})};js.$protected.callAfterRendered=function(a){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);this._renderedCalls.push({func:a,
args:b});this.isRendered()&&a.apply(this,b)};js.$public.$element=function(){return this._$element};js.$public.$styleElement=function(a){if(void 0===a)return this._$styleElement;this._$styleElement=a};js.$public.parent=function(a){if(void 0===a)return js.isNull(this._parent)?!js.isNull(this._$element)&&(a=this._$element.parent(),0<a.length)?f.ui.Control.findOwnerControl(a[0]):null:this._parent;this._parent=a};js.$public.isRendered=function(a){if(void 0===a)return null!=this._$element;if(!0==a)for(this.dispatchEvent("rendered",
{},!1),a=0;a<this._renderedCalls.length;a++)this._renderedCalls[a].func.apply(this,this._renderedCalls[a].args);else!1==a&&this._$element&&(this._$element.empty(),this._$element.remove(),this._$element=null)};js.$public.enabled=function(a){if(void 0===a)return this._enabled;var b=this._enabled;this._enabled=a;b!=a&&this.callAfterRendered(function(){if(this._enabled){this._$element.removeClass("qs-disabled");this._$element.find("input").removeAttr("disabled");var a=this._$element.find(".qs-disabled-mask");
0<a.length&&(a.empty(),a.remove())}else{this._$element.addClass("qs-disabled");this._$element.find("input").attr("disabled","disabled");var b=0;this._$element.children().each(function(){var a=parseInt(l(this).css("z-index"),10);a>b&&(b=a)});1E4>b&&(b=1E4);a=l('\x3cdiv class\x3d"qs-disabled-mask"\x3e\x3c/div\x3e');this._$element.append(a);a.css("z-index",b+1);this.bindEvent("mousedown click",function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()},a)}})};js.$public.updateSize=
function(a,b){};js.$public.invalidateSize=function(a){a=js.param(a,!1);if(this.isRendered()){var b=this.contentSize();if(!0===a||null===this._lastUpdateSize||void 0===this._lastUpdateSize||this._lastUpdateSize.width!==b.width||this._lastUpdateSize.height!==b.height)0<this._width&&0==b.width&&(b.width=Math.max(b.width,this._width)),0<this._height&&0==b.height&&(b.height=Math.max(b.height,this._height)),this.updateSize(b.width,b.height),this._lastUpdateSize=b}};js.$public.options=function(a){if(void 0===
a)return this._options;this._options=a;null==this._options&&(this._options={})};js.$protected.template=function(a){return null};js.$public.style=function(a){if(void 0===a)return this._style;this._style=a};js.$static.style=function(a,b){if(void 0===b)return a.prototype._style;a.prototype._style=b};js.$public.render=function(a,b){this._$styleElement=this._$element=a;"undefined"==typeof b&&(b={});b=l.extend({left:this._left,top:this._top,right:this._right,bottom:this._bottom,width:this._width,height:this._height,
position:"absolute"},this._options,b);a.css("position",b.position);if("absolute"==b.position){var c=this.margin();isNaN(b.left)&&0<c.left&&(b.left=c.left);isNaN(b.top)&&0<c.top&&(b.top=c.top)}!1==this._visible&&a.css("display","none");c=null;if(null==c||void 0==c)c=this.template(b);null!==c&&void 0!==c&&a.append(c);this.move(b.left,b.top,b.width,b.height);this.right(b.right);this.bottom(b.bottom);this._margin&&this.margin(this._margin);this._border&&this.border(this.border());this._padding&&this.padding(this.padding());
this._maxSize&&this.maxSize(this.maxSize());this._minSize&&this.minSize(this.minSize());a.data("control",this);this.onRendered(a,b);this.isRendered(!0);"object"==js.type(this._style)&&this._$styleElement.css(this._style)};js.$protected.onRendered=function(a,b){};js.$protected.qxml=function(a,b){js.instanceOf(a,f.Xml)||(a=new f.Xml(a));f.ui.qxml.apply(this,[a,b])};js.$public.remove=function(){null!=this._$element&&(this._$element.empty(),this._$element.remove(),this._$element=null)};js.$public.triggerEvent=
function(a,b,c){void 0===c&&(c=this._$element);c&&c.trigger(a,b)};js.$public.bindEvent=function(a,b,c){var d=this;b._qs_event_wrapper=function(a){return js.callInternal(d,b,[a])};void 0===c&&(c=this._$element);c?(-1==a.indexOf("key")||c.attr("tabindex")||c.is("input")||c.attr("tabindex","0"),c.bind(a,b._qs_event_wrapper)):this.callAfterRendered(function(){-1==a.indexOf("key")||this._$element.attr("tabindex")||this._$element.attr("tabindex","0");this._$element.bind(a,b._qs_event_wrapper)})};js.$public.unbindEvent=
function(a,b,c){void 0===c&&(c=this._$element);c&&(b&&b._qs_event_wrapper?c.unbind(a,b._qs_event_wrapper):c.unbind(a))};js.$public.setCapture=function(a,b){if(!(l.browser.msie&&8>=l.browser.version))if(void 0===a&&(a=this._$element),a[0].setCapture)a[0].setCapture();else if(document.addEventListener)if(a._qs_capture_function=function(c){c=jQuery.event.fix(c);c.target=a;a.trigger(c);return!1},b)for(var c=b.split(" "),d=0;d<c.length;d++)document.addEventListener(c[d],a._qs_capture_function,!0);else document.addEventListener("mousemove",
a._qs_capture_function,!0),document.addEventListener("mouseup",a._qs_capture_function,!0);else a._qs_capture_function=function(c){a.trigger(c);return!1},b?l(document).bind(b,a._qs_capture_function):l(document).bind("mousemove mouseup",a._qs_capture_function)};js.$public.releaseCapture=function(a,b){if(!(l.browser.msie&&8>=l.browser.version))if(void 0===a&&(a=this._$element),a[0].releaseCapture)a[0].releaseCapture();else if(document.removeEventListener)if(b)for(var c=b.split(" "),d=0;d<c.length;d++)document.removeEventListener(c[d],
a._qs_capture_function,!0);else document.removeEventListener("mousemove",a._qs_capture_function,!0),document.removeEventListener("mouseup",a._qs_capture_function,!0);else b?l(document).unbind(b,a._qs_capture_function):l(document).unbind("mousemove mouseup",a._qs_capture_function),a._qs_capture_function=null};js.$public.data=function(a,b){if(void 0===b)return this._data[a];this._data[a]=b;return this};js.$public.left=function(a){if(void 0===a)return this._left;this._left=a;null!=this._$element&&(isNaN(a)?
this._$element.css("left",""):this._$element.css("left",a))};js.$public.top=function(a){if(void 0===a)return this._top;this._top=a;null!=this._$element&&(isNaN(a)?this._$element.css("top",""):this._$element.css("top",a))};js.$public.right=function(a){if(void 0===a)return this._right;this._right=a;null!=this._$element&&(isNaN(a)?this._$element.css("right",""):this._$element.css("right",a))};js.$public.bottom=function(a){if(void 0===a)return this._bottom;this._bottom=a;null!=this._$element&&(isNaN(a)?
this._$element.css("bottom",""):this._$element.css("bottom",a))};js.$public.width=function(a,b){if(void 0===a)return this._width;a=parseInt(a);if(!isNaN(a)){var c=this.maxContentSize(),d=this.minContentSize();a=Math.min(Math.max(a,d.width),c.width)}this._width=a;null!=this._$element&&(isNaN(a)?this._$element.css("width",""):this._$element.width(a));!1!==b&&this.invalidateSize()};js.$public.height=function(a,b){if(void 0===a)return this._height;a=parseInt(a);if(!isNaN(a)){var c=this.maxContentSize(),
d=this.minContentSize();a=Math.min(Math.max(a,d.height),c.height)}this._height=a;null!=this._$element&&(isNaN(a)?this._$element.css("height",""):this._$element.height(a));!1!==b&&this.invalidateSize()};js.$public.outerWidth=function(a,b){var c=this.margin(),d=this.border(),e=this.padding();if(void 0===a){var g=this._width;null!=this._$element&&(g=this._$element.width());return g+c.left+c.right+d.left+d.right+e.left+e.right}var g=this.maxSize(),f=this.minSize();a=Math.min(Math.max(a,f.width),g.width);
this.width(a-c.left-c.right-d.left-d.right-e.left-e.right,b)};js.$public.outerHeight=function(a,b){var c=this.margin(),d=this.border(),e=this.padding();if(void 0===a){var g=this._height;null!=this._$element&&(g=this._$element.height());return g+c.top+c.bottom+d.top+d.bottom+e.top+e.bottom}var g=this.maxSize(),f=this.minSize();a=Math.min(Math.max(a,f.height),g.height);this.height(a-c.top-c.bottom-d.top-d.bottom-e.top-e.bottom,b)};js.$public.actualWidth=function(){return null!=this._$element?this._$element.outerWidth(!0):
0};js.$public.actualHeight=function(){return null!=this._$element?this._$element.outerHeight(!0):0};js.$public.offset=function(){return null==this._$element?{top:0,left:0}:this._$element.offset()};js.$public.position=function(){return null==this._$element?{top:0,left:0}:this._$element.position()};js.$public.move=function(a,b,c,d){isFinite(a)&&this.left(a);isFinite(b)&&this.top(b);if(isFinite(c)||isFinite(d))isFinite(c)&&this.width(c,!1),isFinite(d)&&this.height(d,!1),this.invalidateSize()};js.$public.margin=
function(a){if(void 0===a)return js.isNull(this._margin)?js.isNull(this._$element)?{top:0,bottom:0,left:0,right:0}:this._$element.margin():this._margin;var b=js.type(a);"number"==b?this._margin={top:a,left:a,right:a,bottom:a}:"object"==b&&(this._margin=l.extend({top:0,left:0,right:0,bottom:0},a));null!=this._$element&&this._$element.margin(this._margin)};js.$public.border=function(a){if(void 0===a)return null==this._border?null==this._$element?{top:0,bottom:0,left:0,right:0}:this._$element.border():
this._border;var b=js.type(a);"number"==b?this._border={top:a,left:a,right:a,bottom:a}:"object"==b&&(this._border=l.extend({top:0,left:0,right:0,bottom:0},a));null!=this._$element&&this._$element.border(this._border)};js.$public.padding=function(a){if(void 0===a)return null==this._padding?null==this._$element?{top:0,bottom:0,left:0,right:0}:this._$element.padding():this._padding;var b=js.type(a);"number"==b?this._padding={top:a,left:a,right:a,bottom:a}:"object"==b&&(this._padding=l.extend({top:0,
left:0,right:0,bottom:0},a));null!=this._$element&&this._$element.padding(this._padding)};js.$public.minSize=function(a){if(void 0===a)return this._minSize||{width:0,height:0};this._minSize={width:a.width||0,height:a.height||0};return null!=this._$element?this._$element.minSize(this.minContentSize()):this};js.$public.minContentSize=function(){var a=this.minSize(),b=this.border(),c=this.margin(),d=this.padding(),e=c.top+c.bottom+b.top+b.bottom+d.top+d.bottom;a.width-=c.left+c.right+b.left+b.right+
d.left+d.right;a.height-=e;return a};js.$public.maxSize=function(a){if(void 0===a)return this._maxSize||{width:Number.MAX_VALUE,height:Number.MAX_VALUE};this._maxSize={width:a.width||Number.MAX_VALUE,height:a.height||Number.MAX_VALUE};return null!=this._$element?this._$element.maxSize(this.maxContentSize()):this};js.$public.maxContentSize=function(){var a=this.maxSize(),b=this.border(),c=this.margin(),d=this.padding(),e=c.top+c.bottom+b.top+b.bottom+d.top+d.bottom;a.width-=c.left+c.right+b.left+b.right+
d.left+d.right;a.height-=e;return a};js.$public.contentSize=function(a){if(void 0===a)return null!=this._$element?{width:this._$element.width(),height:this._$element.height()}:{width:this.width(),height:this.height()};var b=this.maxContentSize(),c=this.minContentSize();void 0!==a.width&&(a.width=Math.min(Math.max(a.width,c.width),b.width),this._$element.width(a.width));void 0!==a.height&&(a.height=Math.min(Math.max(a.height,c.height),b.height),this._$element.height(a.height));this.invalidateSize()};
js.$public.size=function(a){return this.contentSize(a)};js.$public.outerSize=function(a,b){b=js.param(b,!0);if(void 0===a){if(null!=this._$element)return{width:this._$element.outerWidth(!0),height:this._$element.outerHeight(!0)};var c=this.margin(),d=this.border(),e=this.padding();return{width:this._width+c.left+c.right+d.left+d.right+e.left+e.right,height:this._height+c.top+c.bottom+d.top+d.bottom+e.top+e.bottom}}if(null!=this._$element&&(void 0!==a.width||void 0!==a.height)){var c=this.margin(),
d=this.border(),e=this.padding(),g=this.maxSize(),f=this.minSize();void 0!==a.width&&(a.width=Math.min(Math.max(a.width,f.width),g.width),this._$element.width(a.width-c.left-c.right-d.left-d.right-e.left-e.right));void 0!==a.height&&(a.height=Math.min(Math.max(a.height,f.height),g.height),this._$element.height(a.height-c.top-c.bottom-d.top-d.bottom-e.top-e.bottom));!0==b&&this.invalidateSize(!0)}};js.$public.preferredSize=function(a,b){var c=this.margin(),d=this.padding(),e=this.border(),g={width:this._$element.width(),
height:this._$element.height()};g.width+=c.left+c.right+e.left+e.right+d.left+d.right;g.height+=c.top+c.bottom+e.top+e.bottom+d.top+d.bottom;c=this.minSize();d=this.maxSize();g.width=Math.min(Math.max(c.width,g.width),d.width);g.height=Math.min(Math.max(c.height,g.height),d.height);(c=this.data("layout"))&&0<c.width&&(g.width=c.width);c&&0<c.height&&(g.height=c.height);return g}});l(document).ready(function(){var a=void 0;jQuery.cleanData&&(a=jQuery.cleanData);jQuery.cleanData=function(b){for(var c,
d,e=0,g;null!=(g=b[e]);e++)try{d=l(g),c=d.data("control"),null!==c&&void 0!==c&&js.instanceOf(c,f.ui.Control)&&(c.removeAllEventListener(),js.callInternal(c,c.dispose),d.data("control",null))}catch(k){}a&&a(b)}});l.event.special.itemClick={setup:function(a,b){},teardown:function(a){}}})(qs,jQuery);(function(f,l){f.ui.animation={slide:function(a,b,c,d,e,g){b=js.param(b,{});var k=js.param(b.x,0);b=js.param(b.y,0);c=js.param(c,0.3);d=js.param(d,"ease-out");a.unbind(f.events.transitionEnd);if("function"==js.type(e)){var m=!1;a.bind(f.events.transitionEnd,function(c){!0!=m&&e.call(g,c);m=!0;a.unbind(f.events.transitionEnd)});f.Timer.callLater(1E3*c+100,function(){!0!=m&&e.call(g);m=!0})}a.css({transition:"all "+c+"s "+d,transform:"translate("+k+"px, "+b+"px) translateZ(0px)"})},stop:function(a){a.css("transition",
"");a.unbind(f.events.transitionEnd)}}})(qs,jQuery);(function(f,l){js.$class("qs.ui.ItemsControl",f.ui.Control,function(){f.events.register("selectedItemChanged",this);js.$static.SELECTED_ITEM_CHANGED="selectedItemChanged";this.initialize=function(a){this.$super(a);this._items=[];this._selectedItem=null;this._selectedIndex=-1};js.$protected.onPropertyChanged=function(a,b,c){"selectedItem"==a&&this.dispatchEvent(f.ui.ItemsControl.SELECTED_ITEM_CHANGED,{oldValue:b,newValue:c})};js.$public.items=function(a){if(void 0===a)return this._items;if(null!=this._items&&
0<this._items.length)for(var b=this._items.length-1;0<=b;b++)this.removeItem(this._items[b]);this._items=a};js.$public.addItem=function(a){this._items.push(a)};js.$public.removeItem=function(a){a=this._items.indexOf(a);-1!=a&&(a==this._selectedIndex&&this.selectedItem(null),this._items.splice(a,1))};js.$public.selectedItem=function(a){if(void 0===a)return this._selectedItem;var b=this._items.indexOf(a);if(-1!=b){var c=this._selectedItem;this._selectedItem=a;this._selectedIndex=b;if(c!=a)this.onPropertyChanged("selectedItem",
c,a)}};js.$public.selectedIndex=function(a){if(void 0===a)return this._selectedIndex;if(0<=a&&a<this._items.length){var b=this._selectedItem;this._selectedIndex=a;this._selectedItem=this._items[a];if(b!=this._selectedItem)this.onPropertyChanged("selectedItem",b,this._selectedItem)}}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.ContentControl",f.ui.Control,[f.ui.IContentControl],function(){this.initialize=function(a){this.$super(a);this._content=null};js.$public.content=function(a){if(void 0===a)return this._content;this._content=a;this.callAfterRendered(function(){var b=this._$element.find(".qs-content:first");b.empty();if(null!=a){if(js.instanceOf(a,f.ui.Control))if(a.parent(this),this._content.isRendered())b.append(this._content.$element()),this._content.$element().css("position","");else{var c=
l("\x3cdiv\x3e\x3c/div\x3e");b.append(c);this._content.render(c);c.css("position","")}else b.append(a),b.children(":first").css("position","");this.invalidateSize()}})};js.$public.updateSize=function(a,b){this.$super(a,b);if(this.isRendered())if(js.instanceOf(this._content,f.ui.Control))this._content.outerSize({width:a,height:b});else{var c=this._$element.find(".qs-content").children(":first");0<a&&c.outerWidth(a);0<b&&c.outerHeight(b)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-content"\x3e',
"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",text:""},this._options,b);this.$super(a,b);0<b.classes.length&&a.addClass(b.classes);this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Container",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._children=new f.ArrayList;var b="",c=null;a&&a.layout&&(c=a.layout);"string"==f.type(c)?b=a.layout:"object"==f.type(c)&&(this.data("layout",c),c&&c.type&&(b=c.type));switch(b){case "FlowLayout":case "flow":this._layout=new f.layout.FlowLayout(this);break;case "HLayout":case "horizontal":this._layout=new f.layout.HLayout(this);break;case "VLayout":case "vertical":this._layout=new f.layout.VLayout(this);
break;case "GridLayout":case "grid":this._layout=new f.layout.GridLayout(this);break;default:this._layout=null}};js.$public.layout=function(a){if(void 0===a)return this._layout;js.instanceOf(a,f.layout.Layout)&&(a.children().clear(),a.children().addAll(this._children),this._layout=a,a.container(this))};js.$public.children=function(){return this._children};js.$public.addChild=function(a,b){b=js.param(b,!0);if(!this._children.contains(a)&&(a.parent(this),this._children.add(a),null!=this._layout&&this._layout.addChild(a),
this.isRendered())){var c=this._$element.children(".qs-container"),d={};this._options.childOptions&&(d=this._options.childOptions);if(a.isRendered())c.append(a.$element()),a.options(d);else{var e=l("\x3cdiv\x3e\x3c/div\x3e");c.append(e);a.render(e,d)}null!=this._layout&&b&&this._layout.doLayout()}};js.$public.removeChild=function(a,b){b=js.param(b,!0);a.isRendered()&&a.$element().detach();a.parent(null);this._children.remove(a);null!=this._layout&&(this._layout.removeChild(a),b&&this._layout.doLayout())};
js.$public.removeAllChildren=function(){this._children.forEach(function(a){a.isRendered()&&(a.$element().empty(),a.$element().remove())});this._children.clear();null!=this._layout&&this._layout.removeAllChildren()};js.$public.updateSize=function(a,b){this.isRendered()&&null!=this._layout&&this._layout.doLayout()};js.$protected.createChildren=function(){if(this.isRendered()){var a=this._$element.children(".qs-container"),b={};this._options.childOptions&&(b=this._options.childOptions);js.isNull(b.position)&&
!js.isNull(this._layout)&&(b.position="absolute");var c=this._options.gap;isFinite(c)||(c=5);this._children.forEach(function(c){if(c.isRendered())a.append(c.$element()),c.options(b);else{var e=l("\x3cdiv\x3e\x3c/div\x3e");a.append(e);c.render(e,b)}},this);!0==this._options.wrap?a.css("white-space",""):a.css("white-space","nowrap")}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-container"\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&
(b={});this._options=b=l.extend({classes:""},this._options,b);this.$super(a,b);0<b.classes.length&&a.children(".qs-container").addClass(b.classes);this.createChildren()};js.$public.forEach=function(a,b,c){void 0===c&&(c=this);var d=!0;this._children.forEach(function(e){d=b.call(c,e,this);if(!1==d)return!1;!0==a&&(d=this.doEachChild(e,b,c));if(!1==d)return!1},this);return d};this.doEachChild=function(a,b,c){var d=!0;if(js.instanceOf(a,f.ui.Container))d=a.forEach(!0,b,c);else if(js.instanceOf(a,f.ui.ContentControl)){d=
b.call(c,a.content(),a);if(!1==d)return!1;d=this.doEachChild(a.content(),b,c)}else if(js.instanceOf(a,f.ui.ITabView))for(a=a.items(),b=0;b<a.length;b++)this.doEachChild(a[b].content);return d}})})(qs,jQuery);(function(f,l){js.$interface("qs.ui.IFormControl",function(){js.$public.value=function(a){}});js.$class("qs.ui.FormControl",f.ui.Control,[f.ui.IFormControl],function(){this.initialize=function(a){this.$super(a);this.focusEnabled(!0)};js.$public.validator=function(a){this.callAfterRendered(function(){var b=this.findAncestor(f.ui.Form);null!=b&&(null==a?b.removeValidator(this):b.addValidator(this,a))})}});js.$class("qs.ui.Form",f.ui.Container,function(){this.initialize=function(a){this.$super(a);this._action=
"";this._method="post";this._target="";this._validationGroup=new f.ui.ValidationGroup;this.addEventListener("change",this.onChange)};this.onChange=function(a){this._validationGroup.validate(a.target())};js.$public.addValidator=function(a,b){js.instanceOf(b,f.ui.Validator)?this._validationGroup.addValidator(a,b):this._validationGroup.addValidator(a,b.type,b)};js.$public.validate=function(){return this._validationGroup.validate()};js.$public.removeValidator=function(a){this._validationGroup.removeValidator(a)};
js.$public.action=function(a){if(void 0===a)return this._action;this._action=a;null!=this._$element&&this._$element.find("form").attr("action",a)};js.$public.method=function(a){if(void 0===a)return this._method;this._method=a;null!=this._$element&&this._$element.find("form").attr("method",a)};js.$public.target=function(a){if(void 0===a)return this._target;this._target=a;null!=this._$element&&this._$element.find("form").attr("target",a)};js.$public.submit=function(){this._validationGroup.validate()&&
null!=this._$element&&this._$element.find("form").submit()};js.$public.entity=function(a){if(void 0===a){var b={},c;this.forEach(!0,function(a){js.instanceOf(a,f.ui.IFormControl)&&(c=a.name(),StringUtil.isEmpty(c)||(b[c]=a.value()))});return b}null!=a&&this.forEach(!0,function(b){js.instanceOf(b,f.ui.IFormControl)&&(c=b.name(),void 0!==a[c]&&b.value(a[c]))})};js.$protected.template=function(a){return StringUtil.join('\x3cform class\x3d"qs-container" action\x3d"',this._action,'" method\x3d"',this._method,
'" target\x3d"',this._target,'"\x3e',"\x3c/form\x3e")}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Popup",function(){js.$static.POPUP_HIDE_EVENT="popup_hide";this.initialize=function(a){this._classes=js.param(a,"");this._$element=null;this.initialized=!1};js.$public.$element=function(){return this._$element};this._checkExternalClick=function(a){a=l(a.target);"qs-popup"!=a.attr("id")&&0===a.parents(".qs-popup").length&&this.hide()};js.$public.show=function(a,b){if(!this.initialized){var c=this;f.ui.device.isMobile?l(document).bind("touchend",function(a){c._checkExternalClick(a)}):
l(document).bind("mousedown",function(a){c._checkExternalClick(a)});this.initialized=!0}this.hide();"undefined"==typeof b&&(b={});b=l.extend({x:0,y:0,width:0,height:0,$relative:null,fitSize:!0,classes:"",innerClasses:""},b);var d={left:0,top:0};b.$relative&&0<b.$relative.length&&(d=b.$relative.offset());var e=d.left+b.x,g=d.top+b.y,k=!1,m=!1;!0==b.fitSize&&(0<b.width&&(e=Math.max(Math.min(e,f.ui.windowWidth()-b.width-20),20),k=!0),0<b.height&&(g=Math.max(Math.min(g,f.ui.windowHeight()-b.height-20),
20),m=!0));this._$element||(this._$element=l('\x3cdiv class\x3d"qs-popup" \x3e\x3c/div\x3e'),l("body").append(this._$element),this._$element.addClass(this._classes));this._$element.css({left:e+"px",top:g+"px"});0<b.width&&this._$element.css({width:b.width+"px"});0<b.height&&this._$element.css({height:b.height+"px"});0<b.classes.length&&this._$element.addClass(b.classes);b.classes=b.innerClasses;b.left=e;b.top=g;var n;js.instanceOf(a,f.ui.Control)?(this._popupControl=a,a.isRendered()?this._$element.append(a.$element()):
a.render(this._$element,b),0<b.width&&a.outerWidth(b.width),0<b.height&&a.outerHeight(b.height),n=a.$element()):(this._$element.append(a),n=l(a),0<b.classes.length&&n.addClass(b.classes));!0==b.fitSize&&(k||(e=Math.max(Math.min(e,f.ui.windowWidth()-n.width()-10),10),this._$element.css("left",e)),m||(g=Math.max(Math.min(g,f.ui.windowHeight()-n.height()-10),10),this._$element.css("top",g)),f.Timer.callLater(100,function(){null!=this._$element&&(k||(e=Math.max(Math.min(e,f.ui.windowWidth()-n.width()-
10),10),this._$element.css("left",e)),m||(g=Math.max(Math.min(g,f.ui.windowHeight()-n.height()-10),10),this._$element.css("top",g)))},this));this._$element.css({opacity:"1"})};js.$public.hide=function(a){if(this._$element){if(!js.isNull(this._popupControl)){a=this._popupControl;this._popupControl=null;var b=new f.events.Event(f.ui.Popup.POPUP_HIDE_EVENT);a.dispatchEvent(b);if(b.isDefaultPrevented())return}this._$element.empty();this._$element.remove();this._$element=null}};js.$public.isOpened=function(){return js.isNull(this._$element)?
!1:!0}});f.ui.popup=new f.ui.Popup})(qs,jQuery);(function(f,l){js.$class("qs.ui.Calendar",f.ui.Control,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._currentMonth=this._selectedDate=null};js.$public.selectedDate=function(a){if(void 0===a)return this._selectedDate;var b=this._selectedDate;this._selectedDate=a;this.isRendered()&&this.update();b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$protected.template=function(a){a=new Date;var b=this._currentMonth,c=this._selectedDate;null==b&&
(this._currentMonth=b=null==c?new Date(a.getFullYear(),a.getMonth(),1):new Date(c.getFullYear(),c.getMonth(),1));var d=f.I18N.getObject("qs.ui.calendar.weekdays_sn"),e=[];e.push('\x3cdiv class\x3d"qs-calendar"\x3e');e.push('\x3cdiv class\x3d"calendar-header"\x3e','\x3cdiv id\x3d"calendar-pp" class\x3d"calendar-button year-left" title\x3d"',f.I18N.getString("qs.ui.calendar.prev_year"),'"\x3e\x3c/div\x3e','\x3cdiv id\x3d"calendar-p" class\x3d"calendar-button month-left" title\x3d"',f.I18N.getString("qs.ui.calendar.prev_month"),
'"\x3e\x3c/div\x3e','\x3cdiv class\x3d"calendar-month"\x3e',f.I18N.getString("qs.ui.calendar.title",b.getFullYear(),b.getMonth()+1),"\x3c/div\x3e",'\x3cdiv id\x3d"calendar-n" class\x3d"calendar-button month-right" title\x3d"',f.I18N.getString("qs.ui.calendar.next_month"),'"\x3e\x3c/div\x3e','\x3cdiv id\x3d"calendar-nn" class\x3d"calendar-button year-right" title\x3d"',f.I18N.getString("qs.ui.calendar.next_year"),'"\x3e\x3c/div\x3e','\x3cdiv class\x3d"day-of-week"\x3e',d[0],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',
d[1],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',d[2],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',d[3],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',d[4],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',d[5],"\x3c/div\x3e",'\x3cdiv class\x3d"day-of-week"\x3e',d[6],"\x3c/div\x3e","\x3c/div\x3e");e.push('\x3cdiv class\x3d"calendar-container"\x3e\x3cdiv class\x3d"calendar"\x3e');d=new Date(b.getFullYear(),b.getMonth(),1);0==d.getDay()?d.setTime(d.getTime()-6048E5):d.setTime(d.getTime()-
864E5*d.getDay());for(var g=1,k=0;6>k;k++){e.push('\x3cdiv style\x3d"top: ',k/6*100,'%;" class\x3d"week"\x3e');for(var m=0;7>m;m++)e.push('\x3cdiv style\x3d"left: ',m/7*100,"%; width: ",1/7*100,'%;"'),null!=c&&c.getFullYear()==d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()?e.push('class\x3d"day the-date"\x3e'):d.getMonth()!=b.getMonth()?e.push('class\x3d"day not-this-month"\x3e'):a.getFullYear()==d.getFullYear()&&a.getMonth()==d.getMonth()&&a.getDate()==d.getDate()?e.push('class\x3d"day today"\x3e'):
e.push('class\x3d"day"\x3e'),e.push('\x3cspan day_index\x3d"',g,'"\x3e',d.getDate(),"\x3c/span\x3e"),e.push("\x3c/div\x3e"),d.setTime(d.getTime()+864E5),g++;e.push("\x3c/div\x3e")}e.push("\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");return e.join("")};js.$public.render=function(a,b){this.$super(a,b);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mouseup",this.mouseUp);this.invalidateSize()};js.$protected.update=function(){var a=new Date,b=this._currentMonth,c=this._selectedDate;null==b&&(this._currentMonth=
b=null==c?new Date(a.getFullYear(),a.getMonth(),1):new Date(c.getFullYear(),c.getMonth(),1));this._$element.find(".calendar-month").text(f.I18N.getString("qs.ui.calendar.title",b.getFullYear(),b.getMonth()+1));var d=new Date(b.getFullYear(),b.getMonth(),1);0==d.getDay()?d.setTime(d.getTime()-6048E5):d.setTime(d.getTime()-864E5*d.getDay());for(var e=this._$element.find(".calendar .week").first(),g=0;6>g;g++){for(var k=e.find(".day").first(),m=0;7>m;m++)null!=c&&c.getFullYear()==d.getFullYear()&&c.getMonth()==
d.getMonth()&&c.getDate()==d.getDate()?k.attr("class","day the-date"):d.getMonth()!=b.getMonth()?k.attr("class","day not-this-month"):a.getFullYear()==d.getFullYear()&&a.getMonth()==d.getMonth()&&a.getDate()==d.getDate()?k.attr("class","day today"):k.attr("class","day"),k.find("span").first().text(d.getDate()),d.setTime(d.getTime()+864E5),k=k.next();e=e.next()}};js.$protected.prevMonth=function(){var a=this._currentMonth;this._currentMonth=a=new Date(a.getFullYear(),a.getMonth()-1,1)};js.$protected.nextMonth=
function(){var a=this._currentMonth;this._currentMonth=a=new Date(a.getFullYear(),a.getMonth()+1,1)};js.$protected.prevYear=function(){var a=this._currentMonth;this._currentMonth=a=new Date(a.getFullYear()-1,a.getMonth(),1)};js.$protected.nextYear=function(){var a=this._currentMonth;this._currentMonth=a=new Date(a.getFullYear()+1,a.getMonth(),1)};js.$public.mouseDown=function(a){a=l(a.target);switch(a.attr("id")){case "calendar-p":this.prevMonth();this.update();break;case "calendar-n":this.nextMonth();
this.update();break;case "calendar-pp":this.prevYear();this.update();break;case "calendar-nn":this.nextYear(),this.update()}a=a.attr("day_index");if(void 0!==a){var b=this._currentMonth,b=new Date(b.getFullYear(),b.getMonth(),1);0==b.getDay()?b.setTime(b.getTime()-6048E5):b.setTime(b.getTime()-864E5*b.getDay());b.setTime(b.getTime()+864E5*(a-1));this._selectedDate=b;this.update()}};js.$public.mouseUp=function(a){void 0!==l(a.target).attr("day_index")&&this._$element.trigger("change")}});l.fn.qs_calendar=
function(a){return this.each(function(){var b=new f.ui.Calendar;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.TextInput",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._text="";this._readonly=this._password=!1;this._restrict=null;this._textMask="";this._maxChars=0};js.$public.maxChars=function(a){if(void 0===a)return this._maxChars;this._maxChars=a};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find("input").attr("name",a)};js.$public.enabled=function(a){if(void 0===
a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this._enabled?(this._$element.removeClass("qs-disabled"),this._$element.find("input").removeAttr("readonly")):(this._$element.addClass("qs-disabled"),this._$element.find("input").attr("readonly","readonly"))})};js.$public.textMask=function(a){if(void 0===a)return this._textMask;this._textMask=a;this.callAfterRendered(function(){var a=this._$element.find("input");""==this._text&&""!=this._textMask?(a.val(this._textMask),a.addClass("masked")):
a.removeClass("masked")})};js.$public.readonly=function(a){if(void 0===a)return this._readonly;this._readonly=a;this.callAfterRendered(function(){this._readonly?this._$element.find("input").attr("readonly","readonly"):this._$element.find("input").removeAttr("readonly")})};js.$public.restrict=function(a){if(void 0===a)return this._restrict;this._restrict=a};js.$public.focus=function(){this.isRendered()&&this._$element.find("input").focus()};js.$public.text=function(a){if(void 0===a)return this._$element?
(a=this._$element.find("input").val(),a==this._textMask?"":a):_text;this._text=a;if(this._$element){var b=this._$element.find("input");""!=a||""==this._textMask?(b.val(a),b.removeClass("masked")):""!=this._textMask&&(b.val(this._textMask),b.addClass("masked"));this.dispatchEvent("change")}};js.$public.value=function(a){if(void 0===a)return this.text();this.text(a)};js.$public.password=function(a){if(void 0===a)return this._password;this._password=a;this.callAfterRendered(function(){if(!0==this._password)if(!0==
l.browser.msie&&10>l.browser.version)this._$element.children(".qs-input").html('\x3cinput type\x3d"password" name\x3d"'+this.name()+'" value\x3d"'+this._text+'"\x3e\x3c/input\x3e');else return this._$element.find("input").attr("type","password");else return this._$element.find("input").attr("type","text")})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-input qs-textinput"\x3e','\x3cinput type\x3d"text" name\x3d"',this.name(),'" value\x3d"',this._text,'"\x3e\x3c/input\x3e',
"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-textinput");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=c.find("input");this.bindEvent("focusin",function(a){!this._enabled||this._readonly?(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()):(c.addClass("qs-input-focused"),""!=this._textMask&&d.val()==this._textMask&&(d.val(""),d.removeClass("masked")))},
d);this.bindEvent("focusout",function(a){c.removeClass("qs-input-focused");""!=this._textMask&&""==d.val()&&(d.addClass("masked"),d.val(this._textMask))},d);this.bindEvent("keypress",function(a){if(0<this._maxChars&&this.text().length>=this._maxChars||null!=this._restrict&&null==String.fromCharCode(a.which).match(this._restrict))return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1},d);this.bindEvent("input",function(a){this.dispatchEvent("change")},d);this.invalidateSize()}});
l.fn.qs_textinput=function(a){return this.each(function(){var b=new f.ui.TextInput;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.ColorPicker",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(b){this.$super(b);this._text="";this._readonly=!0;this._restrict=null;this.callAfterRendered(function(){a.init(this._$element)})};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find("input").attr("name",a)};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this._enabled?
this._$element.removeClass("qs-disabled"):this._$element.addClass("qs-disabled")})};js.$public.readonly=function(a){};js.$public.restrict=function(a){if(void 0===a)return this._restrict;this._restrict=a};js.$public.focus=function(){this.isRendered()&&this._$element.find("input").focus()};js.$public.text=function(b){if(void 0===b)return this._$element?this._$element.find("input").val():_text;this._text=b;this._$element&&this._$element.find("input").val(b);this._$element&&a.fireEvent(l(this._$element).find("."+
a.bindClass)[0],"input")};js.$public.value=function(a){if(void 0===a)return this.text();this.text(a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-input qs-colorpicker"\x3e','\x3cinput class\x3d"qs-colorpicker-color" type\x3d"text" name\x3d"',this.name(),'" value\x3d"',this._text,'" readonly\x3e\x3c/input\x3e',"\x3c/div\x3e")};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);var d=a.find(".qs-colorpicker");
this.$styleElement(d);0<c.classes.length&&d.addClass(c.classes);var e=d.find("input");this.bindEvent("focusin",function(a){!this._enabled||this._readonly?(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()):d.addClass("qs-input-focused")},e);e.focusout(function(a){d.removeClass("qs-input-focused")});this.bindEvent("keypress",function(a){if(null!=this._restrict&&null==String.fromCharCode(a.which).match(this._restrict))return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),
!1},e);this.bindEvent("input",function(a){this.dispatchEvent("change")},e);this.invalidateSize()};var a={dir:"",bindClass:"qs-colorpicker-color",binding:!0,preloading:!0,init:function(b){a.binding&&a.bind(b);a.preloading&&a.preload()},getDir:function(){a.dir||(a.dir=wos.Desktop.getAbsoluteUrl("applications/qsweb/images/icons/"));return a.dir},bind:function(b){var c=l(b).find("."+a.bindClass);c&&(c[0].color=new a.color(c[0],b))},preload:function(){for(var b in a.imgRequire)a.imgRequire.hasOwnProperty(b)&&
a.loadImage(b)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(b){a.imgRequire[b]=!0},loadImage:function(b){a.imgLoaded[b]||(a.imgLoaded[b]=new Image,a.imgLoaded[b].src=a.getDir()+b)},fetchElement:function(a){return"string"===typeof a?document.getElementById(a):a},addEvent:function(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d)},fireEvent:function(a,c){if(a)if(document.createEvent){var d=
document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);a.dispatchEvent(d)}else if(document.createEventObject)d=document.createEventObject(),a.fireEvent("on"+c,d);else if(a["on"+c])a["on"+c]()},getRelMousePos:function(a){var c=0,d=0;a||(a=window.event);"number"===typeof a.offsetX?(c=a.offsetX,d=a.offsetY):"number"===typeof a.layerX&&(c=a.layerX,d=a.layerY);return{x:c,y:d}},color:function(b,c){function d(a,c,b){if(null===a)return[b,b,b];var d=Math.floor(a),e=b*(1-c);a=b*(1-c*(d%2?a-d:1-(a-d)));switch(d){case 6:case 0:return[b,
a,e];case 1:return[a,b,e];case 2:return[e,b,a];case 3:return[e,a,b];case 4:return[a,e,b];case 5:return[b,e,a]}}function e(c,d){if(!a.picker){a.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(r.pickerCloseText)};
for(var e=0;e<a.images.sld[1];e+=4){var f=document.createElement("div");f.style.height="4px";f.style.fontSize="1px";f.style.lineHeight="0";a.picker.sld.appendChild(f)}a.picker.sldB.appendChild(a.picker.sld);a.picker.box.appendChild(a.picker.sldB);a.picker.box.appendChild(a.picker.sldM);a.picker.padB.appendChild(a.picker.pad);a.picker.box.appendChild(a.picker.padB);a.picker.box.appendChild(a.picker.padM);a.picker.btnS.appendChild(a.picker.btnT);a.picker.btn.appendChild(a.picker.btnS);a.picker.box.appendChild(a.picker.btn);
a.picker.boxB.appendChild(a.picker.box)}var m=a.picker;m.box.onmouseup=m.box.onmouseout=function(){b.focus()};m.box.onmousedown=function(){v=!0};m.box.onmousemove=function(a){if(B||y)B&&l(a),y&&q(a),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),s()};m.padM.onmouseup=m.padM.onmouseout=function(){B&&(B=!1,a.fireEvent(z,"change"))};m.padM.onmousedown=function(a){switch(t){case 0:0===r.hsv[2]&&r.fromHSV(null,null,1);break;case 1:0===r.hsv[1]&&
r.fromHSV(null,1,null)}y=!1;B=!0;l(a);s()};m.sldM.onmouseup=m.sldM.onmouseout=function(){y&&(y=!1,a.fireEvent(z,"change"))};m.sldM.onmousedown=function(a){B=!1;y=!0;q(a);s()};e=[2*r.pickerInset+2*r.pickerFace+a.images.pad[0]+(r.slider?2*r.pickerInset+2*a.images.arrow[0]+a.images.sld[0]:0),r.pickerClosable?4*r.pickerInset+3*r.pickerFace+a.images.pad[1]+r.pickerButtonHeight:2*r.pickerInset+2*r.pickerFace+a.images.pad[1]];m.box.style.width=e[0]+"px";m.box.style.height=e[1]+"px";m.boxB.style.position=
"absolute";m.boxB.style.clear="both";m.boxB.style.left=c+"px";m.boxB.style.top=d+"px";m.boxB.style.zIndex=r.pickerZIndex;m.boxB.style.border=r.pickerBorder+"px solid";m.boxB.style.borderColor=r.pickerBorderColor;m.boxB.style.background=r.pickerFaceColor;m.pad.style.width=a.images.pad[0]+"px";m.pad.style.height=a.images.pad[1]+"px";m.padB.style.position="absolute";m.padB.style.left=r.pickerFace+"px";m.padB.style.top=r.pickerFace+"px";m.padB.style.border=r.pickerInset+"px solid";m.padB.style.borderColor=
r.pickerInsetColor;m.padM.style.position="absolute";m.padM.style.left="0";m.padM.style.top="0";m.padM.style.width=r.pickerFace+2*r.pickerInset+a.images.pad[0]+a.images.arrow[0]+"px";m.padM.style.height=m.box.style.height;m.padM.style.cursor="crosshair";m.sld.style.overflow="hidden";m.sld.style.width=a.images.sld[0]+"px";m.sld.style.height=a.images.sld[1]+"px";m.sldB.style.display=r.slider?"block":"none";m.sldB.style.position="absolute";m.sldB.style.right=r.pickerFace+"px";m.sldB.style.top=r.pickerFace+
"px";m.sldB.style.border=r.pickerInset+"px solid";m.sldB.style.borderColor=r.pickerInsetColor;m.sldM.style.display=r.slider?"block":"none";m.sldM.style.position="absolute";m.sldM.style.right="0";m.sldM.style.top="0";m.sldM.style.width=a.images.sld[0]+a.images.arrow[0]+r.pickerFace+2*r.pickerInset+"px";m.sldM.style.height=m.box.style.height;try{m.sldM.style.cursor="pointer"}catch(n){m.sldM.style.cursor="hand"}m.btn.style.display=r.pickerClosable?"block":"none";m.btn.style.position="absolute";m.btn.style.left=
r.pickerFace+"px";m.btn.style.bottom=r.pickerFace+"px";m.btn.style.padding="0 15px";m.btn.style.height="18px";m.btn.style.border=r.pickerInset+"px solid";(function(){var a=r.pickerInsetColor.split(/\s+/);m.btn.style.borderColor=2>a.length?a[0]:a[1]+" "+a[0]+" "+a[0]+" "+a[1]})();m.btn.style.color=r.pickerButtonColor;m.btn.style.font="12px sans-serif";m.btn.style.textAlign="center";try{m.btn.style.cursor="pointer"}catch(u){m.btn.style.cursor="hand"}m.btnS.style.lineHeight=m.btn.style.height;switch(t){case 0:var C=
"hs.png";break;case 1:C="hv.png"}m.padM.style.backgroundImage="url('"+a.getDir()+"cross.gif')";m.padM.style.backgroundRepeat="no-repeat";m.sldM.style.backgroundImage="url('"+a.getDir()+"arrow.gif')";m.sldM.style.backgroundRepeat="no-repeat";m.pad.style.backgroundImage="url('"+a.getDir()+C+"')";m.pad.style.backgroundRepeat="no-repeat";m.pad.style.backgroundPosition="0 0";g();k();a.picker.owner=r;return m.boxB}function g(){switch(t){case 0:var c=1;break;case 1:c=2}var b=Math.round(r.hsv[0]/6*(a.images.pad[0]-
1)),c=Math.round((1-r.hsv[c])*(a.images.pad[1]-1));a.picker.padM.style.backgroundPosition=r.pickerFace+r.pickerInset+b-Math.floor(a.images.cross[0]/2)+"px "+(r.pickerFace+r.pickerInset+c-Math.floor(a.images.cross[1]/2))+"px";b=a.picker.sld.childNodes;switch(t){case 0:for(var e=d(r.hsv[0],r.hsv[1],1),c=0;c<b.length;c+=1)b[c].style.backgroundColor="rgb("+e[0]*(1-c/b.length)*100+"%,"+e[1]*(1-c/b.length)*100+"%,"+e[2]*(1-c/b.length)*100+"%)";break;case 1:var g,f=[r.hsv[2],0,0],c=Math.floor(r.hsv[0]),
k=c%2?r.hsv[0]-c:1-(r.hsv[0]-c);switch(c){case 6:case 0:e=[0,1,2];break;case 1:e=[1,0,2];break;case 2:e=[2,0,1];break;case 3:e=[2,1,0];break;case 4:e=[1,2,0];break;case 5:e=[0,2,1]}for(c=0;c<b.length;c+=1)g=1-1/(b.length-1)*c,f[1]=f[0]*(1-g*k),f[2]=f[0]*(1-g),b[c].style.backgroundColor="rgb("+100*f[e[0]]+"%,"+100*f[e[1]]+"%,"+100*f[e[2]]+"%)"}}function k(){switch(t){case 0:var c=2;break;case 1:c=1}c=Math.round((1-r.hsv[c])*(a.images.sld[1]-1));a.picker.sldM.style.backgroundPosition="0 "+(r.pickerFace+
r.pickerInset+c-Math.floor(a.images.arrow[1]/2))+"px"}function m(){return a.picker&&a.picker.owner===r}function n(){z!==b&&r.importColor()}function l(c){var b=a.getRelMousePos(c);c=b.x-r.pickerFace-r.pickerInset;b=b.y-r.pickerFace-r.pickerInset;switch(t){case 0:r.fromHSV(6/(a.images.pad[0]-1)*c,1-b/(a.images.pad[1]-1),null,E);break;case 1:r.fromHSV(6/(a.images.pad[0]-1)*c,null,1-b/(a.images.pad[1]-1),E)}}function q(c){c=a.getRelMousePos(c).y-r.pickerFace-r.pickerInset;switch(t){case 0:r.fromHSV(null,
null,1-c/(a.images.sld[1]-1),C);break;case 1:r.fromHSV(null,1-c/(a.images.sld[1]-1),null,C)}}function s(){r.onImmediateChange&&("string"===typeof r.onImmediateChange?new Function(r.onImmediateChange):r.onImmediateChange).call(r)}this.slider=this.caps=this.hash=this.adjust=this.required=!0;this.styleElement=this.valueElement=b;this.onImmediateChange=null;this.hsv=[0,0,1];this.rgb=[1,1,1];this.minH=0;this.maxH=6;this.minS=0;this.maxS=1;this.minV=0;this.maxV=1;this.source=c;this.pickerOnfocus=!0;this.pickerMode=
"HSV";this.pickerPosition="bottom";this.pickerSmartPosition=!0;this.pickerButtonHeight=20;this.pickerClosable=!1;this.pickerCloseText="Close";this.pickerButtonColor="ButtonText";this.pickerFace=10;this.pickerFaceColor="ThreeDFace";this.pickerBorder=1;this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight";this.pickerInset=1;this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow";this.pickerZIndex=1E4;this.showPicker=function(){if(!m()){var a=e(0,
0);f.ui.popup.show(a,{x:0,y:c.outerHeight()+1,innerClasses:"qs-colorpicker-border qs-ani-fadein",$relative:c})}};this.importColor=function(){z?this.adjust?!this.required&&/^\s*$/.test(z.value)?(z.value="",A.style.backgroundImage=A.jscStyle.backgroundImage,A.style.backgroundColor=A.jscStyle.backgroundColor,A.style.color=A.jscStyle.color,this.exportColor(u|D)):this.fromString(z.value)||this.exportColor():this.fromString(z.value,u)||(A.style.backgroundImage=A.jscStyle.backgroundImage,A.style.backgroundColor=
A.jscStyle.backgroundColor,A.style.color=A.jscStyle.color,this.exportColor(u|D)):this.exportColor()};this.exportColor=function(a){if(!(a&u)&&z){var c=this.toString();this.caps&&(c=c.toUpperCase());this.hash&&(c="#"+c);z.value=c}a&D||!A||(A.style.backgroundImage="none",A.style.backgroundColor="#"+this.toString(),A.style.color=0.5>0.213*this.rgb[0]+0.715*this.rgb[1]+0.072*this.rgb[2]?"#FFF":"#000");a&C||!m()||g();a&E||!m()||k()};this.fromHSV=function(a,c,b,e){null!==a&&(a=Math.max(0,this.minH,Math.min(6,
this.maxH,a)));null!==c&&(c=Math.max(0,this.minS,Math.min(1,this.maxS,c)));null!==b&&(b=Math.max(0,this.minV,Math.min(1,this.maxV,b)));this.rgb=d(null===a?this.hsv[0]:this.hsv[0]=a,null===c?this.hsv[1]:this.hsv[1]=c,null===b?this.hsv[2]:this.hsv[2]=b);this.exportColor(e)};this.fromRGB=function(a,c,b,e){null!==a&&(a=Math.max(0,Math.min(1,a)));null!==c&&(c=Math.max(0,Math.min(1,c)));null!==b&&(b=Math.max(0,Math.min(1,b)));a=null===a?this.rgb[0]:a;c=null===c?this.rgb[1]:c;var g=null===b?this.rgb[2]:
b,f=Math.min(Math.min(a,c),g);b=Math.max(Math.max(a,c),g);var k=b-f;0===k?a=[null,0,b]:(a=a===f?3+(g-c)/k:c===f?5+(a-g)/k:1+(c-a)/k,a=[6===a?0:a,k/b,b]);null!==a[0]&&(this.hsv[0]=Math.max(0,this.minH,Math.min(6,this.maxH,a[0])));0!==a[2]&&(this.hsv[1]=null===a[1]?null:Math.max(0,this.minS,Math.min(1,this.maxS,a[1])));this.hsv[2]=null===a[2]?null:Math.max(0,this.minV,Math.min(1,this.maxV,a[2]));a=d(this.hsv[0],this.hsv[1],this.hsv[2]);this.rgb[0]=a[0];this.rgb[1]=a[1];this.rgb[2]=a[2];this.exportColor(e)};
this.fromString=function(a,c){var b=a.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return b?(6===b[1].length?this.fromRGB(parseInt(b[1].substr(0,2),16)/255,parseInt(b[1].substr(2,2),16)/255,parseInt(b[1].substr(4,2),16)/255,c):this.fromRGB(parseInt(b[1].charAt(0)+b[1].charAt(0),16)/255,parseInt(b[1].charAt(1)+b[1].charAt(1),16)/255,parseInt(b[1].charAt(2)+b[1].charAt(2),16)/255,c),!0):!1};this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*
this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};this.hidePicker=function(){m()&&delete a.picker.owner};var r=this,t="hvs"===this.pickerMode.toLowerCase()?1:0,v=!1,z=a.fetchElement(this.valueElement),A=a.fetchElement(this.styleElement),B=!1,y=!1,u=1,D=2,C=4,E=8;a.addEvent(b,"focus",function(){r.pickerOnfocus&&r.showPicker()});a.addEvent(b,"blur",function(){v?v=!1:window.setTimeout(function(){v||(z===b&&r.importColor(),r.pickerOnfocus&&r.hidePicker());
v=!1},0)});z&&(a.addEvent(z,"input",function(){r.fromString(z.value,u);s()}),a.addEvent(z,"blur",n),z.setAttribute("autocomplete","off"));A&&(A.jscStyle={backgroundImage:A.style.backgroundImage,backgroundColor:A.style.backgroundColor,color:A.style.color});switch(t){case 0:a.requireImage("hs.png");break;case 1:a.requireImage("hv.png")}a.requireImage("cross.gif");a.requireImage("arrow.gif");this.importColor()}}});l.fn.qs_colorpicker=function(a){return this.each(function(){var b=new f.ui.ColorPicker;
b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.Label",f.ui.Control,function(){this.initialize=function(a){"string"===f.type(a)?(this._text=a,this.$super()):(this.$super(a),this._text="")};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this._enabled?this._$element.removeClass("qs-disabled"):this._$element.addClass("qs-disabled")})};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&this._$element.find(".qs-label span").text(a)};
js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-label"\x3e',"\x3cspan\x3e",this._text,"\x3c/span\x3e","\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this._$element.find(".qs-label").css("line-height",this.outerHeight()-2+"px")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",text:""},this._options,b);""!=b.text&&(this._text=b.text);this.$super(a,b);var c=a.find(".qs-label");0<b.classes.length&&
c.addClass(b.classes);this.invalidateSize()}});l.fn.qs_label=function(a){return this.each(function(){var b=new f.ui.Label;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.NumberInput",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._value=NaN;this._precision=0;this._maximum=Number.MAX_VALUE;this._minimum=Number.MIN_VALUE;this._stepSize=1};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find(".qs-number input").attr("name",a)};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a};
js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a};js.$public.stepSize=function(a){if(void 0===a)return this._stepSize;this._stepSize=a};js.$public.value=function(a){if(void 0===a)return this._$element?parseFloat(this._$element.find("input").val()):parseFloat(Number(this._value).toFixed(this._precision));a=parseFloat(a);isFinite(a)||(a=0);a=Math.max(Math.min(this._maximum,a),this._minimum);var b=this._value;this._value=a.toFixed(this._precision);this._$element&&this._$element.find("input").val(this._value);
b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$public.precision=function(a){if(void 0===a)return this._precision;this._precision=a;a=this.value();isNaN(a)||this.value(a)};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.find(".qs-number .num-stepper .up-stepper");c.css("line-height",b/2-2+"px");c=this._$element.find(".qs-number .num-stepper .down-stepper");c.css("line-height",b/2-2+"px")}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-input qs-number"\x3e',
'\x3cinput type\x3d"text" name\x3d"',this.name(),'" value\x3d"',isNaN(this._value)?"":this._value,'"\x3e\x3c/input\x3e','\x3cdiv class\x3d"num-stepper"\x3e','\x3cdiv class\x3d"up-stepper"\x3e','\x3cdiv class\x3d"up-stepper-icon"\x3e\x3c/div\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"down-stepper"\x3e','\x3cdiv class\x3d"down-stepper-icon"\x3e\x3c/div\x3e',"\x3c/div\x3e","\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,
b);this.$super(a,b);var c=a.find(".qs-number");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=c.find("input");d.focusin(function(a){c.addClass("qs-input-focused")});d.focusout(function(a){c.removeClass("qs-input-focused")});this.bindEvent("keypress",function(a){var c=a.which;if(46!=c&&45!=c&&43!=c&&(48>c||57<c))return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),13==c&&e.value(e.value()),!1},d);this.bindEvent("input",function(a){a=d.caret();var c=this._$element.find("input").val();
if(0<=c.indexOf("-")){var c=isNaN(parseFloat(c)),b=this._value;this._value=c;b!==c&&this.dispatchEvent("change",{oldValue:b,newValue:c})}else e.value(e.value());d.caret(a)},d);var e=this,g=this._$element.find(".qs-number .num-stepper .up-stepper");g.mousedown(function(a){e.setCapture(g);g.addClass("pressed");return!1});g.mouseup(function(a){g.removeClass("pressed");e.releaseCapture(g);return!1});g.click(function(a){e.value(e.value()+e._stepSize)});var f=this._$element.find(".qs-number .num-stepper .down-stepper");
f.mousedown(function(a){e.setCapture(f);f.addClass("pressed");return!1});f.mouseup(function(a){f.removeClass("pressed");e.releaseCapture(f);return!1});f.click(function(a){e.value(e.value()-e._stepSize)});a.bind("mousewheel",function(a,c){0>c?e.value(e.value()-e._stepSize):e.value(e.value()+e._stepSize);return!1});this.invalidateSize()}});l.fn.qs_numberinput=function(a){return this.each(function(){var b=new f.ui.NumberInput;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}js.$class("qs.ui.DateField",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._selectedDate=null;this.isEditing=!1;this.showDate=!0;this.showTime=!1;this.formatTime="HH:mm";this.formatDate="yyyy-MM-dd";this.formatDateTime="yyyy-MM-dd HH:mm";this._dtConstants="yyyy yy MM mm dd HH hh ss a/p".split(" ");this._wtConstants=[4,2,2,2,2,2,2,2,2];this.activeSelection=0;this.tabsSelections=
[];this._lastPressedKeys={}};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find(".qs-datefield input").attr("name",a)};js.$public.focus=function(){this.isRendered()&&(this._$element.find("input").focus(),this.activeSelection=0,this.updateTextSelection())};js.$public.selectedDate=function(a){if(void 0===a)return this._selectedDate;var c=this._selectedDate;this._selectedDate=a;this._$element&&(null!=this._selectedDate?this._$element.find(".qs-datefield input").val(DateUtil.format(this._selectedDate,
this.format())):this._$element.find(".qs-datefield input").val(""));c!==a&&this.dispatchEvent("change",{oldValue:c,newValue:a})};js.$public.value=function(a){return this.selectedDate(a)};js.$public.updateSize=function(a,c){this.$super();this.isRendered()&&this._$element.find(".qs-datefield .qs-icon").css("top",(this.outerHeight()-16)/2-2)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-input qs-datefield"\x3e','\x3cinput type\x3d"text" name\x3d"',this.name(),'" value\x3d"',
this._text,'"\x3e','\x3cdiv class\x3d"qs-icon"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);var d=a.find(".qs-datefield");this.$styleElement(d);0<c.classes.length&&d.addClass(c.classes);var e=d.find("input"),g=d.find(".qs-icon"),f=this;e.focusin(function(a){d.addClass("qs-input-focused");f.isEditing=!0});e.focusout(function(a){d.removeClass("qs-input-focused");f.isEditing=!1});this.bindEvent("keydown",
this.keyDown,e);this.bindEvent("mouseup",this.mouseUp,e);this.bindEvent("click",this.openDetail,g);null!=this._selectedDate?e.val(DateUtil.format(this._selectedDate,this.format())):e.val("");this.tabsSelections=this.getTabsSelections();e.bind("mousewheel",function(a,c){if(f.isEditing)return 0>c?f.moveDown(a):f.moveUp(a),!1});this.invalidateSize()};this.openDetail=function(){var a=new f.ui.Calendar;a.selectedDate(this._selectedDate);f.ui.popup.show(a,{x:this.outerWidth()-194,y:30,width:194,height:191,
classes:"qs-calendar-popup qs-ani-popup",$relative:this._$element.find(".qs-datefield")});var c=this;f.ui.popup.$element().bind("change",function(){c.selectedDate(a.selectedDate());l.browser.mozilla?f.ui.popup.$element().css("-moz-transform","scale(0)").css("-moz-transition","transform 0.4s ease 0s").css("-moz-transition","-moz-transform 0.4s ease 0s"):l.browser.webkit?f.ui.popup.$element().css("-webkit-transform","scale(0)").css("transition","-webkit-transform 0.4s ease 0s").css("-webkit-transition",
"-webkit-transform 0.4s ease 0s"):l.browser.msie&&f.ui.popup.$element().css("transform","scale(0)").css("transition","-ms-transform 0.4s ease 0s").css("-ms-transition","-ms-transform 0.4s ease 0s");setTimeout(function(){f.ui.popup.hide()},300)})};this.format=function(){var a=this.showTime,c=this.showDate;return!0===a&&!0===c?this.formatDateTime:!0===a?this.formatTime:this.formatDate};this.getTabsSelections=function(){var a=[],c=this.format();if(StringUtil.isEmpty(c))throw"format error.";for(var d=
RegExp("yyyy|yy|MM|mm|dd|HH|hh|ss|a/p","gi"),e;null!=(e=d.exec(c));)switch(e[0]){case "yyyy":a.push({key:e[0],textSelection:{start:e.index,end:e.index+4}});break;case "yy":case "MM":case "dd":case "HH":case "hh":case "mm":case "ss":case "a/p":a.push({key:e[0],textSelection:{start:e.index,end:e.index+2}})}return a};this.updateTextSelection=function(){if(null!=this._selectedDate){var a=this.activeSelection,c=this.tabsSelections,d=this._$element.find(".qs-datefield input");d.val(DateUtil.format(this._selectedDate,
this.format()));this.isEditing&&d.setSelectionRange(c[a].textSelection.start,c[a].textSelection.end)}};this.updateValue=function(b,c){if(null==this._selectedDate){var d=new Date;this._selectedDate=new Date(d.getFullYear(),d.getMonth(),d.getDate())}d=new Date(this._selectedDate.getTime());if("down"===c||"up"===c){var e="down"===c?-1:1;switch(b){case "dd":var g=(new Date(d.getFullYear(),d.getMonth()+1,0)).getDate(),e=d.getDate()+e;1>e&&(e=g);e>g&&(e=1);this._selectedDate.setDate(e);break;case "MM":e=
d.getMonth()+e;0>e&&(e=11);11<e&&(e=0);this._selectedDate.setMonth(e);break;case "HH":case "hh":e=d.getHours()+e;0>e&&(e=23);23<e&&(e=0);this._selectedDate.setHours(e);break;case "mm":e=d.getMinutes()+e;0>e&&(e=59);59<e&&(e=0);this._selectedDate.setMinutes(e);break;case "a/p":g=12<=this._selectedDate.getHours()?-12:12;this._selectedDate.setHours(d.getHours()+g);break;case "ss":e=d.getSeconds()+e;0>e&&(e=59);59<e&&(e=0);this._selectedDate.setSeconds(e);break;case "yy":case "yyyy":this._selectedDate.setYear(d.getFullYear()+
e)}}else{var f=this._lastPressedKeys,e=(new Date).getTime();8E3<e-this._lastPressedTime&&(f={});var m=!1;switch(b){case "yyyy":a(f.val1)?a(f.val3)?(g=parseInt(""+f.val3+f.val2+f.val1+c),m=!0):a(f.val2)?g=parseInt(""+f.val2+f.val1+c+"0"):a(f.val1)&&(g=parseInt(""+f.val1+c+"00")):g=parseInt(""+c+"000");1E3<=g&&this._selectedDate.setYear(g);break;case "yy":a(f.val1)?(g=parseInt("20"+f.val1+c),m=!0):g=parseInt("200"+c);this._selectedDate.setYear(d.getFullYear()+g);break;case "MM":this._updateValue("month",
c,12);if(a(f.val1)||2<c)m=!0;break;case "dd":g=(new Date(d.getFullYear(),d.getMonth()+1,0)).getDate();this._updateValue("day",c,g);a(f.val1)&&(m=!0);break;case "HH":this._updateValue("hour",c,24,!0);a(f.val1)&&(m=!0);break;case "hh":this._updateValue("hour",c,12,!0);a(f.val1)&&(m=!0);break;case "mm":this._updateValue("minute",c,60,!0);a(f.val1)&&(m=!0);break;case "ss":this._updateValue("second",c,60,!0),a(f.val1)&&(m=!0)}!0==m&&(g=this.activeSelection+1,g>=this.tabsSelections.length&&(g=this.tabsSelections.length-
1),this.activeSelection=g,f={});f.val3=f.val2;f.val2=f.val1;f.val1=c;this._lastPressedTime=e;this._lastPressedKeys=f}this.updateTextSelection();d.getTime()!=this._selectedDate.getTime()&&this.dispatchEvent("change",{oldValue:d,newValue:this._selectedDate})};this._updateValue=function(a,c,d,e){var g=this._selectedDate,f;switch(a){case "year":f=g.getFullYear();break;case "month":f=g.getMonth()+1;break;case "day":f=g.getDate();break;case "hour":f=g.getHours();break;case "minute":f=g.getMinutes();break;
case "second":f=g.getSeconds()}f=parseInt(""+f+c);if(f>d||!(0<this._lastPressedKeys.val1))f=c;if(0<f||e){c={};c[a]=f;e&&("hour"===a&&(c.minute=g.getMinutes()),"hour"===a||"minute"===a)&&(c.seconde=g.getSeconds());for(var m in c)switch(m){case "year":g.setYear(c[m]);break;case "month":g.setMonth(c[m]-1);break;case "day":g.setDate(c[m]);break;case "hour":g.setHours(c[m]);break;case "minute":g.setMinutes(c[m]);break;case "second":g.setSeconds(c[m])}this._selectedDate=g;this.updateTextSelection()}};this.interpretKeyEvents=
function(a){switch(a.which){case 37:return this.moveLeft(a);case 38:return this.moveUp(a);case 39:return this.moveRight(a);case 40:return this.moveDown(a);case 9:return this.insertTab(a);case 13:return this.insertNewline(a);case 8:return this.insertBacktab(a)}return!1};this.keyDown=function(b){var c={48:0,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,96:0,97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9}[b.keyCode];if(a(c))return this.updateValue(this.tabsSelections[this.activeSelection].key,c),
b.preventDefault(),b.stopPropagation(),!0;this._lastPressedKeys={};if(this.interpretKeyEvents(b))return b.preventDefault(),b.stopPropagation(),!0;46==b.keyCode&&this.value(null)};this.moveUp=function(a){this.updateValue(this.tabsSelections[this.activeSelection].key,"up");return!0};this.moveDown=function(a){this.updateValue(this.tabsSelections[this.activeSelection].key,"down");return!0};this.moveRight=function(a){a=this.activeSelection+1;a===this.tabsSelections.length&&(a=0);this.activeSelection=a;
this.updateTextSelection();return!0};this.moveLeft=function(a){a=this.tabsSelections;var c=this.activeSelection-1;-1===c&&(c=a.length-1);this.activeSelection=c;this.updateTextSelection();return!0};this.insertTab=function(a){if(null==this._selectedDate)return!1;a=this.activeSelection+1;return a<this.tabsSelections.length?(this.activeSelection=a,this.updateTextSelection(),!0):!1};this.insertNewline=function(a){a=this.activeSelection+1;return a<this.tabsSelections.length?(this.activeSelection=a,this.updateTextSelection(),
!0):!1};this.insertBacktab=function(a){a=this.activeSelection-1;return-1!==a?(this.activeSelection=a,this.updateTextSelection(),!0):!1};this.mouseUp=function(a){a=this._$element.find(".qs-datefield input").caret();for(var c=this.tabsSelections,d=c.length,e,g=0;g<d;g++)if(e=c[g].textSelection,a>=e.start&&a<=e.end){this.activeSelection=g;this.updateTextSelection();this._lastPressedKeys={};return}this.activeSelection=0;this.updateTextSelection();this._lastPressedKeys={}}});l.fn.qs_datefield=function(a){return this.each(function(){(new f.ui.DateField).render(l(this),
a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.Button",f.ui.Control,function(){f.events.register("click",this);this.initialize=function(a){this.$super(a);this._text="";this._iconHeight=this._iconWidth=16;this._selected=this._toggle=!1;this._icon="";this._counter=0};js.$public.icon=function(a){if(void 0===a)return this._icon;this._icon=a;null!=this._$element&&""!=this._icon&&null!=this._icon&&void 0!=this._icon&&(a=this._$element.children(".qs-button"),a.find(".qs-icon").css("background","url("+this._icon+") no-repeat"),
a.find(".qs-text").css("padding-left",this._iconWidth+2))};js.$public.counter=function(a){if(void 0===a)return this._counter;this._counter=a;this.callAfterRendered(function(){var b=this._$element.children(".qs-counter");0<a?0==b.length?(b=l('\x3cspan class\x3d"qs-counter red"\x3e'+this._counter+"\x3c/span\x3e"),this._$element.append(b)):b.html(this._counter):0<b.length&&b.remove()})};js.$public.toggle=function(a){if(void 0===a)return this._toggle;this._toggle=a};js.$public.selected=function(a){if(void 0===
a)return this._selected;this._selected=a;a=this._$element.children(".qs-button");this._selected?a.addClass("selected"):a.removeClass("selected")};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&this._$element.find(".qs-button .qs-text").text(a)};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){!1==a?this._$element.find(".qs-button").addClass("qs-button-disabled"):this._$element.find(".qs-button").removeClass("qs-button-disabled")})};
js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()&&5<b){var c=this._$element.children(".qs-button");c.css({"line-height":b-2+"px",height:b-2+"px"});c.children(".qs-icon").css("top",Math.max((b-this._iconHeight)/2-1,1));!1==c.children(".qs-text").is(":visible")&&this._$element.attr("title",this._text)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-button"\x3e','\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-text"\x3e',this._text,
"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({isDefault:!1,text:"",classes:""},this._options,b);StringUtil.isEmpty(this._text)&&!StringUtil.isEmpty(b.text)&&(this._text=b.text);this.$super(a,b);var c=a.children(".qs-button");!0===b.isDefault?c.addClass("qs-button-default"):c.addClass("qs-button-normal");0<b.classes.length&&c.addClass(b.classes);0<b.iconWidth&&(this._iconWidth=b.iconWidth);0<b.iconHeight&&(this._iconHeight=b.iconHeight);
b.icon&&(this._icon=b.icon);""!=this._icon&&null!=this._icon&&void 0!=this._icon&&(c.find(".qs-icon").css("background","url("+this._icon+") no-repeat"),c.find(".qs-text").css("padding-left",this._iconWidth+2));0<b.counter&&this.counter(b.counter);var d=this;c.mousedown(function(a){if(!d._enabled)return!1;d.setCapture(c);c.addClass("pressed")});c.mouseup(function(a){if(!d._enabled)return!1;c.removeClass("pressed");d._toggle&&d.selected(!d.selected());d.releaseCapture(c);return!1});c.click(function(a){if(!d._enabled)return!1;
d.dispatchEvent("click")});this.bindEvent("keydown",function(a){if(!d._enabled)return!1;if(13==a.keyCode||32==a.keyCode)c.addClass("pressed"),this._pressed=!0});this.bindEvent("keyup",function(a){if(!d._enabled)return!1;13!=a.keyCode&&32!=a.keyCode||!0!=this._pressed||(this._pressed=!1,c.removeClass("pressed"),this._toggle&&this.selected(!this.selected()),this._$element.trigger("click"),this.dispatchEvent("click"))});this.invalidateSize()}});js.$class("qs.ui.SimpleButton",f.ui.Control,function(){f.events.register("click",
this);this.initialize=function(a){this.$super(a)};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this._$element&&(!1==a?this._$element.addClass("disabled"):this._$element.removeClass("disabled"))};js.$public.render=function(a,b){this.$super(a,b);"undefined"==typeof b&&(b={});b=l.extend({isDefault:!1,text:"",classes:""},this._options,b);var c=StringUtil.join('\x3cdiv class\x3d"qs-simple-button"\x3e',"\x3c/div\x3e");a.append(c);c=a.find(".qs-simple-button");0<b.classes.length&&
c.addClass(b.classes);var d=this;a.mousedown(function(c){d.setCapture(a);a.addClass("pressed");return!1});a.mouseup(function(c){a.removeClass("pressed");d.releaseCapture(a);return!1});a.click(function(a){d.dispatchEvent("click")});this.invalidateSize()}});js.$class("qs.ui.UploadButton",f.ui.Button,function(){this.initialize=function(a){this.$super(a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-button qs-upload"\x3e','\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e',
'\x3cspan class\x3d"qs-text"\x3e',this.text(),"\x3c/span\x3e",'\x3cinput name\x3d"',this.name(),'" type\x3d"file" class\x3d"upload" /\x3e',"\x3c/div\x3e")}});js.$class("qs.ui.ButtonBar",f.ui.Container,function(){f.events.register("buttonClick",this);this.initialize=function(a){a=l.extend({classes:"qs-buttonbar",childOptions:{position:"relative"}},a);this.$super(a);this._toggle=!1;this._selectedItem=this._dataProvider=null;this.addEventListener("click",this.onClick)};js.$public.options=function(a){if(void 0===
a)return this._options;a||(a={classes:""});this._options&&(a=l.extend(this._options,a));-1==a.classes.indexOf("qs-buttonbar")&&(a.classes+=" qs-buttonbar");this._options=a};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this.forEach(!1,function(b){b.enabled(a)},this)})};js.$public.onClick=function(a){var b=a.target();a.preventDefault();a.stopPropagation();this.dispatchEvent("buttonClick",{button:b,data:b.data("data")})};js.$public.toggle=
function(a){if(void 0===a)return this._toggle;this._toggle=a};js.$public.updateSize=function(a,b){this.$super(a,b);this.isRendered()&&this.forEach(!1,function(a){a.height(b-2);a.isRendered()&&a.$element().height(b)},this)};js.$public.render=function(a,b){this.$super(a,b);this.invalidateSize(!0);this.updateButtons()};js.$public.updateButtons=function(){if(this.isRendered()){var a=null,b=null;this.forEach(!1,function(c){c.isRendered()&&"none"!=c.$element().css("display")&&(null==a?a=c:b=c,c=c.$element().children(".qs-button"),
c.removeClass("bar_left"),c.removeClass("bar_right"),c.addClass("bar_middle"))},this);if(null!=a&&null!=b){var c=a.$element().children(".qs-button");c.removeClass("bar_middle");c.addClass("bar_left");c=b.$element().children(".qs-button");c.removeClass("bar_middle");c.addClass("bar_right")}else null!=a&&null==b&&(c=a.$element().children(".qs-button"),c.removeClass("bar_middle"))}};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(null!=a&&"array"!=f.type(a)&&!js.instanceOf(a,
f.ArrayList))throw new TypeError("The type of ButtonBar.dataProvider must be array or qs.ArrayList.");this._dataProvider=a;this.removeAllChildren();var b;if(null!=this._dataProvider){var c=0;"array"!=f.type(this._dataProvider)&&this._dataProvider.size();var d=null,e=null;this._dataProvider.forEach(function(a){a.text||(a.text=a.label);a.classes="bar_middle";a.position="relative";b=new f.ui.Button(a);b.data("data",a);!1==this._enabled&&b.enabled(!1);!1==a.visible?b.visible(!1):null==d?d=b:e=b;this.addChild(b);
c++},this);null!=d&&null!=e?(d.isRendered()?(a=d.$element().children(".qs-button"),a.removeClass("bar_middle"),a.addClass("bar_left")):d.options().classes="bar_left",e.isRendered()?(a=e.$element().children(".qs-button"),a.removeClass("bar_middle"),a.addClass("bar_right")):e.options().classes="bar_right"):null!=d&&null==e&&(d.isRendered()?(a=d.$element().children(".qs-button"),a.removeClass("bar_middle")):d.options().classes="");this.invalidateSize(!0)}}});js.$class("qs.ui.MenuButton",f.ui.Control,
function(){f.events.register("change",this);f.events.register("click",this);this.initialize=function(a){this.$super(a);this._text="";this._menu=this._selectedItem=this._menudata=null};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&this._$element.find(".qs-menubutton .qs-text").text(a)};js.$public.selectedItem=function(a){if(void 0===a)return this._selectedItem;var b=this._selectedItem;this._selectedItem=a;a.label&&this.text(a.label);b!==a&&this.dispatchEvent("change")};
js.$public.menudata=function(a){if(void 0===a)return this._menudata;this._menudata=a;null==this._menu&&(this._menu=new f.ui.Menu,this._menu.addEventListener("itemClick",function(a,c){this.selectedItem(c)},this));this._menu.menudata(a)};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&(this._$element.find(".qs-menubutton").css("line-height",this.outerHeight()-2+"px"),this._$element.find(".qs-menubutton .qs-dropdown_button .qs-icon").css("top",(this.outerHeight()-16)/2-1))};js.$protected.template=
function(a){return StringUtil.join('\x3cdiv class\x3d"qs-menubutton qs-button-normal"\x3e','\x3cspan class\x3d"qs-text"\x3e\x26nbsp;',this._text,"\x3c/span\x3e",'\x3cspan class\x3d"qs-dropdown_button qs-button-normal"\x3e','\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e',"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({text:"",classes:""},this._options,b);StringUtil.isEmpty(this._text)&&!StringUtil.isEmpty(b.text)&&(this._text=b.text);this.$super(a,
b);var c=a.find(".qs-menubutton");0<b.classes.length&&c.addClass(b.classes);this.bindEvent("mousedown",function(){this.setCapture();c.addClass("pressed")},c);this.bindEvent("mouseup",function(){this.releaseCapture();c.removeClass("pressed")},c);this.bindEvent("click",function(a){a=l(a.target);a.hasClass("qs-dropdown_button")||a.parent().hasClass("qs-dropdown_button")||this.dispatchEvent("click")},c);var d=c.find(".qs-dropdown_button");this.bindEvent("mousedown",function(a){this.setCapture();d.addClass("pressed");
a.stopPropagation();return!1},d);this.bindEvent("mouseup",function(a){this.releaseCapture();d.removeClass("pressed");this.openMenu();a.stopPropagation();return!1},d);this.invalidateSize()};this.openMenu=function(){if(null!=this._menu){var a=this.offset();this._menu.show(a.left,a.top+this.outerHeight()+1).css("min-width",this.outerWidth())}}});l.fn.qs_button=function(a){return this.each(function(){(new f.ui.Button).render(l(this),a)})};l.fn.qs_menubutton=function(a){return this.each(function(){(new f.ui.MenuButton).render(l(this),
a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.ComboBox",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._text="";this._editable=!1;this._labelField="label";this._valueField="value";this._selectedItem=this._dataProvider=null};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find(".qs-combobox .qs-form-input").attr("name",a)};js.$public.labelField=function(a){if(void 0===a)return this._labelField;
this._labelField=a};js.$public.valueField=function(a){if(void 0===a)return this._valueField;this._valueField=a};js.$public.focus=function(){js.isNull(this._$element)||this._$element.focus()};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&(this._$element.find(".qs-combobox .qs-text").text(a),this._$element.find(".qs-combobox input").val(a));if(null!=this._dataProvider){var b=a;this._dataProvider.forEach(function(c,d){if(null!=c&&c[this._labelField]==a)return b=
c[this._valueField],!1},this);this._$element.find(".qs-combobox .qs-form-input").val(b)}};js.$public.editable=function(a){if(void 0===a)return this._editable;this._editable=a;this._$element&&(a?(this._$element.find(".qs-combobox input").css("display",""),this._$element.find(".qs-combobox").removeClass("qs-button-normal")):(this._$element.find(".qs-combobox input").css("display","none"),this._$element.find(".qs-combobox").addClass("qs-button-normal")))};js.$public.enabled=function(a){this.$super(a);
if(void 0===a)return this._enabled;this._enabled=a;this._$element&&(a?(this._$element.find(".qs-combobox").removeClass("qs-button-disabled"),this._$element.find(".qs-combobox .qs-dropdown_button").removeClass("qs-button-disabled")):(this._$element.find(".qs-combobox").addClass("qs-button-disabled"),this._$element.find(".qs-combobox .qs-dropdown_button").addClass("qs-button-disabled")))};js.$public.selectedItem=function(a){if(void 0===a)return this._selectedItem;var b=this._selectedItem;this._selectedItem=
a;null!=this._$element&&(null!=a?(this.text(a[this._labelField]),this._$element.find(".qs-combobox .qs-form-input").val(a[this._valueField])):(this.text(""),this._$element.find(".qs-combobox .qs-form-input").val("")));b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$public.value=function(a){if(void 0===a){var b=this.selectedItem();return null!=b&&"$null"!=b[this._valueField]?b[this._valueField]:null}var c=!1;null!=this._dataProvider&&this._dataProvider.forEach(function(b,e){if(b[this._valueField]==
a)return c=!0,this.selectedItem(b),!1},this);!1==c&&this.text(a)};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(null!=a&&"array"!=f.type(a)&&!js.instanceOf(a,f.ArrayList))throw new TypeError("The type of ComboBox.dataProvider must be array or qs.ArrayList.");this._dataProvider=a};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-combobox"),d=this.outerHeight();c.css("line-height",d-2+"px");c.height(d-2);c.find(".qs-dropdown_button .qs-icon").css("top",
(d-16)/2-1)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-combobox qs-button-normal"\x3e','\x3cspan class\x3d"qs-text"\x3e\x26nbsp;',this._text,"\x3c/span\x3e",'\x3cinput type\x3d"text" class\x3d"qs-form-input" name\x3d"',this.name(),'" value\x3d"',this._text,'" style\x3d"display:none" class\x3d"qs-input"\x3e\x3c/input\x3e','\x3cspan class\x3d"qs-dropdown_button qs-button-default"\x3e','\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e',"\x3c/span\x3e","\x3c/div\x3e")};
js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({text:"",classes:""},this._options,b);StringUtil.isEmpty(this._text)&&!StringUtil.isEmpty(b.text)&&(this._text=b.text);this.$super(a,b);this.height(this.height());this.editable(this.editable());this.enabled(this.enabled());this.dataProvider(this.dataProvider());this.selectedItem(this.selectedItem());var c=a.find(".qs-combobox");this.$styleElement(c);var d=c.find("input");0<b.classes.length&&c.addClass(b.classes);var e=this;this.bindEvent("focusin",
function(a){!this._enabled||this._readonly?(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()):c.addClass("focused")},a);this.bindEvent("focusout",function(a){c.removeClass("focused")},a);d.focusin(function(a){c.addClass("qs-input-focused");d.addClass("qs-input-focused")});d.focusout(function(a){c.removeClass("qs-input-focused");d.removeClass("qs-input-focused")});d.change(function(a){e._text=d.val()});this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mouseup",this.mouseUp);
this.bindEvent("click",this.click);this.bindEvent("keydown",this.keyDown);this.invalidateSize()};this.keyDown=function(a){if(40==a.keyCode)return this.openList(),!1};this.click=function(a){this._editable&&"INPUT"==a.target.nodeName?a.stopPropagation():this.openList()};this.openList=function(){var a=new f.ui.List;a.labelField(this._labelField);a.dataProvider(this.dataProvider());var b=new f.ui.ScrollView;b.content(a);f.ui.popup.show(b,{x:0,y:this.outerHeight()+1,classes:"qs-combobox-list",innerClasses:"sv-combobox-list qs-ani-fadein",
$relative:this._$element});var c={width:Math.max(this.outerWidth(),a.$element()[0].scrollWidth+f.ui.theme.scrollbar_width+10),height:Math.min(202,a.outerHeight()+10)};b.contentSize(c);a.addEventListener("change",function(c){var d=a.selectedIndex();if(0<=d){var k=f.ui.popup.$element();c=k.find(".qs-scrollview .sv-content");k=k.find(".qs-list ul li[index\x3d"+d+"]");d=k.height();k=k.offset().top-c.offset().top+c[0].scrollTop;k+d>c.height()?(k=k+d-c.height(),b.scrollTo(null,k)):k<c[0].scrollTop&&b.scrollTo(null,
k-d)}});c=this.selectedItem();js.isNull(c)||js.isNull(c[this._valueField])||"$null"==c[this._valueField]||a.selectedItem(c);var d=this;f.ui.popup.$element().bind("change",function(){d.selectedItem(a.selectedItem());f.ui.popup.hide();d.focus()});a.$element().focus()};this.mouseDown=function(a){this._enabled?this._editable&&"INPUT"==a.target.nodeName?a.stopPropagation():(this.setCapture(),this._$element.find(".qs-combobox").addClass("pressed"),this._$element.find(".qs-combobox .qs-dropdown_button").addClass("pressed")):
(a.preventDefault(),a.stopPropagation())};this.mouseUp=function(a){this._$element.find(".qs-combobox").removeClass("pressed");this._$element.find(".qs-combobox .qs-dropdown_button").removeClass("pressed");this.releaseCapture();return!1}});l.fn.qs_combobox=function(a){return this.each(function(){(new f.ui.ComboBox).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.List",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._itemHeight=24;this._selectedIndex=this._itemRenderer=this._selectedItem=this._dataProvider=null;this._labelField="label"};js.$public.labelField=function(a){if(void 0===a)return this._labelField;this._labelField=a};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find(".qs-list input").attr("name",
a)};js.$public.itemRenderer=function(a){if(void 0===a)return this._itemRenderer;"function"==js.type(a)?this._itemRenderer=a:this._itemRenderer=null};js.$public.itemHeight=function(a){if(void 0===a)return this._itemHeight;this._itemHeight=a;null==this._$element||isNaN(a)||this._$element.find(".qs-list ul li").css("line-height",_itemHeight+"px")};js.$public.selectedItem=function(a){if(void 0===a)return this._selectedItem;var b=this._selectedItem;this._selectedItem=a;if(null!=this._$element&&null!=this._dataProvider){var c=
this._$element.find(".qs-list input");if(null!=b&&b!=a){var d=this._$element.find(".qs-list ul li.selected");d.removeClass("selected");this._selectedIndex=null;c.val("")}if(null!=a){var e=this._dataProvider.indexOf(a),d=this._$element.find(".qs-list ul li[index\x3d"+e+"]");d.addClass("selected");this._selectedIndex=e;c.val(a.value)}b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})}};js.$public.value=function(a){if(void 0===a){var b=this.selectedItem();return null!=b?b.value:null}null!=this._dataProvider&&
this._dataProvider.forEach(function(c,b){if(c.value==a)return this.selectedItem(c),!1},this)};js.$public.selectedIndex=function(a){if(void 0===a)return this._selectedIndex;var b=0;"array"==f.type(this._dataProvider)?b=this._dataProvider.length:js.instanceOf(this._dataProvider,f.ArrayList)&&(b=this._dataProvider.size());0<=a&&a<b||(a=-1);this._selectedIndex=a;null!=this._$element&&null!=this._dataProvider&&(-1==a?this.selectedItem(null):js.instanceOf(this._dataProvider,f.ArrayList)?this.selectedItem(this._dataProvider.get(a)):
"array"==f.type(this._dataProvider)&&this.selectedItem(this._dataProvider[a]))};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(null!=a&&"array"!=f.type(a)&&!js.instanceOf(a,f.ArrayList))throw new TypeError("The type of List.dataProvider must be Array or qs.ArrayList.");this._dataProvider=a;if(null!=this._$element&&null!=a){var b=this._$element.find(".qs-list ul"),c=a.length;a.forEach(function(a,e){this.renderItem(b,a,e,c)},this)}};js.$public.items=function(a){return this.dataProvider(a)};
this.renderItem=function(a,b,c,d){null==b&&(b={label:"",value:null});var e=this._labelField,g=l('\x3cli index\x3d"'+c+'"\x3e\x3c/li\x3e');a.append(g);"function"==js.type(this._itemRenderer)?this._itemRenderer(g,b,c,d):g.append(b[e]);g.data("data",b)};js.$public.addItem=function(a){this._dataProvider.push(a);if(this.isRendered()){var b=this._$element.find(".qs-list ul"),c=this._dataProvider.indexOf(a);this.renderItem(b,a,c,this._dataProvider.length);this.invalidateSize(!0)}};js.$public.removeItem=
function(a){a=this._dataProvider.indexOf(a);this.removeItemAt(a)};js.$public.removeItemAt=function(a){if(0<=a){var b=this._$element.find(".qs-list ul"),c=b.children("li:nth-child("+(a+1)+")");if(0!=c.length){c.remove();this._dataProvider.splice(a,1);c=b.children("li");for(a=0;a<c.length;a++)l(c[a]).attr("index",a);this.invalidateSize(!0)}}};js.$public.clear=function(){this._dataProvider=[];this.isRendered()&&(this._$element.find(".qs-list ul").empty(),this.invalidateSize(!0))};js.$public.updateSize=
function(a,b){this.$super();if(this.isRendered()){var c={};isNaN(this.width())&&(this._$element.css("width",""),a=this._$element[0].scrollWidth,!isNaN(a)&&a>this._$element.width()&&(c.width=a));isNaN(this.height())&&(this._$element.css("height",""),b=this._$element[0].scrollHeight,!isNaN(b)&&b>this._$element.height()&&(c.height=b));this.outerSize(c,!1)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-list"\x3e','\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e',
'\x3cdiv class\x3d"qs-list-content"\x3e',"\x3cul\x3e","\x3c/ul\x3e","\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);this.enabled(this.enabled());this.dataProvider(this.dataProvider());var c=this.selectedItem();js.isNull(c)||this.selectedItem(c);c=this.selectedIndex();0<=c&&this.selectedIndex(c);if(0<this.selectedIndex()){var c=a.find(".qs-list .qs-list-content"),d=a.find(".qs-list ul li[index\x3d"+
this.selectedIndex()+"]"),d=d.offset().top-c.offset().top+d.height();d>c.height()&&(d-=c.height(),c.scrollTo(d))}c=a.find(".qs-list");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);this.bindEvent("click",this.click);this.bindEvent("keydown",this._keyDown);this.invalidateSize()};this._keyDown=function(a){if(38==a.keyCode)a=this.selectedIndex(),this.selectedIndex(0<a?a-1:0);else if(40==a.keyCode){var b=0;"array"==f.type(this._dataProvider)?b=this._dataProvider.length:js.instanceOf(this._dataProvider,
f.ArrayList)&&(b=this._dataProvider.size());a=this.selectedIndex();a+1<b&&(a+=1);if(null==a||void 0==a)a=0;this.selectedIndex(a)}else 13==a.keyCode&&this._$element.trigger("change")};this.click=function(a){a=l(a.target).closest("li",this._$element);if(1==a.length)return a=a.attr("index"),js.instanceOf(this._dataProvider,f.ArrayList)?this.selectedItem(this._dataProvider.get(a)):"array"==f.type(this._dataProvider)&&this.selectedItem(this._dataProvider[a]),this._$element.trigger("change"),!1}});l.fn.qs_list=
function(a){return this.each(function(){(new f.ui.List).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$interface("qs.ui.IScrollBar",function(){js.$public.value=function(a){};js.$public.maximum=function(a){};js.$public.minimum=function(a){}});js.$class("qs.ui.HorizontalScrollBar",f.ui.Control,[f.ui.IScrollBar],function(){this.initialize=function(a){this.$super(a);this._minimum=this._value=0;this._maximum=10;this._minimumThumbLength=20;this._maxThumbPosition=this._minThumbPosition=0;this._capOverlap=f.ui.theme.scrollbar_capOverlap;this._tailOverlap=f.ui.theme.scrollbar_tailOverlap;
this._$button_right=this._$button_left=this._$thumb=this._$cap=null};js.$public.value=function(a){if(void 0===a)return this._value;var b=this._value;this._value=a;this.isRendered()&&(this.updateValue(),b!=a&&this._$element.trigger("valueChanged"))};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a;this.isRendered()&&this.update()};js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a;this.isRendered()&&this.update()};js.$public.updateSize=
function(a,b){this.$super();this.isRendered()&&this.update()};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-hscrollbar"\x3e','\x3cdiv class\x3d"hs-track"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-cap"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-button-right"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-button-left"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-thumb"\x3e','\x3cdiv class\x3d"hs-thumb-left"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-thumb-center"\x3e\x3c/div\x3e','\x3cdiv class\x3d"hs-thumb-right"\x3e\x3c/div\x3e',
"\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.children(".qs-hscrollbar");this._$cap=c.children(".hs-cap");this._$thumb=c.children(".hs-thumb");this._$button_left=c.children(".hs-button-left");this._$button_right=c.children(".hs-button-right");this.height(f.ui.theme.scrollbar_width);this.invalidateSize();this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);
this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click)};this.mouseDown=function(a){var b=l(a.target).closest(".hs-button-left, .hs-button-right",this._$element);if(0<b.length)b.hasClass("hs-button-left")&&a.pageX<b.offset().left+this._tailOverlap||(this._clickButton=!0,this.setCapture(this._$element),b.addClass("pressed"));else if(b=l(a.target).closest(".hs-thumb",this._$element),0<b.length)return this.setCapture(this._$element),this._thumbDrag=!0,this._dragX=a.pageX,this._dragPos=
b.offset().left,a.preventDefault(),a.stopPropagation(),!1};this.mouseMove=function(a){if(this._thumbDrag){a=this._dragPos+(a.pageX-this._dragX);var b=this._$element.offset().left;a=Math.min(b+this._maxThumbPosition,Math.max(b+this._minThumbPosition,a))-b;a=(a-this._minThumbPosition)/(this._maxThumbPosition-this._minThumbPosition)*(this._maximum-this._minimum);isFinite(a)&&this.value(a)}};this.mouseUp=function(a){this.releaseCapture(this._$element);this._thumbDrag=!1;this._clickButton&&(this._clickButton=
!1,this._$button_left.removeClass("pressed"),this._$button_right.removeClass("pressed"))};this.click=function(a){var b=l(a.target).closest(".hs-button-left",this._$element);0<b.length&&a.pageX>b.offset().left+this._tailOverlap?this.value(Math.min(Math.max(this._minimum,this._value-30),this._maximum)):0<l(a.target).closest(".hs-button-right",this._$element).length?this.value(Math.min(Math.max(this._minimum,this._value+30),this._maximum)):(b=this._$thumb.offset().left-this._$element.offset().left,a=
a.pageX-this._$element.offset().left,a>this._minThumbPosition&&a<b?this.value(Math.min(Math.max(this._minimum,this._value-this._$element.width()),this._maximum)):a>b+this._thumbLength&&a<this._maxThumbPosition+this._thumbLength&&this.value(Math.min(Math.max(this._minimum,this._value+this._$element.width()),this._maximum)))};js.$protected.update=function(){var a=this._$cap,b=this._$thumb,c=this._$button_left,d=this._$button_right;this._capLength||(this._capLength=a.width());this._bestWidth||(this._bestWidth=
this._capLength+c.width()+d.width());this._$element.width()<this._bestWidth?(a.css("width",0),c.css("width",0),d.css("width",0),this._showAll=!1):(a.css("width",""),c.css("width",""),d.css("width",""),this._showAll=!0);this._trackLength=this._showAll?this._$element.width()-this._capLength-c.width()-d.width()+this._capOverlap+this._tailOverlap:this._$element.width()-3;a=this._trackLength/(this._trackLength+(this._maximum-this._minimum));this._thumbLength=1<=a?this._trackLength:Math.max(this._trackLength*
a,this._minimumThumbLength);b.css("width",this._thumbLength);this._showAll?(this._minThumbPosition=this._capLength-this._capOverlap,this._maxThumbPosition=this._trackLength-this._thumbLength+this._capLength-this._capOverlap):(this._minThumbPosition=0,this._maxThumbPosition=this._trackLength-this._thumbLength);this.updateValue()};js.$protected.updateValue=function(){this._value=Math.min(Math.max(this._minimum,this._value),this._maximum);var a=(this._value-this._minimum)/(this._maximum-this._minimum)*
(this._trackLength-this._thumbLength);this._showAll&&(a+=this._capLength-this._capOverlap);a=Math.floor(isNaN(a)?0:a);this._$thumb.css("left",a)}});js.$class("qs.ui.FlatHScrollBar",f.ui.Control,[f.ui.IScrollBar],function(){this.initialize=function(a){this.$super(a);this._minimum=this._value=0;this._maximum=10;this._minimumThumbLength=20;this._maxThumbPosition=this._minThumbPosition=0;this._$thumb=null};js.$public.value=function(a){if(void 0===a)return this._value;var b=this._value;this._value=a;this.isRendered()&&
(this.updateValue(),b!=a&&this._$element.trigger("valueChanged"))};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a;this.isRendered()&&this.update()};js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a;this.isRendered()&&this.update()};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this.update()};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"hs-thumb"\x3e',"\x3c/div\x3e")};js.$public.render=
function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);a.addClass("qs-fhscrollbar");this._$thumb=a.children(".hs-thumb");this.invalidateSize();this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click)};this.mouseDown=function(a){var b=l(a.target).closest(".hs-thumb",this._$element);if(0<b.length)return this.setCapture(this._$element),this._thumbDrag=
!0,this._dragX=a.pageX,this._dragPos=b.offset().left,a.preventDefault(),a.stopPropagation(),!1};this.mouseMove=function(a){if(this._thumbDrag){a=this._dragPos+(a.pageX-this._dragX);var b=this._$element.offset().left;a=Math.min(b+this._maxThumbPosition,Math.max(b+this._minThumbPosition,a))-b;a=(a-this._minThumbPosition)/(this._maxThumbPosition-this._minThumbPosition)*(this._maximum-this._minimum);isFinite(a)&&this.value(a)}};this.mouseUp=function(a){this.releaseCapture(this._$element);this._thumbDrag=
!1};this.click=function(a){var b=this._$thumb.offset().left-this._$element.offset().left;a=a.pageX-this._$element.offset().left;a>this._minThumbPosition&&a<b?this.value(Math.min(Math.max(this._minimum,this._value-this._$element.width()),this._maximum)):a>b+this._thumbLength&&a<this._maxThumbPosition+this._thumbLength&&this.value(Math.min(Math.max(this._minimum,this._value+this._$element.width()),this._maximum))};js.$protected.update=function(){var a=this._$thumb;this._trackLength=this._$element.width();
var b=this._trackLength/(this._trackLength+(this._maximum-this._minimum));this._thumbLength=1<=b?this._trackLength:Math.max(this._trackLength*b,this._minimumThumbLength);a.css("width",this._thumbLength);this._minThumbPosition=0;this._maxThumbPosition=this._trackLength-this._thumbLength;this.updateValue()};js.$protected.updateValue=function(){this._value=Math.min(Math.max(this._minimum,this._value),this._maximum);var a=(this._value-this._minimum)/(this._maximum-this._minimum)*(this._trackLength-this._thumbLength),
a=Math.floor(isNaN(a)?0:a);this._$thumb.css("left",a)}});js.$class("qs.ui.VerticalScrollBar",f.ui.Control,[f.ui.IScrollBar],function(){this.initialize=function(a){this.$super(a);this._minimum=this._value=0;this._maximum=10;this._minimumThumbLength=20;this._maxThumbPosition=this._minThumbPosition=0;this._capOverlap=f.ui.theme.scrollbar_capOverlap;this._tailOverlap=f.ui.theme.scrollbar_tailOverlap;this._$button_bottom=this._$button_top=this._$thumb=this._$cap=null};js.$public.value=function(a){if(void 0===
a)return this._value;var b=this._value;this._value=a;this.isRendered()&&(this.updateValue(),b!=a&&this._$element.trigger("valueChanged"))};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a;this.isRendered()&&this.update()};js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a;this.isRendered()&&this.update()};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this.update()};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-vscrollbar"\x3e',
'\x3cdiv class\x3d"vs-track"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-cap"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-button-bottom"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-button-top"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-thumb"\x3e','\x3cdiv class\x3d"vs-thumb-top"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-thumb-center"\x3e\x3c/div\x3e','\x3cdiv class\x3d"vs-thumb-bottom"\x3e\x3c/div\x3e',"\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},
this._options,b);this.$super(a,b);var c=a.children(".qs-vscrollbar");this._$cap=c.children(".vs-cap");this._$thumb=c.children(".vs-thumb");this._$button_top=c.children(".vs-button-top");this._$button_bottom=c.children(".vs-button-bottom");this.width(f.ui.theme.scrollbar_width);this.invalidateSize();this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click)};this.mouseDown=function(a){var b=l(a.target).closest(".vs-button-top, .vs-button-bottom",
this._$element);if(0<b.length)b.hasClass("vs-button-top")&&a.pageY<b.offset().top+this._tailOverlap||(this._clickButton=!0,this.setCapture(this._$element),b.addClass("pressed"));else if(b=l(a.target).closest(".vs-thumb",this._$element),0<b.length)return this.setCapture(this._$element),this._thumbDrag=!0,this._dragY=a.pageY,this._dragPos=b.offset().top,a.preventDefault(),a.stopPropagation(),!1};this.mouseMove=function(a){if(this._thumbDrag){a=this._dragPos+(a.pageY-this._dragY);var b=this._$element.offset().top;
a=Math.min(b+this._maxThumbPosition,Math.max(b+this._minThumbPosition,a))-b;a=(a-this._minThumbPosition)/(this._maxThumbPosition-this._minThumbPosition)*(this._maximum-this._minimum);isFinite(a)&&this.value(a)}};this.mouseUp=function(a){this.releaseCapture(this._$element);this._thumbDrag=!1;this._clickButton&&(this._clickButton=!1,this._$button_top.removeClass("pressed"),this._$button_bottom.removeClass("pressed"))};this.click=function(a){var b=l(a.target).closest(".vs-button-top",this._$element);
0<b.length&&a.pageY>b.offset().top+this._tailOverlap?this.value(Math.min(Math.max(this._minimum,this._value-30),this._maximum)):0<l(a.target).closest(".vs-button-bottom",this._$element).length?this.value(Math.min(Math.max(this._minimum,this._value+30),this._maximum)):(b=this._$thumb.offset().top-this._$element.offset().top,a=a.pageY-this._$element.offset().top,a>this._minThumbPosition&&a<b?this.value(Math.min(Math.max(this._minimum,this._value-this._$element.height()),this._maximum)):a>b+this._thumbLength&&
a<this._maxThumbPosition+this._thumbLength&&this.value(Math.min(Math.max(this._minimum,this._value+this._$element.height()),this._maximum)))};js.$protected.update=function(){var a=this._$cap,b=this._$thumb,c=this._$button_top,d=this._$button_bottom;this._capLength||(this._capLength=a.height());this._bestHeight||(this._bestHeight=this._capLength+c.height()+d.height());this._$element.height()<this._bestHeight?(a.height(0),c.height(0),d.height(0),this._showAll=!1):(a.css("height",""),c.css("height",
""),d.css("height",""),this._showAll=!0);this._trackLength=this._showAll?this._$element.height()-this._capLength-c.height()-d.height()+this._capOverlap+this._tailOverlap:this._$element.height()-3;a=this._trackLength/(this._trackLength+(this._maximum-this._minimum));this._thumbLength=1<=a?this._trackLength:Math.max(this._trackLength*a,this._minimumThumbLength);b.height(this._thumbLength);this._showAll?(this._minThumbPosition=this._capLength-this._capOverlap,this._maxThumbPosition=this._trackLength-
this._thumbLength+this._capLength-this._capOverlap):(this._minThumbPosition=0,this._maxThumbPosition=this._trackLength-this._thumbLength);this.updateValue()};js.$protected.updateValue=function(){this._value=Math.min(Math.max(this._minimum,this._value),this._maximum);var a=(this._value-this._minimum)/(this._maximum-this._minimum)*(this._trackLength-this._thumbLength);this._showAll&&(a+=this._capLength-this._capOverlap);a=Math.floor(isNaN(a)?0:a);this._$thumb.css("top",a)}});js.$class("qs.ui.FlatVScrollBar",
f.ui.Control,[f.ui.IScrollBar],function(){this.initialize=function(a){this.$super(a);this._minimum=this._value=0;this._maximum=10;this._minimumThumbLength=20;this._maxThumbPosition=this._minThumbPosition=0;this._$thumb=null};js.$public.value=function(a){if(void 0===a)return this._value;var b=this._value;this._value=a;this.isRendered()&&(this.updateValue(),b!=a&&this._$element.trigger("valueChanged"))};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a;this.isRendered()&&
this.update()};js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a;this.isRendered()&&this.update()};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this.update()};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"vs-thumb"\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);a.addClass("qs-fvscrollbar");this._$thumb=a.children(".vs-thumb");
this.invalidateSize();this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click)};this.mouseDown=function(a){var b=l(a.target).closest(".vs-thumb",this._$element);if(0<b.length)return this.setCapture(this._$element),this._thumbDrag=!0,this._dragY=a.pageY,this._dragPos=b.offset().top,a.preventDefault(),a.stopPropagation(),!1};this.mouseMove=function(a){if(this._thumbDrag){a=this._dragPos+(a.pageY-this._dragY);
var b=this._$element.offset().top;a=Math.min(b+this._maxThumbPosition,Math.max(b+this._minThumbPosition,a))-b;a=(a-this._minThumbPosition)/(this._maxThumbPosition-this._minThumbPosition)*(this._maximum-this._minimum);isFinite(a)&&this.value(a)}};this.mouseUp=function(a){this.releaseCapture(this._$element);this._thumbDrag=!1};this.click=function(a){var b=this._$thumb.offset().top-this._$element.offset().top;a=a.pageY-this._$element.offset().top;a>this._minThumbPosition&&a<b?this.value(Math.min(Math.max(this._minimum,
this._value-this._$element.height()),this._maximum)):a>b+this._thumbLength&&a<this._maxThumbPosition+this._thumbLength&&this.value(Math.min(Math.max(this._minimum,this._value+this._$element.height()),this._maximum))};js.$protected.update=function(){var a=this._$thumb;this._trackLength=this._$element.height();var b=this._trackLength/(this._trackLength+(this._maximum-this._minimum));this._thumbLength=1<=b?this._trackLength:Math.max(this._trackLength*b,this._minimumThumbLength);a.height(this._thumbLength);
this._minThumbPosition=0;this._maxThumbPosition=this._trackLength-this._thumbLength;this.updateValue()};js.$protected.updateValue=function(){this._value=Math.min(Math.max(this._minimum,this._value),this._maximum);var a=(this._value-this._minimum)/(this._maximum-this._minimum)*(this._trackLength-this._thumbLength),a=Math.floor(isNaN(a)?0:a);this._$thumb.css("top",a)}});js.$class("qs.ui.ScrollView",f.ui.ContentControl,function(){this._flat=!1;this.initialize=function(a){this.$super(a);this._content=
null;this._draggable=!1;this._verticalScrollBar=this._horizontalScrollBar=null};js.$public.flat=function(a){if(void 0===a)return this._flat;this._flat=a};js.$public.draggable=function(a){if(void 0===a)return this._draggable;this._draggable=a};js.$public.horizontalScrollBar=function(){return this._horizontalScrollBar};js.$public.verticalScrollBar=function(){return this._verticalScrollBar};js.$public.content=function(a){if(void 0===a)return this._content;this._content=a;if(this.isRendered()){var b=
this._$element.children(".qs-scrollview").children(".sv-content:first");b.empty();null!=a&&(js.instanceOf(a,f.ui.Control)?(a.parent(this),this._content.isRendered()?(b.append(this._content.$element()),this._content.$element().css("position","relative")):(a=l("\x3cdiv\x3e\x3c/div\x3e"),b.append(a),this._content.render(a),a.css("position","relative"))):b.append(a),this.invalidateSize(!0))}};js.$public.updateSize=function(a,b){if(this.isRendered()){var c,d=this._$element.children(".qs-scrollview"),e=
d.children(".sv-content"),g;c=parseFloat(d.css("borderLeftWidth"))+parseFloat(d.css("borderRightWidth"))+parseFloat(d.css("paddingLeft"))+parseFloat(d.css("paddingRight"));isNaN(c)&&(c=0);g=a-c;e.width(g);d.width(g);c=parseFloat(d.css("borderTopWidth"))+parseFloat(d.css("borderBottomWidth"))+parseFloat(d.css("paddingTop"))+parseFloat(d.css("paddingBottom"));isNaN(c)&&(c=0);c=b-c;e.height(c);d.height(c);var k=!1,m=!1,n=e.children(":first");if(0<n.length){var l=e.height(),q=n[0].scrollHeight;js.instanceOf(this._content,
f.ui.Control)&&0<this._content.height()&&(q=this._content.height());if(l<q){if(null==this._verticalScrollBar){this._verticalScrollBar=!0==this._flat?new f.ui.FlatVScrollBar:new f.ui.VerticalScrollBar;this._verticalScrollBar.render(d.children(".sv-vscroll"));var s=this;this._verticalScrollBar.$element().bind("valueChanged",function(a){e.scrollTop(s._verticalScrollBar.value());a.stopPropagation();a.stopImmediatePropagation();return!1})}g-=this._verticalScrollBar.$element().width();e.width(g);this._verticalScrollBar.maximum(q-
c);this._verticalScrollBar.height(b);this._verticalScrollBar.invalidateSize();d.children(".sv-vscroll").css("display","");k=!0}else d.children(".sv-vscroll").css("display","none");l=e.width();n=n[0].scrollWidth;js.instanceOf(this._content,f.ui.Control)&&0<this._content.width()&&(n=this._content.width());l<n?(null==this._horizontalScrollBar&&(this._horizontalScrollBar=!0==this._flat?new f.ui.FlatHScrollBar:new f.ui.HorizontalScrollBar,this._horizontalScrollBar.render(d.children(".sv-hscroll")),s=this,
this._horizontalScrollBar.$element().bind("valueChanged",function(a){e.scrollLeft(s._horizontalScrollBar.value());a.stopPropagation();a.stopImmediatePropagation();return!1})),c-=this._horizontalScrollBar.$element().height()-parseFloat(d.css("paddingBottom")),e.height(c),this._horizontalScrollBar.maximum(n-g),this._horizontalScrollBar.width(a),this._horizontalScrollBar.invalidateSize(),d.children(".sv-hscroll").css("display",""),m=!0):d.children(".sv-hscroll").css("display","none");k&&m?(this._verticalScrollBar.height(b-
this._horizontalScrollBar.$element().height()),this._horizontalScrollBar.width(a-this._verticalScrollBar.$element().width()),this._verticalScrollBar.maximum(q-c),this._horizontalScrollBar.maximum(n-g),d.children(".sv-scrollbar-corner").css("display","")):d.children(".sv-scrollbar-corner").css("display","none")}}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-scrollview"\x3e','\x3cdiv class\x3d"sv-content"\x3e\x3c/div\x3e','\x3cdiv class\x3d"sv-hscroll" style\x3d"display:none"\x3e\x3c/div\x3e',
'\x3cdiv class\x3d"sv-vscroll" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"sv-scrollbar-corner" style\x3d"display:none"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.children(".qs-scrollview"),d=this;a.bind("mousewheel",function(a,c){null!=d._verticalScrollBar&&d._verticalScrollBar.value(d._verticalScrollBar.value()-30*c);return!1});this._$content=c.children(".sv-content");
this.bindEvent("mousedown",this.mouseDown,this._$content);this.bindEvent("mousemove",this.mouseMove,this._$content);this.bindEvent("mouseup",this.mouseUp,this._$content);this.bindEvent("scroll",this.onScroll,this._$content);this.content(this.content());this.invalidateSize()};this.onScroll=function(a){null!=this._verticalScrollBar&&this._verticalScrollBar.value(this._$content[0].scrollTop);null!=this._horizontalScrollBar&&this._horizontalScrollBar.value(this._$content[0].scrollLeft)};this.mouseDown=
function(a){if(!0==this._draggable&&(null!=this._verticalScrollBar&&"none"!=this._verticalScrollBar.$element().css("display")||null!=this._horizontalScrollBar&&"none"!=this._horizontalScrollBar.$element().css("display"))){var b=f.ui.Control.findOwnerControl(a.target);if(!js.instanceOf(b,f.ui.IFormControl))return f.ui.popup.hide(),this.setCapture(this._$content),this._isDragging=!0,this._$content.addClass("dragging"),this._dragX=a.pageX,this._dragY=a.pageY,this._dragPos={x:this._horizontalScrollBar.value(),
y:this._verticalScrollBar.value()},!1}};this.mouseMove=function(a){!0==this._isDragging&&this.scrollTo(this._dragPos.x+(this._dragX-a.pageX),this._dragPos.y+(this._dragY-a.pageY))};this.mouseUp=function(a){!0==this._isDragging&&(this.releaseCapture(this._$content),this._isDragging=!1,this._$content.removeClass("dragging"))};js.$public.scrollTo=function(a,b){isFinite(a)&&null!=this._horizontalScrollBar&&this._horizontalScrollBar.value(a);isFinite(b)&&null!=this._verticalScrollBar&&this._verticalScrollBar.value(b)};
js.$static.updateScrollBar=function(a,b,c,d){if(!js.isNull(this._$element)&&!js.isNull(a)){var e,g;e=parseFloat(a.css("borderLeftWidth"))+parseFloat(a.css("borderRightWidth"))+parseFloat(a.css("paddingLeft"))+parseFloat(a.css("paddingRight"));isNaN(e)&&(e=0);g=c-e;b.width(g);a.width(g);e=parseFloat(a.css("borderTopWidth"))+parseFloat(a.css("borderBottomWidth"))+parseFloat(a.css("paddingTop"))+parseFloat(a.css("paddingBottom"));isNaN(e)&&(e=0);e=d-e;b.height(e);a.height(e);var k=!1,m=!1,n=a.children(".sv-vscroll"),
p=b.height(),q=b[0].scrollHeight;if(p<q){0==n.length&&(n=l('\x3cdiv class\x3d"sv-vscroll"\x3e\x3c/div\x3e'),a.append(n));if(js.isNull(this._verticalScrollBar)){this._verticalScrollBar=!0==this._flat?new f.ui.FlatVScrollBar:new f.ui.VerticalScrollBar;this._verticalScrollBar.render(n);var s=this;this._verticalScrollBar.$element().bind("valueChanged",function(a){b.scrollTop(s._verticalScrollBar.value());a.stopPropagation();a.stopImmediatePropagation();return!1})}g-=this._verticalScrollBar.$element().width();
b.width(g);this._verticalScrollBar.maximum(q-e);this._verticalScrollBar.height(d);this._verticalScrollBar.invalidateSize();n.css("display","");k=!0}else n.css("display","none");var r=b.width(),p=b[0].scrollWidth,n=a.children(".sv-hscroll");r<p?(0==n.length&&(n=l('\x3cdiv class\x3d"sv-hscroll"\x3e\x3c/div\x3e'),a.append(n)),js.isNull(this._horizontalScrollBar)&&(this._horizontalScrollBar=!0==this._flat?new f.ui.FlatHScrollBar:new f.ui.HorizontalScrollBar,this._horizontalScrollBar.render(n),s=this,
this._horizontalScrollBar.$element().bind("valueChanged",function(a){b.scrollLeft(s._horizontalScrollBar.value());a.stopPropagation();a.stopImmediatePropagation();return!1})),e-=this._horizontalScrollBar.$element().height()-parseFloat(a.css("paddingBottom")),b.height(e),this._horizontalScrollBar.maximum(p-g),this._horizontalScrollBar.width(c),this._horizontalScrollBar.invalidateSize(),n.css("display",""),m=!0):n.css("display","none");n=a.children(".sv-scrollbar-corner");k&&m?(0==n.length&&(n=l('\x3cdiv class\x3d"sv-scrollbar-corner"\x3e\x3c/div\x3e'),
a.append(n)),this._verticalScrollBar.height(d-this._horizontalScrollBar.$element().height()),this._horizontalScrollBar.width(c-this._verticalScrollBar.$element().width()),this._verticalScrollBar.maximum(q-e),this._horizontalScrollBar.maximum(p-g),n.css("display","")):n.css("display","none")}}});l.fn.qs_scrollview=function(a){return this.each(function(){(new f.ui.ScrollView).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.TextArea",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._readonly=!1;this._textMask=this._text="";this._maxChars=0;this._verticalScrollBar=this._horizontalScrollBar=null};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find("textarea").attr("name",a)};js.$public.maxChars=function(a){if(void 0===a)return this._maxChars;this._maxChars=a};js.$public.focus=
function(){this.isRendered()&&this._$element.find("textarea").focus()};js.$public.textMask=function(a){if(void 0===a)return this._textMask;this._textMask=a;this.callAfterRendered(function(){var a=this._$element.find("textarea");""==this._text&&""!=this._textMask?(a.val(this._textMask),a.addClass("masked")):a.removeClass("masked")})};js.$public.text=function(a){if(void 0===a)return this._$element?(a=this._$element.find("textarea").val(),a==this._textMask?"":a):_text;this._text=a;if(this._$element){var b=
this._$element.find("textarea");""!=a||""==this._textMask?(b.val(a),b.removeClass("masked")):""!=this._textMask&&(b.val(this._textMask),b.addClass("masked"));this.dispatchEvent("change");this.invalidateSize(!0)}};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this._enabled?(this._$element.removeClass("qs-disabled"),this._$element.find("textarea").removeAttr("readonly")):(this._$element.addClass("qs-disabled"),this._$element.find("textarea").attr("readonly",
"readonly"))})};js.$public.readonly=function(a){if(void 0===a)return this._readonly;this._readonly=a;this.callAfterRendered(function(){this._readonly?this._$element.find("textarea").attr("readonly","readonly"):this._$element.find("textarea").removeAttr("readonly")})};js.$public.value=function(a){return this.text(a)};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.find(".qs-textarea"),d=this._$element.find(".qs-textarea textarea");c.outerWidth(a);c.outerHeight(b);
var e,g;borderWidth=parseFloat(c.css("borderLeftWidth"))+parseFloat(c.css("borderRightWidth"))+parseFloat(c.css("paddingLeft"))+parseFloat(c.css("paddingRight"));isNaN(borderWidth)&&(borderWidth=0);e=a-borderWidth;borderWidth=parseFloat(c.css("borderTopWidth"))+parseFloat(c.css("borderBottomWidth"))+parseFloat(c.css("paddingTop"))+parseFloat(c.css("paddingBottom"));isNaN(borderWidth)&&(borderWidth=0);g=b-borderWidth;var k=d.height(),m=d[0].scrollHeight,n=!1,l=!1;if(k<m){if(null==this._verticalScrollBar){this._verticalScrollBar=
new f.ui.VerticalScrollBar;this._verticalScrollBar.render(this._$element.find(".qs-textarea .sv-vscroll"));var q=this;this._verticalScrollBar.$element().bind("valueChanged",function(){d.scrollTop(q._verticalScrollBar.value());return!1});this._$element.bind("mousewheel",function(a,c){q._verticalScrollBar.value(q._verticalScrollBar.value()-30*c);return!1})}e-=this._verticalScrollBar.$element().width();d.width(e);this._verticalScrollBar.height(b);this._verticalScrollBar.value(d[0].scrollTop);this._verticalScrollBar.maximum(d[0].scrollHeight-
g);this._verticalScrollBar.invalidateSize();this._$element.find(".qs-textarea .sv-vscroll").css("display","");n=!0}else this._$element.find(".qs-textarea .sv-vscroll").css("display","none"),d.width(e);var k=d.width(),s=d[0].scrollWidth;k<s?(null==this._horizontalScrollBar&&(this._horizontalScrollBar=new f.ui.HorizontalScrollBar,this._horizontalScrollBar.render(this._$element.find(".qs-textarea .sv-hscroll")),q=this,this._horizontalScrollBar.$element().bind("valueChanged",function(){d.scrollLeft(q._horizontalScrollBar.value());
return!1})),g-=this._horizontalScrollBar.$element().height()-parseFloat(c.css("paddingBottom")),d.height(g),this._horizontalScrollBar.maximum(d[0].scrollWidth-e),this._horizontalScrollBar.width(a),this._horizontalScrollBar.value(d[0].scrollLeft),this._horizontalScrollBar.invalidateSize(),this._$element.find(".qs-textarea .sv-hscroll").css("display",""),l=!0):(this._$element.find(".qs-textarea .sv-hscroll").css("display","none"),d.height(g));n&&l?(this._verticalScrollBar.height(b-this._horizontalScrollBar.$element().height()),
this._horizontalScrollBar.width(a-this._verticalScrollBar.$element().width()),this._verticalScrollBar.maximum(m-g),this._horizontalScrollBar.maximum(s-e),this._$element.find(".qs-textarea .sv-scrollbar-corner").css("display","")):this._$element.find(".qs-textarea .sv-scrollbar-corner").css("display","none")}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-textarea qs-input"\x3e','\x3ctextarea name\x3d"',this.name(),'"\x3e',this._text,"\x3c/textarea\x3e",'\x3cdiv class\x3d"sv-hscroll" style\x3d"display:none"\x3e\x3c/div\x3e',
'\x3cdiv class\x3d"sv-vscroll" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"sv-scrollbar-corner" style\x3d"display:none"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-textarea");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=a.find(".qs-textarea textarea"),e=this;d.bind("keyup blur scroll",function(){e.invalidateSize(!0)});this.bindEvent("focusin",
function(a){!this._enabled||this._readonly?(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()):(c.addClass("qs-input-focused"),""!=this._textMask&&d.val()==this._textMask&&(d.val(""),d.removeClass("masked")))},d);this.bindEvent("focusout",function(a){c.removeClass("qs-input-focused");""!=this._textMask&&""==d.val()&&(d.addClass("masked"),d.val(this._textMask))},d);this.bindEvent("keypress",function(a){if(0<this._maxChars&&this.text().length>=this._maxChars)return a.preventDefault(),
a.stopPropagation(),a.stopImmediatePropagation(),!1},d);this.bindEvent("input",function(a){this.dispatchEvent("change")},d);this.invalidateSize()};js.$public.scrollTo=function(a,b){isFinite(a)&&null!=this._horizontalScrollBar&&this._horizontalScrollBar.value(a);isFinite(b)&&null!=this._verticalScrollBar&&this._verticalScrollBar.value(b)}});l.fn.qs_textarea=function(a){return this.each(function(){(new f.ui.TextArea).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.CheckBox",f.ui.FormControl,function(){f.events.register("change",this);this._threeState=!1;this.initialize=function(a){"string"===f.type(a)?(this._text=a,this.$super()):(this.$super(a),this._text="",a&&a.threeState&&(this._threeState=a.threeState));this._value=!1;this._iconHeight=17};js.$public.threeState=function(a){if(void 0===a)return this._threeState;this._threeState=a};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&
this._$element.find(".qs-checkbox input").attr("name",a)};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&this._$element.find(".qs-checkbox .qs-text").text(a)};js.$public.isChecked=function(a){if(void 0===a)return!0===this._value;this.value(!0==a)};js.$public.isMidState=function(a){if(void 0===a)return null==this._value;!0==a?this.value(null):this.value(!1)};js.$public.value=function(a){if(void 0===a)return this._value;if(this._value!=a){var b=this._$element.find(".qs-checkbox");
!0==this._value?b.removeClass("checked"):null==this._value&&b.removeClass("mid");!0==a?b.addClass("checked"):!0==this._threeState&&null==a&&b.addClass("mid");var c=this._value;this._value=a;b.children("input").val(a);c!==a&&this.dispatchEvent("change",{oldValue:c,newValue:a})}};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;if(this._$element){var b=this._$element.find(".qs-checkbox");!0==a?(b.removeClass("disable"),b.removeClass("checked_disable")):!1==this._value?
b.addClass("disable"):!0==this._value&&b.addClass("checked_disable");null==this._value&&(!1==a?(b.addClass("disable"),b.removeClass("mid")):!0==this._threeState&&b.addClass("mid"))}};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&(0!=this.outerHeight()?(this._$element.find(".qs-checkbox").css("line-height",this.outerHeight()-2+"px"),this._$element.find(".qs-checkbox .chk-box").css("top",(this.outerHeight()-this._iconHeight)/2-2)):this._$element.find(".qs-checkbox .chk-box").css("top",
-2))};js.$public.focus=function(){if(!js.isNull(this._$element)){var a=this._$element.children(".qs-checkbox");a.focus();a.addClass("focused")}};js.$protected.template=function(a){return StringUtil.join('\x3ca class\x3d"qs-checkbox" tabindex\x3d"1"\x3e','\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e','\x3cspan class\x3d"chk-box"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-text"\x3e',this._text,"\x3c/span\x3e","\x3c/a\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=
l.extend({isDefault:!1,text:"",classes:""},this._options,b);StringUtil.isEmpty(this._text)&&!StringUtil.isEmpty(b.text)&&(this._text=b.text);this.$super(a,b);var c=a.children(".qs-checkbox");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);this.bindEvent("focusout",function(a){c.removeClass("focused")},c);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click);this.bindEvent("keyup",this.keyUp);this.invalidateSize()};this.keyUp=
function(a){!1!=this._enabled&&32==a.keyCode&&this.value(!this.value())};this.mouseDown=function(a){!1!=this._enabled&&(this.setCapture(),a=this._$element.find(".qs-checkbox"),!1==this._value?a.addClass("pressed"):!0==this._value?a.addClass("checked_pressed"):null==this._value&&a.addClass("mid_pressed"))};this.mouseUp=function(a){!1!=this._enabled&&(this.releaseCapture(),a=this._$element.find(".qs-checkbox"),!1==this._value?a.removeClass("pressed"):!0==this._value?a.removeClass("checked_pressed"):
null==this._value&&a.removeClass("mid_pressed"))};this.click=function(a){!1!=this._enabled&&(!1==this._value?this.value(!0):!0==this._value?this.value(!1):null==this._value&&this.value(!0),a.preventDefault())};js.$static.HTML_CHECKBOX='\x3ca class\x3d"qs-scheckbox"\x3e\x3c/a\x3e';js.$static.HTML_CHECKBOX_CHECKED='\x3ca class\x3d"qs-scheckbox checked"\x3e\x3c/a\x3e';js.$static.HTML_CHECKBOX_MIDDLE='\x3ca class\x3d"qs-scheckbox middle"\x3e\x3c/a\x3e';js.$static.CHECKED=1;js.$static.UNCHECKED=0;js.$static.MIDDLE=
2;js.$static.isCheckBox=function(a){return a.is(".qs-scheckbox")};js.$static.setValue=function(a,b){b==f.ui.CheckBox.CHECKED?(a.removeClass("middle"),a.addClass("checked")):b==f.ui.CheckBox.MIDDLE?(a.removeClass("checked"),a.addClass("middle")):(a.removeClass("checked"),a.removeClass("middle"))};js.$static.getValue=function(a){return a.hasClass("checked")?f.ui.CheckBox.CHECKED:a.hasClass("middle")?f.ui.CheckBox.MIDDLE:f.ui.CheckBox.UNCHECKED};js.$static.checked=function(a,b){if(void 0===b)return f.ui.CheckBox.getValue(a)==
f.ui.CheckBox.CHECKED;!0==b?f.ui.CheckBox.setValue(a,f.ui.CheckBox.CHECKED):f.ui.CheckBox.setValue(a,f.ui.CheckBox.UNCHECKED)}});js.$class("qs.ui.CheckGroup",f.ui.FormControl,function(){f.events.register("change",this);this._scrollView=null;this._construction=!1;this.initialize=function(a){this.$super(a);this._dataProvider=this._value=null;this._children=new f.ArrayList};js.$public.name=function(a){if(void 0===a)return this.$super();this.$super(a);null!=this._$element&&this._$element.find(".qs-checkgroup input").attr("name",
a)};js.$public.focus=function(){js.isNull(this._$element)||(0<this._children.size()&&this._children.get(0).focus(),this._curFocuseIndex=0)};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(null!=a&&"array"!=f.type(a)&&!js.instanceOf(a,f.ArrayList))throw new TypeError;if(!0!=this._construction){this._construction=!0;this._dataProvider=a;this.isRendered()&&this.createChildren();var b=this;setTimeout(function(){b._construction=!1},200)}};js.$public.value=function(a){if(void 0===
a)return this._value;var b=this._value;this._value=a;if(this.isRendered()){var c=[];js.isNull(this._value)?this._children.forEach(function(a){a.isChecked(!1)},this):c=String(this._value).split(",");this._children.forEach(function(a){for(var b=0;b<c.length;b++)a._itemdata.value==c[b]&&a.isChecked(!0)},this);this._$element.find(".qs-checkgroup input").val(a)}b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$public.selectedItems=function(){var a=[];this._children.forEach(function(b){b.isChecked()&&
a.push(b._itemdata)},this);return a};js.$protected.createChildren=function(){if(this.isRendered()&&null!=this._dataProvider&&0!=this._dataProvider.length){this._children.forEach(function(a){a.remove()},this);this._children&&this._children.clear();var a={};this._options.childOptions&&(a=this._options.childOptions);var b=this._options.layout,c=this._options.gap;isFinite(c)||(c=5);var d=l("\x3cdiv style\x3d'padding: 2px;'\x3e\x3c/div\x3e");this._dataProvider.forEach(function(e){var k=l("\x3cdiv\x3e\x3c/div\x3e");
d.append(k);var m=new f.ui.CheckBox;m.text(e.label);m._itemdata=e;m.name(this.name());m.render(k,a);this._value==e.value&&m.isChecked(!0);m.$element().css("position","relative");"vertical"==b?m.$element().css("margin-bottom",c):(m.$element().css("display","inline-block"),m.$element().css("margin-right",c));m.$element().css("margin-top",2);this._children.add(m)},this);this._scrollView.content(d);var e=0;this._children.forEach(function(a){a=a._$element.width();a>e&&(e=a)},this);this._children.forEach(function(a){0<
e&&a._$element.css("width",e)},this);!0==this._options.wrap?d.css("white-space","normal"):d.css("white-space","nowrap");this.invalidateSize(!0)}else this._children.forEach(function(a){a.remove()},this),this._children&&this._children.clear()};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this.$super(a);this.callAfterRendered(function(){if(!1==this._enabled){var a=this._$element.children(".qs-disabled-mask");a&&a.css("height",this.height()-1)}})};js.$public.updateSize=function(a,
b){this.$super();this.isRendered()&&this._scrollView&&this._scrollView.outerSize({width:a-2,height:b-2})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-checkgroup" style\x3d"white-space: nowrap"\x3e','\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});this._options=b=l.extend({wrap:!0,classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-checkgroup");this.$styleElement(c);
0<b.classes.length&&c.addClass(b.classes);var d=l("\x3cdiv\x3e\x3c/div\x3e");this._scrollView=new f.ui.ScrollView;this._scrollView.render(d,{position:"relative"});c.append(d);this.bindEvent("keydown",function(a){if(9==a.keyCode||13==a.keyCode){if(this._children.size()>this._curFocuseIndex+1)return this._curFocuseIndex++,this._children.get(this._curFocuseIndex).focus(),!1;f.ui.FocusManager.focusNext(this)}else if(37<=a.keyCode&&40>=a.keyCode){switch(a.keyCode){case 37:case 38:this._curFocuseIndex--;
break;case 39:case 40:this._curFocuseIndex++}this._curFocuseIndex=Math.max(0,Math.min(this._curFocuseIndex,this._children.size()-1));this._children.get(this._curFocuseIndex).focus()}},c);this.createChildren();this.addEventListener("change",this.onValueChanged)};this.onValueChanged=function(a){if(js.instanceOf(a.target(),f.ui.CheckBox)){a.stopPropagation();a="";for(var b=this.selectedItems(),c=0;c<b.length;c++)a=c!=b.length-1?a+(b[c].value+","):a+b[c].value;this.value(a)}}});l.fn.qs_checkbox=function(a){return this.each(function(){(new f.ui.CheckBox).render(l(this),
a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.RadioBox",f.ui.Control,function(){f.events.register("change",this);this.initialize=function(a){"string"===f.type(a)?(this._text=a,this.$super()):(this.$super(a),this._text="");this._value=!1;this._iconHeight=14};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;this._$element&&this._$element.find(".qs-radiobox .qs-text").text(a)};js.$public.isChecked=function(a){if(void 0===a)return!0===this._value;this.value(!0==a)};js.$public.value=function(a){if(void 0===
a)return this._value;if(this._value!=a){var b=this._$element.find(".qs-radiobox");!0==this._value&&b.removeClass("checked");!0==a&&b.addClass("checked");b=this._value;this._value=a;b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})}};js.$public.focus=function(){if(!js.isNull(this._$element)){var a=this._$element.children(".qs-radiobox");a.focus();a.addClass("focused")}};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;if(this._$element){var b=this._$element.find(".qs-radiobox");
!1==this._value?!1==a?b.addClass("disable"):b.removeClass("disable"):!0==this._value&&(!1==a?b.addClass("checked_disable"):b.removeClass("checked"))}};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&(this._$element.find(".qs-radiobox").css("line-height",this.height()-2+"px"),this._$element.find(".qs-radiobox .rdo-box").css("top",(this.height()-this._iconHeight)/2-2))};js.$protected.template=function(a){return StringUtil.join('\x3ca class\x3d"qs-radiobox" tabindex\x3d"1"\x3e',
'\x3cspan class\x3d"rdo-box"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-text"\x3e',this._text,"\x3c/span\x3e","\x3c/a\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({text:"",classes:""},this._options,b);StringUtil.isEmpty(this._text)&&!StringUtil.isEmpty(b.text)&&(this._text=b.text);this.$super(a,b);var c=a.find(".qs-radiobox");0<b.classes.length&&c.addClass(b.classes);this.bindEvent("focusin",function(a){c.addClass("focused")},c);this.bindEvent("focusout",function(a){c.removeClass("focused")},
c);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",this.click);this.bindEvent("keyup",this.keyUp);this.invalidateSize()};this.keyUp=function(a){!1!=this._enabled&&32==a.keyCode&&this.value(!0)};this.mouseDown=function(a){!1!=this._enabled&&(this.setCapture(),a=this._$element.find(".qs-radiobox"),!1==this._value?a.addClass("pressed"):!0==this._value&&a.addClass("checked_pressed"))};this.mouseUp=function(a){!1!=this._enabled&&(this.releaseCapture(),
a=this._$element.find(".qs-radiobox"),!1==this._value?a.removeClass("pressed"):!0==this._value&&a.removeClass("checked_pressed"))};this.click=function(a){!1!=this._enabled&&!1==this._value&&this.value(!0)}});js.$class("qs.ui.RadioGroup",f.ui.FormControl,function(){f.events.register("change",this);this._scrollView=null;this._construction=!1;this.initialize=function(a){this.$super(a);this._dataProvider=this._value=null;this._children=new f.ArrayList};js.$public.name=function(a){if(void 0===a)return this.$super();
this.$super(a);null!=this._$element&&this._$element.find(".qs-radiogroup input").attr("name",a)};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(null!=a&&"array"!=f.type(a)&&!js.instanceOf(a,f.ArrayList))throw new TypeError;if(!0!=this._construction){this._construction=!0;this._dataProvider=a;this.isRendered()&&this.createChildren();var b=this;setTimeout(function(){b._construction=!1},200)}};js.$public.value=function(a){if(void 0===a)return this._value;var b=this._value;
this._value=a;this.isRendered()&&(this._isSetting=!0,this._children.forEach(function(c){c._itemdata.value==a?c.isChecked(!0):c.isChecked(!1)},this),this._isSetting=!1,this._$element.find(".qs-radiogroup input").val(a));b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$protected.createChildren=function(){if(this.isRendered()&&null!=this._dataProvider&&0!=this._dataProvider.length){this._children.forEach(function(a){a.remove()},this);this._children&&this._children.clear();var a={};this._options.childOptions&&
(a=this._options.childOptions);var b=this._options.layout,c=this._options.gap;isFinite(c)||(c=5);var d=l("\x3cdiv style\x3d'padding: 2px;'\x3e\x3c/div\x3e");this._dataProvider.forEach(function(e){var k=l("\x3cdiv\x3e\x3c/div\x3e");d.append(k);var m=new f.ui.RadioBox;m.text(e.label);m._itemdata=e;m.name(this.name());m.render(k,a);this._value==e.value&&m.isChecked(!0);m.$element().css("position","relative");"vertical"==b?m.$element().css("margin-bottom",c):(m.$element().css("display","inline-block"),
m.$element().css("margin-right",c));m.$element().css("margin-top",2);this._children.add(m)},this);this._scrollView.content(d);var e=0;this._children.forEach(function(a){a=a._$element.width();a>e&&(e=a)},this);this._children.forEach(function(a){0<e&&a._$element.css("width",e)},this);!0==this._options.wrap?d.css("white-space","normal"):d.css("white-space","nowrap");this.invalidateSize(!0)}else this._children.forEach(function(a){a.remove()},this),this._children&&this._children.clear()};js.$public.enabled=
function(a){if(void 0===a)return this._enabled;this.$super(a);this.callAfterRendered(function(){if(!1==this._enabled){var a=this._$element.children(".qs-disabled-mask");a&&a.css("height",this.height()-1)}})};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this._scrollView&&this._scrollView.outerSize({width:a-2,height:b-2})};js.$public.focus=function(){js.isNull(this._$element)||(0<this._children.size()&&this._children.get(0).focus(),this._curFocuseIndex=0)};js.$protected.template=
function(a){return StringUtil.join('\x3cdiv class\x3d"qs-radiogroup" style\x3d"white-space: nowrap"\x3e','\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});this._options=b=l.extend({wrap:!0,classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-radiogroup");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=l("\x3cdiv\x3e\x3c/div\x3e");this._scrollView=new f.ui.ScrollView;this._scrollView.render(d,
{position:"relative"});c.append(d);this.bindEvent("keydown",function(a){if(9==a.keyCode||13==a.keyCode){if(this._children.size()>this._curFocuseIndex+1)return this._curFocuseIndex++,this._children.get(this._curFocuseIndex).focus(),!1;f.ui.FocusManager.focusNext(this)}else if(37<=a.keyCode&&40>=a.keyCode){switch(a.keyCode){case 37:case 38:this._curFocuseIndex--;break;case 39:case 40:this._curFocuseIndex++}this._curFocuseIndex=Math.max(0,Math.min(this._curFocuseIndex,this._children.size()-1));this._children.get(this._curFocuseIndex).focus()}},
c);this.createChildren();this.addEventListener("change",this.onValueChanged)};this.onValueChanged=function(a){if(js.instanceOf(a.target(),f.ui.RadioBox)&&(a.stopPropagation(),!0!=this._isSetting)){var b=a.target();b.isChecked()&&this._children.forEach(function(a){a===b?this.value(a._itemdata.value):a.isChecked(!1)},this)}}});l.fn.qs_radiobox=function(a){return this.each(function(){(new f.ui.RadioBox).render(l(this),a)})}})(qs,jQuery);(function(f,l){function a(){var a=1E3;l("body div .qs-window").each(function(){var c=parseInt(l(this).css("z-index"));a=c>a?c:a});return a}js.$class("qs.ui.Window",f.ui.ContentControl,function(){f.events.register("close",this);f.events.register("windowOpened",this);f.events.register("windowClosed",this);js.$static.WINDOW_OPENED="windowOpened";js.$static.WINDOW_CLOSED="windowClosed";this.initialize=function(a){this.$super(a);this._minHeight=this._minWidth=150;this._resizable=!0;this._title="Window";
this._content=null;this._frontable=!1};js.$public.minWidth=function(a){if(void 0===a)return this._minWidth;this._minWidth=a};js.$public.minHeight=function(a){if(void 0===a)return this._minHeight;this._minHeight=a};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a};js.$public.title=function(a){if(void 0===a)return this._title;this._title=a;this.isRendered()&&this._$element.find(".qs-window .win-title").html(this._title)};js.$public.resizable=function(a){if(void 0===
a)return this._resizable;this._resizable=a;if(this.isRendered()){var c=this._$element.find(".qs-window");!0==a?(a=this._$element.find(".qs-window .win-resize-left"),0==a.length&&c.append('\x3cdiv class\x3d"win-resize-left"\x3e\x3c/div\x3e'),a=this._$element.find(".qs-window .win-resize-right"),0==a.length&&c.append('\x3cdiv class\x3d"win-resize-right"\x3e\x3c/div\x3e'),a=this._$element.find(".qs-window .win-resize-bottom"),0==a.length&&c.append('\x3cdiv class\x3d"win-resize-bottom"\x3e\x3c/div\x3e'),
a=this._$element.find(".qs-window .win-resize-cornet"),0==a.length&&c.append('\x3cdiv class\x3d"win-resize-cornet"\x3e\x3c/div\x3e')):(a=this._$element.find(".qs-window .win-resize-left"),0<a.length&&a.remove(),a=this._$element.find(".qs-window .win-resize-right"),0<a.length&&a.remove(),a=this._$element.find(".qs-window .win-resize-bottom"),0<a.length&&a.remove(),a=this._$element.find(".qs-window .win-resize-cornet"),0<a.length&&a.remove())}};js.$public.updateSize=function(a,c){if(this.isRendered()){var d=
this._$element.find(".qs-window .win-titlebar");js.instanceOf(this._content,f.ui.Control)?this._content.outerSize({width:a,height:c-d.height()}):null!=this._content&&(this._content.outerWidth(a),this._content.outerHeight(c-d.height()))}};js.$public.content=function(a){if(void 0===a)return this._content;this._content=a;if(this.isRendered()){var c=this._$element.find(".qs-window .win-client:first");c.empty();null!=a&&(js.instanceOf(a,f.ui.Control)?(a.parent(this),this._content.isRendered()?(c.append(this._content.$element()),
this._content.$element().css("position","")):(a=l("\x3cdiv\x3e\x3c/div\x3e"),c.append(a),this._content.render(a),a.css("position",""))):c.append(a),this.invalidateSize())}};js.$protected.template=function(b){var c="";b.icon&&(c='\x3cimg src\x3d"'+b.icon+'" class\x3d"qs-icon"\x3e\x3c/img\x3e');return StringUtil.join('\x3cdiv class\x3d"qs-window" style\x3d"z-index:',a()+1,'"\x3e','\x3cdiv class\x3d"win-titlebar"\x3e',c,'\x3cdiv class\x3d"win-title-area"\x3e\x26nbsp;\x3c/div\x3e','\x3cspan class\x3d"win-title"\x3e\x3c/span\x3e',
'\x3cdiv class\x3d"win-title-btns"\x3e\x3c/div\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"win-client"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({frontable:!1,classes:""},this._options,c);this._frontable=c.frontable;var d=c.classes;c.classes="";this.$super(a,c);this.resizable(this.resizable());this.title(this.title());this.content(this.content());var e=a.find(".qs-window");0<d.length&&e.addClass(d);var d=a.find(".qs-window .win-title-btns"),
g=l('\x3cdiv class\x3d"win-closebutton" title\x3d"'+f.I18N.getString("qs.ui.window.close")+'"\x3e\x3c/div\x3e');d.append(g);(new f.ui.SimpleButton).render(g);!0==c.maximizable&&(g=l('\x3cdiv class\x3d"win-maxbutton" title\x3d"'+f.I18N.getString("qs.ui.window.maximize")+'"\x3e\x3c/div\x3e'),d.append(g),(new f.ui.SimpleButton).render(g));this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.bindEvent("click",function(a){var c=
l(a.target).closest(".win-closebutton",this._$element);if(0<c.length)return this.close(!0),!1;c=l(a.target).closest(".win-maxbutton",this._$element);if(0<c.length)return this.maximize(),!1});this.bindEvent("dblclick",function(a){!0==c.maximizable&&this.maximize();a.preventDefault();return!1},e.children(".win-titlebar"));this.bindEvent("scroll",function(a){e.scrollTop(0);return!1},e);d=parseInt(e.css("min-width"));d>this._minWidth&&(this._minWidth=d);d=parseInt(e.css("min-height"));d>this._minHeight&&
(this._minHeight=d);this.invalidateSize()};js.$public.show=function(a){if(null!=this._$element)this._$element.css("display",""),0==this._$element.parent().length&&l("body").append(this._$element);else{var c=l("\x3cdiv\x3e\x3c/div\x3e");l("body").append(c);this.render(c,a)}this.move((f.ui.windowWidth()-this.outerWidth())/2,(l(window).height()-this.outerHeight())/3);this.toFront();this.dispatchEvent(f.ui.Window.WINDOW_OPENED)};js.$public.showDialog=function(b){b=js.param(b,{});b.classes=b.classes?b.classes+
" dialog":"dialog";if(null!=this._$mask)this._$mask.css("display",""),this._$mask.css("z-index",a()),0==this._$mask.parent().length&&l("body").append(this._$mask);else{var c=l("\x3cdiv\x3e\x3c/div\x3e");null!=this._$element?c.insertBefore(this._$element):l("body").append(c);c.css("z-index",a());c.addClass("qs-dialog-mask");this._$mask=c}this.show(b)};js.$public.maximize=function(){this.isRendered()&&(!0==this._maximized?(this._$element.css({left:this._normalPos.left,top:this._normalPos.top}),this.outerSize({width:this._normalSize.width,
height:this._normalSize.height}),this._maximized=!1):(this._normalPos=this.position(),this._normalSize=this.outerSize(),this._$element.css({left:0,top:0}),this.outerSize({width:f.ui.windowWidth(),height:f.ui.windowHeight()}),this._maximized=!0))};js.$public.close=function(a,c){a=js.param(a,!1);c=js.param(c,!1);if(this._$element){if(!0==a){var d=new f.events.Event("close",this);this.dispatchEvent(d);if(d.isDefaultPrevented())return}!0==c?this.hide():(null!=this._$mask&&0<this._$mask.length&&(this._$mask.empty(),
this._$mask.remove(),this._$mask=null),this._$element.empty(),this._$element.remove(),this._$element=null);this.dispatchEvent(f.ui.Window.WINDOW_CLOSED)}};js.$public.hide=function(){null!=this._$element&&(this._$element.css("display","none"),this._$element.detach());null!=this._$mask&&(this._$mask.css("display","none"),this._$mask.detach())};js.$public.isOpened=function(){return null==this._$element||"none"==this._$element.css("display")?!1:!0};js.$public.mouseDown=function(a){var c=l(a.target).closest(".win-titlebar",
this._$element);0<c.length&&(this.setCapture(this._$element),this._dragArea="title",this._dragX=a.pageX,this._dragY=a.pageY,this._dragPos=this._$element.offset());if(this._resizable){this._dragX=a.pageX;this._dragY=a.pageY;var c=this._$element.offset(),d=this._$element.width(),e=this._$element.height();this._dragPos={left:c.left,top:c.top,width:d,height:e};c=l(a.target).closest(".win-resize-left",this._$element);0<c.length&&(this.setCapture(this._$element),this._dragArea="resize-left");c=l(a.target).closest(".win-resize-right",
this._$element);0<c.length&&(this.setCapture(this._$element),this._dragArea="resize-right");c=l(a.target).closest(".win-resize-bottom",this._$element);0<c.length&&(this.setCapture(this._$element),this._dragArea="resize-bottom");c=l(a.target).closest(".win-resize-cornet",this._$element);0<c.length&&(this.setCapture(this._$element),this._dragArea="resize-cornet")}!0==this._frontable&&this.toFront()};js.$public.mouseMove=function(a){var c=!1;if("title"==this._dragArea){var d=a.pageX-this._dragX,c=a.pageY-
this._dragY,d=Math.min(Math.max(this._dragPos.left+d,50-this._$element.width()),f.ui.windowWidth()-50),c=Math.min(Math.max(this._dragPos.top+c,0),f.ui.windowHeight()-30);this.move(d,c);c=!0}else if("resize-left"==this._dragArea){var d=a.pageX-this._dragX,d=this._dragPos.left+d,d=Math.min(Math.max(d,10),this._dragPos.left+this._dragPos.width-this._minWidth),e=this._dragPos.left+this._dragPos.width-d;this.move(d,this.top(),e,this.height());c=!0}else"resize-right"==this._dragArea?(d=a.pageX-this._dragX,
e=Math.min(Math.max(this._dragPos.width+d,this._minWidth),f.ui.windowWidth()-this._dragPos.left-10),this.width(e),c=!0):"resize-bottom"==this._dragArea?(c=a.pageY-this._dragY,c=Math.min(Math.max(this._dragPos.height+c,this._minHeight),f.ui.windowHeight()-this._dragPos.top-40),this.height(c),c=!0):"resize-cornet"==this._dragArea&&(d=a.pageX-this._dragX,e=Math.min(Math.max(this._dragPos.width+d,this._minWidth),f.ui.windowWidth()-this._dragPos.left-10),c=a.pageY-this._dragY,c=Math.min(Math.max(this._dragPos.height+
c,this._minHeight),f.ui.windowHeight()-this._dragPos.top-40),this.width(e),this.height(c),c=!0);if(!0==c)return a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),!1};js.$public.mouseUp=function(a){this.releaseCapture(this._$element);this._dragArea=""};js.$public.centerScreen=function(){var a=this.outerSize(),c=(f.ui.windowWidth()-a.width)/2,a=(f.ui.windowHeight()-a.height)/3;this.left(c);this.top(a)};js.$public.toFront=function(){var b=this._$element.children(".qs-window"),c=a()+
1;b.css("z-index",c);b.find(".edui-editor").css("z-index",c+1)}});l.fn.qs_window=function(a){return this.each(function(){(new f.ui.Window).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.Menu",f.ui.Control,function(){f.events.register("itemClick",this);this.initialize=function(a){this.$super(a);this._iconHeight=this._iconWidth=16;this._menudata=null};js.$public.menudata=function(a){if(void 0===a)return this._menudata;this._menudata=a};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a};js.$public.updateSize=function(a,b){this.$super();this.isRendered()};js.$public.render=function(a,b){this.$super(a,b);"undefined"==typeof b&&
(b={});b=l.extend({isDefault:!1,label:"",classes:""},this._options,b);StringUtil.isEmpty(this._label)&&!StringUtil.isEmpty(b.label)&&(this._label=b.label);var c="";null!=this._menudata&&this._menudata.label&&(c=this._menudata.label);c=StringUtil.join('\x3cdiv class\x3d"qs-menu-button"\x3e','\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-label"\x3e',c,"\x3c/span\x3e","\x3c/div\x3e");a.append(c);c=a.find(".qs-menu");0<b.classes.length&&c.addClass(b.classes);0<b.iconWidth&&(this._iconWidth=
b.iconWidth);0<b.iconHeight&&(this._iconHeight=b.iconHeight);null!=this._menudata&&this._menudata.iconUrl&&($button.find(".qs-icon").css("background","url("+this._menudata.iconUrl+") no-repeat"),$button.find(".qs-label").css("padding-left",this._iconWidth-2));this.invalidateSize()};js.$public.createMenu=function(a){for(var b=l('\x3cdiv class\x3d"qs-menu"\x3e\x3c/div\x3e'),c,d,e,g=0;g<a.length;g++)if(e=a[g])"separator"==e.type?c=l('\x3cdiv class\x3d"qs-menu-separator"\x3e\x3c/div\x3e'):(c=!1==a[g].enabled?
l('\x3cdiv class\x3d"qs-menuitem disabled"\x3e\x3c/div\x3e'):l('\x3cdiv class\x3d"qs-menuitem"\x3e\x3c/div\x3e'),c.data("menudate",a[g]),d=l('\x3cspan class\x3d"qs-icon"\x3e\x3c/span\x3e'),e.iconUrl?d.css("background","url("+e.iconUrl+") no-repeat"):e.icon&&d.css("background","url("+e.icon+") no-repeat"),c.append(d),d=l('\x3cspan class\x3d"qs-label"\x3e'+e.label+"\x3c/span\x3e"),c.append(d),e.menuitem&&(e=this.createMenu(e.menuitem),c.append(l('\x3cspan class\x3d"qs-submenu-tag"\x3e\x3c/span\x3e')),
c.data("submenu",e))),b.append(c);return b};this.closeSubMenu=function(a){a.detach();var b=a.data("opened-submenu");b&&b.parent()&&(this.closeSubMenu(b),a.removeData("opened-submenu"))};js.$public.show=function(a,b){if(null!=this._menudata){var c;if("array"==js.type(this._menudata))c=this.createMenu(this._menudata);else if("array"==js.type(this._menudata.menuitem))c=this.createMenu(this._menudata.menuitem);else return;f.ui.popup.show(c[0],{x:a,y:b,classes:"qs-menu-popup"});var d=this,e={click:function(a){a=
l(a.target).closest(".qs-menuitem");if(!a.data("submenu")){var c=a.data("menudate");if(js.isNull(c)||!1!=c.enabled)d.dispatchEvent("itemClick",a.data("menudate")),f.ui.popup.hide()}},mouseenter:function(a){var c=l(a.target).closest(".qs-menuitem");a=c.data("submenu");var b=c.closest(".qs-menu"),n=b.data("opened-submenu");if(n&&n.parent()){if(n===a)return;d.closeSubMenu(n);b.removeData("opened-submenu")}a&&0<a.length&&(b.data("opened-submenu",a),f.ui.popup.$element().append(a),n=c.offset(),c=n.left+
c.width(),c>f.ui.windowWidth()-a.width()-10&&(c=b.offset().left-a.width()),b=n.top,b=Math.max(Math.min(b,f.ui.windowHeight()-a.height()-10),10),n=f.ui.popup.$element().offset(),a.css({left:c-n.left,top:b-n.top}),!0!=a.data("event-binded")&&(a.find(".qs-menuitem").bind(e),a.data("event-binded",!0)))}};c.find(".qs-menuitem").bind(e);return c}}});l.fn.qs_menu=function(a){return this.each(function(){(new f.ui.Menu).render(l(this),a)})}})(qs,jQuery);(function(f,l){var a=!1,b="";js.$class("qs.ui.MessageBox",f.ui.Window,function(){js.$static.OK=1;js.$static.YesNo=2;js.$static.Yes=3;js.$static.No=4;js.$static.Info=1;js.$static.Warning=2;js.$static.Error=3;js.$static.Question=4;this.initialize=function(a){this.$super(a);this._resizable=!1;this._title="MessageBox";this._closeResult=null;this.addEventListener("close",function(a){a.preventDefault();this.closeAnimation()})};js.$public.updateSize=function(a,b){this.$super();this.isRendered()};js.$static.show=
function(c,d,e,g,k,m){if(!0!=a||c!=b){var n=StringUtil.join('\x3cdiv class\x3d"qs-messagebox"\x3e','\x3cdiv class\x3d"msgbox-content"\x3e','\x3cdiv class\x3d"icon"\x3e\x3c/div\x3e','\x3cdiv class\x3d"message"\x3e\x3c/div\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"msgbox-buttons"\x3e\x3c/div\x3e',"\x3c/div\x3e"),p=new f.ui.MessageBox,q=l(n),n=q.find(".msgbox-buttons"),s=q.find(".icon");q.find(".message").html(c);p.content(q);p.width(300);d&&p.title(d);switch(g){case f.ui.MessageBox.Info:s.addClass("info");
break;case f.ui.MessageBox.Warning:s.addClass("alert");break;case f.ui.MessageBox.Error:s.addClass("error");break;case f.ui.MessageBox.Question:s.addClass("question");break;default:e==f.ui.MessageBox.YesNo?s.addClass("question"):s.addClass("info")}"function"==js.type(k)?p._closeHandler=k:p._closeHandler=null;p._handlerScope=m?m:null;d=null;k=new f.ui.Container({layout:{type:"horizontal",innerLayout:{hAlign:"right"},hGap:5,width:"100%"}});e==f.ui.MessageBox.YesNo?(m=new f.ui.Button,q=l("\x3cdiv class\x3d'msg-yesbutton'\x3e\x3c/div\x3e"),
n.append(q),m.render(q,{width:70,height:24,isDefault:!0,text:f.I18N.getString("qs.ui.messagebox.yes")}),k.addChild(m),d=q,m=new f.ui.Button,q=l("\x3cdiv class\x3d'msg-nobutton'\x3e\x3c/div\x3e"),n.append(q),m.render(q,{width:70,height:24,text:f.I18N.getString("qs.ui.messagebox.no")}),k.addChild(m)):"object"==js.type(e)&&"array"==js.type(e.choices)&&2==e.choices.length?(m=new f.ui.Button,q=l("\x3cdiv class\x3d'msg-chsbutton'\x3e\x3c/div\x3e"),g=null,"string"==js.type(e.choices[0])?c=e.choices[0]:(c=
e.choices[0].text,g=e.choices[0].icon),n.append(q),m.render(q,{width:70,height:24,text:c,icon:g}),k.addChild(m),q.data("data",c),g=null,"string"==js.type(e.choices[1])?c=e.choices[1]:(c=e.choices[1].text,g=e.choices[1].icon),m=new f.ui.Button,q=l("\x3cdiv class\x3d'msg-chsbutton'\x3e\x3c/div\x3e"),n.append(q),m.render(q,{width:70,height:24,text:c,icon:g}),k.addChild(m),q.data("data",c)):(m=new f.ui.Button,q=l("\x3cdiv class\x3d'msg-okbutton'\x3e\x3c/div\x3e"),n.append(q),m.render(q,{right:10,width:70,
height:24,isDefault:!0,text:f.I18N.getString("qs.ui.messagebox.ok")}),k.addChild(m),d=q);k.padding(3);k.render(n,{position:"relative"});p.bindEvent("click",p.click);p.showDialog({classes:"qs-ani-popup"});k.invalidateSize(!0);p._$preFocus=l(document.activeElement);null!=d&&d.focus();a=!0;b=c}};js.$public.close=function(a,b){this.$super(a,b);this._$preFocus.focus()};this.closeAnimation=function(){a=!1;l.browser.mozilla?this._$element.css("-moz-transform","scale(0.2)").css("-moz-transition","transform 0.2s ease 0s").css("-moz-transition",
"-moz-transform 0.2s ease 0s"):l.browser.webkit?this._$element.css("-webkit-transform","scale(0.2)").css("transition","-webkit-transform 0.2s ease 0s").css("-webkit-transition","-webkit-transform 0.2s ease 0s"):l.browser.msie&&this._$element.css("transform","scale(0.2)").css("transition","-ms-transform 0.2s ease 0s").css("-ms-transition","-ms-transform 0.2s ease 0s");this._$element.addClass("qs-ani-hide");var c=this;setTimeout(function(){c.close();null!=c._closeHandler&&null!=c._closeResult&&c._closeHandler.apply(c._handlerScope,
[c._closeResult])},200)};js.$public.click=function(a){var b=l(a.target).closest(".msg-okbutton",this._$element);if(0<b.length)return this._closeResult=this.$class.OK,this.closeAnimation(),!1;b=l(a.target).closest(".msg-yesbutton",this._$element);if(0<b.length)return this._closeResult=this.$class.Yes,this.closeAnimation(),!1;b=l(a.target).closest(".msg-nobutton",this._$element);if(0<b.length)return this._closeResult=this.$class.No,this.closeAnimation(),!1;b=l(a.target).closest(".msg-chsbutton",this._$element);
if(0<b.length)return this._closeResult=b.data("data"),this.closeAnimation(),!1}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.VRule",f.ui.Control,function(){this.initialize=function(a){this.$super(a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-vrule"\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.find(".qs-vrule");c.css("left",(a-c.width())/2);c.outerHeight(b)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);0<b.classes.length&&
$label.addClass(b.classes);this.invalidateSize()}});js.$class("qs.ui.HRule",f.ui.Control,function(){this.initialize=function(a){this.$super(a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-hrule"\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.find(".qs-hrule");c.css("top",(b-c.height())/2);c.outerWidth(a)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,
b);this.$super(a,b);0<b.classes.length&&$label.addClass(b.classes);this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.FieldSet",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._text=""};js.$public.text=function(a){if(void 0===a)return _text;this._text=a;this._$element&&this._$element.find(".qs-fieldset .qs-title").text(a)};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.find(".qs-fieldset"),d=this._$element.find(".qs-fieldset .qs-border"),e=this._$element.find(".qs-fieldset .qs-title").height()/2;d.outerWidth(a);
d.outerHeight(b-e);d.css("margin-top",e+"px");c.outerWidth(a);c.outerHeight(b)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-fieldset"\x3e','\x3cdiv class\x3d"qs-border"\x3e\x3c/div\x3e','\x3cspan class\x3d"qs-title"\x3e',this._text,"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",text:""},this._options,b);""!=b.text&&(this._text=b.text);a.css("z-index",0);this.$super(a,b);var c=a.children(".qs-fieldset");
0<b.classes.length&&c.addClass(b.classes);this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Panel",f.ui.ContentControl,function(){this.initialize=function(a){"string"===f.type(a)?(this._title=a,this.$super()):(this.$super(a),this._title="");this._headerHeight=0};js.$public.title=function(a){if(void 0===a)return _title;this._title=a;this._$element&&this._$element.find(".qs-panel-title").text(a)};js.$public.headerHeight=function(a){if(void 0===a)return _headerHeight;this._headerHeight=a};js.$public.outerSize=function(a,b){if(void 0===a)return this.$super(a,
b);this.$super(a,b);this._$element.children(".qs-panel")};js.$public.updateSize=function(a,b){var c=0;if(0<this._headerHeight)c=this._headerHeight;else{var d=this._$element.find(".qs-panel .qs-panel-title");0<d.length&&(c=d.outerHeight())}this.$super(a-2,b-c-2)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-panel"\x3e','\x3cdiv class\x3d"qs-panel-title"\x3e',this._title,"\x3c/div\x3e",'\x3cdiv class\x3d"qs-content"\x3e',"\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=
function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",title:""},this._options,b);""!=b.title&&(this._title=b.title);this.$super(a,b);var c=a.children(".qs-panel");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.ProgressBar",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._maximum=100;this._minimum=0;this._indeterminate=!1;this._label="";this._barHeight=8};js.$public.label=function(a){if(void 0===a)return this._label;this._label=a};js.$public.barHeight=function(a){if(void 0===a)return this._barHeight;this._barHeight=a;this.isRendered()&&this.invalidateSize(!0)};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a};js.$public.minimum=
function(a){if(void 0===a)return this._minimum;this._minimum=a};js.$public.indeterminate=function(a){if(void 0===a)return this._indeterminate;this._indeterminate=a;this.callAfterRendered(function(){var b=this._$element.find(".qs-progressbar");!0==a?b.addClass("indeterminate"):b.removeClass("indeterminate");b.children(".qs-pbar-label").text(this._label);b.children(".qs-pbar-bar").css("width","")})};js.$public.setProgress=function(a,b){if(null!=this._$element){var c=a/b*this._$element.width(),d=this._$element.find(".qs-progressbar"),
e=d.children(".qs-pbar-label");""!=this._label&&(e.text(this._label+" "+NumberUtil.toInt(a/b*100)+"%"),e.css("left",(this._$element.width()-e.width())/2));d.children(".qs-pbar-bar").outerWidth(c)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-progressbar"\x3e','\x3cdiv class\x3d"qs-pbar-border"\x3e\x3c/div\x3e','\x3cdiv class\x3d"qs-pbar-bar"\x3e\x3c/div\x3e','\x3cdiv class\x3d"qs-pbar-label"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){if(null!=
this._$element){var c=this._$element.children(".qs-progressbar"),d=c.children(".qs-pbar-label");d.text(this._label);d.css("left",(a-d.width())/2);c.children(".qs-pbar-border").outerHeight(this._barHeight);c.children(".qs-pbar-bar").outerHeight(this._barHeight)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);0<b.classes.length&&$label.addClass(b.classes);this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Image",f.ui.Control,function(){this.initialize=function(a){"string"===f.type(a)?(this._src=a,this.$super()):(this.$super(a),this._src="")};js.$static.getNatural=function(a){if(0==a.length||!a.is("img"))return null;a=a[0];if(0<a.naturalWidth&&0<a.naturalHeight)return{width:a.naturalWidth,height:a.naturalHeight};var b=new Image;b.src=a.src;return{width:b.width,height:b.height}};js.$public.src=function(a){if(void 0===a)return _src;this._src=a;this._$element&&this._$element.find(".qs-image img").attr("src",
a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-image"\x3e','\x3cimg src\x3d"',this._src,'"\x3e\x3c/img\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();this.isRendered()&&this._$element.find(".qs-image img").css({width:a,height:b})};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",src:""},this._options,b);""!=b.src&&(this._src=b.src);this.$super(a,b);var c=a.find(".qs-image");0<b.classes.length&&c.addClass(b.classes);
this.invalidateSize()}});l.fn.qs_image=function(a){return this.each(function(){var b=new f.ui.Image;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.TabView",f.ui.ItemsControl,[f.ui.ITabView],function(){f.events.register("selectedItemChanged",this);this._delayRender=!0;this.initialize=function(a){a=l.extend({delayRender:!0},a);this._delayRender=a.delayRender;this.$super(a);this._closeable=!1;this._tabId=0};js.$public.closeable=function(a){if(void 0===a)return this._closeable;this._closeable=a;this.callAfterRendered(function(){var a=this._$element.children(".qs-tab-view").children(".qs-tab-header").children(".qs-tab-control");
this._closeable?a.addClass("closeable"):a.removeClass("closeable")})};js.$public.updateSize=function(a,b){this.$super();var c=this._$element.children(".qs-tab-view"),d=c.children(".qs-tab-top-border"),e=this.tabContent(this.selectedTab());if(null!=e&&0!=e.length){var g=c.children(".qs-tab-header"),k=g.children(".qs-tab-control"),m=g.children(".qs-tab-nav");g.outerWidth()<k.outerWidth()?m.css("display",""):m.css("display","none");c=b-(d.offset().top-c.offset().top+d.height());d=e.data("control");js.instanceOf(d,
f.ui.Control)?(d.outerWidth(a),0<this._height?d.outerHeight(c):d.outerSize({height:c})):(e.width(a),e.height(c))}};this.tabContent=function(a){return null==a||0==a.length?null:this._$element.children(".qs-tab-view").children(".qs-tab-content[tabid\x3d'"+a.attr("tabid")+"']")};js.$public.selectedTab=function(a){var b=this._$element.children(".qs-tab-view"),c=b.children(".qs-tab-header"),d=c.children(".qs-tab-control");if(void 0===a)return d.children(".qs-tab-item.active");var e=this.findTab(a);if(null==
e||0==e.length)return!1;a=e.attr("tabid");var g=d.children(".qs-tab-item.active");if(g.attr("tabid")==a)return!0;g.removeClass("active");e.addClass("active");for(var e=null,k=0,m=0;m<this._items.length;m++)if(this._items[m].tabid==a){k=m;e=this._items[m];break}c.children(".qs-tab-nav");c=c.outerWidth();m=d.outerWidth();if(c<m&&0<c){var d=d.children(".qs-tab-item"),n=l(this._$element).offset(),p=l(d[k]).offset().left,m=l(d[k]).outerWidth(),p=p-n.left;if(p>=c-m){for(m=p=0;m<d.length;m++){var q=l(d[m]).offset();
0==m?l(d[m]).offset({top:q.top,left:n.left+10}):(p+=l(d[m-1]).outerWidth()+4,l(d[m]).offset({top:q.top,left:n.left+10+p}))}for(m=p=0;m<d.length;m++){var s=l(d[m]).outerWidth(),q=l(d[m]).offset().left;q-n.left>c-s&&m<=k&&(p=q-n.left-c+s+30)}for(m=0;m<d.length;m++)k=l(d[m]).offset(),l(d[m]).offset({top:k.top,left:k.left-p})}else if(0>p){for(m=c=0;m<d.length;m++)l(d[m]).outerWidth(),q=l(d[m]).offset().left,0>q-n.left&&m<=k&&(c=-(q-n.left)+10);for(m=0;m<d.length;m++)k=l(d[m]).offset(),l(d[m]).offset({top:k.top,
left:k.left+c})}}else if(0<c)for(d=d.children(".qs-tab-item"),n=l(this._$element).offset(),m=p=0;m<d.length;m++)q=l(d[m]).offset(),0==m?l(d[m]).offset({top:q.top,left:n.left+10}):(p+=l(d[m-1]).outerWidth()+4,l(d[m]).offset({top:q.top,left:n.left+10+p}));k=null;null!=e&&js.instanceOf(e.content,f.ui.Control)&&!e.content.isRendered()&&(k=l("\x3cdiv\x3e\x3c/div\x3e"),k.addClass("qs-tab-content"),b.append(k),e.content.render(k),k.css("position",""),k.attr("tabid",a));b.children(".qs-tab-content[tabid\x3d'"+
g.attr("tabid")+"']").removeClass("active");null==k&&(k=b.children(".qs-tab-content[tabid\x3d'"+a+"']"));k.addClass("active");for(m=0;m<this._items.length;m++)if(this._items[m].tabid==a){this._selectedItem!=this._items[m]&&(this._selectedItem=this._items[m],this._selectedIndex=m);break}this.invalidateSize(!0);return!0};this.findTab=function(a){var b=this._$element.children(".qs-tab-view").children(".qs-tab-header").children(".qs-tab-control"),c=-1;if(NumberUtil.isNumber(a))c=a;else{var d=b.children(".qs-tab-item:contains('"+
a+"')");if(0==d.length)return null;d.each(function(b){l(this).text()==a&&(c=l(this).attr("tabid"))});if(-1==c)return null}return b.children(".qs-tab-item[tabid\x3d'"+c+"']")};js.$public.closeTab=function(a,b){b=js.param(b,!0);var c=this.findTab(a);if(null==c||0==c.length)return!1;var d=c.attr("tabid"),e=null;c.hasClass("active")&&(e=c.prev(".qs-tab-item"),0==e.length&&(e=c.next(".qs-tab-item")));c.empty();c.remove();c=this._$element.children(".qs-tab-view").children(".qs-tab-content[tabid\x3d'"+d+
"']");c.empty();c.remove();c=-1;null!=e&&1==e.length&&(c=e.attr("tabid"));for(e=0;e<this._items.length;e++)if(this._items[e].tabid==d){this._items.splice(e,1);break}if(0==this._items.length)this.selectedIndex(-1);else if(!0==b&&-1!=c)for(e=0;e<this._items.length;e++)if(this._items[e].tabid==c){this.selectedIndex(e);break}0==this._items.length&&this.visible(!1)};js.$public.items=function(a){if(void 0===a)return this._items;if("array"==js.type(this._items)&&this.isRendered())for(var b=this._items.length-
1;0<=b;b--)this.removeItem(this._items[b],!1);this._items=a;this.callAfterRendered(function(){for(var a,b=0;b<this._items.length;b++)a=this._items[b],void 0!==a.label&&js.instanceOf(a.content,f.ui.Control)&&this.addTab(a.label,a.content,a)})};js.$public.addItem=function(a,b){void 0!==a.label&&js.instanceOf(a.content,f.ui.Control)&&this.addTab(a.label,a.content,a,b)};js.$public.removeItem=function(a,b){b=js.param(b,!0);var c=this._items.indexOf(a);-1!=c&&(c==this._selectedIndex&&this.selectedItem(null),
0<=this._items[c].tabid?this.closeTab(this._items[c].tabid,b):this._items.splice(c,1))};js.$public.selectedItem=function(a){if(void 0===a)return this._selectedItem;var b=this._items.indexOf(a);if(-1!=b){var c=this._selectedItem;this._selectedItem=a;this._selectedIndex=b;0<=a.tabid&&this.selectedTab(a.tabid);if(c!=a)this.onPropertyChanged("selectedItem",c,a)}};js.$public.selectedIndex=function(a){if(void 0===a)return this._selectedIndex;if(0<=a&&a<this._items.length){var b=this._selectedItem;this._selectedIndex=
a;this._selectedItem=this._items[a];0<=this._items[a].tabid&&this.selectedTab(this._items[a].tabid)}else this.selectedTab().removeClass("active"),b=this._selectedItem,this._selectedIndex=-1,this._selectedItem=null;if(b!=this._selectedItem)this.onPropertyChanged("selectedItem",b,this._selectedItem)};js.$public.addTab=function(a,b,c,d){this.callAfterRendered(function(){var e=this._tabId++,g=this._$element.children(".qs-tab-view"),k=g.children(".qs-tab-header").children(".qs-tab-control"),m=l('\x3cli class\x3d"qs-tab-item" tabid\x3d"'+
e+'"\x3e\x3cspan class\x3d"qs-label"\x3e'+a+'\x3c/span\x3e\x3cdiv class\x3d"qs-close-button"\x3e\x3c/div\x3e\x3c/li\x3e');k.append(m);js.instanceOf(b,f.ui.Control)?(this._delayRender||b.isRendered()?b.isRendered()&&(g.append(b.$element()),b.$element().addClass("qs-tab-content"),b.$element().css("position",""),b.$element().attr("tabid",e)):(k=l("\x3cdiv\x3e\x3c/div\x3e"),k.addClass("qs-tab-content"),g.append(k),b.render(k),k.css("position",""),k.attr("tabid",e)),b.parent(this)):(b.addClass("qs-tab-content"),
g.append(b),l(b).attr("tabid",e));void 0===c?this._items.push({tabid:e,label:a,content:b}):(c.tabid=e,c.label=a,c.content=b,-1==this._items.indexOf(c)&&this._items.push(c));!1!=d&&1==this._items.length&&this.selectedTab(e)})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-tab-view"\x3e','\x3cdiv class\x3d"qs-tab-header"\x3e','\x3cul class\x3d"qs-tab-control"\x3e',"\x3c/ul\x3e",'\x3cdiv class\x3d"qs-tab-nav" style\x3d"display:none"\x3e','\x3cdiv class\x3d"nav-menu"\x3e\x3cdiv class\x3d"nav-menu-icon"\x3e\x3c/div\x3e\x3c/div\x3e',
"\x3c/div\x3e","\x3c/div\x3e",'\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e','\x3cdiv class\x3d"qs-tab-top-border"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.children(".qs-tab-view");0<b.classes.length&&c.addClass(b.classes);var c=c.children(".qs-tab-header"),d=c.children(".qs-tab-control");this.bindEvent("mousedown",this.mouseDown,d);this.bindEvent("mouseup",this.mouseUp,d);this.bindEvent("click",
this.click,d);c=c.children(".qs-tab-nav").children(".nav-menu");this.bindEvent("mousedown",this.navMenu,c);this.invalidateSize()};this.menuClick=function(a,b){this.selectedItem(b)};this.navMenu=function(a){js.isNull(this._navMenu)&&(this._navMenu=new f.ui.Menu,this._navMenu.addEventListener("itemClick",this.menuClick,this));this._navMenu.menudata({menuitem:this._items});this._navMenu.show(a.pageX,a.pageY);return!1};this.mouseDown=function(a){var b=l(a.target).closest(".qs-close-button",this._$element);
if(0<b.length)this.setCapture(b),b.addClass("pressed");else if(b=l(a.target).closest(".qs-tab-item",this._$element),0!=b.length)for(a=b.attr("tabid"),b=0;b<this._items.length;b++)if(this._items[b].tabid==a){this.selectedIndex(b);break}};this.mouseUp=function(a){a=l(a.target).closest(".qs-close-button",this._$element);0<a.length&&(a.removeClass("pressed"),this.releaseCapture(a));return!1};this.click=function(a){a=l(a.target).closest(".qs-close-button",this._$element);if(0<a.length)return a=a.closest(".qs-tab-item",
this._$element),this.closeTab(a.attr("tabid")),!1}});l.fn.qs_tab=function(a){return this.each(function(){(new f.ui.TabView).render(l(this),a)})}})(qs,jQuery);(function(f,l){js.$interface("qs.ui.ITreeDataProvider",function(){js.$public.root=function(){};js.$public.children=function(a,b){};js.$public.label=function(a,b){};js.$public.icon=function(a,b){};js.$public.checked=function(a,b){};js.$public.enabled=function(a,b){};js.$public.addChild=function(a,b,c){};js.$public.removeChild=function(a,b){};js.$public.isBranch=function(a){};js.$public.load=function(a){}});js.$class("qs.ui.JsonTreeDataProvider",[f.ui.ITreeDataProvider],function(){this._data=null;this._childrenField=
this._enabledField=this._checkedField=this._iconField=this._labelField="";this._loadFunction=null;this.initialize=function(a,b){this._data=a;b=l.extend({labelField:"label",iconField:"icon",checkedField:"checked",enabledField:"enabled",childrenField:"children"},b);this._labelField=b.labelField;this._iconField=b.iconField;this._checkedField=b.checkedField;this._enabledField=b.enabledField;this._childrenField=b.childrenField;"function"==js.type(b.load)&&(this._loadFunction=b.load)};js.$public.root=function(){return this._data};
js.$public.children=function(a,b){if(null==a||void 0==a)a=this._data;if(void 0===b)return a[this._childrenField]||null;a[this._childrenField]=b};js.$public.load=function(a){null!=this._loadFunction&&this._loadFunction(a)};js.$public.label=function(a,b){if(null==a||void 0==a)a=this._data;if(void 0===b)return a[this._labelField]||"";a[this._labelField]=b};js.$public.icon=function(a,b){if(null==a||void 0==a)a=this._data;return a[this._iconField]||""};js.$public.checked=function(a,b){if(null==a||void 0==
a)a=this._data;if(void 0===b)return a[this._checkedField]||!1;a[this._checkedField]=b};js.$public.enabled=function(a,b){if(null==a||void 0==a)a=this._data;if(void 0===b)return a[this._enabledField]||!0;a[this._enabledField]=b};js.$public.addChild=function(a,b,c){if(null==a||void 0==a)a=this._data;var d=a[this._childrenField];d||(d=[],a[this._childrenField]=d);d.splice(c,0,b);return!0};js.$public.removeChild=function(a,b){if(null==a||void 0==a)a=this._data;var c=a[this._childrenField];if(c){var d=
c.indexOf(b);if(-1!=d)return c.splice(d,1),!0}return!1};js.$public.isBranch=function(a){if(null==a||void 0==a)a=this._data;return(a=a[this._childrenField])&&0<a.length?!0:!1}});js.$class("qs.ui.XmlTreeDataProvider",[f.ui.ITreeDataProvider],function(){this._xml=null;this._enabledAttr=this._checkedAttr=this._iconAttr=this._labelAttr="";this.initialize=function(a,b){this._xml=a;b=l.extend({labelAttr:"label",iconAttr:"icon",checkedAttr:"checked",enabledAttr:"enabled"},b);this._labelAttr=b.labelAttr;this._iconAttr=
b.iconAttr;this._checkedAttr=b.checkedAttr;this._enabledAttr=b.enabledAttr;"function"==js.type(b.load)&&(this._loadFunction=b.load)};js.$public.root=function(){return this._xml};js.$public.children=function(a,b){if(null==a||void 0==a)a=this._xml;if(void 0===b)return a.children();for(var c=0;c<b.length;c++)a.append(b[c])};js.$public.load=function(a){null!=this._loadFunction&&this._loadFunction(a)};js.$public.label=function(a,b){if(null==a||void 0==a)a=this._xml;if(void 0===b)return""==this._labelAttr?
a.text():a.attr(this._labelAttr);""==this._labelAttr?a.text(b):a.attr(this._labelAttr,b)};js.$public.icon=function(a,b){if(null==a||void 0==a)a=this._xml;return a.attr(this._iconAttr)};js.$public.checked=function(a,b){if(null==a||void 0==a)a=this._xml;if(void 0===b)return a.attr(this._checkedAttr);a.attr(this._checkedAttr,b)};js.$public.enabled=function(a,b){if(null==a||void 0==a)a=this._xml;if(void 0===b)return a.attr(this._enabledAttr);a.attr(this._enabledAttr,b)};js.$public.addChild=function(a,
b,c){a.append(b)};js.$public.removeChild=function(a,b){b.remove()};js.$public.isBranch=function(a){if(null==a||void 0==a)a=this._xml;return 0==a.children().length?!1:!0}});js.$class("qs.ui.TreeView",f.ui.Control,function(){f.events.register("change",this);this._dataProvider=null;this._showRoot=this._checkable=!1;this._$selectedLi=null;this.initialize=function(a){this.$super(a);a=l.extend({checkable:!1,showRoot:!1},a);this._checkable=a.checkable;this._showRoot=a.showRoot};js.$public.options=function(a){if(void 0===
a)return this._options;this._options=a;js.isNull(this._options)||(this._options.hasOwnProperty("checkable")&&(this._checkable=this._options.checkable),this._options.hasOwnProperty("showRoot")&&(this._showRoot=this._options.showRoot))};js.$public.selectedItem=function(a){if(void 0===a)return null!=this._$selectedLi?this._$selectedLi.data("node"):null;var b=null;null!=this._$selectedLi&&(b=this._$selectedLi.data("node"),this._$selectedLi.removeClass("selected"));this._$selectedLi=null;if(null!=a){this._$selectedLi=
this.findLi(a);this._$selectedLi.addClass("selected");for(var c=this._$selectedLi;0<c.length;)this.expandLi(c),c=this.$parentLi(c)}else js.isNull(this._$selectedLi)||(this._$selectedLi.removeClass("selected"),this._$selectedLi=null);this.dispatchEvent("change",{oldValue:b,newValue:a})};this.findLi=function(a){return this._$element.find(".item-li").filter(function(b){return l(this).data("node")==a})};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;if(!js.instanceOf(a,f.ui.ITreeDataProvider))throw Error("dataProvider type error.");
this._dataProvider=a;this.callAfterRendered(function(){var a=this._$element.children(".qs-treeview");a.empty();null!=this._dataProvider&&(this._showRoot?this.buildChildren(a,null,[this._dataProvider.root()]):this.buildChildren(a,this._dataProvider.root(),this._dataProvider.children(null)))})};js.$protected.buildChildren=function(a,b,c){if(null!=c&&void 0!=c&&0!=c.length)for(var d,e,g,k,m=0;m<c.length;m++)d=c[m],js.isNull(d)||(e=this._dataProvider.icon(d,!1),this._checkable?(g=this._dataProvider.checked(d),
k=!0==g||g==f.ui.CheckBox.CHECKED?f.ui.CheckBox.HTML_CHECKBOX_CHECKED:!1==g||g==f.ui.CheckBox.UNCHECKED?f.ui.CheckBox.HTML_CHECKBOX:f.ui.CheckBox.HTML_CHECKBOX_MIDDLE):k="",g=this._dataProvider.isBranch(d),e=l(StringUtil.join('\x3cli class\x3d"item-li ',g?"collapsed":"leaf",'"\x3e','\x3cdiv class\x3d"tree-row"\x3e\x3c/div\x3e','\x3cdiv class\x3d"',g?"expander":"expander-space",'"\x3e\x3c/div\x3e',k,'\x3cdiv class\x3d"icon" ',""==e?"":'style\x3d"background-image:url('+e+')"',"\x3e\x3c/div\x3e",'\x3cspan class\x3d"label"\x3e',
this._dataProvider.label(d),"\x3c/span\x3e","\x3c/li\x3e")),e.data("node",d),e.data("parentNode",b),a.append(e),k=this._dataProvider.children(d),null!==k&&void 0!==k&&0<k.length&&(g=l('\x3cul class\x3d"children-ul" style\x3d"display:none"\x3e\x3c/ul\x3e'),e.append(g),this.buildChildren(g,d,k)))};js.$public.invalidateItem=function(a,b){b=js.param(b,!0);if(this.isRendered()){var c=this.findLi(a),d=c.children(".children-ul");d.empty();d.remove();d=l('\x3cul class\x3d"children-ul"\x3e\x3c/ul\x3e');c.hasClass("collapsed")&&
d.css("display","none");c.append(d);if(this._dataProvider.isBranch(a)){if(c.hasClass("leaf")){c.removeClass("leaf");c.addClass("collapsed");d.css("display","none");var e=c.children(".expander-space");e.removeClass("expander-space");e.addClass("expander")}}else c.hasClass("collapsed")&&(c.removeClass("collapsed"),c.addClass("leaf"),e=c.children(".expander"),e.removeClass("expander"),e.addClass("expander-space"));e=this._dataProvider.icon(a,!1);""!=e&&c.children(".icon").css("background-image","url("+
e+")");c.children(".label").html(this._dataProvider.label(a));e=c.children(".loading");e.empty();e.remove();e=this._dataProvider.children(a);null!==e&&void 0!==e&&0<e.length&&(this.buildChildren(d,a,e),!0==b&&(this.collapseLi(c,!1),this.expandLi(c)))}};js.$public.removeItem=function(a){var b=this.findLi(a),c=b.data("parentNode");this._dataProvider.removeChild(c,a);b.empty();b.remove();this.selectedItem(null)};js.$protected.template=function(a){return StringUtil.join('\x3cul class\x3d"qs-treeview"\x3e',
"\x3c/ul\x3e")};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c={};isNaN(this.width())&&(this._$element.css("width",""),a=this._$element[0].scrollWidth,!isNaN(a)&&a>this._$element.width()&&(c.width=a));isNaN(this.height())&&(this._$element.css("height",""),b=this._$element[0].scrollHeight,!isNaN(b)&&b>this._$element.height()&&(c.height=b));this.outerSize(c,!1)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,
b);var c=this._$element.children(".qs-treeview");0<b.classes.length&&c.addClass(b.classes);this.bindEvent("mousedown",this._mouseDown,c);this.bindEvent("click",this._click,c);this.invalidateSize()};js.$public.expand=function(a,b){var c=this.findLi(a);this.expandLi(c,b)};js.$public.collapse=function(a,b){var c=this.findLi(a);this.collapseLi(c,b)};this.expandLi=function(a,b){b=js.param(b,!0);if(a.hasClass("collapsed")){a.removeClass("collapsed");a.addClass("expanded");var c=a.children(".children-ul");
if(0==c.length||0==c.children().length)c=a.children(".loading"),0==c.length&&(c=l('\x3cdiv class\x3d"loading"\x3e\x3cdiv class\x3d"loading_icon"\x3e\x3c/div\x3e'+f.I18N.getString("qs.ui.treeview.loading")+"\x3c/div\x3e"),a.append(c)),this._dataProvider.load(a.data("node"));else if(!0==b){var d=this;c.animate({height:"toggle",opacity:1},300,function(){d.invalidateSize(!0);js.instanceOf(d.parent(),f.ui.Control)&&d.parent().invalidateSize(!0)})}else d=this,c.animate({height:"toggle",opacity:1},0,function(){d.invalidateSize(!0);
js.instanceOf(d.parent(),f.ui.Control)&&d.parent().invalidateSize(!0)})}};this.collapseLi=function(a,b){b=js.param(b,!0);if(a.hasClass("expanded")){a.removeClass("expanded");a.addClass("collapsed");var c=a.children(".children-ul");if(!0==b){var d=this;c.animate({height:"toggle",opacity:0},300,function(){d.invalidateSize(!0);js.instanceOf(d.parent(),f.ui.Control)&&d.parent().invalidateSize(!0)})}else d=this,c.animate({height:"toggle",opacity:0},0,function(){d.invalidateSize(!0);js.instanceOf(d.parent(),
f.ui.Control)&&d.parent().invalidateSize(!0)})}};this._mouseDown=function(a){var b=l(a.target);a=b.parent();a.is(".item-li")&&(b.hasClass("expander")?a.hasClass("expanded")?this.collapseLi(a):a.hasClass("collapsed")&&this.expandLi(a):null==this._$selectedLi?(this._$selectedLi=a,this._$selectedLi.addClass("selected"),a=this._$selectedLi.data("node"),this.dispatchEvent("change",{oldValue:null,newValue:a})):this._$selectedLi[0]!=a[0]&&(b=this._$selectedLi.data("node"),this._$selectedLi.removeClass("selected"),
this._$selectedLi=a,this._$selectedLi.addClass("selected"),a=this._$selectedLi.data("node"),this.dispatchEvent("change",{oldValue:b,newValue:a})))};this._click=function(a){var b=l(a.target);if(f.ui.CheckBox.isCheckBox(b)){var c=f.ui.CheckBox.checked(b);f.ui.CheckBox.checked(b,!c);c=f.ui.CheckBox.getValue(b);b=b.parent();this._dataProvider.checked(b.data("node"),c);this.updateCheckState(this.$parentLi(b));this.updateChildrenCheck(b,c);a.stopPropagation();a.stopImmediatePropagation()}};this.$parentLi=
function(a){return a.parent().closest(".item-li",this._$element)};this.updateCheckState=function(a){var b=a.data("node");if(null!=b&&void 0!=b){var c=this._dataProvider.children(b);if(null!=c&&void 0!=c&&0<c.length){for(var d=0,e=0,g=0,k,m=0;m<c.length;m++)k=c[m],k=this._dataProvider.checked(k),k==f.ui.CheckBox.CHECKED?d++:k==f.ui.CheckBox.MIDDLE?e++:g++;c=c.length;e=a.children(".qs-scheckbox");d==c?(this._dataProvider.checked(b,f.ui.CheckBox.CHECKED),f.ui.CheckBox.checked(e,!0)):g==c?(this._dataProvider.checked(b,
f.ui.CheckBox.UNCHECKED),f.ui.CheckBox.checked(e,!1)):(this._dataProvider.checked(b,f.ui.CheckBox.MIDDLE),f.ui.CheckBox.setValue(e,f.ui.CheckBox.MIDDLE))}a=this.$parentLi(a);0<a.length&&this.updateCheckState(a)}};this.updateChildrenCheck=function(a,b){var c=a.data("node");if(null!=c&&void 0!=c){var d=a.find(".children-ul\x3e.item-li");if(0<d.length&&b!=f.ui.CheckBox.MIDDLE)for(var e,g,k=0;k<d.length;k++)e=l(d[k]),c=e.data("node"),g=this._dataProvider.enabled(c),!1!==g&&"false"!==g&&(this._dataProvider.checked(c,
b),c=e.children(".qs-scheckbox"),b==f.ui.CheckBox.CHECKED?f.ui.CheckBox.checked(c,!0):f.ui.CheckBox.checked(c,!1),this.updateChildrenCheck(e,b))}}});l.fn.qs_treeview=function(a){return this.each(function(){(new f.ui.TreeView).render(l(this),a)})}})(qs,jQuery);(function(f,l){var a=new f.ui.Popup("qs-validate-popup");js.$class("qs.ui.ValidateMessage",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._text=""};js.$public.text=function(a){if(void 0===a)return _text;this._text=a;this._$element&&this._$element.find(".message").text(a)};js.$public.arrow=function(a,b){this.callAfterRendered(function(){var e=this._$element.find(".arrow-left"),g=this._$element.find(".arrow-top"),f=this._$element.find(".arrow-right"),m=this._$element.find(".arrow-bottom");
e.css("display","none");g.css("display","none");f.css("display","none");m.css("display","none");switch(a){case "left":e.css({display:"",top:b+"px"});break;case "top":g.css({display:"",left:b+"px"});break;case "right":f.css({display:"",top:b+"px"});break;case "bottom":m.css({display:"",left:b+"px"})}})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-validate"\x3e','\x3cem class\x3d"arrow-left" style\x3d"display:none"\x3e\x3c/em\x3e','\x3cem class\x3d"arrow-top" style\x3d"display:none"\x3e\x3c/em\x3e',
'\x3cem class\x3d"arrow-right" style\x3d"display:none"\x3e\x3c/em\x3e','\x3cem class\x3d"arrow-bottom" style\x3d"display:none"\x3e\x3c/em\x3e','\x3cspan class\x3d"message"\x3e',this._text,"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var e=a.children(".qs-validate");0<b.classes.length&&e.addClass(b.classes);this.invalidateSize()}});var b={};js.$class("qs.ui.Validator",function(){b.validator=
this;js.$static.register=function(a,d){b[a]=d};js.$static.create=function(a,d){return""==a||void 0==a?new f.ui.Validator(d):js.newInstance(b[a],d)};this.initialize=function(a){this._required=!1;this._source=null;this._message="";this._showTag=!1;this._options=null;this.options(a)};js.$public.options=function(a){if(void 0===a)return this._options;this._options=a;this._options.required&&this.required(this._options.required);void 0!==this._options.showTag&&(this._showTag=this._options.showTag);this._options.message&&
this.message(this._options.message);this._options.source&&js.instanceOf(this._options.source,f.ui.IFormControl)&&this.source(this._options.source)};js.$public.validate=function(){if(!0==this._required&&null!=this._source){var a=this._source.value();if(null==a||void 0==a||"number"==js.type(a)&&isNaN(a)||"string"==js.type(a)&&""==a)return!1}return!0};js.$public.show=function(c){void 0===c&&(c=this.validate());a.hide();var b=this._source,e=this,g=b.$element();!0==c?!0!=b.validationError&&("function"!=
js.type(b.validationHandler)&&(b.validationHandler=function(){var c=new f.ui.ValidateMessage;c.text(e._message);c.arrow("top",10);a.show(c,{x:0,y:b.outerHeight()+6,classes:"qs-ani-fadein",$relative:g})}),b.$styleElement().addClass("qs-validate-border"),!1!=this._showTag&&(c=g.children(".qs-validate-ok"),0<c.length&&c.remove(),c=g.children(".qs-validate-error"),0==c.length&&g.append('\x3cdiv class\x3d"qs-validate-error"\x3e\x3c/div\x3e')),g.unbind("mouseenter",b.validationHandler),g.bind("mouseenter",
b.validationHandler)):(b.$styleElement().removeClass("qs-validate-border"),!1!=this._showTag&&(c=g.children(".qs-validate-error"),0<c.length&&c.remove(),c=g.children(".qs-validate-ok"),0==c.length&&g.append('\x3cdiv class\x3d"qs-validate-ok"\x3e\x3c/div\x3e')),g.unbind("mouseenter",b.validationHandler),b.validationHandler=null)};js.$public.required=function(a){if(void 0===a)return this._required;this._required=a;!0==this._required&&""==this._message&&(this._message=f.I18N.getString("qs.ui.validate.required"))};
js.$public.message=function(a){if(void 0===a)return this._message;this._message=a};js.$public.source=function(a){if(void 0===a)return this._source;js.instanceOf(a,f.ui.IFormControl)&&(this._source=a)}});js.$class("qs.ui.RegExpValidator",f.ui.Validator,function(){f.ui.Validator.register("regexp",this);this.initialize=function(a){this._regexp=null;this.$super(a)};js.$public.options=function(a){if(void 0===a)return this.$super(a);this.$super(a);this._options.regexp instanceof RegExp?this._regexp=this._options.regexp:
"string"==js.type(this._options.regexp)&&(this._regexp=RegExp(this._options.regexp))};js.$public.regexp=function(a){if(void 0===a)return this._regexp;a instanceof RegExp?this._regexp=a:"string"==js.type(a)&&(this._regexp=RegExp(a))};js.$public.validate=function(){if(!1==this.$super())return!1;if(null!=this._regexp&&null!=this._source){var a=this._source.value();return this._regexp.test(a)}return!0}});js.$class("qs.ui.EMailValidator",f.ui.RegExpValidator,function(){f.ui.Validator.register("email",
this);this.initialize=function(a){this.$super(a);this.regexp(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)}});js.$class("qs.ui.ValidationGroup",function(){this.initialize=function(){this._validators=[]};js.$public.addValidator=function(a,b,e){if(!js.instanceOf(a,f.ui.IFormControl))throw Error("Control type must be qs.ui.IFormControl");var g=null,g=js.instanceOf(b,f.ui.Validator)?b:f.ui.Validator.create(b,e);if(null==g)throw Error("Validator error.");g.source(a);this._validators.push(g)};
js.$public.removeValidator=function(a){if(void 0===a){for(var b=this._validators.length-1;0<=b;b--)this._validators[b].show(!1);this._validators.length=0}else for(b=this._validators.length-1;0<=b;b--)this._validators[b].source()==a&&(this._validators[b].show(!1),this._validators.splice(b,1))};js.$public.validate=function(a){for(var b,e=!1,g=0;g<this._validators.length;g++)if(b=this._validators[g],void 0===a||b.source()===a)!1==b.validate()?(b.show(!0),e=!0):b.show(!1);return!e}})})(qs,jQuery);(function(f,l){var a={},b={};a.height=a.paddingTop=a.paddingBottom=a.borderTopWidth=a.borderBottomWidth="hide";b.height=b.paddingTop=b.paddingBottom=b.borderTopWidth=b.borderBottomWidth="show";js.$class("qs.ui.Accordion",f.ui.ItemsControl,function(){this.initialize=function(a){this.$super(a);this._$selectedLi=this._$ul=null};js.$public.items=function(a){if(void 0===a)return this._items;this._items=a;if(null!=this._$ul)for(this._$ul.empty(),a=0;a<this._items.length;a++)this.createItem(this._items[a])};
js.$public.addItem=function(a){this._items.push(a);null!=this._$ul&&this.createItem(a)};js.$public.removeItem=function(a){a=this._items.indexOf(a);-1!=a&&(this._items.splice(a,1),null!=this._$ul&&(a=l(this._$ul.children("li")[a]),a.empty(),a.remove()))};js.$protected.onPropertyChanged=function(a,b,e){"selectedItem"==a&&(a=this._items.indexOf(e),-1!=a&&null!=this._$ul&&(a=this._$ul.children("li:nth-child("+(a+1)+")"),this.selectedLi(a)))};this.createItem=function(a){var b=StringUtil.join("\x3cli\x3e",
'\x3cspan class\x3d"qs-acco-header"\x3e','\x3ci class\x3d"qs-acco-icon"\x3e\x3c/i\x3e',a.label||"",'\x3cspan class\x3d"qs-acco-counter"\x3e',void 0==a.counter?"":a.counter,"\x3c/span\x3e","\x3c/span\x3e",'\x3cdiv class\x3d"qs-acco-content" style\x3d"display:none"\x3e',"\x3c/div\x3e","\x3c/li\x3e"),b=l(b);b.data("data",a);this._$ul.append(b);b=b.find(".qs-acco-content");if(a.content)if(js.instanceOf(a.content,f.ui.Control)){if(a.content.isRendered())b.append(a.content.$element()),a.content.$element().css("position",
"");else{var e=l("\x3cdiv\x3e\x3c/div\x3e");b.append(e);a.content.render(e);e.css("position","")}a.content.parent(this)}else b.append(a.content)};js.$public.updateSize=function(a,b){this.$super();var e=this.parent();js.isNull(e)||e.invalidateSize(!0)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-accordion"\x3e',"\x3cul\x3e","\x3c/ul\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,
b);var e=this._$element.find(".qs-accordion");0<b.classes.length&&e.addClass(b.classes);this._$ul=this._$element.find(".qs-accordion\x3eul");for(e=0;e<this._items.length;e++)this.createItem(this._items[e]);this.bindEvent("mousedown",this.mouseDown);this.invalidateSize()};this.selectedLi=function(a){if(!a.hasClass("active")){var b,e;null!=this._$selectedLi?(this._$selectedLi.removeClass("active"),e=b=this._$selectedLi.find(".qs-acco-content")):e=this._$ul.children("li.active");this._$selectedLi=a;
this._$selectedLi.addClass("active");b=this._$selectedLi.find(".qs-acco-content");this.animate(b,e);this.selectedItem(this._$selectedLi.data("data"))}};this.mouseDown=function(a){a=l(a.target).closest(".qs-acco-header",this._$element);0<a.length&&this.selectedLi(a.parent())};this.animate=function(c,d){var e,g=this,k=0;!c.length||d.length&&(c.index(),d.index());var m=function(){js.instanceOf(g.parent(),f.ui.Control)&&g.parent().invalidateSize(!0);var a=g.selectedItem();!js.isNull(a)&&js.instanceOf(a.content,
f.ui.Control)&&a.content.invalidateSize(!0)};if(!d.length)return c.animate(b,{duration:300,complete:m});if(!c.length)return d.animate(a,300);e=c.show().outerHeight();d.animate(a,{duration:300,step:function(a,c){c.now=Math.round(a)}});c.hide().animate(b,{duration:300,complete:m,step:function(a,c){c.now=Math.round(a);"height"!==c.prop?k+=c.now:(c.now=Math.round(e-d.outerHeight()-k),k=0)}})}});l.fn.qs_accordion=function(a){return this.each(function(){(new f.ui.Accordion).render(l(this))})}})(qs,jQuery);(function(f,l){js.$class("qs.ui.HSplitter",f.ui.Control,function(){this.initialize=function(a){this.$super(a);isNaN(this.width())&&this.width(5)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-hsplitter"\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-hsplitter");c.width(a);c.height(b)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",text:""},this._options,
b);this.$super(a,b);var c=a.children(".qs-hsplitter");0<b.classes.length&&c.addClass(b.classes);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.invalidateSize()};js.$public.mouseDown=function(a){if(0<l(a.target).closest(".qs-hsplitter",this._$element).length){var b=this.parent();if(js.instanceOf(b,f.ui.Container)&&js.instanceOf(b.layout(),f.layout.HLayout)){var b=b.children(),c=b.indexOf(this);if(-1!=c&&0!=c&&c!=b.size()-
1)return this._leftCtrl=b.get(c-1),this._rightCtrl=b.get(c+1),this._dragArea="bar",this.setCapture(this._$element),this._dragX=a.pageX,this._dragY=a.pageY,this._dragPos=this._$element.offset(),js.isNull(this._$bar)&&(this._$bar=l('\x3cdiv class\x3d"qs-hsplitter-bar"\x3e\x3c/div\x3e'),a=this.outerSize(),this._$bar.width(a.width),this._$bar.height(a.height),this._$bar.css("left",this._dragPos.left),this._$bar.css("top",this._dragPos.top),l("body").append(this._$bar)),this._minX=this._dragPos.left-this._leftCtrl.outerWidth(),
this._maxX=this._dragPos.left+this._rightCtrl.outerWidth(),!1}}};js.$public.mouseMove=function(a){var b=!1;"bar"==this._dragArea&&(b=Math.min(Math.max(this._dragPos.left+(a.pageX-this._dragX),this._minX),this._maxX),this._$bar.css("left",b),this._$bar.css("top",this._dragPos.top),b=!0);if(!0==b)return a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),!1};js.$public.mouseUp=function(a){this.releaseCapture(this._$element);if("bar"==this._dragArea){js.isNull(this._$bar)||(this._$bar.empty(),
this._$bar.remove(),this._$bar=null);a=a.pageX-this._dragX;a=Math.min(Math.max(this._dragPos.left+a,this._minX),this._maxX);a=Math.floor(a-this._dragX);var b=this._leftCtrl.contentSize().width+a;this._leftCtrl.width(b,!1);var c=this._leftCtrl.data("layout");c&&c.width&&(c.width=b);b=this._rightCtrl.contentSize().width-a;this._rightCtrl.outerSize({width:b},!1);(c=this._rightCtrl.data("layout"))&&"number"==js.type(c.width)&&(c.width=b);this.parent().invalidateSize(!0)}this._dragArea=""}});js.$class("qs.ui.VSplitter",
f.ui.Control,function(){this.initialize=function(a){this.$super(a);isNaN(this.height())&&this.height(5)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-vsplitter"\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-vsplitter");c.width(a);c.height(b)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",text:""},this._options,b);this.$super(a,b);var c=a.children(".qs-vsplitter");
0<b.classes.length&&c.addClass(b.classes);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);this.invalidateSize()};js.$public.mouseDown=function(a){if(0<l(a.target).closest(".qs-vsplitter",this._$element).length){var b=this.parent();if(js.instanceOf(b,f.ui.Container)&&js.instanceOf(b.layout(),f.layout.VLayout)){var b=b.children(),c=b.indexOf(this);if(-1!=c&&0!=c&&c!=b.size()-1)return this._topCtrl=b.get(c-1),this._bottomCtrl=
b.get(c+1),this._dragArea="bar",this.setCapture(this._$element),this._dragX=a.pageX,this._dragY=a.pageY,this._dragPos=this._$element.offset(),js.isNull(this._$bar)&&(this._$bar=l('\x3cdiv class\x3d"qs-vsplitter-bar"\x3e\x3c/div\x3e'),a=this.outerSize(),this._$bar.width(a.width),this._$bar.height(a.height),this._$bar.css("left",this._dragPos.left),this._$bar.css("top",this._dragPos.top),l("body").append(this._$bar)),this._minY=this._dragPos.top-this._topCtrl.outerHeight(),this._maxY=this._dragPos.top+
this._bottomCtrl.outerHeight(),!1}}};js.$public.mouseMove=function(a){var b=!1;"bar"==this._dragArea&&(b=Math.min(Math.max(this._dragPos.top+(a.pageY-this._dragY),this._minY),this._maxY),this._$bar.css("top",b),this._$bar.css("left",this._dragPos.left),b=!0);if(!0==b)return a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),!1};js.$public.mouseUp=function(a){this.releaseCapture(this._$element);if("bar"==this._dragArea){js.isNull(this._$bar)||(this._$bar.empty(),this._$bar.remove(),
this._$bar=null);a=a.pageY-this._dragY;a=Math.min(Math.max(this._dragPos.top+a,this._minY),this._maxY);a=Math.floor(a-this._dragY);var b=this._topCtrl.contentSize().height+a;this._topCtrl.height(b,!1);var c=this._topCtrl.data("layout");c&&c.height&&(c.height=b);b=this._bottomCtrl.contentSize().height-a;this._bottomCtrl.outerSize({height:b},!1);(c=this._bottomCtrl.data("layout"))&&"number"==js.type(c.height)&&(c.height=b);this.parent().invalidateSize(!0)}this._dragArea=""}})})(qs,jQuery);(function(f,l){js.$class("qs.ui.Slider",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._direction="horizontal";this._maximum=10;this._step=this._minimum=1};js.$public.direction=function(a){if(void 0===a)return this._direction;this._direction=a};js.$public.maximum=function(a){if(void 0===a)return this._maximum;this._maximum=a};js.$public.minimum=function(a){if(void 0===a)return this._minimum;this._minimum=a};js.$public.step=function(a){if(void 0===a)return this._step;this._step=
a};js.$public.value=function(a){if(void 0===a)return this._value;a=parseFloat(a);isFinite(a)||(a=0);a=Math.max(Math.min(this._maximum,a),this._minimum);var b=this._value;this._value=a;b!==a&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-slider horizontal"\x3e','\x3cdiv class\x3d"slider-handler"\x3e\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},
this._options,b);this.$super(a,b);var c=a.children(".qs-slider");this._$handler=c.children(".slider-handler");"vertical"==this._direction?(c.removeClass("horizontal"),c.addClass("vertical"),c.width(f.ui.theme.slider_height),this._$handler.css("top",-1)):(c.height(f.ui.theme.slider_height),this._$handler.css("left",-1));0<b.classes.length&&c.addClass(b.classes);this.bindEvent("mousedown",this.mouseDown);this.bindEvent("mousemove",this.mouseMove);this.bindEvent("mouseup",this.mouseUp);if("vertical"==
this._direction){var d=this._$element.height()-this._$handler.height(),c=(this._maximum-this._minimum)/this._step,c=Math.round(d/c*(this._value/this._step-1));this._$handler.css("top",c)}else d=this._$element.width()-this._$handler.width(),c=(this._maximum-this._minimum)/this._step,c=Math.round(d/c*(this._value/this._step-1)),this._$handler.css("left",c);this.invalidateSize()};js.$public.mouseDown=function(a){l(a.target).is(".slider-handler")&&(this.setCapture(this._$element),this._handling=!0,this._dragX=
a.pageX,this._dragY=a.pageY,this._dragPos={left:parseInt(this._$handler.css("left")),top:parseInt(this._$handler.css("top"))});return!1};js.$public.mouseMove=function(a){if(!0==this._handling){var b=a.pageX-this._dragX;a=a.pageY-this._dragY;if("vertical"==this._direction){var c=this._$element.height()-this._$handler.height(),d=this._dragPos.top+a,b=(this._maximum-this._minimum)/this._step;a=c/b;var e=Math.round(d/a),e=Math.max(Math.min(b,e),0),d=Math.min(Math.max(e*a,0),c)-1,b=this._minimum+e*this._step;
this._$handler.css("top",d)}else c=this._$element.width()-this._$handler.width(),d=this._dragPos.left+b,b=(this._maximum-this._minimum)/this._step,a=c/b,e=Math.round(d/a),e=Math.max(Math.min(b,e),0),d=Math.min(Math.max(e*a,0),c)-1,b=this._minimum+e*this._step,this._$handler.css("left",d);this.value(b)}return!1};js.$public.mouseUp=function(a){this.releaseCapture(this._$element);return this._handling=!1}});l.fn.qs_slider=function(a){return this.each(function(){var b=new f.ui.Slider;b.render(l(this),
a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){function a(a){try{var c=a.target;(c.contentWindow||c.contentDocument.parentWindow).qs=f}catch(d){console.trace(d)}}js.$class("qs.ui.Html",f.ui.Control,function(){this.initialize=function(a){this.$super(a);this._iframe=!1;this._url="";this._param={};this._html=""};js.$public.url=function(a){if(void 0===a)return this._url;this._url=a};js.$public.iframe=function(a){if(void 0===a)return this._iframe;this._iframe=a};js.$public.html=function(a){if(void 0===a)return this._html;this._html=
a;this.callAfterRendered(function(){this._$element.html(this._html)})};js.$public.param=function(a){if(void 0===a)return this._param;this._param=a};js.$protected.template=function(a){return""};this.onHtmlLoaded=function(a){this._$element.html(a);this._html=a};js.$public.refresh=function(){if(!js.isNull(this._url)&&""!=this._url)if(!0==this._iframe)this._$element.find("iframe").attr("src",this._url);else{var a=this,c=l.extend({_:(new Date).getTime()},this._param);l.ajax({url:this._url,type:"POST",
data:c,async:!0,dataType:"text",success:function(c){js.callInternal(a,a.onHtmlLoaded,[c])},error:function(a,c,b){},complete:function(a,c){}})}};js.$protected.onRendered=function(b,c){b.addClass("qs-html");c=l.extend({classes:""},this._options,c);0<c.classes.length&&b.addClass(c.classes);if(!0==this._iframe){var d=StringUtil.join('\x3cdiv style\x3d"width: 100%; height: 100%; overflow: scroll !important;-webkit-overflow-scrolling:touch !important;"\x3e','\x3ciframe scrolling\x3d"yes" style\x3d"width:100%;height:100%;border:none"\x3e',
"\x3c/iframe\x3e","\x3c/div\x3e");b.append(d);b.find("iframe").bind("load",a)}this.refresh()};js.$static.QXMLParser=function(a,c,d){if(0!=d.length){c="";for(var e=0;e<d.length;e++)c+=d[e].toString();a.html(c)}}})})(qs,jQuery);(function(f,l){function a(a){function b(a){return function(){A||(A=!0,a.apply(this,arguments),A=!1)}}function e(a){for(var c=[],b=0;b<a.length;b++)for(var d=a[b].fromRow;d<=a[b].toRow;d++)c.push(d);return c}function g(a){for(var c=[],b=r.getColumns().length-1,d=0;d<a.length;d++)c.push(new Slick.Range(a[d],0,a[d],b));return c}function f(a,c){var b,d=[];for(b=a;b<=c;b++)d.push(b);for(b=c;b<a;b++)d.push(b);return d}function m(){return e(t)}function n(a){t=a;v.onSelectedRangesChanged.notify(t)}function p(a,
c){if(B.selectActiveRow&&null!=c.row){var b=r.getColumns();if("array"!=js.type(t)||1!=t.length||t[0].fromRow!=c.row||t[0].toRow!=c.row||0!=t[0].fromCell||t[0].toCell!=b.length-1)n([new Slick.Range(c.row,0,c.row,b.length-1)]),(b[c.cell].editable||b[c.cell].editor)&&r.editActiveCell()}}function q(a){var c=r.getActiveCell();if(c&&a.shiftKey&&!(a.ctrlKey||a.altKey||a.metaKey||38!=a.which&&40!=a.which)){var b=m();b.sort(function(a,c){return a-c});b.length||(b=[c.row]);var d=b[0],b=b[b.length-1],c=40==
a.which?c.row<b||d==b?++b:++d:c.row<b?--b:--d;0<=c&&c<r.getDataLength()&&(r.scrollRowIntoView(c),t=g(f(d,b)),n(t));a.preventDefault();a.stopPropagation()}}function s(a,c){var b=r.getCellFromEvent(a);if(!(b&&r.canCellBeActive(b.row,b.cell)&&r.getOptions().multiSelect&&(a.ctrlKey||a.shiftKey||a.metaKey)))return!1;var d=e(t),f=l.inArray(b.row,d);if(-1===f&&(a.ctrlKey||a.metaKey))d.push(b.row),r.setActiveCell(b.row,b.cell);else if(-1!==f&&(a.ctrlKey||a.metaKey))d=l.grep(d,function(a,c){return a!==b.row}),
r.setActiveCell(b.row,b.cell);else if(d.length&&a.shiftKey){for(var f=d.pop(),k=Math.min(b.row,f),m=Math.max(b.row,f);k<=m;k++)k!==f&&d.push(k);d.push(f);r.setActiveCell(b.row,b.cell)}t=g(d);n(t);a.stopImmediatePropagation();return!0}var r,t=[],v=this,z=new Slick.EventHandler,A,B,y={selectActiveRow:!0};l.extend(this,{getSelectedRows:m,setSelectedRows:function(a){n(g(a))},getSelectedRanges:function(){return t},setSelectedRanges:n,init:function(e){B=l.extend(!0,{},y,a);r=e;z.subscribe(r.onActiveCellChanged,
b(p));z.subscribe(r.onKeyDown,b(q));z.subscribe(r.onClick,b(s))},destroy:function(){z.unsubscribeAll()},onSelectedRangesChanged:new Slick.Event})}var b=300;js.$class("qs.ui.DataGrid",f.ui.Control,function(){f.events.register("selectedRowChange",this);js.$static.SELECTEDROW_CHANGE_EVENT="selectedRowChange";js.$static.CONTEXT_MENU_EVENT="contextMenu";this.initialize=function(a){this.$super(a);this._dataProvider=[];this._columns=[];this._grid=null;this._editable=!0;this._verticalScrollBar=this._horizontalScrollBar=
null;this.addEventListener("showColumnMenu",this.onShowColumnMenu);this.addEventListener("headerMenu",this.onHeaderMenu)};js.$protected.onShowColumnMenu=function(a,b){};js.$protected.onHeaderMenu=function(a,b){};js.$public.editable=function(a){if(void 0===a)return this._editable;this._editable=a};js.$public.dataProvider=function(a){if(void 0===a)return this._dataProvider;this._dataProvider=null;if(null==a)null!=this._grid&&this._grid.setData([],!0);else{if("array"==f.type(a))this._dataProvider=a;
else if(js.instanceOf(a,f.ArrayList))this._dataProvider=a.toArray();else if("function"==js.type(a.getItem))this._dataProvider=a;else throw new TypeError;null!=this._grid&&(this._grid.getSelectionModel()&&this._grid.setSelectedRows([]),this._grid.setData(this._dataProvider,!0),this._grid.invalidate(),this._grid.render(),this._verticalScrollBar&&this._verticalScrollBar.value(0),this._horizontalScrollBar&&this._horizontalScrollBar.value(0),this.invalidateSize(!0))}};js.$public.getDataItem=function(a){return js.isNull(this._dataProvider)?
null:"array"==f.type(this._dataProvider)?this._dataProvider[a]:"function"==js.type(this._dataProvider.getItem)?this._dataProvider.getItem(a):null};js.$public.getDataLength=function(){return js.isNull(this._dataProvider)?0:"array"==f.type(this._dataProvider)?this._dataProvider.length:"function"==js.type(this._dataProvider.getLength)?this._dataProvider.getLength():0};js.$public.columns=function(a){if(void 0===a)return this._columns;this._columns=a;var b=this;if("array"==js.type(a))for(var e=0;e<a.length;e++)a[e].asyncPostRender=
function(a,c,e,f){js.callInternal(b,b.onCellPostRender,[a,c,e,f])};null!=this._grid&&this._grid.setColumns(this._columns)};js.$protected.onCellPostRender=function(a,b,e,g){};js.$public.enabled=function(a){if(void 0===a)return this.$super();this.$super(a);!1==a&&this.callAfterRendered(function(){this._$element.find(".qs-disabled-mask").css("display","none")})};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()&&this._grid){var e=this._$element.find(".qs-slickgrid");if(0<e.length){var g=
!1,k=!1,m=this._$element.find(".qs-slickgrid .slick-viewport");m.css("overflow-x","hidden");m.css("overflow-y","hidden");var n=this._$element.find(".qs-slickgrid .slick-viewport .grid-canvas");e.width(a);e.height(b);this._grid.resizeCanvas();var l=n.width()>e.width();n.height()>m.height()?(this._verticalScrollBar.$element().css("display",""),this._verticalScrollBar.top(m.offset().top-e.offset().top),e.width(a-f.ui.theme.scrollbar_width),this._verticalScrollBar.height(m.height()),this._verticalScrollBar.maximum(n.height()-
m.height()),g=this._$element.find(".dg-vscroll-header"),g.height(m.offset().top-e.offset().top-1),g.css("display",""),g=!0):this._verticalScrollBar.$element().css("display","none");l?(this._horizontalScrollBar.$element().css("display",""),e.height(b-f.ui.theme.scrollbar_width),this._horizontalScrollBar.width(e.width()),this._horizontalScrollBar.maximum(n.width()-e.width()),k=!0):this._horizontalScrollBar.$element().css("display","none");this._grid.resizeCanvas();!0==g&&!0==k&&(this._verticalScrollBar.height(m.height()),
this._verticalScrollBar.maximum(n.height()-m.height()),this._horizontalScrollBar.width(e.width()),this._horizontalScrollBar.maximum(n.width()-e.width()),this._$element.find(".dg-scrollbar-corner").css("display",""));!1==this._enabled&&(e=this._$element.find(".qs-disabled-mask"),m=this.outerSize(),!0==g&&(m.width-=this._verticalScrollBar.$element().width()),!0==k&&(m.height-=this._horizontalScrollBar.$element().height()),e.outerWidth(m.width),e.outerHeight(m.height))}}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-slickgrid"\x3e',
"\x3c/div\x3e",'\x3cdiv class\x3d"dg-vscroll-header" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dg-hscroll" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dg-vscroll" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dg-scrollbar-corner" style\x3d"display:none"\x3e\x3c/div\x3e')};js.$public.options=function(a){if(void 0===a)return null!=this._grid?l.extend({},this._options,this._grid.getOptions()):this._options;this._options=a;null==this._options&&(this._options=
{});if(null!=this._grid)return this._grid.setOptions(this._options)};js.$public.render=function(c,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"",editable:this._editable,enableAsyncPostRender:!0,asyncPostRenderDelay:0,syncColumnCellResize:!0,selectActiveRow:!0,enableTextSelectionOnCells:!0},this._options,b);this.$super(c,b);c.addClass("qs-datagrid");0<b.classes.length&&c.addClass(b.classes);var e=c.find(".qs-slickgrid"),g=new f.ui.DataGrid.ColumnHeaderPlugin(this);this._grid=new Slick.Grid(e,
this._dataProvider,this._columns,b);this._grid.registerPlugin(g);this._grid.setSelectionModel(new a({selectActiveRow:b.selectActiveRow}));var k=c.find(".qs-slickgrid .slick-viewport"),g=c.find(".qs-slickgrid .slick-viewport .grid-canvas"),m=c.find(".dg-vscroll"),n=new f.ui.VerticalScrollBar;n.maximum(g.height()-k.height());n.render(m,{});n.top(k.offset().top-e.offset().top);n.right(0);n.width(f.ui.theme.scrollbar_width);n.height(k.height());n.bindEvent("valueChanged",function(a){a=n.value();k.scrollTop(a)});
k.bind("scroll",function(){q._renderTimeId&&clearTimeout(q._renderTimeId);q._renderTimeId=setTimeout(function(){q._grid.render()},200)});this._verticalScrollBar=n;var e=c.find(".dg-hscroll"),p=new f.ui.HorizontalScrollBar;p.maximum(g.width());p.render(e,{});p.bottom(0);p.height(f.ui.theme.scrollbar_width);p.width(k.width());p.bindEvent("valueChanged",function(a){a=p.value();k.scrollLeft(a)});this._horizontalScrollBar=p;k.css("overflow-x","hidden");k.css("overflow-y","hidden");var q=this;this._grid.onColumnsResized.subscribe(function(a,
c){q.invalidateSize(!0)});this._grid.onKeyDown.subscribe(function(a,c){q.onKeyDown(a,c)});this._grid.onActiveCellChanged.subscribe(function(a,c){q._activeRow!=c.row&&(q._activeRow=c.row,q.dispatchEvent(f.ui.DataGrid.SELECTEDROW_CHANGE_EVENT))});this._grid.onSort.subscribe(function(a,c){if(!l(a.target).hasClass("slick-header-column")||!(10>a.offsetX||20>a.target.offsetWidth-a.offsetX))q.onColumnSort(c.sortCol,c.sortAsc?"asc":"desc")});this._grid.onBeforeEditCell.subscribe(function(a,c){return q.enabled()?
q.onBeforeEditCell(a,c):!1});this._grid.onContextMenu.subscribe(function(a,c){var b=c.grid.getCellFromEvent(a);c.grid.setActiveCell(b.row,b.cell);c.grid.getEditController().cancelCurrentEdit();q.dispatchEvent(f.ui.DataGrid.CONTEXT_MENU_EVENT,{cell:b})});c.bind("mousewheel",function(a,c){n.value(n.value()-30*c);return!1});this.invalidateSize()};js.$public.onColumnSort=function(a,b){};js.$public.onBeforeEditCell=function(a,b){};js.$protected.onKeyDown=function(a,b){};js.$public.selectedItem=function(a){if(void 0===
a){a=this._grid.getActiveCell();var b=-1;a&&(b=a.row);return-1==b||void 0==b?null:this.getDataItem(b)}a=this._dataProvider.indexOf(a);-1==a?this._grid.resetActiveCell():this._grid.setActiveCell(a,0)};js.$public.selectedIndex=function(a){if(void 0===a)return(a=this._grid.getActiveCell())?a.row:-1;this._grid.setActiveCell(a,0)};js.$public.invalidateAllRows=function(){this._grid.invalidateAllRows();this._grid.render()};js.$public.invalidateRow=function(a){this._grid.invalidateRow(a);this._grid.render();
(a=this._grid.getActiveCell())&&(this._columns[a.cell].editable||this._columns[a.cell].editor)&&this._grid.editActiveCell()};js.$public.invalidateRows=function(a){this._grid.invalidateRows(a);this._grid.render()};js.$public.invalidate=function(){this.commitCurrentEdit();this._grid.invalidate();this.invalidateSize(!0)};js.$public.getSelectedRows=function(){return this._grid.getSelectedRows()};js.$public.setSelectedRows=function(a){this._grid.setSelectedRows(a)};js.$public.commitCurrentEdit=function(){this._grid.getCellEditor()&&
this._grid.getEditController().commitCurrentEdit()};js.$protected.onRowSelectionChange=function(a,b){}});f.ui.DataGrid.ColumnHeaderPlugin=function(a){var d,e,g;function k(a,c){var b=c.column,k=b.header;if(k){var m=b.header.menu;if(m){if(0<l(c.node).find(".qs-grid-header-menu").length)return;var n=l('\x3cdiv class\x3d"qs-grid-header-menu"\x3e\x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\x3c/div\x3e').data("column",b).data("menu",m);n.bind("click",t).appendTo(c.node);n.mousedown(function(a){n.addClass("pressed");
return!1});n.mouseup(function(a){n.removeClass("pressed");return!1})}!0!=k.checkbox||0<l(c.node).find(".qs_scheckbox").length||(n=l(f.ui.CheckBox.HTML_CHECKBOX),l(c.node).width(16),n.appendTo(c.node),d=b.id,e=b.field,g=n,b.resizable=!1,b.width=l(c.node).outerWidth(),b.formatter=function(a,c,b,d,e){return e?!0==e[d.field]||"true"==e[d.field]?f.ui.CheckBox.HTML_CHECKBOX_CHECKED:f.ui.CheckBox.HTML_CHECKBOX:null},n.bind("click",function(){var a=f.ui.CheckBox.checked(n);f.ui.CheckBox.checked(n,!a)}))}}
function m(a){if(a=z.getCellFromEvent(a)){a=l(z.getCellNode(a.row,a.cell));var c;c=a.innerWidth()<a[0].scrollWidth?l.trim(a.text()):"";a.attr("title",c)}}function n(a,c){var b=z.getDataItem(c.row);try{if(js.instanceOf(v.dataProvider(),f.app.data.DataView)&&js.instanceOf(b,f.app.data.GroupData)){var d=v.dataProvider();c.group=b;js.callInternal(d,d.onGroupClick,[a,c]);return!1}}catch(g){}d=l(a.target);if(f.ui.CheckBox.isCheckBox(d)){if(z.getEditorLock().isActive()&&!z.getEditorLock().commitCurrentEdit()){a.preventDefault();
a.stopImmediatePropagation();return}var k=f.ui.CheckBox.checked(d),k=!k;f.ui.CheckBox.checked(d,k);b[e]=k;q(c.row);a.stopPropagation();a.stopImmediatePropagation()}(b=z.getActiveCell())&&c.cell==b.cell&&c.row==b.row&&(b=z.getColumns(),(b[c.cell].editable||b[c.cell].editor)&&z.editActiveCell())}function p(a,c){if(c.column.id==d){var e=l(a.target);if(f.ui.CheckBox.isCheckBox(e)){if(z.getEditorLock().isActive()&&!z.getEditorLock().commitCurrentEdit())a.preventDefault();else{if(!0==f.ui.CheckBox.checked(e)){var g=
z.getDataLength();if(g>b)f.ui.MessageBox.show(f.I18N.getString("qs.ui.datagrid.001"),f.I18N.getString("qs.ui.messagebox.info"),f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,function(a){a==f.ui.MessageBox.Yes&&z.setSelectedRows([])}),f.ui.CheckBox.checked(e,!1);else{for(var e=[],k=0;k<g;k++)e.push(k);z.setSelectedRows(e)}}else z.setSelectedRows([]);a.stopPropagation()}a.stopImmediatePropagation()}}}function q(a){B[a]?z.setSelectedRows(l.grep(z.getSelectedRows(),function(c){return c!=a})):z.setSelectedRows(z.getSelectedRows().concat(a))}
function s(a,c){if(g){var b=z.getSelectedRows(),d,k={},m,n;for(n=0;n<b.length;n++)m=b[n],k[m]=!0,d=z.getDataItem(m),d[e]=!0,k[m]!==B[m]&&(z.invalidateRow(m),delete B[m],js.callInternal(v,v.onRowSelectionChange,[m,!0]));for(n in B)d=z.getDataItem(n),!k[n]&&d&&(delete d[e],js.callInternal(v,v.onRowSelectionChange,[n,!1])),z.invalidateRow(n);B=k;z.render();b.length&&b.length==z.getDataLength()?f.ui.CheckBox.setValue(g,f.ui.CheckBox.CHECKED):0==b.length?f.ui.CheckBox.setValue(g,f.ui.CheckBox.UNCHECKED):
f.ui.CheckBox.setValue(g,f.ui.CheckBox.MIDDLE)}}function r(a,c){var b=c.column;b.header&&b.header.menu&&l(c.node).find(".qs-grid-header-menu").remove()}function t(a){var c=l(this),b=c.data("menu"),d=c.data("column");void 0!=b&&null!=b&&(!0==b?v.dispatchEvent("showColumnMenu",{column:d,$el:c}):b.menuitem&&(d=new f.ui.Menu,d.menudata(b),b=c.offset(),d.show(b.left,b.top+c.height()),d.addEventListener("itemClick",function(a,c){v.dispatchEvent("headerMenu",c)})),a.preventDefault(),a.stopPropagation())}
var v=a,z=null,A=new Slick.EventHandler,B={};g=e=d=void 0;this.init=function(a){z=a;A.subscribe(z.onHeaderCellRendered,k).subscribe(z.onClick,n).subscribe(z.onMouseEnter,m).subscribe(z.onHeaderClick,p).subscribe(z.onSelectedRowsChanged,s).subscribe(z.onBeforeHeaderCellDestroy,r);z.setColumns(z.getColumns())};this.destroy=function(){A.unsubscribeAll()}};f.ui.DataGrid.TextEditor=function(a){var b=null,e="";this.init=function(){b=new f.ui.TextInput;var e=l("\x3cdiv\x3e\x3c/div\x3e");l(a.container).append(e);
b.render(e,{width:l(a.container).width()+8,classes:"dg-input-editor",position:"relative"});b.focus()};this.destroy=function(){b.remove()};this.focus=function(){b.focus()};this.getValue=function(){return b.text()};this.setValue=function(a){b.text(a)};this.loadValue=function(g){e=g[a.column.field]||"";b.text(e);g=b.$element().find("input");g[0].defaultValue=e;g.select()};this.serializeValue=function(){return b.text()};this.applyValue=function(b,d){b[a.column.field]=d};this.isValueChanged=function(){return!(""==
b.text()&&null==e)&&b.text()!=e};this.validate=function(){if(a.column.validator){var e=a.column.validator(b.text());if(!e.valid)return e}return{valid:!0,msg:null}};this.init()};f.ui.DataGrid.DateTimeEditor=function(a){var b=null,e="";this.init=function(){b=new f.ui.DateField;var e=l("\x3cdiv\x3e\x3c/div\x3e");l(a.container).append(e);b.render(e,{width:l(a.container).width()+8,classes:"dg-input-editor",position:"relative"})};this.destroy=function(){b.remove()};this.focus=function(){b.focus()};this.getValue=
function(){return b.selectedDate()};this.setValue=function(a){b.selectedDate(a)};this.loadValue=function(g){e=g[a.column.field]||null;b.selectedDate(e);b.$element().find("input").select()};this.serializeValue=function(){return b.selectedDate()};this.applyValue=function(b,d){b[a.column.field]=d};this.isValueChanged=function(){return!(""==b.selectedDate()&&null==e)&&b.selectedDate()!=e};this.validate=function(){if(a.column.validator){var e=a.column.validator(b.selectedDate());if(!e.valid)return e}return{valid:!0,
msg:null}};this.init()};f.ui.DataGrid.dateFormatter=function(a,b,e,g,k){return null==e?"":"date"==f.type(e)?DateUtil.format(e,"yyyy-MM-dd"):e};l.fn.qs_datagrid=function(a){return this.each(function(){var b=new f.ui.DataGrid;b.render(l(this),a);l(this).data("control",b)})}})(qs,jQuery);(function(f,l){var a=null;js.$class("qs.ui.FocusManager",function(){js.$static.FOCUS_IN="focusin";js.$static.FOCUS_OUT="focusout";this.initialize=function(){};js.$static.focus=function(b){if(a!=b&&(a=b,a.dispatchEvent(f.ui.FocusManager.FOCUS_IN),b=b.$element(),!js.isNull(b))){var c=b.find("input[type!\x3dhidden],textarea,a");0<c.length&&"none"!=c.css("display")?l(c[0]).focus():b.focus()}};js.$static.focusNext=function(a){var c=a.parent();if(js.instanceOf(c,f.ui.Container)){var d=a.tabIndex(),e=a.offset(),
g=null,k=null,m=null,n,l;c.forEach(!1,function(c){if(c!=a&&c.enabled()&&c.focusEnabled()){if(null==g)g=c;else if(g.tabIndex()>c.tabIndex())g=c;else if(g.tabIndex()==c.tabIndex()){var f=g.offset(),r=c.offset();if(r.top<f.top||r.top==f.top&&r.left<f.left)g=c}n=c.tabIndex();n==d?(l=c.offset(),l.top<e.top||l.top==e.top&&l.left<e.left||(null==k?k=c:k.offset())):n>d&&(null==m||n<m.tabIndex()?m=c:n==m.tabIndex()&&(l=c.offset(),m.offset()))}});null!=k?k.focus():null!=m?m.focus():null!=g&&g.focus()}}});l(document).keydown(function(a){switch(a.keyCode){case 9:var c=
f.ui.Control.findOwnerControl(a.target);js.isNull(c)||!0!=c.focusEnabled()||(f.ui.FocusManager.focusNext(c),a.preventDefault(),a.stopImmediatePropagation());return!1;case 8:if(!l(a.target).is("input,textarea")&&"true"!=a.target.contentEditable)return!1}});l(document).mousedown(function(a){a=f.ui.Control.findOwnerControl(a.target);js.isNull(a)||!0!=a.focusEnabled()||f.ui.FocusManager.focus(a)})})(qs,jQuery);(function(){js.$namespace("wos.events");wos.events.WOSEvent={OK:"ok"};js.$class("wos.events.AsyncOption",function(){js.$public.asyncName="";js.$public.asyncData=null;js.$public.showWaitingBox=!0;js.$public.silence=!1;this.initialize=function(f,l){this.asyncName=f;this.asyncData=l}});js.$class("wos.events.CallbackEvent",qs.events.Event,function(){js.$static.CALLBACK="callback";js.$public.callUID="";js.$public.methodName="";js.$public.option=null;js.$public.result=null;js.$public.hasException=!1;js.$public.exceptionMessage=
"";js.$public.exception=null;this.initialize=function(f,l,a,b){this.callUID=f;this.methodName=l;this.option=b;this.result=a;null==this.option?this.option=new wos.events.AsyncOption(l,null):null==this.option.asyncName&&(this.option.asyncName=l);this.$super(wos.events.CallbackEvent.CALLBACK);this.stopPropagation()};js.$public.setException=function(f,l){this.hasException=!0;this.exceptionMessage=f;this.exception=l}});js.$class("wos.events.DesktopEvent",qs.events.Event,function(){js.$public.action="";
js.$public.relatedObject=null;this.initialize=function(f,l,a){this.$super(f);this.action=l;this.body=this.relatedObject=a}});js.$class("wos.events.ExceptionEvent",qs.events.Event,function(){js.$static.EXCEPTION="exception";js.$public.callUID="";js.$public.methodName="";js.$public.option=null;js.$public.result=null;js.$public.exceptionMessage="";js.$public.exception=null;this.initialize=function(f,l,a,b,c){this.callUID=f;this.methodName=l;this.option=c;this.exceptionMsg=a;this.exception=b;null==this.option?
this.option=new wos.events.AsyncOption(l,null):null==this.option.asyncName&&(this.option.asyncName=l);this.$super(wos.events.ExceptionEvent.EXCEPTION)}});js.$class("wos.events.FileLoadEvent",qs.events.Event,function(){js.$static.FILE_LOAD="fileload";js.$public.url="";js.$public.content="";js.$public.option=null;js.$public.isLoaded=!1;js.$public.message="";this.initialize=function(f,l,a,b,c){this.$super(wos.events.FileLoadEvent.FILE_LOAD);this.url=f;this.content=l;this.isLoaded=a;this.message=b;this.option=
c;null==this.option?this.option=new wos.events.AsyncOption(f,null):null==this.option.asyncName&&(this.option.asyncName=f)}});js.$class("wos.events.PageChangedEvent",qs.events.Event,function(){js.$static.PAGE_CHANGED_EVENT="pageChanged";this.initialize=function(){this.$super(wos.events.PageChangedEvent.PAGE_CHANGED_EVENT)};js.$public.pageNo=0});js.$class("wos.events.ScriptEvent",qs.events.Event,function(){js.$static.ASYNC_EXECUTE_FINISHED="asyncExecuteFinished";js.$public.result=null;js.$public.option=
null;this.initialize=function(f,l){this.$super(wos.events.ScriptEvent.ASYNC_EXECUTE_FINISHED);this.result=f;this.option=l;null==this.option&&(this.option=new wos.events.AsyncOption("",null))}})})();(function(f){function l(a){var c=document.getElementsByTagName("head")[0];if(StringUtil.endWith(a,".css")){var d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=a;d.media="screen";c.appendChild(d)}else StringUtil.endWith(a,".js")&&(d=document.createElement("script"),d.defer="defer",d.type="text/javascript",d.src=a,c.appendChild(d))}js.$namespace("wos");js.$interface("wos.IWaitingBox",function(){js.$public.open=function(a,c,d){};js.$public.close=function(a){};js.$public.setMessage=
function(a){};js.$public.updateProgress=function(a,c){}});js.$interface("wos.IALinkHandler",function(){js.$public.handleALink=function(a){}});js.$class("wos.Runtime",function(){this.type="QSWebRuntime";this.env="js";this.initialize=function(){};js.$public.call=function(a){for(var c=a.split("."),d=window,e=0;e<c.length&&(d=d[c[e]],null!=d&&void 0!=d);e++);"function"==js.type(d)&&d.apply(null,Array.prototype.slice.call(arguments,1))};js.$public.addCallback=function(a,c){this[a]=c}});js.$class("wos.Desktop",
qs.events.EventDispatcher,function(){js.$static.cache={};js.$static.READY_EVENT="ready";js.$static.alinkHandlers={};js.$static.defaultALinkHandler=null;js.$static.customerControl={};this.initialize=function(){this.$super();this._waitingBox=null;this._root=this._serverAddr="";this._dmprops=null;this._config={};this._desktopLinks=[];this._menuXml=null;var a=window.location.pathname,c=a.indexOf("/applications",0);-1!=c&&(a=a.substring(0,c),"/"!=a.charAt(0)&&(a="/"+a),this._root=a);a=window.location.href;
c=a.indexOf("/applications",0);-1!=c&&(this._serverAddr=a=a.substring(0,c));this.dictLoader=null;this._logined=!1;this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(wos.events.ExceptionEvent.EXCEPTION,this.onRemotingException);this.addEventListener(wos.events.FileLoadEvent.FILE_LOAD,this.onFileLoaded)};js.$static.instance=function(){return a};js.$static.registerALinkHandler=function(a,c){js.instanceOf(c,wos.IALinkHandler)&&(wos.Desktop.alinkHandlers[a]=
c)};js.$static.registerDefaultALinkHandler=function(a){js.instanceOf(a,wos.IALinkHandler)&&(wos.Desktop.defaultALinkHandler=a)};js.$static.addCustomerControl=function(a,c){wos.Desktop.customerControl[a]=c};js.$static.getCustomerControl=function(a){return wos.Desktop.customerControl[a]};js.$static.openALinkWindow=function(a){var c=wos.Desktop.alinkHandlers[a.target];js.isNull(c)?null!=wos.Desktop.defaultALinkHandler&&wos.Desktop.defaultALinkHandler.handleALink(a):c.handleALink(a)};js.$static.openALink=
function(a,c,d){d=js.param(d,null);c=wos.ALink.parseALink(c);null==c.param&&(c.param={});if(null!=d)for(var e in d)c.param[e]=d[e];d=wos.Desktop.alinkHandlers[c.target];js.isNull(d)?"this"==c.target?(d=wos.Desktop.alinkHandlers[a],js.isNull(d)||d.handleALink(c)):null!=wos.Desktop.defaultALinkHandler&&wos.Desktop.defaultALinkHandler.handleALink(c):d.handleALink(c)};this.onFileLoaded=function(a){if("desktop.xml"==a.option.asyncName){a=(new qs.Xml(a.content)).xpath("user-controls/control/runtime[@name \x3d 'QSWebRuntime']");
for(var c,d=0;d<a.length;d++){c=a[d];l(baseUrl+"../../controls/"+c.attr("url"));if(c.has("depends"))for(var e=c.attr("depends").split(";"),g=0;g<e.length;g++)""!=e[g]&&l(baseUrl+"../../controls/"+e[g]);wos.Desktop.addCustomerControl(c.parent().attr("name"),c.attr("class"))}}};this.onRemotingCallback=function(a,c){var d=a.result;switch(a.option.asyncName){case "LoginSession.getLoginInfo":this.onLogin(d);break;case "DomainService.getServerProperties":wos.Desktop.setAttribute("server_props",d);break;
case "DepartmentService.getLoginedUser":null!=d?wos.Desktop.setAttribute("ctxUser",d):wos.Desktop.setAttribute("ctxUser",{});break;case "PagePermissionService.getAllPermissions":wos.PermissionUtil.instance().setPermissionList(d);break;case "LoginSession.generateMenuBar":this.cb_generateMenuBar(d);break;case "DomainService.getDomainProperties":this._dmprops=d;break;case "ready":this.cb_domainProperties(this._dmprops);this.dispatchEvent(wos.Desktop.READY_EVENT);break;case "WDService.getTaskWithName":obj=
a.option.asyncData;js.isNull(obj)||this.cb_getTaskWithName(obj.definitionName,obj.taskName,obj.param,a.result);break;case "WDService.getTaskWithUID":obj=a.option.asyncData;js.isNull(obj)||this.cb_getTaskWithUID(obj.definitionUID,obj.taskUID,obj.param,a.result);break;case "LoginSession.logout":d=null;try{js.isNull(this._config)||js.isNull(this._config.logout)?window.opener&&window.opener.logout&&(d=window.opener.logout):d=this._config.logout}catch(e){}if(!js.isNull(d))if("string"==js.type(d.url)){window.location.href=
d.url;break}else if(!0==d.close){window.close();break}window.location.href="login.jsp"}};this.onRemotingException=function(a,c){};this.cb_generateMenuBar=function(a){wos.Desktop.getRelativeUrl();var c=new qs.Xml("\x3croot\x3e"+a+"\x3c/root\x3e"),d,e=c.children();for(a=e.length-1;0<=a;a--)d=e[a],0==d.children().length&&d.remove();var e=c.xpath("//menuitem"),g;for(a=0;a<e.length;a++)d=e[a],g=d.attr("runtime"),""!=g&&"null"!=g&&"all"!=g&&g!=wos.Desktop.runtime.type&&d.remove();this._menuXml=c;this.addDesktopLinks()};
this.cb_domainProperties=function(a){if(null!=a){if((a=this.buildData(a).Desktop)&&a.Title){var c=a.Title;c&&c.text&&(window.title=c.text)}if(a&&a.Icons){a=a.Icons;for(var d,e=0;e<a.length;e++)c=a[e],!js.isNull(c.runtime)&&"null"!=c.runtime&&"all"!=c.runtime&&c.runtime!=wos.library.Desktop.runtime.type||c.menu&&null==this.getMenuItem(this._menuXml,c.menu)||(c.iconUrl&&(d=c.iconUrl,2==d.split(":").length&&(c.iconUrl="/docroot/attachments"+d.split(":")[1])),d={},d.url=c.url,d.appName=c.appName,d.icon=
wos.Desktop.getAbsoluteUrl(c.iconUrl),d.title=c.title||c.appName,d.alink=c.alink,d.show=c.show,this._desktopLinks.splice(e,0,d))}}};this.buildData=function(a){var c={},d;for(d in a){var e=d.split(".");if(!(2>e.length)){var g=this.findData(e,c),f=a[d];if("string"==js.type(f))try{StringUtil.beginWith(f,"[")&&StringUtil.endWith(f,"]")?g[e[e.length-1]]=JSON.decode(f):StringUtil.beginWith(f,"{")&&StringUtil.endWith(f,"}")?g[e[e.length-1]]=JSON.decode(f):g[e[e.length-1]]=f}catch(m){g[e[e.length-1]]=f}else g[e[e.length-
1]]=f}}return c};this.findData=function(a,c){for(var d=null,e=null,g=0;g<a.length-1;g++)null==e?c.hasOwnProperty(a[g])?e=c[a[g]]:(e={},c[a[g]]=e):e.hasOwnProperty(a[g])?e=e[a[g]]:(d={},e=e[a[g]]=d);return e};this.addDesktopLinks=function(){var a,c,d;if(this._config&&this._config.desktopLink)for(d=0;d<this._config.desktopLink.length;d++)c=this._config.desktopLink[d],!js.isNull(c.runtime)&&"null"!=c.runtime&&"all"!=c.runtime&&c.runtime!=wos.library.Desktop.runtime.type||c.menu&&null==this.getMenuItem(this._menuXml,
c.menu)||(a={},a.icon=wos.Desktop.getAbsoluteUrl(c.iconUrl),a.title=c.title,a.alink=c.alink,a.url=c.url,a.appName=c.appName,a.show=c.show,this._desktopLinks.push(a))};this.getMenuItem=function(a,c){if(null==a)return null;for(var d=c.split("/"),e=a,g,f=0;f<d.length;f++){g=e.children("menuitem");for(var e=null,m=0;m<g.length;m++)if(g[m].attr("label")==d[f]){e=g[m];break}if(null==e)return null}return e};js.$public.config=function(a){if(void 0===a)return this._config;js.isNull(a)||(this._config=a,"AMF"!=
this._config.rpc&&wos.Remoting.setMethod(this._config.rpc),!0==this._config.logined&&wos.Remoting.call("LoginSession.getLoginInfo",[],this),wos.FileLoader.loadFile("conf/desktop.xml",{},this,new wos.events.AsyncOption("desktop.xml")))};js.$public.desktopLinks=function(){return this._desktopLinks};js.$public.menuXml=function(){return this._menuXml};js.$public.domainProperties=function(){return this._dmprops};js.$public.logout=function(){wos.Remoting.call("LoginSession.logout",[],this)};js.$public.onLogin=
function(a){a=js.param(a,null);var c="";if(null!=a){c=a.system_errorMessage;js.isEmpty(a["system.product.data"])&&(c=qs.I18N.getString("wos.desktop.001"));var d=parseInt(a.serverTimer);isNaN(d)||(wos.Desktop.setAttribute("serverTimer",d),wos.Desktop.setAttribute("initTimer",(new Date).getTime()))}if(""!=c&&void 0!=c&&null!=c)return qs.ui.MessageBox.show(c,qs.I18N.getString("qs.ui.messagebox.error"),qs.ui.MessageBox.OK,qs.ui.MessageBox.Error),!1;wos.Desktop.setAttribute("domainName",a.domainName);
wos.Desktop.setAttribute("loginName",a.principalName);wos.Desktop.setAttribute("fullLoginName",a.fullLoginName);wos.Desktop.setAttribute("userGroupTree",a.userGroupTree);wos.Desktop.setAttribute("enterpriseName",a.enterpriseName);var c={},e;for(e in a)c[e.replace(".","_")]=a[e];wos.Desktop.setAttribute("loginInfo",c);dictLoader=new wos.DictionaryLoader;dictLoader.load();this._logined=!0;wos.Remoting.beginBatchCall();wos.Remoting.call("DomainService.getServerProperties",[],this);wos.Remoting.call("DepartmentService.getLoginedUser",
[],this);wos.Remoting.call("PagePermissionService.getAllPermissions",[],this);wos.Remoting.call("LoginSession.generateMenuBar",[],this);wos.Remoting.call("DomainService.getDomainProperties",[],this);wos.Remoting.endBatchCall(this,new wos.events.AsyncOption("ready"));return!0};js.$static.openTask=function(b,c,d){var e="WF_"+b+"."+c,g=wos.Desktop.getAttribute(e);if(js.isNull(g))wos.Remoting.call("WDService.getTaskWithName",[c,b],a,new wos.events.AsyncOption(null,{definitionName:b,taskName:c,param:d}));
else{b=d;js.isNull(b)&&(b={});b.WF_taskKey=e;b.WF_mode="HumanStart";b.WF_taskId=g.id;if(!0!=b.WF_overwrite&&(e=wos.ALink.parseALink(g.formUrl),!js.isNull(e)&&!js.isNull(e.param)))for(var f in e.param)b[f]=e.param[f];wos.Desktop.openALink("wos.desktop",g.formUrl,b)}};js.$static.openTaskWithUID=function(b,c,d){var e=wos.Desktop.getAttribute(c);if(js.isNull(e))wos.Remoting.call("WDService.getTaskWithUID",[c,b],a,new wos.events.AsyncOption(null,{definitionUID:b,taskUID:c,param:d}));else{b=d;js.isNull(b)&&
(b={});b.WF_taskKey=c;b.WF_mode="HumanStart";b.WF_taskId=e.id;if(!0!=b.WF_overwrite&&(c=wos.ALink.parseALink(e.formUrl),!js.isNull(c)&&!js.isNull(c.param)))for(var g in c.param)b[g]=c.param[g];wos.Desktop.openALink("wos.desktop",e.formUrl,b)}};this.cb_getTaskWithName=function(a,c,d,e){if(null==e)qs.ui.MessageBox.show(qs.I18N.getString("wos.desktop.002",a,c),qs.I18N.getString("wos.desktop.003"));else{a="WF_"+a+"."+c;wos.Desktop.setAttribute(a,e);js.isNull(d)&&(d={});d.WF_taskKey=a;d.WF_mode="HumanStart";
d.WF_taskId=e.id;if(!0!=d.WF_overwrite&&(a=wos.ALink.parseALink(e.formUrl),!js.isNull(a)&&!js.isNull(a.param)))for(var g in a.param)d[g]=a.param[g];wos.Desktop.openALink("wos.desktop",e.formUrl,d)}};this.cb_getTaskWithUID=function(a,c,d,e){if(null==e)qs.ui.MessageBox.show(qs.I18N.getString("wos.desktop.002",a,c),qs.I18N.getString("wos.desktop.003"));else{wos.Desktop.setAttribute(c,e);a=d;js.isNull(a)&&(a={});a.WF_taskKey=c;a.WF_mode="HumanStart";a.WF_taskId=e.id;if(!0!=a.WF_overwrite&&(c=wos.ALink.parseALink(e.formUrl),
!js.isNull(c)&&!js.isNull(c.param)))for(var g in c.param)a[g]=c.param[g];wos.Desktop.openALink("wos.desktop",e.formUrl,a)}};js.$static.regWaitingBox=function(b){a._waitingBox=b};js.$static.openWaitingBox=function(){null!=a._waitingBox&&a._waitingBox.open()};js.$static.closeWaitingBox=function(){null!=a._waitingBox&&a._waitingBox.close()};js.$static.getWaitingBox=function(){return a._waitingBox};js.$static.getRelativeUrl=function(b){b=js.param(b,"");var c=a._root;"/"!=c.charAt(c.length-1)&&(c+="/");
return 0<b.length&&"/"==b.charAt(0)?c+b.substr(1):c+b};js.$static.getAbsoluteUrl=function(b){if(!js.isNull(b)&&0==b.indexOf("http"))return b;var c=a._serverAddr;return null==b||0==b.length?c:"/"==c.charAt(c.length-1)&&"/"==b.charAt(0)?c+b.substr(1):"/"!=c.charAt(c.length-1)&&"/"!=b.charAt(0)?c+"/"+b:c+b};js.$static.getAttribute=function(a){return null!=wos.Desktop.cache[a]?wos.Desktop.cache[a]:null};js.$static.setAttribute=function(a,c){wos.Desktop.cache[a]=c};js.$static.getAttributes=function(){return wos.Desktop.cache};
js.$static.getDictionary=function(a){return wos.DictionaryLoader.getValueList(a)}});wos.Desktop.runtime=new wos.Runtime;var a=new wos.Desktop})(jQuery);function createAMFConnection(f){var l={CONST:{EMPTY_STRING:"",NULL_STRING:"null",UNDEFINED_TYPE:0,NULL_TYPE:1,FALSE_TYPE:2,TRUE_TYPE:3,INTEGER_TYPE:4,DOUBLE_TYPE:5,STRING_TYPE:6,XML_TYPE:7,DATE_TYPE:8,ARRAY_TYPE:9,OBJECT_TYPE:10,XMLSTRING_TYPE:11,BYTEARRAY_TYPE:12,AMF0_AMF3:17,UINT29_MASK:536870911,INT28_MAX_VALUE:268435455,INT28_MIN_VALUE:-268435456,CLASS_ALIAS:"_explicitType"},requestTimeout:3E4,requestPoolSize:6,requestPool:[],messageQueue:[],sendMessageId:!1,clientId:null,sequence:1,destination:"",
endpoint:"",headers:null,doNothing:new Function,init:function(a,b,c){this.clientId=null;this.sequence=1;this.destination=a;this.endpoint=b;this.requestTimeout=c?c:3E4;this.headers=[]},addHeader:function(a,b){var c={};c[a]=b;this.headers.push(c)},ActionMessage:function(){return{version:3,headers:[{name:"mobile",mustUnderstand:!1,data:!0}],bodies:[]}},MessageBody:function(){return{targetURI:"null",responseURI:"/1",data:[]}},MessageHeader:function(){return{name:"",mustUnderstand:!1,data:null}},CommandMessage:function(){return{destination:"",
operation:5,clientId:null}},RemotingMessage:function(){return{destination:"",source:"",operation:"",body:[],clientId:null}},AcknowledgeMessage:function(){return{body:null,headers:[],messageId:null,clientId:null}},createMessage:function(a,b,c){var d=new l.ActionMessage,e=new l.MessageBody,g;if("ping"==a)this.sequence=1,e.responseURI="/"+this.sequence++,g=new l.CommandMessage,g.destination=this.destination;else for(e.responseURI="/"+this.sequence++,g=new l.RemotingMessage,g.destination=this.destination,
g.source=a,g.operation=b,g.body=c,this.sendMessageId&&(g.messageId=l.uuid(0,0)),g.clientId=this.clientId,a=0;a<this.headers.length;a++){b=this.headers[a];for(var f in b)g.headers[f]=b[f]}e.data.push(g);d.bodies.push(e);return d},invoke:function(a,b,c,d,e){null==this.clientId&&0==this.messageQueue.length&&(this.messageQueue.push([this.createMessage("ping"),d,e]),this._processQueue());this.messageQueue.push([this.createMessage(a,b,c),d,e]);null!=this.clientId&&this._processQueue()},call:function(a,
b,c,d){a={version:3,headers:[],bodies:[{targetURI:a,responseURI:"/"+this.sequence++,data:b}]};this.messageQueue.push([a,c,d]);this._processQueue()},_processQueue:function(){var a,b;for(a=0;a<this.requestPoolSize&&0<this.messageQueue.length;a++)if(this.requestPool.length==a?(b=new XMLHttpRequest,b.parent=this,b.busy=!1,this.requestPool.push(b)):b=this.requestPool[a],!b.busy){var c=this.messageQueue.shift();this._send(b,c[0],c[1],c[2])}},_send:function(a,b,c,d){var e=new l.Serializer;a.message=e.writeMessage(b);
a.onreadystatechange=function(){if(1===this.readyState){if(!this.busy){this.busy=!0;this.setRequestHeader("Content-Type","application/x-amf; charset\x3dUTF-8");this.responseType="arraybuffer";var b=new Uint8Array(a.message);this.send(b.buffer)}}else if(4===this.readyState){this.onreadystatechange=l.doNothing;try{if(200<=this.status&&300>=this.status)if(-1<this.getResponseHeader("Content-type").indexOf("application/x-amf")){var b=(new l.Deserializer(new Uint8Array(this.response))).readMessage(),e;
for(e in b.bodies)if(b.bodies.hasOwnProperty(e)){var f=b.bodies[e];if(f.targetURI&&-1<f.targetURI.indexOf("/onResult"))c(f.data);else if(f.data.rootCause){var n=f.data.rootCause;d({errorCode:n.errorCode,message:n.message,exception:n})}else d({errorCode:3,message:f.data.message,exception:f.data})}this.busy=!1;this.message=null;this.parent._processQueue()}else d({errorCode:1,message:this.responseText});else try{d({errorCode:1,message:this.responseText})}catch(p){d({errorCode:2,message:qs.I18N.getString("amf.disconnected")})}}catch(q){"string"==
js.type(q)?d({errorCode:2,message:q}):d({errorCode:2,message:q.message})}}};a.open("POST",this.endpoint,!0)},Writer:function(){this.data=[];this.objects=[];this.traits={};this.strings={};this.objectCount=this.traitCount=this.stringCount=0}};l.Writer.prototype.write=function(a){this.data.push(a)};l.Writer.prototype.writeShort=function(a){this.write(a>>>8&255);this.write(a>>>0&255)};l.Writer.prototype.writeUTF=function(a,b){var c,d,e,g,f;g=a.length;for(e=f=0;e<g;e++)d=a.charCodeAt(e),0<d&&128>d?f++:
f=2047<d?f+3:f+2;c=[];b?this.writeUInt29(f<<1|1):(c.push(f>>>8&255),c.push(f&255));for(e=0;e<g;e++)d=a.charCodeAt(e),0<d&&128>d?c.push(d):(2047<d?(c.push(224|d>>12),c.push(128|d>>6&63)):c.push(192|d>>6),b?c.push(128|d>>0&63):c.push(128|d&63));this.writeAll(c);return b?f:f+2};l.Writer.prototype.writeUInt29=function(a){if(128>a)this.write(a);else if(16384>a)this.write(a>>7&127|128),this.write(a&127);else if(2097152>a)this.write(a>>14&127|128),this.write(a>>7&127|128),this.write(a&127);else if(1073741824>
a)this.write(a>>22&127|128),this.write(a>>15&127|128),this.write(a>>8&127|128),this.write(a&255);else throw"Integer out of range: "+a;};l.Writer.prototype.writeAll=function(a){for(var b=0;b<a.length;b++)this.write(a[b])};l.Writer.prototype.writeBoolean=function(a){this.write(a?1:0)};l.Writer.prototype.writeInt=function(a){this.write(a>>>24&255);this.write(a>>>16&255);this.write(a>>>8&255);this.write(a>>>0&255)};l.Writer.prototype.writeUnsignedInt=function(a){0>a&&(a=-(a^4294967295)-1);a&=4294967295;
this.write(a>>24&255);this.write(a>>16&255);this.write(a>>8&255);this.write(a&255)};l.Writer.prototype._getDouble=function(a){var b=[0,0];if(a!=a)return b[0]=-524288,b;var c=0>a||0===a&&0>1/a?-2147483648:0;a=Math.abs(a);if(a===Number.POSITIVE_INFINITY)return b[0]=c|2146435072,b;for(var d=0;2<=a&&1023>=d;)d++,a/=2;for(;1>a&&-1022<=d;)d--,a*=2;d+=1023;if(2047==d)return b[0]=c|2146435072,b;var e;0==d?(e=a*Math.pow(2,23)/2,a=Math.round(a*Math.pow(2,52)/2)):(e=a*Math.pow(2,20)-Math.pow(2,20),a=Math.round(a*
Math.pow(2,52)-Math.pow(2,52)));b[0]=c|d<<20&2147418112|e&1048575;b[1]=a;return b};l.Writer.prototype.writeDouble=function(a){a=this._getDouble(a);this.writeUnsignedInt(a[0]);this.writeUnsignedInt(a[1])};l.Writer.prototype.getResult=function(){return this.data.join("")};l.Writer.prototype.reset=function(){this.objects=[];this.objectCount=0;this.traits={};this.traitCount=0;this.strings={};this.stringCount=0};l.Writer.prototype.writeStringWithoutType=function(a){0==a.length?this.writeUInt29(1):this.stringByReference(a)||
this.writeUTF(a,!0)};l.Writer.prototype.stringByReference=function(a){var b=this.strings[a];b?this.writeUInt29(b<<1):this.strings[a]=this.stringCount++;return b};l.Writer.prototype.objectByReference=function(a){for(var b=0,c=!1;b<this.objects.length;b++)if(this.objects[b]===a){c=!0;break}c?this.writeUInt29(b<<1):(this.objects.push(a),this.objectCount++);return c?b:null};l.Writer.prototype.traitsByReference=function(a,b){for(var c=b+"|",d=0;d<a.length;d++)c+=a[d]+"|";(d=this.traits[c])?this.writeUInt29(d<<
2|1):this.traits[c]=this.traitCount++;return d};l.Writer.prototype.writeAmfInt=function(a){a>=l.CONST.INT28_MIN_VALUE&&a<=l.CONST.INT28_MAX_VALUE?(a&=l.CONST.UINT29_MASK,this.write(l.CONST.INTEGER_TYPE),this.writeUInt29(a)):(this.write(l.CONST.DOUBLE_TYPE),this.writeDouble(a))};l.Writer.prototype.writeDate=function(a){this.write(l.CONST.DATE_TYPE);this.objectByReference(a)||(this.writeUInt29(1),this.writeDouble(a.getTime()))};l.Writer.prototype.writeObject=function(a){null==a?this.write(l.CONST.NULL_TYPE):
a.constructor===String?(this.write(l.CONST.STRING_TYPE),this.writeStringWithoutType(a)):a.constructor===Number?a===+a&&a===(a|0)?this.writeAmfInt(a):(this.write(l.CONST.DOUBLE_TYPE),this.writeDouble(a)):a.constructor===Boolean?this.write(a?l.CONST.TRUE_TYPE:l.CONST.FALSE_TYPE):a.constructor===Date?this.writeDate(a):a.constructor===Array?this.writeArray(a):l.CONST.CLASS_ALIAS in a?this.writeCustomObject(a):this.writeMap(a)};l.Writer.prototype.writeCustomObject=function(a){this.write(l.CONST.OBJECT_TYPE);
if(!this.objectByReference(a))for(var b=this.writeTraits(a),c=0;c<b.length;c++)this.writeObject(a[b[c]])};l.Writer.prototype.writeTraits=function(a){var b=[],c=0,d;for(d in a)d!=l.CONST.CLASS_ALIAS&&(b.push(d),c++);if(!this.traitsByReference(b,a[l.CONST.CLASS_ALIAS])&&(this.writeUInt29(3|c<<4),this.writeStringWithoutType(a[l.CONST.CLASS_ALIAS]),0<c))for(var e in b)this.writeStringWithoutType(b[e]);return b};l.Writer.prototype.writeMap=function(a){this.write(l.CONST.OBJECT_TYPE);if(!this.objectByReference(a)){this.writeUInt29(11);
this.traitCount++;this.writeStringWithoutType(l.CONST.EMPTY_STRING);for(var b in a)b?this.writeStringWithoutType(b):this.writeStringWithoutType(l.CONST.EMPTY_STRING),this.writeObject(a[b]);this.writeStringWithoutType(l.CONST.EMPTY_STRING)}};l.Writer.prototype.writeArray=function(a){this.write(l.CONST.ARRAY_TYPE);if(!this.objectByReference(a)&&(this.writeUInt29(a.length<<1|1),this.writeUInt29(1),0<a.length))for(var b=0;b<a.length;b++)this.writeObject(a[b])};l.Reader=function(a){this.objects=[];this.traits=
[];this.strings=[];this.data=a;this.pos=0};l.Reader.prototype.read=function(){return this.data[this.pos++]};l.Reader.prototype.readUnsignedShort=function(){var a=this.read(),b=this.read();return(a<<8)+(b<<0)};l.Reader.prototype.readUInt29=function(){var a=this.read()&255;if(128>a)return a;var b=(a&127)<<7,a=this.read()&255;if(128>a)return b|a;b=(b|a&127)<<7;a=this.read()&255;if(128>a)return b|a;b=(b|a&127)<<8;a=this.read()&255;return b|a};l.Reader.prototype.readFully=function(a,b,c){for(;b<c;b++)a[b]=
this.read()};l.Reader.prototype.readUTF=function(a){a=a?a:this.readUnsignedShort();for(var b=[],c=this.pos,d=0;d<a;d++){var e=this.read();if(128>e)b.push(String.fromCharCode(e));else if(194<=e&&224>e){var g=this.read();d++;b.push(String.fromCharCode(((e&31)<<6)+(g&63)))}else if(224<=e&&240>e){g=this.read();d++;var f=this.read();d++;b.push(String.fromCharCode(((e&255)<<12)+((g&63)<<6)+(f&63)))}else if(240<=e&&245>e){g=this.read();d++;f=this.read();d++;var m=this.read();d++;e=((e&7)<<18)+((g&63)<<12)+
((f&63)<<6)+(m&63);e-=65536;b.push(String.fromCharCode((e>>10)+55296,(e&1023)+56320))}}this.pos=c+a;return b.join("")};l.Reader.prototype.reset=function(){this.objects=[];this.traits=[];this.strings=[]};l.Reader.prototype.readObject=function(){var a=this.read();return this.readObjectValue(a)};l.Reader.prototype.readString=function(){var a=this.readUInt29();if(0==(a&1))return this.getString(a>>1);a>>=1;if(0==a)return l.CONST.EMPTY_STRING;a=this.readUTF(a);this.rememberString(a);return a};l.Reader.prototype.rememberString=
function(a){this.strings.push(a)};l.Reader.prototype.getString=function(a){return this.strings[a]};l.Reader.prototype.getObject=function(a){return this.objects[a]};l.Reader.prototype.getTraits=function(a){return this.traits[a]};l.Reader.prototype.rememberTraits=function(a){this.traits.push(a)};l.Reader.prototype.rememberObject=function(a){this.objects.push(a)};l.Reader.prototype.readTraits=function(a){if(1==(a&3))return this.getTraits(a>>2);var b=a>>4,c=4==(a&4),d=8==(a&8),e=this.readString();a={};
null!=e&&""!=e&&(a[l.CONST.CLASS_ALIAS]=e);a.externalizable=c;a.dynamic=d;a.props=[];for(c=0;c<b;c++)a.props.push(this.readString());this.rememberTraits(a);return a};l.Reader.prototype.readScriptObject=function(){var a=this.readUInt29();if(0==(a&1))return this.getObject(a>>1);var b=this.readTraits(a),a={};l.CONST.CLASS_ALIAS in b&&(a[l.CONST.CLASS_ALIAS]=b[l.CONST.CLASS_ALIAS]);this.rememberObject(a);if(!0==b.externalizable)return this.readObject();for(var c in b.props)a[b.props[c]]=this.readObject();
if(!0==b.dynamic)for(;;){c=this.readString();if(null==c||0==c.length)break;a[c]=this.readObject()}return a};l.Reader.prototype.readArray=function(){var a=this.readUInt29();if(0==(a&1))return this.getObject(a>>1);for(var a=a>>1,b=null,c=0;;){c=this.readString();if(!c)break;b||(b={},this.rememberObject(b));b[c]=this.readObject()}if(b){for(c=0;c<a;c++)b[c]=this.readObject();return b}b=Array(a);this.rememberObject(b);for(c=0;c<a;c++)b[c]=this.readObject();return b};l.Reader.prototype.readDouble=function(){var a=
this.read()&255,b=this.read()&255;if(255===a){if(248===b)return Number.NaN;if(240===b)return Number.NEGATIVE_INFINITY}else if(127===a&&240===b)return Number.POSITIVE_INFINITY;var c=this.read()&255,d=this.read()&255,e=this.read()&255,g=this.read()&255,f=this.read()&255,m=this.read()&255;if(!(a||b||c||d))return 0;for(var n=(a<<4&2047|b>>4)-1023,b=((b&15)<<16|c<<8|d).toString(2),c=b.length;20>c;c++)b="0"+b;g=((e&127)<<24|g<<16|f<<8|m).toString(2);for(c=g.length;31>c;c++)g="0"+g;e=parseInt(b+(e>>7?"1":
"0")+g,2);return 0==e&&-1023==n?0:(1-(a>>7<<1))*(1+Math.pow(2,-52)*e)*Math.pow(2,n)};l.Reader.prototype.readDate=function(){var a=this.readUInt29();if(0==(a&1))return this.getObject(a>>1);a=this.readDouble();a=new Date(a);this.rememberObject(a);return a};l.Reader.prototype.readMap=function(){var a=this.readUInt29();if(0==(a&1))return this.getObject(a>>1);var b=null;if(0<a>>1)for(b={},this.rememberObject(b),a=this.readObject();null!=a;)b[a]=this.readObject(),a=this.readObject();return b};l.Reader.prototype.readByteArray=
function(){var a=this.readUInt29();if(0==(a&1))return this.getObject(a>>1);var b=[];this.readFully(b,0,a>>1);this.rememberObject(b);return b};l.Reader.prototype.readObjectValue=function(a){var b=null;switch(a){case l.CONST.STRING_TYPE:b=this.readString();break;case l.CONST.OBJECT_TYPE:try{b=this.readScriptObject()}catch(c){throw"Failed to deserialize:"+c;}break;case l.CONST.ARRAY_TYPE:b=this.readArray();break;case l.CONST.FALSE_TYPE:b=!1;break;case l.CONST.TRUE_TYPE:b=!0;break;case l.CONST.INTEGER_TYPE:b=
this.readUInt29();b=b<<3>>3;break;case l.CONST.DOUBLE_TYPE:b=this.readDouble();break;case l.CONST.UNDEFINED_TYPE:case l.CONST.NULL_TYPE:break;case l.CONST.DATE_TYPE:b=this.readDate();break;case l.CONST.BYTEARRAY_TYPE:b=this.readByteArray();break;case l.CONST.AMF0_AMF3:b=this.readObject();break;default:throw"Unknown AMF type: "+a;}return b};l.Reader.prototype.amf0_readObject=function(){var a=this.read();return this.amf0_readObjectValue(a)};l.Reader.prototype.amf0_readObjectValue=function(a){var b=
null;switch(a){case 0:b=this.readDouble();break;case 1:b=this.readBoolean();break;case 2:a=this.readUnsignedShort();b=this.readUTF(a);break;case 3:b=this.amf0_readScriptObject();break;case 5:b=null;break;case 6:b=void 0;break;case 7:b=this.getObject(this.readUnsignedShort());break;case 8:b=this.amf0_readAssociativeArray();break;case 10:b=this.amf0_readArray();break;case 11:b=this.amf0_readDate();break;case 12:a=this.amf0_readNumber(4);b=this.readUTF(a);break;case 16:b=this.amf0_readTypedObject();
break;case l.CONST.AMF0_AMF3:b=this.readObject();break;default:throw"Unknown AMF type: "+a;}return b};l.Reader.prototype.amf0_readScriptObject=function(){for(var a={},b=this.readUTF(),c=this.read();0<b.length&&9!=c;)a[b]=this.amf0_readObjectValue(c),b=ba.readUTF(),c=ba.read();this.rememberObject(a);return a};l.Reader.prototype.amf0_readTypedObject=function(){var a=this.readUTF(),b=this.amf0_readObject();b.__className=a;return b};l.Reader.prototype.amf0_readNumber=function(a){for(var b=0;a--;)b=b<<
8|this.read();return b};l.Reader.prototype.amf0_readAssociativeArray=function(){var a=[];this.amf0_readNumber(4);for(var b=this.readUTF(),c=this.read();0<b.length&&9!=c;)a[b]=this.amf0_readObjectValue(c),b=this.readUTF(),c=this.read();this.rememberObject(a);return a};l.Reader.prototype.amf0_readArray=function(){for(var a=this.amf0_readNumber(4),b=[],c,d=0;d<a;++d)c=this.read(),b.push(this.amf0_readObjectValue(c));this.rememberObject(b);return b};l.Reader.prototype.amf0_readDate=function(){var a=this.readDouble();
this.readUnsignedShort();return new Date(a)};l.Reader.prototype.readBoolean=function(){return 1===this.read()};l.Serializer=function(){this.writer=new l.Writer};l.Serializer.prototype.writeMessage=function(a){try{this.writer.writeShort(a.version);this.writer.writeShort(a.headers.length);for(var b in a.headers)this.writeHeader(a.headers[b]);this.writer.writeShort(a.bodies.length);for(var c in a.bodies)this.writeBody(a.bodies[c])}catch(d){console.log(d)}return this.writer.data};l.Serializer.prototype.writeObject=
function(a){this.writer.writeObject(a)};l.Serializer.prototype.writeHeader=function(a){this.writer.writeUTF(a.name);this.writer.writeBoolean(a.mustUnderstand);this.writer.writeInt(1);this.writer.reset();this.writer.write(1);this.writer.writeBoolean(!0)};l.Serializer.prototype.writeBody=function(a){null==a.targetURI?this.writer.writeUTF(l.CONST.NULL_STRING):this.writer.writeUTF(a.targetURI);null==a.responseURI?this.writer.writeUTF(l.CONST.NULL_STRING):this.writer.writeUTF(a.responseURI);this.writer.writeInt(-1);
this.writer.reset();this.writer.write(l.CONST.AMF0_AMF3);this.writeObject(a.data)};l.Deserializer=function(a){this.reader=new l.Reader(a)};l.Deserializer.prototype.readMessage=function(){var a=new l.ActionMessage;a.version=this.reader.readUnsignedShort();for(var b=this.reader.readUnsignedShort(),c=0;c<b;c++)a.headers.push(this.readHeader());b=this.reader.readUnsignedShort();for(c=0;c<b;c++)a.bodies.push(this.readBody());return a};l.Deserializer.prototype.readHeader=function(){var a=new l.MessageHeader;
a.name=this.reader.readUTF();a.mustUnderstand=this.reader.readBoolean();this.reader.pos+=4;this.reader.reset();a.data=this.readObject();return a};l.Deserializer.prototype.readBody=function(){var a=new l.MessageBody;a.targetURI=this.reader.readUTF();a.responseURI=this.reader.readUTF();this.reader.pos+=4;this.reader.reset();a.data=this.readObject();return a};l.Deserializer.prototype.readObject=function(){return this.reader.amf0_readObject()};l.uuid=function b(c,d){return c?(d|16*Math.random()>>d/4).toString(16):
([1E7]+-1E3+-4E3+-8E3+-1E11).replace(/1|0|(8)/g,b)};l.init("ime",f);return l};(function(f,l){js.$interface("wos.RemotingFilter",function(){js.$public.pre_call=function(a,b){}});js.$class("wos.Remoting",function(){js.$static.clientId="";js.$static.filters={};js.$static.batchs={};js.$static.method="AMF";js.$static.dwrPath="";this.initialize=function(){};js.$static.init=function(a,b){b=js.param(b,"AMF");f.Remoting.method=b;f.Remoting.amf=createAMFConnection(a+"/messagebroker/amf");f.Remoting.dwrPath=a+"/dwr"};js.$static.setMethod=function(a){a=js.param(a,"AMF");f.Remoting.method=
a};js.$static.addFilter=function(a,b){f.Remoting.filters[a]=b};js.$static.call=function(a,b,c,d,e){c=js.param(c,null);d=js.param(d,null);e=js.param(e,!0);for(var g in f.Remoting.filters)null!=f.Remoting.filters[g]&&f.Remoting.filters[g].pre_call(a,b);!1==e&&(null==d&&(d=new AsyncOption(null)),d.showWaitingBox=e);var k=Math.uuid(),m=null;!0==f.Remoting.isBatchCall&&(m=f.Remoting.batchs[f.Remoting.batchUID],m.calls.push(k));var n=f.Desktop.getWaitingBox();null==n||null!=d&&!0!=d.showWaitingBox||(n.setMessage("\u6b63\u5728\u8bf7\u6c42\u670d\u52a1..."),
n.open(!0,!1,c));e=function(b){null==n||null!=d&&!0!=d.showWaitingBox||n.close();b=new f.events.CallbackEvent(k,a,b,d);null!=c&&c.dispatchEvent(b);null!=m&&(b=m.calls.indexOf(k),-1!=b&&m.calls.splice(b,1),0==m.calls.length&&(b=new f.events.CallbackEvent(m.batchUID,"Remoting.endBatchCall",null,m.option),null!=m.caller&&m.caller.dispatchEvent(b)))};var l=function(b){null==n||null!=d&&!0!=d.showWaitingBox||n.close();var e=b.message,g=new f.events.ExceptionEvent(k,a,e,b.exception,d);null!=c&&c.dispatchEvent(g);
g.isDefaultPrevented()||(null==e||""==e?(e="",js.isNull(b.exception)||("flex.messaging.messages.ErrorMessage"==b.exception._explicitType?e+=b.exception.faultString:js.isNull(b.exception._explicitType)||(e+=b.exception._explicitType),js.isNull(b.exception.javaClassName)||(e+=b.exception.javaClassName),js.isNull(b.exception.localizedMessage)||(e+=b.exception.localizedMessage))):js.isNull(b.exception)||js.isNull(b.exception.cause)||""==b.exception.cause.message||(e=b.exception.cause.message),(js.isNull(d)||
!0!=d.silence)&&qs.ui.MessageBox.show(e,qs.I18N.getString("qs.ui.messagebox.error"),qs.ui.MessageBox.OK,qs.ui.MessageBox.Error));null!=m&&(b=m.calls.indexOf(k),-1!=b&&m.calls.splice(b,1),0==m.calls.length&&(g=new f.events.CallbackEvent(m.batchUID,"Remoting.endBatchCall",null,m.option),null!=m.caller&&m.caller.dispatchEvent(g)))};if("AMF"==f.Remoting.method)f.Remoting.amf.call(a,b,e,l);else if("DWR"==f.Remoting.method){g=a.split(".");g=[f.Remoting.dwrPath,g[0],g[1]];if("array"==js.type(b))for(var q=
0;q<b.length;q++)g.push(b[q]);g.push({callback:e,exceptionHandler:function(a,c){l({message:a,exception:c})}});dwr.engine._execute.apply(dwr.engine,g)}return k};js.$static.beginBatchCall=function(a){f.Remoting.isBatchCall=!0;f.Remoting.batchUID=Math.uuid();f.Remoting.batchs[f.Remoting.batchUID]={batchUID:f.Remoting.batchUID,calls:[]};return f.Remoting.batchUID};js.$static.endBatchCall=function(a,b){f.Remoting.isBatchCall=!1;var c=f.Remoting.batchs[f.Remoting.batchUID];c.caller=js.param(a,null);c.option=
js.param(b,null);delete f.Remoting.batchs[f.Remoting.batchUID]}});f.Remoting.init(f.Desktop.instance()._serverAddr)})(wos,jQuery);(function(f,l){var a={};js.$class("wos.FileLoader",function(){this.initialize=function(){};js.$static.config=function(b){if(void 0===b)return a;a=b};js.$static.loadFile=function(b,c,d,e,g,k){e=js.param(e,null);g=js.param(g,"text/html; charset\x3dutf-8");k=js.param(k,"GET");c=js.param(c,{});f.Desktop.openWaitingBox();f.Desktop.getWaitingBox().setMessage(qs.I18N.getString("wos.fileloader.loading"));var m=f.Desktop.getAbsoluteUrl(b);js.isEmpty(a.version)||(c._ver=a.version);b=!0;-1==m.indexOf("?")?m+=
"?":b=!1;for(var n in c)b||(m+="\x26"),m+=n+"\x3d"+c[n],b=!1;m=encodeURI(m);l.ajax({url:m,type:k,contentType:g,dataType:"text",success:function(a){f.Desktop.closeWaitingBox();js.instanceOf(d,qs.events.EventDispatcher)?(a=new f.events.FileLoadEvent(m,a,!0,"",e),d.dispatchEvent(a)):"function"==js.type(d)?d(a,e):js.isNull(d)||"function"!=js.type(d.success)||d.success(a,e)},error:function(a,c,b){f.Desktop.closeWaitingBox();js.instanceOf(d,qs.events.EventDispatcher)?(a=new f.events.FileLoadEvent(m,null,
!1,b,e),d.dispatchEvent(a)):js.isNull(d)||"function"!=js.type(d.error)||d.error(b,e)}})}})})(wos,jQuery);(function(f,l){js.$class("wos.PermissionUtil",function(){js.$static._instance=null;this.initialize=function(){this.appReg={};this.permissions=[]};js.$static.instance=function(){null==f.PermissionUtil._instance&&(f.PermissionUtil._instance=new f.PermissionUtil);return f.PermissionUtil._instance};js.$public.setApplication=function(a,b,c){this.appReg[a]={permissionXml:b,menuXml:c}};js.$public.setPermissionList=function(a){this.permissions=a};js.$public.getPermissionList=function(){return this.permissions};
js.$public.hasPermission=function(a,b){if("No"==b||""==b||null==b||"null"==b||void 0==b||"undefined"==b)return!0;if(-1!=b.indexOf(".")){if(null==this.permissions||0==this.permissions.length)return!1;if("$all permissions$"==this.permissions[0])return!0;var c=this.appReg[a];if(js.isNull(c))return!1;var d=c.permissionXml;if(js.isNull(d))return!1;var e=b.split(".");if(1>=e.length)return!1;for(var g=e[e.length-1],f,c=0;c<e.length-1;c++)if(f=e[c],d=d.xpath('PermissionGroup[@name \x3d "'+f+'"]')[0],js.isNull(d))return!0;
e=parseInt(d.attr("id"));for(c=0;c<this.permissions.length;c++)if(this.permissions[c].groupId==e&&null!=this.permissions[c].permissions&&-1!=this.permissions[c].permissions.indexOf(g))return!0}if(-1!=b.indexOf("/")){if("$all permissions$"==this.permissions[0])return!0;c=this.appReg[a];if(js.isNull(c))return!1;g=c.menuXml;if(js.isNull(g))return!1;e=b.split("/");for(c=0;c<e.length;c++)if(d=e[c],g=g.xpath('menuitem[@label \x3d "'+d+'"]')[0],js.isNull(g))return!1;return!0}return!1}})})(wos,jQuery);(function(f,l){js.$class("wos.DictionaryLoader",qs.events.EventDispatcher,function(){js.$static.LOADED_EVENT="DICT_LOADED";js.$static.dictXml=null;js.$static.DICT_ATTRIBUTE="_dictionary";js.$static.dict=null;this.initialize=function(){this.$super()};js.$public.load=function(){if(null!=f.DictionaryLoader.dict)this.dispatchEvent(f.DictionaryLoader.LOADED_EVENT);else{var a=this;l.ajax({url:f.Desktop.getAbsoluteUrl("pages/core/dictionary.jsp"),type:"GET",dataType:"xml",headers:{pragma:"no-cache","Cache-Control":"no-cache",
Expires:"0"},success:function(b){b=new qs.Xml(b.documentElement);f.DictionaryLoader.dictXml=b;f.DictionaryLoader.dict={};for(var c,d=0;d<b.children().length;d++)c=b.children()[d],f.DictionaryLoader.dict[c.attr("name")]=a.generateEntrys(c);a.dispatchEvent(f.DictionaryLoader.LOADED_EVENT)},error:function(a,c,d){qs.ui.MessageBox.show(qs.I18N.getString("wos.dictionaryloader.001",d),qs.I18N.getString("qs.ui.messagebox.error"))}})}};js.$static.getValueList=function(a){a=a.split(".");if(2!=a.length)return[];
null==f.DictionaryLoader.dict&&(f.DictionaryLoader.dict=f.Desktop.getAttribute(f.DictionaryLoader.DICT_ATTRIBUTE));if(js.isNull(f.DictionaryLoader.dict))return[];var b;b=f.DictionaryLoader.dict[a[0]];if(null==b)return[];a=b[a[1]];return null==a?[]:js.clone(a)};js.$static.getValueItem=function(a,b){var c;c="string"===js.type(a)?f.DictionaryLoader.getValueList(a):a;if(null==c)return null;for(var d=0;d<c.length;d++)if(c[d].value==b)return c[d];return null};js.$static.getDefaultValue=function(a,b){b=
js.param(b,!0);var c;c="string"===js.type(a)?f.DictionaryLoader.getValueList(a):a;if(null==c||0==c.length)return{label:"",value:0};for(var d=0;d<c.length;d++)if(!0==c[d].isDefault)return c[d];return b?c[0]:null};js.$static.updateValue=function(a,b){var c=a.split(".");if(2==c.length&&(null==f.DictionaryLoader.dict&&(f.DictionaryLoader.dict=f.Desktop.getAttribute(f.DictionaryLoader.DICT_ATTRIBUTE)),!js.isNull(f.DictionaryLoader.dict))){var d,e;d=f.DictionaryLoader.dict[c[0]];if(null!=d)if(e=d[c[1]],
null==e)d[c[1]]=b;else for(e.splice(0,e.length),c=0;c<b.length;c++)e.push(b[c])}};js.$static.getRelationValueList=function(a,b){if(-1!=a.indexOf("!rela:")){var c,d=a.substr(6),e=d.indexOf(":");-1!=e?(c=d.substr(e+1),d=d.substring(0,e)):c="?";d=b[d];if(null==d)return[];c=c.replace("?",d);return f.DictionaryLoader.getValueList(c)}return f.DictionaryLoader.getValueList(a)};this.generateEntrys=function(a){for(var b,c={},d=0;d<a.children().length;d++)b=a.children()[d],c[b.attr("name")]=this.generateEntry(b);
return c};this.generateEntry=function(a){var b=[],c,d,e,g,f,m,n=!1;"Number"==a.attr("type")&&(n=!0);e=a.attr("default");for(m=0;m<a.children().length;m++)c=String(a.children()[m].attr("label")),d=String(a.children()[m].attr("value")),f=Number(a.children()[m].attr("order")),g=String(a.children()[m].attr("enable")),"false"!=g&&(isNaN(f)&&(f=0),g=e==d?!0:!1,c={order:f,label:c,isDefault:g},c.value=n?parseInt(d):"$null"==d?null:d,b.push(c));b.sort(function(a,c){return a.order>c.order?1:a.order<c.order?
-1:0});for(m=0;m<b.length;m++)delete b[m].order;return b}})})(wos,jQuery);(function(f,l){f.expression={};var a=new js.Class("wos.expression.SyntaxNode",function(){js.$static.MATH=1;js.$static.LOGI=2;js.$static.FUNC=3;js.$static.EVAL=4;js.$static.VARL=5;js.$public.type=-1;js.$public.name="";js.$public.operands=[];this.initialize=function(a,b){a=js.param(a,-1);b=js.param(b,"");this.type=a;this.name=b}}),b=new js.Class("wos.expression.Token",function(){js.$static.tkOperator=1;js.$static.tkLetter=2;js.$static.tkDigital=3;js.$static.tkString=4;js.$static.tkConstant=5;js.$public.type=
-1;js.$public.value=null;this.initialize=function(a,b){a=js.param(a,-1);b=js.param(b,null);this.type=a;this.value=b}});js.$class("wos.expression.ExpressionResult",function(){js.$static.CALCULATED=0;js.$static.INVALIDE=1;js.$static.POSTPONED=2;js.$static.InvalideResult={state:1,value:null};js.$public.state=1;js.$public.value=null;js.$public.message="";this.initialize=function(a,b,e){e=js.param(e,"");this.state=a;this.value=b;this.message=e}});f.expression.ExpressionResult.InvalideResult=new f.expression.ExpressionResult(f.expression.ExpressionResult.INVALIDE,
null);js.$class("wos.expression.ExpressionEvent",qs.events.Event,function(){js.$static.VALUE_PREPARED_EVENT="valuePrepared";this.initialize=function(a,b){this.$super(f.expression.ExpressionEvent.VALUE_PREPARED_EVENT);this._name=a;this._value=b};js.$public.name=function(){return this._name};js.$public.value=function(){return this._value}});js.$interface("wos.expression.IExpressionValueProvider",function(){js.$public.getVariableValue=function(a,b){};js.$public.getFunctionValue=function(a,b,e){}});js.$class("wos.expression.ExpressionParser",
qs.events.EventDispatcher,function(){var c={"(":9,")":1,"!":8,"*":7,"/":7,"+":6,"-":6,"\x3c":5,"\x3e":5,"\x3c\x3d":5,"\x3e\x3d":5,"\x3d\x3d":5,"!\x3d":5,"\x26\x26":4,"||":4};this.initialize=function(a){a=js.param(a,null);this.$super();this.constMap={"true":!0,"false":!1};this.valueProvider=new f.expression.ValueProviderFilter(a);this.expression="";this.length=this.pos=0;this.rootSyntax=this.lastToken=null};js.$public.addConstantValue=function(a,c){this.constMap[a]=c};js.$public.delConstantValue=function(a){delete this.constMap[a]};
js.$public.calculate=function(a){if(js.isNull(a))return null;if("string"!=js.type(a))return new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,a);this.parse(a);return null!=this.rootSyntax?this.getResult(this.rootSyntax):null};this.getResult=function(c){var b,g=[];if(c.type!=a.EVAL)for(var k=0;k<c.operands.length;k++)if(b=c.operands[k],js.instanceOf(b,a))switch(b=this.getResult(b),b.state){case f.expression.ExpressionResult.CALCULATED:g.push(b.value);break;case f.expression.ExpressionResult.POSTPONED:case f.expression.ExpressionResult.INVALIDE:return b}else g.push(b);
switch(c.type){case a.MATH:return new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,this.getMathResult(c.name,g));case a.LOGI:return new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,this.getLogiResult(c.name,g));case a.EVAL:return this.getEvalResult(c.operands);case a.FUNC:return this.getFuncResult(c.name,g);case a.VARL:return new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,c.operands[0]);default:throw Error(qs.I18N.getString("wos.expression.parser.001",
this.expression));}};this.getMathResult=function(a,c){var b,f;b=parseFloat(c[0]);f=parseFloat(c[1]);"date"==js.type(c[0])&&(b=c[0].getTime());"date"==js.type(c[1])&&(f=c[1].getTime());switch(a){case "+":if(isNaN(b)||isNaN(f))b=null!=c[0]?c[0]:"",f=null!=c[1]?c[1]:"";return b+f;case "-":if(isNaN(b))throw Error(qs.I18N.getString("wos.expression.parser.002",c[0],this.expression));if(isNaN(f))throw Error(qs.I18N.getString("wos.expression.parser.002",c[1],this.expression));return b-f;case "*":if(isNaN(b))throw Error(qs.I18N.getString("wos.expression.parser.002",
c[0],this.expression));if(isNaN(f))throw Error(qs.I18N.getString("wos.expression.parser.002",c[1],this.expression));return b*f;case "/":if(isNaN(b))throw Error(qs.I18N.getString("wos.expression.parser.002",c[0],this.expression));if(isNaN(f))throw Error(qs.I18N.getString("wos.expression.parser.002",c[1],this.expression));if(0==f)throw Error(qs.I18N.getString("wos.expression.parser.003",this.expression));return b/f;default:throw Error(qs.I18N.getString("wos.expression.parser.004",this.expression));
}};this.getLogiResult=function(a,c){switch(a){case "!":return!c[0];case "\x26\x26":return c[0]&&c[1];case "||":return c[0]||c[1];case "\x3d\x3d":return c[0]==c[1];case "!\x3d":return c[0]!=c[1];case "\x3c":return c[0]<c[1];case "\x3e":return c[0]>c[1];case "\x3c\x3d":return c[0]<=c[1];case "\x3e\x3d":return c[0]>=c[1];default:throw Error(qs.I18N.getString("wos.expression.parser.005",this.expression));}};this.getEvalResult=function(c){var b;if(null==this.valueProvider)throw Error(qs.I18N.getString("wos.expression.parser.006",
c[0],this.expression));for(var g=[],k=this.valueProvider,m,n=0;n<c.length;n++){m=c[n];if("string"==js.type(m))if(js.instanceOf(k,f.expression.IExpressionValueProvider))if(b=k.getVariableValue(m,this),b.state==f.expression.ExpressionResult.CALCULATED)k=b.value;else return b;else k=k[m];else if(js.instanceOf(m,a)&&m.type==a.FUNC){if(!js.instanceOf(k,f.expression.IExpressionValueProvider))throw Error(qs.I18N.getString("wos.expression.parser.007",m.name,this.expression));for(var l=0;l<m.operands.length;l++)if(b=
m.operands[l],js.instanceOf(b,a))switch(b=this.getResult(b),b.state){case f.expression.ExpressionResult.CALCULATED:g.push(b.value);break;case f.expression.ExpressionResult.POSTPONED:case f.expression.ExpressionResult.INVALIDE:return b}else g.push(b);b=k.getFunctionValue(m.name,g,this);switch(b.state){case f.expression.ExpressionResult.CALCULATED:k=b.value;break;case f.expression.ExpressionResult.POSTPONED:case f.expression.ExpressionResult.INVALIDE:return b}}else throw Error(qs.I18N.getString("wos.expression.parser.008",
this.expression));if(null==k)break}return k!=this.valueProvider?new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,k):new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,null)};this.getFuncResult=function(a,c){var b=null;switch(a){case "now":b=f.expression.ExpressionFunction.now(c);break;case "max":b=f.expression.ExpressionFunction.max(c);break;case "min":b=f.expression.ExpressionFunction.min(c);break;case "toFixed":b=f.expression.ExpressionFunction.toFixed(c);
break;case "case":b=f.expression.ExpressionFunction.doCase(c);break;case "upcase":b=f.expression.ExpressionFunction.upcase(c);break;case "upcaseRMB":b=f.expression.ExpressionFunction.upcaseRMB(c);break;case "toEnglish":b=f.expression.ExpressionFunction.toEnglish(c);break;case "dateFormat":b=f.expression.ExpressionFunction.dateFormat(c);break;case "eval":b=this.execEvalFunction(c);break;case "json":b=this.execJsonFunction(c);break;case "dictLabel":b=f.expression.ExpressionFunction.dictLabel(c);break;
default:if(null==this.valueProvider)throw Error(qs.I18N.getString("wos.expression.parser.009",a,this.expression));return this.valueProvider.getFunctionValue(a,c,this)}return new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,b)};this.execEvalFunction=function(a){if(0==a.length)return null;a=a[0];a=a.replace(this.expPattern,this.expReplaceFunction);return f.expression.ExpressionFunction.eval(a)};this.execJsonFunction=function(a){if(0==a.length)return null;a=a[0];a=a.replace(this.expPattern,
this.expReplaceFunction);return f.expression.ExpressionFunction.json(a)};this.expReplaceFunction=function(a){var c=null;if(""==a||null==a||3>=a.length)return a;a=a.substring(2,a.length-1);a=a.replace(/&quot;/g,'"');a=a.replace(/&amp;/g,"\x26");a=a.replace(/&lt;/g,"\x3c");a=a.replace(/&gt;/g,"\x3e");a=(new f.expression.ExpressionParser(this.valueProvider)).calculate(a);a.state==f.expression.ExpressionResult.CALCULATED&&(c=a.value);return null==c?"":"date"==js.type(c)?f.expression.ExpressionFunction.dateFormat([c,
"YYYY-MM-DD HH:MI:SS"]):c.toString()};js.$public.parse=function(a){if(this.expression!=a||null==this.rootSyntax)this.expression=a,this.pos=0,this.length=a.length,this.rootSyntax=this.parseAll("")};this.parseAll=function(d){for(var e=null,g=e=null,f=[],m=[],n,g=null,l=[];null!=(n=this.getNextToken());){switch(n.type){case b.tkOperator:if("("==n.value)null!=g&&g.type==b.tkLetter?(g=this.parseFunction(g.value),null!=e?1==e.operands.length?(m.pop(),m.push(g),e=null):(e.operands.pop(),e.operands.push(g)):
m.push(g),n.type=b.tkOperator,n.value="func"):m.push(this.parseAll("("));else{if(")"==n.value){if("("==d){e=this.generateSyntaxTree(f,m);if(0<f.length||0<m.length)throw Error(qs.I18N.getString("wos.expression.parser.010",")",this.expression));return e}if("func"==d){if(0==f.length&&0==m.length)return null;e=this.generateSyntaxTree(f,m);if(0<f.length||0<m.length)throw Error(qs.I18N.getString("wos.expression.parser.010",")",this.expression));return e}throw Error(qs.I18N.getString("wos.expression.parser.011",
this.expression));}if(","==n.value){if("func"==d){e=this.generateSyntaxTree(f,m);if(0<f.length||0<m.length)throw Error(qs.I18N.getString("wos.expression.parser.010",",",this.expression));return e}throw Error(qs.I18N.getString("wos.expression.parser.010",",",this.expression));}if("."==n.value)if(g.type==b.tkOperator&&"func"==g.value)null==e&&(e=new a(a.EVAL),e.operands.push(m.pop()),m.push(e));else{if(g.type!=b.tkLetter)throw Error(qs.I18N.getString("wos.expression.parser.010",".",this.expression));
}else e=null,0<f.length&&(g=f[f.length-1],c[g]>=c[n.value]&&(g=this.generateSyntaxTree(f,m,c[n.value]),m.push(g))),f.push(n.value)}break;case b.tkLetter:if(null==e)e=new a(a.EVAL),e.operands.push(n.value),m.push(e);else if(null!=g&&g.type==b.tkOperator&&"."==g.value)e.operands.push(n.value);else throw Error(qs.I18N.getString("wos.expression.parser.010",n.value,this.expression));break;case b.tkDigital:null!=g&&g.type==b.tkOperator&&"-"==g.value&&(2>l.length||"("==l[l.length-2].value)&&(n.value=-1*
NumberUtil.toNumber(n.value),f.pop());if(null!=e)throw Error(qs.I18N.getString("wos.expression.parser.010",n.value,this.expression));m.push(n.value);break;case b.tkString:case b.tkConstant:if(null!=e)throw Error(qs.I18N.getString("wos.expression.parser.010",n.value,this.expression));m.push(n.value)}g=n;l.push(n)}if("("==d)throw Error(qs.I18N.getString("wos.expression.parser.011",this.expression));e=this.generateSyntaxTree(f,m);if(0<f.length||0<m.length)throw Error(qs.I18N.getString("wos.expression.parser.008",
this.expression));return e};this.generateSyntaxTree=function(b,e,g){g=js.param(g,0);var f,m,n,l;if(0==b.length){if(1==e.length){b=e.pop();if(js.instanceOf(b,a))return b;f=new a(a.VARL);f.operands.push(b);return f}throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));}for(var q;0<b.length;){m=b.pop();if(c[m]<g){b.push(m);break}switch(m){case "!":n=1;q=a.LOGI;break;case "+":case "-":case "*":case "/":n=2;q=a.MATH;break;case "\x26\x26":case "||":case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":n=
2;q=a.LOGI;break;default:throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));}if(1==n)if(null==f){if(1>e.length)throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));n=e.pop();f=new a(q,m);f.operands.push(n);js.instanceOf(n,a)&&(n.parent=f)}else m=new a(q,m),m.operands.push(f),f=f.parent=m;else if(2==n)if(null==f){if(2>e.length)throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));n=e.pop();l=e.pop();f=new a(q,m);f.operands.push(l);
f.operands.push(n);js.instanceOf(n,a)&&(n.parent=f);js.instanceOf(l,a)&&(l.parent=f)}else{if(1>e.length)throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));n=e.pop();m=new a(q,m);m.operands.push(n);m.operands.push(f);js.instanceOf(n,a)&&(n.parent=m);f=f.parent=m}}if(null==f)throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));return f};this.parseFunction=function(c){c=new a(a.FUNC,c);for(var b;null!=(b=this.parseAll("func"))&&(b.type==a.VARL?c.operands.push(b.operands.pop()):
(c.operands.push(b),b.parent=c),")"!=String(this.lastToken.value)););return c};this.getNextToken=function(){for(var a,c;this.pos<this.length;){c=this.expression.charCodeAt(this.pos);if(32<c&&127>c||19968<=c&&40869>=c)break;this.pos++}if(this.pos==this.length)return null;a=this.expression.charAt(this.pos);this.lastToken=c=new b;switch(a){case "(":c.type=b.tkOperator;c.value="(";break;case ")":c.type=b.tkOperator;c.value=")";break;case '"':case "'":c.type=b.tkString;c.value=this.parseString();break;
case "\x3d":"\x3d"==this.expression.charAt(this.pos+1)&&this.pos++;c.type=b.tkOperator;c.value="\x3d\x3d";break;case "!":"\x3d"==this.expression.charAt(this.pos+1)?(this.pos++,c.type=b.tkOperator,c.value="!\x3d"):(c.type=b.tkOperator,c.value="!");break;case "\x3c":"\x3d"==this.expression.charAt(this.pos+1)?(this.pos++,c.type=b.tkOperator,c.value="\x3c\x3d"):(c.type=b.tkOperator,c.value="\x3c");break;case "\x3e":"\x3d"==this.expression.charAt(this.pos+1)?(this.pos++,c.type=b.tkOperator,c.value="\x3e\x3d"):
(c.type=b.tkOperator,c.value="\x3e");break;case ",":c.type=b.tkOperator;c.value=",";break;case "+":c.type=b.tkOperator;c.value="+";break;case "-":c.type=b.tkOperator;c.value="-";break;case "*":c.type=b.tkOperator;c.value="*";break;case "/":c.type=b.tkOperator;c.value="/";break;case ".":c.type=b.tkOperator;c.value=".";break;case "\x26":"\x26"==this.expression.charAt(this.pos+1)&&this.pos++;c.type=b.tkOperator;c.value="\x26\x26";break;case "|":"|"==this.expression.charAt(this.pos+1)&&this.pos++,c.type=
b.tkOperator,c.value="||"}if(-1!=c.type)return this.pos++,c;"0"<=a&&"9">=a?(c.type=b.tkDigital,c.value=this.parseNumber()):(a=this.parseLetter(),null!=this.constMap[a]?(c.type=b.tkConstant,c.value=this.constMap[a]):(c.type=b.tkLetter,c.value=a));return c};this.parseString=function(){var a=this.expression.charAt(this.pos);if('"'!=a&&"'"!=a)throw Error(qs.I18N.getString("wos.expression.parser.008",this.expression));a=this.expression.indexOf(a,this.pos+1);if(-1==a)throw Error(qs.I18N.getString("wos.expression.parser.008",
this.expression));var c=this.expression.substring(this.pos+1,a);this.pos=a;return c};this.parseLetter=function(){var a="",c;for(c=this.pos;c<this.length;)if(a=this.expression.charCodeAt(c),65<=a&&90>=a||48<=a&&57>=a||97<=a&&122>=a||19968<=a&&40869>=a||36==a||95==a)c++;else break;a=this.expression.substring(this.pos,c);this.pos=c;return a};this.parseNumber=function(){for(var a="",c;this.pos<this.length;){c=this.expression.charAt(this.pos);if("0"<=c&&"9">=c||"."==c)a+=c;else break;this.pos++}c=parseFloat(a);
if(isNaN(c))throw Error(qs.I18N.getString("wos.expression.parser.012",a,this.expression));return c}})})(wos,jQuery);(function(f,l){js.$class("wos.expression.ExpressionFunction",function(){this.initialize=function(){};js.$static.now=function(a){a=Number(f.Desktop.getAttribute("serverTimer"));var b=Number(f.Desktop.getAttribute("initTimer"));if(isNaN(a)||isNaN(b))return new Date;var c=new Date;c.setTime(a+c.getTime()-b);return c};js.$static.toFixed=function(a){if(1==a.length)return Number(a[0]).toFixed(2);if(2==a.length)return Number(a[0]).toFixed(Number(a[1]));throw Error(qs.I18N.getString("wos.expression.function.001",
"toFix()"));};js.$static.max=function(a){if(0==a.length)throw Error(qs.I18N.getString("wos.expression.function.002","max()"));for(var b=Number(a[0]),c=1;c<a.length;c++)b<Number(a[c])&&(b=Number(a[c]));return b};js.$static.min=function(a){if(0==a.length)throw Error(qs.I18N.getString("wos.expression.function.002","min()"));for(var b=Number(a[0]),c=1;c<a.length;c++)b>Number(a[c])&&(b=Number(a[c]));return b};js.$static.doCase=function(a){if(2>a.length)throw Error(qs.I18N.getString("wos.expression.function.001",
"case()"));for(var b=a[0],c=1;c+1<a.length;c+=2){if(c==a.length-1)return a[c];if(a[c]==b)return a[c+1]}return c<a.length?a[c]:null};js.$static.upcase=function(a){return 0==a.length?"":String(a[0]).toUpperCase()};js.$static.upcaseRMB=function(a){if(0==a.length)return"\u96f6\u5706\u6574";a=Number(a[0]);return isNaN(a)?"":StringUtil.upcaseRMB(a)};js.$static.toEnglish=function(a){if(0==a.length)return"";var b=Number(a[0]);return isNaN(b)?"":2<=a.length&&!0==a[1]?StringUtil.toEnglish(b).toUpperCase():
StringUtil.toEnglish(b)};js.$static.dateFormat=function(a){if(2>a.length)throw Error(qs.I18N.getString("wos.expression.function.001","dateFormat()"));if(null==a[0])return"";var b=a[1],c;if("date"==js.type(a[0]))c=a[0];else{if("string"==js.type(a[0]))return a[0];c="function"==js.type(a[0].getMilliseconds)?new Date(a[0].getMilliseconds()):new Date(a[0])}return 3<=a.length&&!0==a[2]?DateUtil.format(c,b).toUpperCase():DateUtil.format(c,b)};js.$static.eval=function(a){var b;try{b="string"==typeof a?"{"==
a.charAt(0)?eval("["+a+"]")[0]:eval(a):a}catch(c){b=null}return b};js.$static.json=function(a){var b;try{b="string"==typeof a?JSON.parse(a):a}catch(c){b=null}return b};js.$static.dictLabel=function(a){if(2>a.length)throw Error(qs.I18N.getString("wos.expression.function.001","dictLabel()"));var b=f.DictionaryLoader.getValueItem(a[0],a[1]);return null!=b?b.label:a[1]}})})(wos,jQuery);(function(f,l){js.$class("wos.expression.ValueProviderFilter",qs.events.EventDispatcher,[f.expression.IExpressionValueProvider],function(){this.initialize=function(a){this.$super();this.invalideResult=new f.expression.ExpressionResult(f.expression.ExpressionResult.INVALIDE,null);this.valueProvider=a;this.result=new f.expression.ExpressionResult(f.expression.ExpressionResult.CALCULATED,null);this.addEventListener(f.events.CallbackEvent.CALLBACK,this.onRemotingCallback,this)};this.onRemotingCallback=
function(a){switch(a.option.asyncName){case "POSTPONED_VALUE":"$user"==a.option.asyncData.name&&f.Desktop.setAttribute("ctxUser",a.result),a.option.asyncData.parser.dispatchEvent(new f.expression.ExpressionEvent(a.option.asyncData.name,a.result))}};js.$public.getVariableValue=function(a,b){var c;switch(a){case "loginInfo":case "$loginInfo":return c=f.Desktop.getAttribute("loginInfo"),null==c?this.getResult(f.expression.ExpressionResult.INVALIDE,null,"\u65e0\u6cd5\u83b7\u53d6\u5f53\u524d\u767b\u5f55\u4fe1\u606f\uff01"):
this.getResult(f.expression.ExpressionResult.CALCULATED,c);case "user":case "$user":return c=f.Desktop.getAttribute("ctxUser"),null==c?(f.Remoting.call("DepartmentService.getLoginedUser",[],this,new f.events.AsyncOption("POSTPONED_VALUE",{name:a,parser:b})),this.getResult(f.expression.ExpressionResult.POSTPONED,null,a)):this.getResult(f.expression.ExpressionResult.CALCULATED,c);case "dmconf":case "$dmconf":return c=f.Desktop.getAttribute("dmconf"),this.getResult(f.expression.ExpressionResult.CALCULATED,
c);case "runtime":case "$runtime":return c=f.Desktop.getAttribute("runtime"),this.getResult(f.expression.ExpressionResult.CALCULATED,c);case "WebOS":case "$WebOS":return c=f.Desktop.getAttributes(),this.getResult(f.expression.ExpressionResult.CALCULATED,c);case "null":return this.getResult(f.expression.ExpressionResult.CALCULATED,null)}return null!=this.valueProvider?this.valueProvider.getVariableValue(a,b):this.invalideResult};js.$public.getFunctionValue=function(a,b,c){return null!=this.valueProvider?
this.valueProvider.getFunctionValue(a,b,c):this.invalideResult};this.getResult=function(a,b,c){c=js.param(c,"");this.result.state=a;this.result.value=b;this.result.message=c;return this.result}})})(wos,jQuery);(function(f){var l={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,
function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})},getBytes:function(a){a=l.encode(a);for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b},newBytes:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return l.decode(b)}};f.Base64={encode:function(a){a=l.getBytes(a);return f.Base64.encodeByteArray(a)},encodeByteArray:function(a){for(var b="",c,d=Array(4),e=0;e<a.length;){c=[];for(var f=0;3>f&&e<a.length;f++)c[f]=a[e++];
d[0]=(c[0]&252)>>2;d[1]=(c[0]&3)<<4|c[1]>>4;d[2]=(c[1]&15)<<2|c[2]>>6;d[3]=c[2]&63;for(c=c.length;3>c;c++)d[c+1]=64;for(c=0;c<d.length;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d[c])}return b},decode:function(a){a=f.Base64.decodeToByteArray(a);return l.newBytes(a)},decodeToByteArray:function(a){for(var b=[],c=Array(4),d=Array(3),e=0;e<a.length;e+=4){for(var f=0;4>f&&e+f<a.length;f++)c[f]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".indexOf(a.charAt(e+
f));d[0]=(c[0]<<2)+((c[1]&48)>>4);d[1]=((c[1]&15)<<4)+((c[2]&60)>>2);d[2]=((c[2]&3)<<6)+c[3];for(f=0;f<d.length&&64!=c[f+1];f++)b.push(d[f]&255)}return b}};f.Utf8=l})(wos);(function(f){function l(a,c){var d=0==(a.length&3)?a.length>>>2:(a.length>>>2)+1,e;c?(e=Array(d+1),e[d]=a.length):e=Array(d);for(var d=a.length,f=0;f<d;f++)e[f>>>2]|=(255&a[f])<<((f&3)<<3);return e}function a(a,c){var d;d=c?a[a.length-1]:a.length<<2;var e=[];e.length=d;for(var f=0;f<d;f++)e[f]=a[f>>>2]>>>((f&3)<<3)&255;return e}f.XXTEA={encrypt:function(b,c){var d=f.Utf8.getBytes(b),e=f.Utf8.getBytes(c);if(0==d.length)return d;d=a(f.XXTEA.encryptIntArray(l(d,!0),l(e,!1)),!1);return f.Base64.encodeByteArray(d)},
decrypt:function(b,c){var d=f.Base64.decodeToByteArray(b),e=f.Utf8.getBytes(c);if(0==d.length)return"";d=a(f.XXTEA.decryptIntArray(l(d,!1),l(e,!1)),!0);return f.Utf8.newBytes(d)},encryptIntArray:function(a,c){var d=a.length-1;if(1>d)return a;4>c.length&&(c.length=4);for(var e=a[d],f=a[0],k=0,m,n,l=Math.floor(6+52/(d+1));0<l--;){k+=2654435769;m=k>>>2&3;for(n=0;n<d;n++)f=a[n+1],e=a[n]+=(e>>>5^f<<2)+(f>>>3^e<<4)^(k^f)+(c[n&3^m]^e);f=a[0];e=a[d]+=(e>>>5^f<<2)+(f>>>3^e<<4)^(k^f)+(c[n&3^m]^e)}return a},
decryptIntArray:function(a,c){var d=a.length-1;if(1>d)return a;4>c.length&&(c.length=4);var e=a[d],f=a[0],k,m,n;for(k=2654435769*Math.floor(6+52/(d+1));0!=k;){m=k>>>2&3;for(n=d;0<n;n--)e=a[n-1],f=a[n]-=(e>>>5^f<<2)+(f>>>3^e<<4)^(k^f)+(c[n&3^m]^e);e=a[d];f=a[0]-=(e>>>5^f<<2)+(f>>>3^e<<4)^(k^f)+(c[n&3^m]^e);k-=2654435769}return a}}})(wos);(function(f){function l(a){str="";for(j=0;3>=j;j++)str+=g.charAt(a>>8*j+4&15)+g.charAt(a>>8*j&15);return str}function a(a,c){var b=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(b>>16)<<16|b&65535}function b(c,b,d,e,f,g){c=a(a(b,c),a(e,g));return a(c<<f|c>>>32-f,d)}function c(a,c,d,e,f,g,l){return b(c&d|~c&e,a,c,f,g,l)}function d(a,c,d,e,f,g,l){return b(c&e|d&~e,a,c,f,g,l)}function e(a,c,d,e,f,g,l){return b(d^(c|~e),a,c,f,g,l)}var g="0123456789abcdef";f.MD5=function(g){g=f.Utf8.encode(g);nblk=(g.length+
8>>6)+1;blks=Array(16*nblk);for(i=0;i<16*nblk;i++)blks[i]=0;for(i=0;i<g.length;i++)blks[i>>2]|=g.charCodeAt(i)<<i%4*8;blks[i>>2]|=128<<i%4*8;blks[16*nblk-2]=8*g.length;x=blks;g=1732584193;var m=-271733879,n=-1732584194,p=271733878;for(i=0;i<x.length;i+=16){var q=g,s=m,r=n,t=p;g=c(g,m,n,p,x[i+0],7,-680876936);p=c(p,g,m,n,x[i+1],12,-389564586);n=c(n,p,g,m,x[i+2],17,606105819);m=c(m,n,p,g,x[i+3],22,-1044525330);g=c(g,m,n,p,x[i+4],7,-176418897);p=c(p,g,m,n,x[i+5],12,1200080426);n=c(n,p,g,m,x[i+6],17,
-1473231341);m=c(m,n,p,g,x[i+7],22,-45705983);g=c(g,m,n,p,x[i+8],7,1770035416);p=c(p,g,m,n,x[i+9],12,-1958414417);n=c(n,p,g,m,x[i+10],17,-42063);m=c(m,n,p,g,x[i+11],22,-1990404162);g=c(g,m,n,p,x[i+12],7,1804603682);p=c(p,g,m,n,x[i+13],12,-40341101);n=c(n,p,g,m,x[i+14],17,-1502002290);m=c(m,n,p,g,x[i+15],22,1236535329);g=d(g,m,n,p,x[i+1],5,-165796510);p=d(p,g,m,n,x[i+6],9,-1069501632);n=d(n,p,g,m,x[i+11],14,643717713);m=d(m,n,p,g,x[i+0],20,-373897302);g=d(g,m,n,p,x[i+5],5,-701558691);p=d(p,g,m,n,x[i+
10],9,38016083);n=d(n,p,g,m,x[i+15],14,-660478335);m=d(m,n,p,g,x[i+4],20,-405537848);g=d(g,m,n,p,x[i+9],5,568446438);p=d(p,g,m,n,x[i+14],9,-1019803690);n=d(n,p,g,m,x[i+3],14,-187363961);m=d(m,n,p,g,x[i+8],20,1163531501);g=d(g,m,n,p,x[i+13],5,-1444681467);p=d(p,g,m,n,x[i+2],9,-51403784);n=d(n,p,g,m,x[i+7],14,1735328473);m=d(m,n,p,g,x[i+12],20,-1926607734);g=b(m^n^p,g,m,x[i+5],4,-378558);p=b(g^m^n,p,g,x[i+8],11,-2022574463);n=b(p^g^m,n,p,x[i+11],16,1839030562);m=b(n^p^g,m,n,x[i+14],23,-35309556);g=
b(m^n^p,g,m,x[i+1],4,-1530992060);p=b(g^m^n,p,g,x[i+4],11,1272893353);n=b(p^g^m,n,p,x[i+7],16,-155497632);m=b(n^p^g,m,n,x[i+10],23,-1094730640);g=b(m^n^p,g,m,x[i+13],4,681279174);p=b(g^m^n,p,g,x[i+0],11,-358537222);n=b(p^g^m,n,p,x[i+3],16,-722521979);m=b(n^p^g,m,n,x[i+6],23,76029189);g=b(m^n^p,g,m,x[i+9],4,-640364487);p=b(g^m^n,p,g,x[i+12],11,-421815835);n=b(p^g^m,n,p,x[i+15],16,530742520);m=b(n^p^g,m,n,x[i+2],23,-995338651);g=e(g,m,n,p,x[i+0],6,-198630844);p=e(p,g,m,n,x[i+7],10,1126891415);n=e(n,
p,g,m,x[i+14],15,-1416354905);m=e(m,n,p,g,x[i+5],21,-57434055);g=e(g,m,n,p,x[i+12],6,1700485571);p=e(p,g,m,n,x[i+3],10,-1894986606);n=e(n,p,g,m,x[i+10],15,-1051523);m=e(m,n,p,g,x[i+1],21,-2054922799);g=e(g,m,n,p,x[i+8],6,1873313359);p=e(p,g,m,n,x[i+15],10,-30611744);n=e(n,p,g,m,x[i+6],15,-1560198380);m=e(m,n,p,g,x[i+13],21,1309151649);g=e(g,m,n,p,x[i+4],6,-145523070);p=e(p,g,m,n,x[i+11],10,-1120210379);n=e(n,p,g,m,x[i+2],15,718787259);m=e(m,n,p,g,x[i+9],21,-343485551);g=a(g,q);m=a(m,s);n=a(n,r);p=
a(p,t)}return l(g)+l(m)+l(n)+l(p)}})(wos);(function(f,l){js.$interface("wos.script.IScriptHost",function(){js.$public.getHostName=function(){};js.$public.scriptInvoke=function(a,b){}});var a={},b={};js.$class("wos.script.ScriptProxy",function(){js.$static._instance=null;this.initialize=function(){};js.$static.asyncExecute=function(c,b,e,g){e=js.param(e,null);g=js.param(g,null);var k=Math.uuid();a[k]={host:c,asyncOption:g};f.Desktop.runtime.call("ScriptPropxy.execute",k,c.getHostName(),b,e)};js.$static.regHost=function(c,d){for(var e in a)if(a[e].host==
c){null==b[e]&&(b[e]=[]);var f=Math.uuid();a[f]={host:d,finished:!0};b[e].push(f);return f}return null};js.$static.removeHost=function(c){var d=null;if("string"==js.type(c)){d=c;if(null!=b[d]){for(c=0;c<b[d].length;c++)f.script.ScriptProxy.removeHost(b[d][c]);delete b[d]}delete a[d]}else for(var e in a)a[e].host===c&&f.script.ScriptProxy.removeHost(e)};js.$static.js_invoke=function(c,d){var e=Array.prototype.slice.call(arguments,2),g=a[c];if(null==g)return null;var k=g.host;if(null==k)return null;
if("$asyncExecute_finished$"==d){js.instanceOf(k,qs.events.EventDispatcher)&&k.dispatchEvent(new f.events.ScriptEvent(e[0],g.asyncOption),null,!1);g.finished=!0;if(null!=b[c])for(k=0;k<b[c].length;k++)e=a[b[c][k]],js.isNull(e)||(e.finished=!0);delete g.asyncOption}else if(js.instanceOf(k,f.script.IScriptHost))return k.scriptInvoke(d,e);return null};js.$static.isScriptRunning=function(c){for(var b in a)if(a[b].host===c&&!0!=a[b].finished)return!0;return!1}});f.Desktop.runtime.addCallback("ScriptProxy_invoke",
f.script.ScriptProxy.js_invoke)})(wos,jQuery);(function(f){function l(a){var d=null;if(""==a||null==a||3>=a.length)return a;a=a.substring(2,a.length-1);a=a.replace(/&quot;/g,'"');a=a.replace(/&amp;/g,"\x26");a=a.replace(/&lt;/g,"\x3c");a=a.replace(/&gt;/g,"\x3e");a=b.calculate(a);a.state==wos.expression.ExpressionResult.CALCULATED&&(d=a.value);return null==d||""==d.toString()?'""':d.toString()}var a=/\$\{[\x20-\x7A|\x7C|\x7E|\u4e00-\u9fa5]*\}/g,b=new wos.expression.ExpressionParser;wos.ALink={EVENT_RECEIVER:"$eventReceiver",parseALink:function(c){c=
c.replace(a,l);var b={target:"",form:"",openMode:null,param:{}};if("alink://"!=c.substr(0,8))return b;var e,f,k,m=c.indexOf("/",9);if(-1==m)return b;e=c.substring(8,m);f=e.indexOf(":");if(-1==f)b.target=e;else if(b.target=e.substring(0,f),b.openMode={},e=e.substr(f+1),0<e.length)for(e=e.split(","),k=0;k<e.length;k++)f=e[k].split("\x3d"),2==f.length&&0<f[0].length&&(b.openMode[f[0]]=f[1]);f=c.indexOf("?",m);-1==f?(b.form=c.substr(m+1),b.param={}):(b.form=c.substring(m+1,f),b.param={},e=c.substr(f+
1),0<StringUtil.trim(e).length&&(b.param=JSON.parse(e)));null==b.param&&(b.param={});return b},toALink:function(a){if(null==a)return"";var b;b="alink://"+(a.target+"/"+a.form);null!=a.param&&(b+="?"+JSON.stringify(a.param));return b},mergeALink:function(a,b){var e=StringUtil.trim(a),f=e.charAt(e.length-1),k=!1;if(null==b||2>=b.length)return a;"}"==f?(e=e.substr(0,e.length-1),e=StringUtil.trim(e),"{"!=e.charAt(e.length-1)&&(k=!0)):e="?"==f?e+"{":e+"?{";f=StringUtil.trim(b);2<f.length&&"{"==f.charAt(0)&&
"}"==f.charAt(f.length-1)&&(f=f.substr(1),e=k?e+","+f:e+f);return e}}})(jQuery);(function(f,l){js.$namespace("qs.app");js.$interface("qs.app.IApplication",function(){js.$public.name=function(){}});js.$interface("qs.app.IPage",function(){js.$public.application=function(a){};js.$public.parentPage=function(a){};js.$public.onPropertyChange=function(a,b,c){};js.$public.onEntityChange=function(a,b,c,d){}});js.$interface("qs.app.IPageComponent",function(){js.$public.page=function(a){};js.$public.name=function(a){};js.$public.getProperty=function(a){};js.$public.setProperty=function(a,
b){};js.$public.onPropertyChange=function(a,b,c){};js.$public.onEntityChange=function(a,b,c,d){}});js.$interface("qs.app.IFormComponent",function(){js.$public.form=function(a){};js.$public.value=function(a){}});js.$interface("qs.app.IForm",function(){js.$public.application=function(a){};js.$public.getProperty=function(a){};js.$public.setProperty=function(a,b){}});f.app.Constant={STORE_TYPE:"applications",WORKSPACE_FILE_LOAD_URL:"pages/core/getWorkspaceFile.jsp",WORKSHOPDEF_FILE_URL:"conf/workshop-def.xml",
ENTITY_FILE:"Entity",ENTITY_EXT_FILE:"EntityExt",FORM_FILE:"Form",QUERY_FILE:"Query",PAGE_FILE:"Page",REPORT_FILE:"Report",APPLICATION_NODE:0,ENTITY_NODE:1,FORM_NODE:2,QUERY_NODE:3,REPORT_NODE:4,PAGE_NODE:5,PERMISSION_NODE:6,MENU_NODE:7,OTHER_NODE:8};js.$class("qs.app.WSFileLoadEvent",f.events.Event,function(){js.$static.WSFILE_LOAD="WSFileLoad";js.$public.fileXml=null;js.$public.isLoaded=!1;js.$public.message="";js.$public.option=null;this.initialize=function(a,b,c,d){this.$super(f.app.WSFileLoadEvent.WSFILE_LOAD);
this.fileXml=a;this.isLoaded=b;this.message=c;this.option=d;null==this.option?this.option=new wos.events.AsyncOption(a.name(),null):null==this.option.asyncName&&(this.option.asyncName=a.name())}});js.$class("qs.app.Workspace",f.events.EventDispatcher,function(){js.$static._instance=null;this.initialize=function(){this.$super();this._definitionXml=null;this._fileMap={};this.formWindowMap={};this.pageWindowMap={};this.cacheWindowMap={};this.addEventListener(wos.events.FileLoadEvent.FILE_LOAD,this.onFileLoaded,
this)};js.$static.instance=function(){null==f.app.Workspace._instance&&(f.app.Workspace._instance=new f.app.Workspace);return f.app.Workspace._instance};js.$public.getFormWindow=function(a){return this.formWindowMap.hasOwnProperty(a)?this.formWindowMap[a]:null};js.$public.addFormWindow=function(a,b){this.formWindowMap.hasOwnProperty(a)&&this.formWindowMap[a].remove();this.formWindowMap[a]=b};js.$public.removeFormWindow=function(a){this.formWindowMap.hasOwnProperty(a)&&this.formWindowMap[a].remove();
delete this.formWindowMap[a]};js.$public.getPageWindow=function(a){return this.pageWindowMap.hasOwnProperty(a)?this.pageWindowMap[a]:null};js.$public.addPageWindow=function(a,b){this.pageWindowMap.hasOwnProperty(a)&&this.pageWindowMap[a].remove();this.pageWindowMap[a]=b};js.$public.removePageWindow=function(a){this.pageWindowMap.hasOwnProperty(a)&&this.pageWindowMap[a].remove();delete this.pageWindowMap[a]};js.$public.getCacheWindow=function(a){return this.cacheWindowMap.hasOwnProperty(a)?this.cacheWindowMap[a]:
null};js.$public.addCacheWindow=function(a,b){this.cacheWindowMap.hasOwnProperty(a)&&this.cacheWindowMap[a].remove();this.cacheWindowMap[a]=b};js.$public.removeCacheWindow=function(a){if("string"==js.type(a)){var b=a;this.cacheWindowMap.hasOwnProperty(b)&&this.cacheWindowMap[b].remove();delete this.cacheWindowMap[b]}else for(b in this.cacheWindowMap)if(this.cacheWindowMap[b]==a){delete this.cacheWindowMap[b];break}};js.$public.definitionXml=function(a){if(void 0===a)return this._definitionXml;this._definitionXml=
a};js.$public.getLoadedFile=function(a){return this._fileMap[a]};js.$public.clearLoadedFile=function(a){delete this._fileMap[a]};js.$public.updateLoadedFile=function(a,b){this._fileMap[a]=b};this.onFileLoaded=function(a){if(!1==a.isLoaded)f.ui.MessageBox.show(a.option.asyncName+"\u6587\u4ef6\u88c5\u8f7d\u5931\u8d25\uff01\n"+a.message,"\u9519\u8bef");else{var b=a.option.asyncData,c=new f.Xml(a.content);this._fileMap[b.uid]=c;js.instanceOf(b.target,f.events.EventDispatcher)?(a=new f.app.WSFileLoadEvent(c,
!0,a.message,b.option),b.target.dispatchEvent(a)):"function"==js.type(b.target)&&b.target(c,b.option)}};js.$public.getFilePath=function(a){var b;js.instanceOf(a,f.Xml)?(b=a.name(),a=a.attr("uid")):(b=a.x_name,a=a.uid);if(""==a)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0c\u5fc5\u987b\u63d0\u4f9buid\u5c5e\u6027\u3002");a=a.split(".");switch(b){case "Entity":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");
return a[0]+"/Entity/"+a[1]+".xml";case "EntityExt":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");return a[0]+"/Entity/"+a[1]+"_EXT.xml";case "EntityForm":case "FreeForm":case "From":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");return a[0]+"/Form/"+a[1]+".xml";case "EntityQuery":case "Query":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");
return a[0]+"/Query/"+a[1]+".xml";case "QueryPage":case "ReportPage":case "Page":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");return a[0]+"/Page/"+a[1]+".xml";case "Report":if(2!=a.length)throw Error("\u6587\u4ef6\u63cf\u8ff0\u5bf9\u8c61\u9519\u8bef\uff0cuid\u683c\u5f0f\u4e0d\u6b63\u786e\u3002");return a[0]+"/Report/"+a[1]+".xml"}throw Error("\u6587\u4ef6\u7c7b\u578b\u4e0d\u652f\u6301\u3002");};js.$public.loadFile=function(a,
b,c){var d,e,g;js.instanceOf(a,f.Xml)?(d=a.name(),a.has("xmlName")&&(d=a.attr("xmlName")),e=a.attr("uid"),g=a.attr("label")):(d=a.x_name,js.isNull(a.xmlName)||""==a.xmlName||(d=a.xmlName),e=a.uid,g=a.label);if(""!=e)switch(a=e.split("."),b=new wos.events.AsyncOption(g,{uid:e,target:b,option:c}),d){case "Entity":wos.FileLoader.loadFile(f.app.Constant.WORKSPACE_FILE_LOAD_URL,{fileType:f.app.Constant.ENTITY_FILE,appUID:String(a[0]),entityUID:String(a[1])},this,b);break;case "Form":case "FreeForm":case "EntityForm":wos.FileLoader.loadFile(f.app.Constant.WORKSPACE_FILE_LOAD_URL,
{fileType:f.app.Constant.FORM_FILE,appUID:String(a[0]),formUID:String(a[1])},this,b);break;case "Query":case "EntityQuery":wos.FileLoader.loadFile(f.app.Constant.WORKSPACE_FILE_LOAD_URL,{fileType:f.app.Constant.QUERY_FILE,appUID:String(a[0]),queryUID:String(a[1])},this,b);break;case "Page":case "QueryPage":case "ReportPage":wos.FileLoader.loadFile(f.app.Constant.WORKSPACE_FILE_LOAD_URL,{fileType:f.app.Constant.PAGE_FILE,appUID:String(a[0]),pageUID:String(a[1])},this,b);break;case "Report":wos.FileLoader.loadFile(f.app.Constant.WORKSPACE_FILE_LOAD_URL,
{fileType:f.app.Constant.REPORT_FILE,appUID:String(a[0]),reportUID:String(a[1])},this,b)}}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cContainer xmlns:app\x3d"qs.app" padding\x3d"{top:1, left:2, right:2, bottom:1}"\x3e','\x3cHLayout width\x3d"100%" height\x3d"100%" hGap\x3d"0" innerLayout\x3d"{height:\'100%\'}"\x3e','\x3cScrollView width\x3d"200"\x3e','\x3capp:NavigateBar name\x3d"navBar" selectChange\x3d"onMenuSelectChange"/\x3e',"\x3c/ScrollView\x3e","\x3cHSplitter /\x3e",'\x3capp:Page name\x3d"page" layout\x3d"{width:\'100%\'}"/\x3e','\x3cTabView name\x3d"pageTab" layout\x3d"{width:\'100%\'}" selectedItemChanged\x3d"onTabChange" closeable\x3d"true" visible\x3d"false" options\x3d"{classes:\'app-tab\'}"\x3e',
"\x3c/TabView\x3e","\x3c/HLayout\x3e","\x3c/Container\x3e"));js.$class("qs.app.AppWindow",f.ui.Container,[f.app.IApplication],function(){this.homeMap={};this.newTab=!0;this.applicationName="ime.AppWindow";this.applicationXml=null;this.roles=[];this.initialize=function(b){b=l.extend({classes:"qs-app"},b);this.$super(b);this.qxml(a);this.page.application(this);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.home=function(a){if(void 0!==a){this.homeMap={};
a=a.split(";");for(var c,d=0;d<a.length;d++)c=a[d].split(":"),1==c.length?this.homeMap["default"]=c[0]:this.homeMap[c[0]]=c[1]}};js.$public.getHomePage=function(){var a=this.homeMap["default"],c=wos.Desktop.getAttribute("loginInfo").domainName;null!=this.homeMap[c]?a=this.homeMap[c]:null!=this.homeMap["*@"+c]&&(a=this.homeMap["*@"+c]);if(null!=this.roles)for(var d=0;d<this.roles.length;d++)if(null!=this.homeMap[this.roles[d].name+"@"+c]){a=this.homeMap[this.roles[d].name+"@"+c];break}return a};js.$public.name=
function(a){if(void 0===a)return this.applicationName;this.applicationName=a};js.$public.open=function(a,c){this.alink=c;this.applicationName=a;null!=this.pageTab&&this.pageTab.items([]);null!=this.page.pageXml()&&this.page.reset();if(null!=this.applicationXml&&this.applicationXml.attr("name")==this.applicationName)this.load(this.applicationXml,c.param);else this.onRefresh(c.param)};this.onRefresh=function(a){""!=this.applicationName&&null!=this.applicationName&&(wos.Remoting.beginBatchCall(),wos.Remoting.call("WorkshopService.getApplicationXml",
[this.applicationName],this,new wos.events.AsyncOption("WorkshopService.getApplicationXml",a)),wos.Remoting.call("PagePermissionService.getAllPermissions",[],this),wos.Remoting.endBatchCall())};this.onRemotingCallback=function(a,c){var d=a.result;switch(a.option.asyncName){case "WorkshopService.getApplicationXml":this.applicationXml=new f.Xml(d),this.load(this.applicationXml,a.option.asyncData)}};this.load=function(a,c){try{var d,e;null==c&&(c={});if(null!=a){var g=a.children("Application")[0];js.isNull(g)||
(g.attr("label"),"top"==g.attr("menuPos")?this.currentState="topmenu":this.currentState="");var k,m=a.children("menu");0<m.length&&(k=m[0]);var m=a.children("permission");0<m.length&&wos.PermissionUtil.instance().setApplication(this.applicationName,m[0],k);m=a.xpath("roles/role");if(0<m.length)for(this.roles=[],d=0;d<m.length;d++)e=m[d],this.roles.push({id:parseInt(e.attr("id")),name:e.attr("name")});if(!js.isNull(k)){js.isNull(this.alink)||js.isNull(this.alink.param)||js.isNull(this.alink.param.rootMenu)||
(e=k.xpath('menuitem[@label \x3d "'+this.alink.param.rootMenu+'"]')[0],js.isNull(e)||(k=e));this.loadApplicationMenu(k,c.showMenus);d=null;null!=c.home?d=c.home:js.isNull(g)||(d=g.attr("home"));if(null!=d&&void 0!=d&&"null"!=d&&""!=d&&(this.home(d),d=this.getHomePage(),!js.isNull(d))){this.navBar.selectedMenu(d);return}this.navBar.selectedFirst()}}}catch(n){f.ui.MessageBox.show(n.message,f.I18N.getString("qs.ui.messagebox.error"))}};this.loadApplicationMenu=function(a,c){for(var d=a.xpath("//menuitem"),
e,g=0;g<d.length;g++)e=d[g],""!=e.attr("xmlName")&&e.name(e.attr("xmlName")),""!=e.attr("icon")&&e.attr("icon",wos.Desktop.getAbsoluteUrl(e.attr("icon"))),"PageGroup"==e.name()&&0==e.children().length&&e.remove();if(null!=c){for(var d=new f.Xml("\x3cxml /\x3e"),k,m=a.children(),g=0;g<c.length;g++){k=c[g];e=null;for(var n=0;n<m.length;n++)if(m[n].attr("label")==k){e=m[n];break}null!=e&&d.append(e.copy())}e=d}else e=a;if(0==e.children().length)f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.001"),
f.I18N.getString("qs.ui.messagebox.info"));else return this.navBar.menuXml(e),e};this.findMenu=function(a){var c=this.applicationXml.children("menu")[0];a=a.split("/");for(var d=0;d<a.length;d++){for(var e=c.children(),c=null,f=0;f<e.length;f++)if(e[f].attr("label")==a[d]){c=e[f];break}if(null==c)return null}return c};js.$public.showMenu=function(a){null==this.findMenu(a)?null!=this.alink.param.errorMessage?f.ui.MessageBox.show(this.alink.param.errorMessage,f.I18N.getString("qs.ui.messagebox.error")):
f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.002",a),f.I18N.getString("qs.ui.messagebox.error")):this.navBar.selectedMenu(a)};this.onMenuSelectChange=function(a,c){if(void 0==c||null!=c.newValue){var d=c.newValue;"QueryPage"==d.xmlName||"ReportPage"==d.xmlName?this.openPage(d):"webpage"==d.action?this.openPage(d):"alink"==d.action&&wos.Desktop.openALink("ime.AppWindow",d.alink)}};this.onTabChange=function(a,c){var d=c.newValue;js.isNull(d)?this.navBar.selectedItem(null):this.navBar.selectedItem(d.menu)};
this.firstLoadPageTab=!1;this.openPage=function(a,c){this.isNull(a.uid)&&(a.uid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)}));c=js.param(c,this.newTab);var d;if(c&&("webpage"==a.action||0<this.pageTab.items().length||null!=this.page.pageXml()))if(this.page.visible()&&this.page.visible(!1),this.pageTab.visible()||(this.pageTab.visible(!0),this.pageTab.parent().invalidateSize(!0)),d=this.getTabPage(a),null!=d)this.pageTab.selectedItem(d);
else{d=this.page.pageXml();if(!js.isNull(d)){var e=new f.app.Page;e.application(this);var g={label:d.attr("label"),content:e,uid:d.attr("uid")};g.menu=this.page.menu;this.pageTab.addItem(g,!1);e.openPage(d)}this.page.reset();"webpage"==a.action?(e=new f.app.AppFrame,g={label:a.label,content:e,uid:a.uid},this.pageTab.addItem(g),e.src(a.url)):(e=new f.app.Page,e.application(this),g={label:a.label,content:e,uid:a.uid},this.pageTab.addItem(g),e.openPage(a));g.menu=a;this.pageTab.selectedItem(g)}else this.pageTab.visible()&&
(this.pageTab.visible(!1),this.pageTab.items([])),this.page.openPage(a),this.page.menu=a,this.page.visible()||(this.page.visible(!0),this.page.parent().invalidateSize(!0))};this.getTabPage=function(a){if(null==this.pageTab)return null;for(var c=this.pageTab.items(),d,e=0;e<c.length;e++)if(d=c[e],d.uid==a.uid)return d;return null};this.isNull=function(a){return void 0==a||null==a||""==a.replace(/\s/g,"")||"null"==a?!0:!1}});js.$class("qs.app.DefaultApplication",[f.app.IApplication],function(){this.initialize=
function(){};js.$public.name=function(){return"ime.AppWindow"}});js.$class("qs.app.AppWindowALinkHandler",f.events.EventDispatcher,[wos.IALinkHandler],function(){var a=new f.app.DefaultApplication;this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$static.register=function(){wos.Desktop.registerALinkHandler("ime.AppWindow",new f.app.AppWindowALinkHandler)};js.$public.handleALink=function(c){var d=null,e,d=null;null==c.param&&
(c.param={});js.instanceOf(c.param.$parentWindow,f.ui.Window)?d=c.param.$parentWindow:js.isNull(c.param.$winEnv)||js.instanceOf(c.param.$winEnv.$opener,f.ui.Control)&&(d=c.param.$winEnv.$opener.findAncestor(f.ui.Window));if("Application"==c.form)js.isNull(c.param.application)||(d=QSWeb.getApplication(c.param.application),js.instanceOf(d,f.app.AppWindow)?js.equals(c,d.alink)||d.open(c.param.application,c):(d=new f.app.AppWindow,d.open(c.param.application,c)),QSWeb.addApplication(c.param.application,
d),QSWeb.instance().selecteApp(c));else if("Menu"==c.form)js.isNull(c.param.application)||(d=QSWeb.getApplication(c.param.application),js.instanceOf(d,f.app.AppWindow)?d.showMenu(c.param.path):(d=new f.app.AppWindow,c.param.home=c.param.path,d.open(c.param.application,c)),QSWeb.addApplication(c.param.application,d));else if("EntityForm"==c.form){var g=QSWeb.getApplication(c.param.application);e=new f.app.FormWindow;js.instanceOf(g,f.app.IApplication)?e.application(g):e.application(a);e.open(c,d)}else if("EntitySelectWindow"==
c.form)g=QSWeb.getApplication(c.param.application),e=new f.app.PageWindow,js.instanceOf(g,f.app.IApplication)?e.application(g):e.application(a),e.addEventListener(EntitySelectEvent.ENTITY_SELECT_EVENT,this.entitySelectWindowHandler,this),e.open(c,d);else if("EntityQuery"==c.form)g=QSWeb.getApplication(c.param.application),e=new f.app.PageWindow,js.instanceOf(g,f.app.IApplication)?e.application(g):e.application(a),e.open(c,d);else if("WorkflowActivityLog"==c.form)d=0,js.isNull(c.param.processId)?js.isNull(c.param.ctxEntity)||
js.isNull(c.param.ctxEntity.WF_ProcessId)||(d=c.param.ctxEntity.WF_ProcessId):d=c.param.processId,0==d?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.003"),f.I18N.getString("qs.ui.messagebox.error")):(new f.app.workflow.FlowViewWindow).open(null,d);else if("WorkflowTask"==c.form)js.isNull(c.param.definitionName)||js.isNull(c.param.taskName)?js.isNull(c.param.definitionUID)||js.isNull(c.param.taskUID)?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.004"),f.I18N.getString("qs.ui.messagebox.error")):
wos.Desktop.openTaskWithUID(c.param.definitionUID,c.param.taskUID,c.param):wos.Desktop.openTask(c.param.definitionName,c.param.taskName,c.param);else if("TaskForm"==c.form){g=parseInt(c.param.WF_workerId);isNaN(g)&&null!=c.param.ctxEntity&&(g=c.param.ctxEntity.WF_ProcessorPrinId);d=parseInt(c.param.WF_processId);isNaN(d)&&null!=c.param.ctxEntity&&(d=c.param.ctxEntity.WF_ProcessId);null!=c.param.ctxEntity&&(c.param.entityId=c.param.ctxEntity.id);e=parseInt(c.param.WF_WorkItemId);isNaN(e)&&null!=c.param.ctxEntity&&
(e=c.param.ctxEntity.WF_WorkItemId);var k=c.param.entityUID,m=c.param.entityId,n=wos.Desktop.getAttribute("loginInfo");if(null==n)f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.005"),f.I18N.getString("qs.ui.messagebox.error"));else if(n=parseInt(n.principalId),isNaN(n))f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.005"),f.I18N.getString("qs.ui.messagebox.error"));else if(isNaN(d)||0==d)f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.006"),f.I18N.getString("qs.ui.messagebox.error"));
else if(isNaN(e)||0==e||isNaN(g)||0==g)wos.Remoting.call("WorkflowService.findWorkItem",[k,m],this,new wos.events.AsyncOption("findWorkItem",c));else if(g!=n){d=null;null!=c.param.ctxEntity&&(d=c.param.ctxEntity.WF_ProcessorPrinName);if(null==d||""==d)d="\u5176\u4ed6\u4eba";!0==c.param.directALink?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.007",d),f.I18N.getString("qs.ui.messagebox.error")):f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.008",d),f.I18N.getString("qs.ui.messagebox.error"))}else!isNaN(e)&&
0<e?wos.Remoting.call("WorkflowService.getWorkItem",[e],this,new wos.events.AsyncOption("getWorkItem",c)):wos.Remoting.call("WorkflowService.getWorkingList",[null,4,d,0,1E3],this,new wos.events.AsyncOption("findWorkItem",c))}else"DeliverWorkItem"==c.form?(d=null,js.isNull(c.param.taskEntity)?js.isNull(c.param.ctx)||js.isNull(c.param.ctx.$masterEntity)||(d=c.param.ctx.$masterEntity):d=c.param.taskEntity,null==d?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.009"),f.I18N.getString("qs.ui.messagebox.error")):
js.isNull(d.WF_WorkItemId)||0==d.WF_WorkItemId?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.010"),f.I18N.getString("qs.ui.messagebox.error")):(g=d.$type$,e=new f.app.workflow.DeliverWorkItemWindow,e.setWorkItem(d.WF_WorkItemId,d.WF_ProcessorPrinName,d,g),null!=c.param&&e.mode(c.param.mode),e.show())):"ReplyActivityNote"==c.form?(d=null,js.isNull(c.param.taskEntity)?js.isNull(c.param.ctx)||js.isNull(c.param.ctx.$masterEntity)||(d=c.param.ctx.$masterEntity):d=c.param.taskEntity,null==d?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.011"),
f.I18N.getString("qs.ui.messagebox.error")):js.isNull(d.WF_ProcessId)||js.isNull(d.WF_ProcessName)?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.012"),f.I18N.getString("qs.ui.messagebox.error")):(c=new f.app.workflow.ReplyActivityNoteWindow,c.setProcessInstance(d.WF_ProcessId,d.WF_ProcessName),c.show())):"Report"==c.form?(g=QSWeb.getApplication(c.param.application),e=new f.app.PageWindow,js.instanceOf(g,f.app.IApplication)?e.application(g):e.application(a),e.open(c,d)):"HtmlImageWindow"==
c.form&&(new f.app.HtmlImageWindow).open(c,d)};this.entitySelectWindowHandler=function(a,b){var e=a.target;if(!js.isNull(e)&&(e=e.alink(),!js.isNull(e)&&!js.isNull(e.param))){if(!js.isNull(e.param.entitySelectReceiver)){var f=e.param.entitySelectReceiver;js.isNull(f.entitySelectHandler)||"function"!=js.type(f.entitySelectHandler)||f.entitySelectHandler(b.selectedRecords)}if("function"==js.type(e.param[wos.ALink.EVENT_RECEIVER]))e.param[wos.ALink.EVENT_RECEIVER](b.selectedRecords)}};this.onRemotingCallback=
function(a){switch(a.option.asyncName){case "findWorkItem":this.handleALinkTask(a.result,a.option.asyncData);break;case "getWorkItem":if(null==a.result){f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.013"),f.I18N.getString("qs.ui.messagebox.info"));break}if(4!=a.result.state){f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.014"),f.I18N.getString("qs.ui.messagebox.info"));break}this.openTask(a.result,a.option.asyncData);break;case "getTask":this.cb_getTaskWithId(a.result,a.option.asyncData.alink,
a.option.asyncData.workItem)}};this.cb_getTaskWithId=function(a,b,e){if(null==a)f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.015"),f.I18N.getString("qs.ui.messagebox.error"));else{var g="WF_taskId_"+a.id;wos.Desktop.setAttribute(g,a);null==wos.ALink.parseALink(a.formUrl)?f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.016"),f.I18N.getString("qs.ui.messagebox.error")):(a={},js.isNull(b)||js.isNull(b.param)||(a=b.param),a.WF_taskKey=g,a.WF_mode="HumanSubmit",a.WF_processName=e.processName,
a.WF_processId=e.processInstanceId,a.WF_workItemId=e.id,a.WF_workItem=e,wos.Desktop.openALink("ime.AppWindow",e.action,a))}};this.handleALinkTask=function(a,b){for(var e,g,k=a.length-1;0<=k;k--)if(e=a[k],g=wos.ALink.parseALink(e.action),!js.isNull(g.param)&&g.param.entityUID==b.param.entityUID&&g.param.entityId==b.param.entityId){this.openTask(e,b);return}f.ui.MessageBox.show(f.I18N.getString("qs.app.appwindow.017"),f.I18N.getString("qs.ui.messagebox.error"))};this.openTask=function(a,b){var e="WF_taskId_"+
a.taskId;if(null!=wos.Desktop.getAttribute(e)){var f={};js.isNull(b)||js.isNull(b.param)||(f=b.param);f.WF_mode="HumanSubmit";f.WF_taskKey=e;f.WF_processName=a.processName;f.WF_processId=a.processInstanceId;f.WF_workItemId=a.id;f.WF_workItem=a;wos.Desktop.openALink("ime.WorkPanel",a.action,f)}else wos.Remoting.call("WDService.getTaskWithId",[a.taskId],this,new wos.events.AsyncOption("getTask",{alink:b,workItem:a}))}});wos.Desktop.registerALinkHandler("ime.AppWindow",new f.app.AppWindowALinkHandler)})(qs,
jQuery);(function(f,l){js.$class("qs.app.AppFrame",f.ui.Control,function(){this._src="";this._scrollView=this._$frame=null;this.initialize=function(a){this.$super(a)};js.$public.src=function(a){if(void 0===a)return this._src;this._src=a;this.callAfterRendered(function(){this.isNull(this._src)||(this._$element.find(".qs-app-frame\x3eiframe")[0].src=wos.Desktop.getAbsoluteUrl(this._src))})};this.isNull=function(a){return void 0==a||null==a||""==a.replace(/\s/g,"")||"null"==a?!0:!1};js.$public.updateSize=function(a,
b){this.$super();this.isRendered()&&(this._$frame.width(a),this._$frame.height(b))};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-app-frame"\x3e','\x3ciframe style\x3d"border: 0px;"/\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.children(".qs-app-frame");0<b.classes.length&&c.addClass(b.classes);this._$frame=c.children("iframe");this.invalidateSize()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.Page",f.ui.Container,[wos.script.IScriptHost],function(){js.$static.PAGE_LOADED_EVENT="pageLoaded";js.$static.ENTITY_SELECT_EVENT="EntitySelectEvent";this._application=this._parentPage=this._opener=this._pageXml=this.reportPage=this.queryPage=this.alink=null;this.selectEntity=this.loaded=!1;this.selectEntityUID="";this.expParser=this.cancelButton=this.okButton=null;this.isInitializing=this.isInitialized=!1;this.initialize=function(a){a=l.extend({layout:{type:"GridLayout",
rows:["*","auto"],vGap:2}},a);this.$super(a);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);this.addEventListener(wos.events.ScriptEvent.ASYNC_EXECUTE_FINISHED,this.onScriptExecuteFinished);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.callAfterRendered(function(){!1==this.loaded&&null!=this._pageXml&&this.loadPage()})};js.$public.application=function(a){if(void 0===a)return this._application;this._application=a};js.$public.opener=
function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.parentPage=function(a){if(void 0===a)return this._parentPage;this._parentPage=a};js.$public.pageXml=function(){return this._pageXml};js.$public.setSelectEntity=function(a){this.selectEntityUID=a;this.selectEntity=!0};js.$public.getQueryPage=function(){return this.queryPage};this.loadPage=function(){!1==this.isRendered()||null==this._pageXml||!0==this.loaded?(null!=this.queryPage&&this.queryPage.reset(),!0==this.loaded&&!0!=this.isInitialized&&
this.firePageEvent("initialize")):("QueryPage"==this._pageXml.name()?(null==this.queryPage?this.queryPage=new f.app.QueryPage:this.queryPage.reset(),null==this.queryPage.parent()&&(this.queryPage.addEventListener(f.app.QueryPage.LOADED_EVENT,this.onQueryPageLoaded,this),this.addChild(this.queryPage)),this.expParser=new wos.expression.ExpressionParser(this.queryPage),this.queryPage.application(this._application),this.queryPage.alink(this.alink),this.queryPage.parentPage(this._parentPage),this.queryPage.opener(this._opener),
this.queryPage.setPageXml(this._pageXml),!0==this.selectEntity&&this.createSelectPanel()):"ReportPage"==this._pageXml.name()&&(null==this.reportPage&&(this.reportPage=new f.app.ReportPage),null==this.reportPage.parent()&&this.addChild(this.reportPage),this.expParser=new wos.expression.ExpressionParser(this.reportPage),this.reportPage.application(this._application),this.reportPage.alink(this.alink),this.reportPage.parentPage(this._parentPage),this.reportPage.opener(this._opener),this.reportPage.setPageXml(this._pageXml)),
this.loaded=!0)};this.onQueryPageLoaded=function(a){this.firePageEvent("initialize");this.invalidateSize(!0)};js.$public.refreshQuery=function(){this.findQueryAndRefresh(this)};this.findQueryAndRefresh=function(a){a.children().forEach(function(a){js.instanceOf(a,f.app.QueryControl)?a.refresh():js.instanceOf(a,f.ui.Container)&&this.findQueryAndRefresh(a)},this)};this.createSelectPanel=function(){var a=new f.ui.Container({layout:{type:"HLayout",rowIndex:1,width:"*",hAlign:"right",hGap:3,innerLayout:{height:"100%"}}});
this.okButton=new f.ui.Button({isDefault:!0});this.okButton.text("\u786e\u5b9a");this.okButton.width(70);this.okButton.addEventListener("click",this.onOK,this);a.addChild(this.okButton);this.cancelButton=new f.ui.Button;this.cancelButton.text("\u53d6\u6d88");this.cancelButton.width(70);this.cancelButton.addEventListener("click",this.onCancel,this);a.addChild(this.cancelButton);this.addChild(a);a.height(24);this.bindEvent("dblclick",function(a){if(0!=l(a.target).closest(".slick-cell",this._$element).length)this.onOK()});
this.invalidateSize(!0)};js.$public.getSelectedRecords=function(a){return null!=this.queryPage&&(a=this.queryPage.findQueryControl(a),null!=a&&(a=a.getSelectedRecords(),0<a.length))?a[0]:null};js.$public.clearSelectedRecords=function(a){null!=this.queryPage&&(a=this.queryPage.findQueryControl(a),null!=a&&a.setSelectIndex(-1))};this.onOK=function(a){this.firePageEvent("okEvent")};this.okHandler=function(){if(!0==this.selectEntity&&null!=this.queryPage){var a=this.queryPage.findQueryControl(this.selectEntityUID);
if(null!=a){var b=a.getSelectedRecords();if(0==b.length){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u76f8\u5e94\u7684\u8bb0\u5f55\u5bf9\u8c61","\u63d0\u793a");return}var c="";js.isNull(this.alink)||js.isNull(this.alink.param)||(c=this.alink.param.selectName);a={selectName:c,selectedRecords:b,selectedEntities:a.getSelectedEntities()};this.dispatchEvent(f.app.Page.ENTITY_SELECT_EVENT,a)}else f.ui.MessageBox.show("\u65e0\u6cd5\u627e\u5230\u5b9e\u4f53\u67e5\u8be2\u5bf9\u8c61\uff0c\u53ef\u80fd\u67e5\u8be2\u4e0e\u5b9e\u4f53\u4e0d\u5bf9\u5e94\u6216\u67e5\u8be2\u4e2d\u4e3b\u5b9e\u4f53\u914d\u7f6e\u9519\u8bef\u3002",
"\u63d0\u793a")}a=this.findAncestor(f.ui.Window);null!=a&&a.close()};this.onCancel=function(a){a=this.findAncestor(f.ui.Window);null!=a&&a.close()};js.$protected.dispose=function(){this.$super();wos.script.ScriptProxy.removeHost(this)};js.$public.reset=function(){wos.script.ScriptProxy.removeHost(this);null!=this.queryPage&&this.queryPage.parent()==this&&(this.removeChild(this.queryPage),this.queryPage.remove(),this.queryPage=null);null!=this.reportPage&&this.reportPage.parent()==this&&(this.removeChild(this.reportPage),
this.reportPage.remove(),this.reportPage=null);this.removeAllChildren();this._pageXml=null;this.loaded=this.isInitializing=this.isInitialized=!1};js.$public.openPage=function(a,b){var c="",c=js.instanceOf(a,f.Xml)?a.attr("uid"):a.uid;void 0!=b&&(this.alink=b);this.isRendered()&&!0==this.loaded&&""!=this._pageXml.attr("uid")&&this._pageXml.attr("uid")==c?this.firePageEvent("initialize"):(this.isInitializing=this.isInitialized=this.loaded=!1,null!=this.queryPage&&this.queryPage.parent()==this&&(this.removeChild(this.queryPage),
this.queryPage.remove(),this.queryPage=null),null!=this.reportPage&&this.reportPage.parent()==this&&(this.removeChild(this.reportPage),this.reportPage.remove(),this.reportPage=null),this.removeAllChildren(),""!=c?(this._pageXml=f.app.Workspace.instance().getLoadedFile(c),null==this._pageXml?f.app.Workspace.instance().loadFile(a,this,new wos.events.AsyncOption("loadPageXml")):this.loadPage()):(this._pageXml=a,this.loadPage()))};js.$public.open=function(a){var b;this.alink=a;this.selectEntity=this.loaded=
!1;this.selectEntityUID="";this.isInitializing=this.isInitialized=!1;this.removeAllChildren();this.reportPage=this.queryPage=null;null!=a&&null!=a.param&&("PageWindow"==a.form&&null!=a.param.pageUID&&""!=a.param.pageUID?(this._pageXml=f.app.Workspace.instance().getLoadedFile(a.param.pageUID),null==this._pageXml?(b={x_name:"Page"},b.uid=a.param.pageUID,f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("loadPageXml"))):this.loadPage()):"EntityQuery"==a.form&&null!=a.param.queryUID&&
""!=a.param.queryUID?(this._pageXml=new f.Xml(StringUtil.join('\x3cQueryPage control\x3d"VBox"\x3e','\x3cQueryControl width\x3d"100%" height\x3d"100%" uid\x3d"',a.param.queryUID,'" /\x3e',"\x3c/QueryPage\x3e")),this.loadPage()):"EntitySelectWindow"==a.form&&null!=a.param.entityUID&&""!=a.param.entityUID?(this.selectEntityUID=a.param.entityUID,this.selectEntity=!0,null!=a.param.queryUID&&""!=a.param.queryUID?(this._pageXml=new f.Xml(StringUtil.join('\x3cQueryPage control\x3d"VBox" selectEntity\x3d"true"\x3e',
'\x3cQueryControl width\x3d"100%" height\x3d"100%" name\x3d"selectQuery" uid\x3d"',a.param.queryUID,'" /\x3e',"\x3c/QueryPage\x3e")),this.loadPage()):null!=a.param.pageUID&&""!=a.param.pageUID&&(this._pageXml=f.app.Workspace.instance().getLoadedFile(a.param.pageUID),null==this._pageXml?(b={x_name:"Page"},b.uid=a.param.pageUID,f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("loadPageXml"))):this.loadPage())):"Report"==a.form&&null!=a.param.reportUID&&""!=a.param.reportUID&&(this._pageXml=
new f.Xml(StringUtil.join('\x3cReportPage control\x3d"Canvas"\x3e','\x3cReportControl width\x3d"100%" height\x3d"100%" uid\x3d"',a.param.reportUID,'" /\x3e',"\x3c/ReportPage\x3e")),this.loadPage()))};this.onFileLoaded=function(a){switch(a.option.asyncName){case "loadPageXml":this._pageXml=a.fileXml,this.loadPage()}};this.firePageEvent=function(a,b){b=js.param(b,null);var c=this._pageXml.xpath('event[@name \x3d "'+a+'"]')[0],d=null;js.isNull(c)||(d=c.text());if(null!=d&&""!=d){if("initialize"==a){if(!0==
this.isInitializing)return;this.isInitializing=!0}wos.script.ScriptProxy.asyncExecute(this,d,b,new wos.events.AsyncOption(a))}else this.eventFinished(a,null)};this.onScriptExecuteFinished=function(a){this.eventFinished(a.option.asyncName,a.result)};this.eventFinished=function(a,b){"initialize"==a?(null!=b&&!0==b.error?(f.ui.MessageBox.show(b.message,"\u9519\u8bef"),this.onCancel(null)):(this.isInitialized=!0,this.dispatchEvent(f.app.Page.PAGE_LOADED_EVENT)),this.isInitializing=!1):"okEvent"==a&&(null!=
b&&!0==b.error?f.ui.MessageBox.show(b.message,"\u9519\u8bef"):this.okHandler())};this.getScriptHost=function(a){a=this.expParser.calculate(a);if(a.state==wos.expression.ExpressionResult.CALCULATED&&(a=a.value,js.instanceOf(a,wos.script.IScriptHost))){var b=wos.script.ScriptProxy.regHost(this,a);if(null!=b)return{hostUID:b,hostName:a.getHostName()}}return null};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "RemoteEventCallback":js.isNull(a.option.asyncData)||this.cb_RemoteEvent(a.option.asyncData,
a.result);break;case "js_executeQuery":js.isNull(a.option.asyncData)||this.firePageEvent(a.option.asyncData,{result:a.result});break;case "js_findEntity":js.isNull(a.option.asyncData)||this.firePageEvent(a.option.asyncData,{result:a.result})}};this.cb_RemoteEvent=function(a,b){if(null!=b&&null!=b.$jsResult){var c=wos.expression.ExpressionFunction.eval(b.$jsResult);null!=c&&js.copy(c,b)}this.firePageEvent(a,{result:b})};this.invokeExp=function(a,b,c){var d;null!=this.queryPage&&(d=this.queryPage.getPageComponent(a));
return null!=d&&js.instanceOf(d,wos.expression.IExpressionValueProvider)?d.getFunctionValue(b,c,null).value:null};this.executeQuery=function(a,b,c,d,e){wos.Remoting.call("QueryService.executeQuery",[a,null,b,c,d],this,new wos.events.AsyncOption("js_executeQuery",e))};this.fireRemoteEvent=function(a,b,c,d){wos.Remoting.call("DynamicEntityService.fireCustomeEvent",[a,b,c],this,new wos.events.AsyncOption("RemoteEventCallback",d))};this.getExpressionValue=function(a){if(null==this.expParser)return null;
a=this.expParser.calculate(a);return a.state==wos.expression.ExpressionResult.CALCULATED?a.value:null};this.findEntity=function(a,b,c){wos.Remoting.call("DynamicEntityService.getEntity",[b,a],this,new wos.events.AsyncOption("js_findEntity",c))};js.$public.getHostName=function(){return"ime.appwindow.PageWindow"};js.$public.scriptInvoke=function(a,b){switch(a){case "invokeExp":return this.invokeExp(b[0],b[1],b[2]);case "getExpressionValue":return this.getExpressionValue(b[0]);case "findEntity":this.findEntity(b[0],
b[1],b[2]);break;case "fireRemoteEvent":this.fireRemoteEvent(b[0],b[1],b[2],b[3]);break;case "fireCustomerEvent":this.firePageEvent(b[0],b[1]);break;case "executeQuery":this.executeQuery(b[0],b[1],b[2],b[3],b[4]);break;case "getScriptHost":return this.getScriptHost(b[0])}return null}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" width\x3d"840" height\x3d"500" title\x3d"PageWindow" resizable\x3d"true"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" \x3e','\x3capp:Page name\x3d"page" layout.width\x3d"*" layout.height\x3d"*" /\x3e',"\x3c/GridLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.PageWindow",f.ui.Window,function(){this._alink=null;this.initialize=function(b){this.$super(b);this.qxml(a)};js.$public.render=function(a,
c){"undefined"==typeof c&&(c={});c=l.extend({maximizable:!0,classes:""},this._options,c);this.$super(a,c);this.invalidateSize(!0)};js.$public.open=function(a){this._alink=a;js.isNull(a.param.title)||""==a.param.title?this.page.addEventListener(f.app.Page.PAGE_LOADED_EVENT,this.onPageLoaded,this):this.title(a.param.title);this.page.open(a);this.show()};this.onPageLoaded=function(a){this.page.removeEventListener(f.app.Page.PAGE_LOADED_EVENT,this.onPageLoaded);a=this.page.pageXml();js.isNull(a)||""==
a.attr("label")||this.title(this.page.pageXml().attr("label"))};js.$public.application=function(a){if(void 0===a)return this.page.application();this.page.application(a)};js.$public.opener=function(a){if(void 0===a)return this.page.opener();this.page.opener(a)};js.$public.parentPage=function(a){if(void 0===a)return this.page.parentPage();this.page.parentPage(a)};js.$public.alink=function(){return this._alink}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" width\x3d"431" height\x3d"351" title\x3d"\u56fe\u7247" resizable\x3d"false"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" columns\x3d"[70, 140, 70, 140]" rows\x3d"[185, 23, 23, 23, 23, 24]" hGap\x3d"2" vGap\x3d"2"\x3e','\x3capp:ImageField name\x3d"image" layout\x3d"{colSpan : 4}"/\x3e','\x3cLabel text\x3d"\u66ff\u6362\u6587\u672c:" layout\x3d"{rowIndex : 1, hAlign : \'right\'}" /\x3e','\x3cTextInput name\x3d"txtAlt" layout\x3d"{rowIndex : 1, colIndex : 1, colSpan : 3}"/\x3e',
'\x3cLabel layout\x3d"{rowIndex : 2, hAlign : \'right\'}" text\x3d"\u5bbd\u5ea6:"/\x3e','\x3cTextInput name\x3d"txtWidth" layout\x3d"{rowIndex : 2, colIndex : 1}" text\x3d""/\x3e','\x3cLabel layout\x3d"{rowIndex : 2, colIndex : 2, hAlign : \'right\'}" text\x3d"\u9ad8\u5ea6:"/\x3e','\x3cTextInput name\x3d"txtHeight" layout\x3d"{rowIndex : 2, colIndex : 3, width:\'*\'}" text\x3d""/\x3e','\x3cLabel layout\x3d"{rowIndex : 3, hAlign : \'right\'}" text\x3d"\u8fb9\u6846\u5927\u5c0f:"/\x3e','\x3cTextInput name\x3d"txtBorder" layout\x3d"{rowIndex : 3, colIndex : 1, width:\'*\'}" text\x3d"0"/\x3e',
'\x3cLabel layout\x3d"{rowIndex : 3, colIndex : 2, hAlign : \'right\'}" text\x3d"\u5bf9\u9f50\u65b9\u5f0f:"/\x3e','\x3cComboBox name\x3d"cmbAlign" layout\x3d"{rowIndex : 3, colIndex : 3, width:\'*\'}" /\x3e','\x3cLabel layout\x3d"{rowIndex : 4, colIndex : 0, hAlign : \'right\'}" text\x3d"\u6c34\u5e73\u95f4\u8ddd:"/\x3e','\x3cTextInput name\x3d"txtHspace" layout\x3d"{rowIndex : 4, colIndex : 1, hAlign : \'right\'}" text\x3d"0"/\x3e','\x3cLabel layout\x3d"{rowIndex : 4, colIndex : 2, hAlign : \'right\'}" text\x3d"\u5782\u76f4\u95f4\u8ddd:"/\x3e',
'\x3cTextInput name\x3d"txtVspace" layout\x3d"{rowIndex : 4, colIndex : 3, width:\'*\'}" text\x3d"0" /\x3e','\x3cHLayout layout\x3d"{rowIndex : 5, colSpan : 4, hAlign : \'right\', innerLayout:{height : 24}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButton width\x3d"70" text\x3d"\u786e\u5b9a" click\x3d"onOK" options\x3d"{isDefault:true}" icon\x3d"images/icons/ok.png"/\x3e','\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',"\x3c/HLayout\x3e",
"\x3c/GridLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.HtmlImageWindow",f.ui.Window,function(){this.PART_PATH="docroot/attachments/";this.aligns=[{label:"\u5de6\u5bf9\u9f50",value:"left"},{label:"\u7edd\u5bf9\u5e95\u8fb9",value:"absBottom"},{label:"\u7edd\u5bf9\u5c45\u4e2d",value:"absMiddle"},{label:"\u57fa\u7ebf",value:"baseline"},{label:"\u5e95\u8fb9",value:"bottom"},{label:"\u5c45\u4e2d",value:"middle"},{label:"\u53f3\u5bf9\u9f50",value:"right"},{label:"\u6587\u672c\u4e0a\u65b9",value:"textTop"},
{label:"\u9876\u7aef",value:"top"}];this.alink=null;this.initialize=function(b){this.$super(b);this.qxml(a);this.cmbAlign.dataProvider(this.aligns)};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);this.invalidateSize(!0)};js.$public.open=function(a){this.alink=a;this.parseHtml(a.param.html);this.showDialog()};this.parseHtml=function(a){if(!js.isNull(a)&&""!=a){a=l(a);var c=a.attr("src");if(""!=c){if(-1==c.indexOf("http://")){var d=
c.indexOf(this.PART_PATH);-1!=d&&(c=c.substr(d+this.PART_PATH.length));c="image:"+c}this.image.value(c)}c=a.attr("alt");""!=c&&this.txtAlt.text(c);c=a.attr("width");""!=c&&this.txtWidth.text(c);c=a.attr("border");""!=c&&this.txtBorder.text(c);c=a.attr("hspace");""!=c&&this.txtHspace.text(c);c=a.attr("vspace");""!=c&&this.txtVspace.text(c);c=a.attr("height");""!=c&&this.txtHeight.text(c);c=a.attr("align");""!=c&&this.cmbAlign.value(c)}};this.onOK=function(){var a=this.image.value();if(!js.isNull(a)&&
""!=a){var c=a.split(":");if(2==c.length&&(a=c[1],-1==a.indexOf(this.PART_PATH))){var c=wos.Desktop.getAbsoluteUrl(""),d=c.lastIndexOf("/",c.length-2);6<d&&(c=c.substr(d));a=c+"/"+this.PART_PATH+a}a=StringUtil.join("\x3cimg ",'src\x3d"',a,'" ','alt\x3d"',this.txtAlt.text(),'" ','width\x3d"',this.txtWidth.text(),'" ','height\x3d"',this.txtHeight.text(),'" ','border\x3d"',this.txtBorder.text(),'" ','hspace\x3d"',this.txtHspace.text(),'" ','vspace\x3d"',this.txtVspace.text(),'" ','align\x3d"',this.cmbAlign.value(),
'" \x3e',"\x3c/img\x3e");js.isNull(this.alink)||js.isNull(this.alink.param)||js.isNull(this.alink.param.$eventReceiver)||(c=this.alink.param.$eventReceiver,"string"==js.type(c)&&"function"==js.type(window[c])&&(c=window[c]),"function"==js.type(c)&&c("OK",{html:a,param:this.alink.param}));this.close()}};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.CodingPattern",f.events.EventDispatcher,function(){f.events.register("CodingGenerated",this);js.$static.CODING_GENERATED_EVENT="CodingGenerated";this._pattern=this._seqType=this._name="";this._ref={};this._sequenceNo=-1;this._typecode="";this._replaceExp=/\$\{[\w|\u4e00-\u9fa5|_]{1}[\w|\u4e00-\u9fa5]*(\.[\w|\u4e00-\u9fa5]*)*(:[\w|,]*){0,1}\}/g;this._typecodeExp=/!\{[\w|\u4e00-\u9fa5|_]*\}/g;this._coding="";this._expParser=null;this.initialize=function(a,b,c,d){this.$super();
this._name=a;this._seqType=b;this._pattern=c;this._expParser=d;this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(wos.events.ExceptionEvent.EXCEPTION,this.onRemotingException)};js.$public.name=function(){return this._name};js.$public.coding=function(){return this._coding};js.$public.typecode=function(){var a=this._pattern.match(this._typecodeExp);return null!=a&&0<a.length&&(a=a[0],3<a.length)?a.substring(2,a.length-1):""};js.$public.generate=function(a){a=
js.param(a,"");if(!0!=this._generating&&(-1==this._sequenceNo||this._typecode!=a)){this._coding=this._pattern;var b=this;this._coding=this._coding.replace(this._replaceExp,function(a){return b.expReplaceFunction(a)});var c=this._typecode;""!=a?(this._typecode=a,this._coding=this._coding.replace(this._typecodeExp,a)):this._coding=this._coding.replace(this._typecodeExp,function(a){return b.tpcReplaceFunction(a)});this._generating=!0;-1!=this._sequenceNo?(wos.Remoting.beginBatchCall(),null!=c&&""!=c&&
c!=this._typecode&&wos.Remoting.call("SequenceService.recycle",[this._seqType,c,this._sequenceNo],this),wos.Remoting.call("SequenceService.generate",[this._seqType,this._typecode],this),wos.Remoting.endBatchCall()):wos.Remoting.call("SequenceService.generate",[this._seqType,this._typecode],this)}};js.$public.recycle=function(){-1!=this._sequenceNo&&wos.Remoting.call("SequenceService.recycle",[this._seqType,this._typecode,this._sequenceNo],this)};this.onRemotingCallback=function(a){var b=this;switch(a.option.asyncName){case "SequenceService.generate":this._generating=
!1;this._sequenceNo=Number(a.result);this._coding=this._pattern;a=this._typecode;this._coding=this._coding.replace(this._replaceExp,function(a){return b.expReplaceFunction(a)});""!=a&&null!=a?(this._typecode=a,this._coding=this._coding.replace(this._typecodeExp,this._typecode)):this._coding=this._coding.replace(this._typecodeExp,function(a){return b.tpcReplaceFunction(a)});a={};a.name=this._name;a.coding=this._coding;this.dispatchEvent(this.$class.CODING_GENERATED_EVENT,a);break;case "SequenceService.recycle":this._sequenceNo=
-1}};this.onRemotingException=function(a,b){switch(a.option.asyncName){case "SequenceService.generate":this._generating=!1}};this.tpcReplaceFunction=function(a){if(""==a||null==a||3>=a.length)return a;this._typecode=a=a.substring(2,a.length-1);null==this._typecode&&(this._typecode="");return this._typecode};this.expReplaceFunction=function(a){var b,c=a;if(""==c||null==c||3>=c.length)return c;var c=c.substring(2,c.length-1),d,e,f=" ",k="P",m=0,c=c.split(":");d=c[0];1<c.length&&(c=c[1].split(","),e=
c[0],1<c.length&&(f=c[1],null==f||0==f.length)&&(f=" "),2<c.length&&(k=c[2]),null!=e&&(m=parseInt(e),isNaN(m)&&(m=0)));e=wos.expression.ExpressionFunction.now(null);c=d.split(".");switch(c[0]){case "sequence":if(0<=this._sequenceNo)b=this._sequenceNo;else return a;break;case "year":b=e.getFullYear();break;case "month":b=e.getMonth()+1;break;case "date":b=e.getDate();break;default:a=this._expParser.calculate(d),a.state==wos.expression.ExpressionResult.CALCULATED&&(b=a.value)}null==b?b="":"date"==js.type(b)&&
(b=0==b.getHours()&&0==b.getMinutes()&&0==b.getSeconds()?DateUtil.format(b,"YYYY/MM/DD"):DateUtil.format(b,"YYYY/MM/DD HH:MI:SS"));b=b.toString();if(0<m)if(a=m-b.length,0<a)if("S"==k)for(k=0;k<a;k++)b+=f;else for(k=0;k<a;k++)b=f+b;else b=b.substr(b.length-m,m);return b}})})(qs,jQuery);(function(f,l){js.$class("qs.app.WaitingBox",f.ui.Control,[wos.IWaitingBox],function(){this._text="\u6b63\u5728\u88c5\u5165...";this._progressBar=null;this.initialize=function(a){this.$super(a)};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-waitingbox"\x3e','\x3cimg class\x3d"qs-loading" src\x3d"images/loading.gif"\x3e\x3c/img\x3e','\x3cdiv class\x3d"qs-close" /\x3e','\x3cdiv class\x3d"qs-text"\x3e',this._text,"\x3c/div\x3e",'\x3cdiv class\x3d"qs-progress" style\x3d"display:none"/\x3e',
"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-progress");this._progressBar=new f.ui.ProgressBar;this._progressBar.render(c);this._progressBar.barHeight(7);this.bindEvent("mousedown",this.mouseDown);this.invalidateSize()};this.mouseDown=function(a){0<l(a.target).closest(".qs-close",this._$element).length&&this.close(!0)};js.$public.open=function(a,b,c){js.param(a,!0);js.param(b,!1);c=js.param(c,
null);this._$element.css("display","");this._$element.find(".qs-progress").css("display","none");a=this.outerSize();if(js.instanceOf(c,f.ui.Control)&&c.isRendered()){b=c.outerSize();var d=c.$element().offset();0<d.left&&0<d.top?(c=d.left+(b.width-a.width)/2,a=d.top+(b.height-a.height)/2):(c=(f.ui.windowWidth()-a.width)/2,a=(f.ui.windowHeight()-a.height)/3)}else c=(f.ui.windowWidth()-a.width)/2,a=(f.ui.windowHeight()-a.height)/3;this.left(c);this.top(a)};js.$public.close=function(a){js.param(a,!1);
this._$element.css("display","none")};js.$public.setMessage=function(a){this._text=a;this.isRendered()&&this._$element.find(".qs-text").html(a)};js.$public.updateProgress=function(a,b){this._$element.find(".qs-progress").css("display","");null!=this._progressBar&&this._progressBar.setProgress(a,b)}})})(qs,jQuery);(function(f,l){js.$class("qs.app.QueryPage",f.ui.Container,[f.app.IPage,wos.expression.IExpressionValueProvider],function(){js.$static.LOADED_EVENT="qpageLoaded";this.pageXml=null;this.loaded=!1;this.unloadedFile={};this.componentMap={};this._alink=this._opener=this._application=this._parentPage=null;this.initialize=function(a){a=l.extend({layout:{type:"GridLayout",rows:["*"],columns:["*"]}},a);this.$super(a);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);wos.Desktop.instance().addEventListener("ime.DynamicEntity",
this.onDesktopEvent,this);this.callAfterRendered(function(){if(!this.loaded&&null!=this.pageXml)this.onLoad()})};js.$public.alink=function(a){if(void 0===a)return this._alink;this._alink=a};js.$public.opener=function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.getPageComponent=function(a){return this.componentMap[a]};js.$public.findQueryControl=function(a){var b,c,d;for(d in this.componentMap)if(js.instanceOf(this.componentMap[d],f.app.QueryControl)&&(b=this.componentMap[d],c=
b.masterEntityXml(),!js.isNull(c)&&c.attr("uid")==a))return b;return null};js.$public.reset=function(){var a,b;for(a in this.componentMap)b=this.componentMap[a],js.instanceOf(b,f.app.QueryControl)&&(b.reset(!0),b.reinitialize())};js.$public.setPageXml=function(a){this.loaded=!1;this.unloadedFile={};this.componentMap={};this.pageXml=a;if(this.isRendered())this.onLoad()};js.$public.loadPage=function(a){this.loaded=!1;this.unloadedFile={};this.componentMap={};var b="",b=js.instanceOf(a,f.Xml)?a.attr("uid"):
a.uid,b=f.app.Workspace.instance().getLoadedFile(b);if(null!=b){if(this.pageXml=b,this.isRendered())this.onLoad()}else f.app.Workspace.instance().loadFile(a,this,new wos.events.AsyncOption("QueryPage"))};this.onFileLoaded=function(a){var b=a.fileXml,c=!1;switch(a.option.asyncName){case "LoadRequiredFile":"EntityQuery"==b.name()?(b=f.app.QueryControl.getRequiredFile(b),this.loadRequiredFile(b),js.copy(b,this.unloadedFile)):"Report"==b.name()&&(b=f.app.ReportControl.getRequiredFile(b),this.loadRequiredFile(b),
js.copy(b,this.unloadedFile));delete this.unloadedFile[a.option.asyncData];for(var d in this.unloadedFile){c=!0;break}c||this.load();break;case "QueryPage":if(this.pageXml=b,this.isRendered())this.onLoad()}};js.$static.getRequiredFile=function(a){var b={},c,d,e,g=a.xpath("//QueryControl");for(e=0;e<g.length;e++)c=g[e],d=f.app.Workspace.instance().getLoadedFile(c.attr("uid")),js.isNull(d)?b[c.attr("uid")]="EntityQuery":(c=f.app.QueryControl.getRequiredFile(d),js.copy(c,b));g=a.xpath("//ReportControl");
for(e=0;e<g.length;e++)c=g[e],a=f.app.Workspace.instance().getLoadedFile(c.attr("uid")),null!=a?(c=f.app.ReportControl.getRequiredFile(a),js.copy(c,b)):b[c.attr("uid")]="Report";return b};this.onLoad=function(){this.unloadedFile=f.app.QueryPage.getRequiredFile(this.pageXml);this.loadRequiredFile(this.unloadedFile)||this.load()};this.loadRequiredFile=function(a){for(var b in a)js.isNull(f.app.Workspace.instance().getLoadedFile(b))||delete a[b];var c=!1,d;for(b in a)c=!0,d={x_name:a[b]},d.uid=b,f.app.Workspace.instance().loadFile(d,
this,new wos.events.AsyncOption("LoadRequiredFile",b));return c};this.load=function(){!0!=this.loaded&&(this.removeAllChildren(),this.restoreControl(this.pageXml,this),this.invalidateSize(!0),this.loaded=!0,this.dispatchEvent(f.app.QueryPage.LOADED_EVENT))};this.restoreControl=function(a,b){var c=a.name();"QueryPage"==c&&(c=a.attr("control"));var d,e,g=null,k=!0;switch(c){case "Panel":e=new f.ui.Panel({classes:"query-page-panel"});"horizontal"==a.attr("layout")?e.content(new f.ui.Container({layout:{type:"HLayout",
hGap:2,innerLayout:{height:"100%"}}})):e.content(new f.ui.Container({layout:{type:"VLayout",vGap:2,innerLayout:{width:"100%"}}}));e.content().padding(1);break;case "TabNavigator":e=new f.ui.TabView({classes:"query-page-tab"});break;case "HBox":e=new f.ui.Container({layout:{type:"HLayout",hGap:2,innerLayout:{height:"100%"}}});break;case "HDividedBox":e=new f.ui.Container({type:"HDividedBox",layout:{type:"HLayout",hGap:0,innerLayout:{height:"100%"}}});break;case "VBox":e=new f.ui.Container({layout:{type:"VLayout",
vGap:2,innerLayout:{width:"100%"}}});break;case "VDividedBox":e=new f.ui.Container({type:"VDividedBox",layout:{type:"VLayout",vGap:1,innerLayout:{width:"100%"}}});break;case "QueryControl":e=new f.app.QueryControl;this.loadQueryControl(e,a);k=!1;break;case "ReportControl":e=new f.app.ReportControl;this.loadReportControl(e,a);k=!1;break;case "MultilevelTree":e=new f.app.MultilevelTree;e.entityUid(a.attr("entityUID"));e.queryUID(a.attr("queryUID"));e.formUid(a.attr("formUID"));e.entityLabelField(a.attr("labelField"));
e.domainLimit("false"!=a.attr("domainLimit"));e.page(this);e.permission(a.attr("permission"));k=!1;d=a.attr("name");""==d&&(d=Math.uuid());this.componentMap[d]=e;g=new f.ui.ScrollView({classes:"qs-mltree-border"});g.content(e);break;case "CustomerControl":e=this.createCustomerControl(a);k=!1;null!=e&&(d=a.attr("name"),""==d&&(d=Math.uuid()),this.componentMap[d]=e);break;default:return null}d=e.data("layout")||{};"QueryPage"==a.name()&&("Panel"==c&&e.title(a.attr("label")),d.width="100%",d.height=
"100%");for(var m=a.attributes,n,l,c=0;c<m.length;c++)if(n=m[c],l=n.name,n=n.value,"t_label"==l&&(l="label"),"width"==l)-1!=n.indexOf("%")?d.width=parseInt(n.substr(0,n.length-1))+"%":(d.width=parseInt(n),null!=g?g.width(d.width):e.width(d.width));else if("height"==l)-1!=n.indexOf("%")?d.height=parseInt(n.substr(0,n.length-1))+"%":(d.height=parseInt(n),null!=g?g.height(d.height):e.height(d.height));else if(""!=l)if("true"==n?n=!0:"false"==n&&(n=!1),"function"==f.type(e[l]))e[l](n);else e[l]=n;null!=
g&&(e=g);e.data("layout",d);js.instanceOf(b,f.ui.Panel)&&(b=b.content());js.instanceOf(b,f.ui.ItemsControl)?(g="","string"==js.type(e.label)&&""!=e.label?g=e.label:"function"==js.type(e.label)&&""!=e.label()?g=e.label():"function"==js.type(e.title)&&""!=e.title()&&(g=e.title()),b.addItem({label:g,content:e})):js.instanceOf(b,f.ui.Container)&&(g=b.options(),!js.isNull(g)&&"HDividedBox"==g.type&&0<b.children().size()&&b.addChild(new f.ui.HSplitter,!1),!js.isNull(g)&&"VDividedBox"==g.type&&0<b.children().size()&&
b.addChild(new f.ui.VSplitter,!1),b.addChild(e,!1));if(!0==k)for(k=a.children(),c=0;c<k.length;c++)this.restoreControl(k[c],e);return e};this.createCustomerControl=function(a){try{var b=wos.Desktop.getCustomerControl(a.name());if(js.isNull(b))return null;var c=null;try{c=js.newInstance(b)}catch(d){return f.ui.MessageBox.show(d.message,"\u81ea\u5b9a\u4e49\u63a7\u4ef6\u9519\u8bef"),null}this.setCustomerControlProperty(c,a.attr("properties"))}catch(e){f.ui.MessageBox(e.message,"\u9519\u8bef")}return null};
this.setCustomerControlProperty=function(a,b){for(var c=b.split(";"),d,e,g=0;g<c.length;g++)if(d=c[g].split("\x3d"),2==d.length){e=StringUtil.trim(d[0]);d=StringUtil.trim(d[1]);try{if("function"==f.type(a[e]))a[e](d);else a[e]=d}catch(k){}}};this.loadQueryControl=function(a,b){var c=b.attr("name");""==c&&(c=Math.uuid());a.name(c);a.page(this);this.componentMap[c]=a;a.openALink(this._alink);if(!js.isNull(this._alink)&&!js.isNull(this._alink.param)){var d=this._alink.param.conditionMap;if(!js.isNull(d)&&
(c=d[c],!js.isNull(c))){d=c.addtionalList;if("array"==js.type(d))for(var e,g=0;g<d.length;g++)e=d[g],a.pushAddtionalCondition(e.type,e.option,e.leftEntity,e.leftField,e.right,e.rightType,e.valueType,e.right2,e.rightType2);js.isNull(c.condition)||a.condition(c.condition)}}c=f.app.Workspace.instance().getLoadedFile(b.attr("uid"));null!=c&&a.queryXml(c)};this.loadReportControl=function(a,b){var c=f.app.Workspace.instance().getLoadedFile(b.attr("uid"));js.isNull(c)||a.templateXml(c);c=b.attr("name");
""==c&&(c=Math.uuid());a.name(c);a.page(this);this.componentMap[c]=a;a.openALink(this._alink)};this.onDesktopEvent=function(a,b){this.onEntityChange(b.param.$type$,b.param.$uid$,b.param,b.action)};js.$public.getVariableValue=function(a,b){switch(a){case "parent":case "$parent":return null!=this._parentPage&&js.instanceOf(this._parentPage,wos.expression.IExpressionValueProvider)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._parentPage):wos.expression.ExpressionResult.InvalideResult;
case "opener":case "$opener":return null!=this._opener&&js.instanceOf(this._opener,wos.expression.IExpressionValueProvider)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._opener):wos.expression.ExpressionResult.InvalideResult;case "ctx":case "$ctx":return js.isNull(this._alink.param)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx);
case "alink":case "$alink":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink)}var c=this.componentMap[a];return js.instanceOf(c,wos.expression.IExpressionValueProvider)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,c):wos.expression.ExpressionResult.InvalideResult};js.$public.getFunctionValue=function(a,b,c){switch(a){case "ctx":return js.isNull(this._alink.param)||js.isNull(this._alink.param.ctx)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
null):0==b.length?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx.master):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx[b[0]])}return wos.expression.ExpressionResult.InvalideResult};js.$public.application=function(a){if(void 0===a)return this._application;this._application=a};js.$public.parentPage=function(a){if(void 0===a)return this._parentPage;this._parentPage=a};js.$public.onPropertyChange=
function(a,b,c){var d,e;for(e in this.componentMap)if(d=this.componentMap[e],d!=a&&js.instanceOf(d,f.app.IPageComponent))d.onPropertyChange(a,b,c)};js.$public.onEntityChange=function(a,b,c,d){var e,g;for(g in this.componentMap)if(e=this.componentMap[g],js.instanceOf(e,f.app.IPageComponent))e.onEntityChange(a,b,c,d)}})})(qs,jQuery);(function(f,l){js.$class("qs.app.ReportPage",f.ui.Container,[f.app.IPage,wos.expression.IExpressionValueProvider],function(){this.pageXml=null;this.loaded=!1;this.unloadedFile={};this._alink=this._opener=this._application=this._parentPage=null;this.initialize=function(a){a=l.extend({layout:{type:"GridLayout",rows:["*"],columns:["*"]}},a);this.$super(a);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);this.callAfterRendered(function(){if(!this.loaded&&null!=this.pageXml)this.onLoad()})};
js.$public.alink=function(a){if(void 0===a)return this._alink;this._alink=a};js.$public.opener=function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.setPageXml=function(a){this.loaded=!1;this.unloadedFile={};this.pageXml=a;if(this.isRendered())this.onLoad()};js.$public.loadPage=function(a){this.loaded=!1;this.unloadedFile={};var b="",b=js.instanceOf(a,f.Xml)?a.attr("uid"):a.uid,b=f.app.Workspace.instance().getLoadedFile(b);if(null!=b){if(this.pageXml=b,this.isRendered())this.onLoad()}else f.app.Workspace.instance().loadFile(a,
this,new wos.events.AsyncOption("ReportPage"))};this.onFileLoaded=function(a){var b=a.fileXml,c=!1;switch(a.option.asyncName){case "LoadRequiredFile":"Entity"==b.name()?js.isNull(this._alink)||js.isNull(this._alink.param)||js.isNull(this._alink.param.entityUID)||!js.isNull(this._alink.param.entityXml)||this._alink.param.entityUID!=a.option.asyncData||(this._alink.param.entityXml=b):"Report"==b.name()&&(b=f.app.ReportControl.getRequiredFile(b),this.loadRequiredFile(b),js.copy(b,this.unloadedFile));
delete this.unloadedFile[a.option.asyncData];for(var d in this.unloadedFile){c=!0;break}c||this.load();break;case "ReportPage":if(this.pageXml=b,this.isRendered())this.onLoad()}};js.$static.getRequiredFile=function(a){var b={},c,d,e=a.xpath("//ReportControl");for(a=0;a<e.length;a++)c=e[a],d=f.app.Workspace.instance().getLoadedFile(c.attr("uid")),null!=d?(c=f.app.ReportControl.getRequiredFile(d),js.copy(c,b)):b[c.attr("uid")]="Report";js.isNull(this._alink)||js.isNull(this._alink.param)||js.isNull(this._alink.param.entityUID)||
!js.isNull(this._alink.param.entityXml)||(b[this._alink.param.entityUID]="Entity");return b};this.onLoad=function(){this.unloadedFile=f.app.ReportPage.getRequiredFile(this.pageXml);this.loadRequiredFile(this.unloadedFile)||this.load()};this.loadRequiredFile=function(a){for(var b in a)js.isNull(f.app.Workspace.instance().getLoadedFile(b))||delete a[b];var c=!1,d;for(b in a)c=!0,d={x_name:a[b]},d.uid=b,f.app.Workspace.instance().loadFile(d,this,new wos.events.AsyncOption("LoadRequiredFile",b));return c};
this.load=function(){!0!=this.loaded&&(this.removeAllChildren(),this.loadReportControl(this,this.pageXml.children("ReportControl")[0]),this.invalidateSize(!0),this.loaded=!0)};this.loadReportControl=function(a,b){if(!js.isNull(b)){var c=new f.app.ReportControl;c.page(this);a.addChild(c);c.openALink(this._alink);if(!js.isNull(this._alink)&&!js.isNull(this._alink.param)){js.isNull(this._alink.param.entity)||c.entity(this._alink.param.entity);js.isNull(this._alink.param.entityXml)||c.entityXml(this._alink.param.entityXml);
var d=this._alink.param.conditionMap;if(!js.isNull(d)){for(var e in d){var g=d[e];if(!js.isNull(g)&&(g=g.addtionalList,"array"==js.type(g)))for(var k,m=0;m<g.length;m++)k=g[m],c.pushAddtionalCondition(e,k.type,k.option,k.leftEntity,k.leftField,k.right,k.rightType,k.valueType,k.right2,k.rightType2)}js.isNull(this._alink.param.condition)||c.condition(this._alink.param.condition)}}d=f.app.Workspace.instance().getLoadedFile(b.attr("uid"));null!=d&&c.templateXml(d)}};js.$public.getVariableValue=function(a,
b){switch(a){case "parent":case "$parent":if(null!=this._parentPage&&js.instanceOf(this._parentPage,wos.expression.IExpressionValueProvider))return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._parentPage);break;case "opener":case "$opener":if(null!=this._opener&&js.instanceOf(this._opener,wos.expression.IExpressionValueProvider))return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._opener);break;case "ctx":case "$ctx":return js.isNull(this.alink.param)?
new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx);case "alink":case "$alink":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink)}return wos.expression.ExpressionResult.InvalideResult};js.$public.getFunctionValue=function(a,b,c){switch(a){case "ctx":return js.isNull(this._alink.param)||js.isNull(this._alink.param.ctx)?
new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):0==b.length?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx.master):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._alink.param.ctx[b[0]])}return wos.expression.ExpressionResult.InvalideResult};js.$public.application=function(a){if(void 0===a)return this._application;this._application=a};js.$public.parentPage=function(a){if(void 0===
a)return this._parentPage;this._parentPage=a};js.$public.onPropertyChange=function(a,b,c){};js.$public.onEntityChange=function(a,b,c,d){}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cContainer xmlns:app\x3d"qs.app" xmlns:q\x3d"qs.app.query" options\x3d"{classes:\'qs-querycontrol\'}"\x3e',"\x3cGridLayout width\x3d\"100%\" height\x3d\"100%\" columns\x3d\"['*', 'auto']\" rows\x3d\"['auto', 'auto', '*', 'auto']\" hGap\x3d\"0\" vGap\x3d\"2\"\x3e",'\x3cHLayout name\x3d"bar" layout\x3d"{rowIndex : 0, colSpan : 2, innerLayout:{height:\'100%\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButtonBar name\x3d"systemBar" options\x3d"{classes:\'qs-ctrlbar\'}" margin\x3d"0,0,5,0" height\x3d"23"/\x3e',
'\x3cButtonBar name\x3d"toolBar" options\x3d"{classes:\'qs-ctrlbar\'}" height\x3d"23"/\x3e',"\x3c/HLayout\x3e",'\x3capp:XmlForm name\x3d"conditionForm" queryMode\x3d"true" useDefaultValidator\x3d"true" layout\x3d"{width : \'*\', rowIndex : 1, colSpan : 2}"/\x3e','\x3cq:DataGridEx name\x3d"dgResult" layout\x3d"{rowIndex : 2}"/\x3e','\x3cq:DataGridNavigator name\x3d"gridNav" layout\x3d"{rowIndex : 3, colSpan : 2}"/\x3e','\x3cPanel title\x3d"\u5df2\u9009\u62e9\u6570\u636e" name\x3d"selectedPanel" width\x3d"150" options\x3d"{classes:\'query-page-panel\'}" layout\x3d"{rowIndex : 2, colIndex : 1}" visible\x3d"false"\x3e',
"\x3cScrollView\x3e",'\x3cList name\x3d"lstSelectedRecords" options\x3d"{classes:\'query-select-list\'}" labelField\x3d"Label" /\x3e',"\x3c/ScrollView\x3e","\x3c/Panel\x3e","\x3c/GridLayout\x3e","\x3c/Container\x3e")),b={copy:function(a,b){var e,f;for(f in a)e=a[f],b[f]=e}};js.$class("qs.app.QueryControl",f.ui.Container,[f.app.IPageComponent,f.app.IFormComponent,f.app.IEntityRuleApplier,wos.expression.IExpressionValueProvider,wos.script.IScriptHost],function(){f.events.register("saved",this);f.events.register("loaded",
this);js.$static.SAVED_EVENT="saved";js.$static.LOADED_EVENT="loaded";js.$static.PROP_SELECTED_ITEM="selectedItem";js.$static.PROP_INITIALIZED="isInitialized";this.initialize=function(c){this.refreshButton={label:"\u67e5\u8be2",action:"refresh",icon:"images/icons/refresh.png",isSystemAction:!0};this.saveButton={label:"\u4fdd\u5b58",action:"save",icon:"images/icons/save.png",isSystemAction:!0};this.resetButton={label:"\u91cd\u7f6e",action:"reset",icon:"images/icons/reset.png",isSystemAction:!0};this._ruleManager=
this._expParser=null;this.actionMap={};this.ctxMenuData={menuitem:[]};this.ctxMenu=null;this.expPattern=/\$\{[\x20-\x7A|\x7C|\x7E|\u4e00-\u9fa5]*\}/g;this.systemButtons=[];this.toolButtons=[];this.recordResult=[];this.dataView=null;this.isDataView=!1;this._queryXml=null;this.entityXml=new f.Xml("\x3cEntity /\x3e");this.recordSetHeadXml=new f.Xml("\x3chead /\x3e");this._loaded=!1;this.unloadedFile={};this._condition={};this.variables={};this.confirmEvent="";this.updateEntities=[];this.createEntities=
[];this.selectedRecords=[];this.autoClearSelection=!0;this.instructions=[];this.deleteEntities=[];this.isMultiSelectable=this.ontimeEdit=!1;this._form=this._page=this.defaultActionButton=null;this._formMode=!1;this._valueList=[];this._parentField="";this.created=this._designmode=!1;this.queryCondition=null;this.addtionalCondition=[];this.acuid=0;this.selectedEntityLabelField="label";this.columnSort=this.database=this.querySql=this.currentRow=null;this._autopaging=!0;this.isInitializing=this.isInitializedOK=
!1;this._editable=!0;this._excelPasteEnabled=!1;this._openALink=null;this.nextPage=this.currentPage=0;this.messageCallbackEvent="";this.groupingProvider=this.hyperlinkColumn=null;this._enableGrouping=!0;this.$super();var b=wos.Desktop.getAttribute("loginInfo");null!=b&&(this.database=b.database);this._expParser=new wos.expression.ExpressionParser(this);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);
this.addEventListener(wos.events.ScriptEvent.ASYNC_EXECUTE_FINISHED,this.onScriptExecuteFinished);this.addEventListener(f.app.form.SubmitPanel.COPY,this.onCopy);this.qxml(a,null,c);this.callAfterRendered(function(){this.dgResult.query=this;this.dgResult.dataProvider(this.recordResult);this.systemBar.addEventListener("buttonClick",this.onSystemButtonClick,this);this.toolBar.addEventListener("buttonClick",this.onToolButtonClick,this);this.conditionForm.queryMode=!0;this.conditionForm.query(this);this.conditionForm.addEventListener(f.app.XmlForm.BUTTON_ACTION_EVENT,
this.onFormButtonActionEvent,this);this.conditionForm.addEventListener(f.app.XmlForm.FIELD_CHANGE_ACTION_EVENT,this.onFormFireEvent,this);this.gridNav.addEventListener(f.app.query.DataGridNavigator.PAGE_CHANGED_EVENT,this.onPageChanged,this);this.gridNav.addEventListener(f.app.query.DataGridNavigator.PAGINGMODE_CHANGED_EVENT,this.onPageModeChanged,this);this.dgResult.addEventListener(f.ui.DataGrid.SELECTEDROW_CHANGE_EVENT,this.onSelectChange,this);this.dgResult.addEventListener(f.app.query.DataGridEx.COLUMN_SORT_EVENT,
this.onColumnSort,this);this.dgResult.addEventListener(f.app.query.DataGridEx.COLUMN_GROUPING_EVENT,this.onColumnGrouping,this);this.dgResult.addEventListener(f.app.query.DataGridEx.CELL_LINK_EVENT,this.onCellLink,this);this.dgResult.addEventListener(f.ui.DataGrid.CONTEXT_MENU_EVENT,this.onContextMenu,this);this.bindEvent("dblclick",this.onDoubleClick,this.dgResult.$element());this.bindEvent("keydown",this.onConditionKeyDown,this.conditionForm.$element());null!=this._page&&this.conditionForm.application(this._page.application());
this.created=!0;null!=this._queryXml&&this.load(this._queryXml);f.Timer.callLater(1E3,function(){this.invalidateSize(!0)},this);this.lstSelectedRecords.itemRenderer(function(a,c,b,d){a.append('\x3cspan class\x3d"remove" title\x3d"\u5220\u9664"\x3e\x26nbsp;\x3c/span\x3e\x3cspan class\x3d"text"\x3e'+c.Label+"\x3c/span\x3e")});var a=this,c=this.lstSelectedRecords.$element();this.lstSelectedRecords.bindEvent("click",function(b){var d=l(b.target);if(l(b.target).is(".remove")&&(b=d.closest("li",c),1==b.length))a.onRemoveSelectedRecord(b.data("data"))})})};
js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){this.systemBar.enabled(a);this.toolBar.enabled(a);if(!0==a)for(var b=this.toolBar.children().toArray(),e=0;e<b.length;e++)!1==this.toolButtons[e].enabled?b[e].enabled(!1):b[e].enabled(!0);this.dgResult.enabled(a)})};js.$public.enableGrouping=function(a){if(void 0===a)return this._enableGrouping;this._enableGrouping=a};js.$public.designMode=function(a){if(void 0===a)return this._designmode;
this._designmode=a};js.$public.formMode=function(a){if(void 0===a)return this._formMode;this._formMode=a};js.$public.loaded=function(){return this._loaded};js.$public.openALink=function(a){if(void 0===a)return this._openALink;this._openALink=a};js.$static.getRequiredFile=function(a){for(var b={},e,f=a.xpath("queryEntities/Entity"),k=0;k<f.length;k++)e=f[k],a=e.name(),e=e.attr("uid"),b[e]=a;return b};this.hasUnloadedFile=function(){for(var a in this.unloadedFile)return!0;return!1};js.$public.application=
function(){return null!=this._page?this._page.application():null!=this._form?this._form.application():null};js.$public.expParser=function(){return this._expParser};js.$public.ruleManager=function(){return this._ruleManager};js.$public.masterEntityXml=function(){return this.entityXml};js.$public.autopaging=function(a){if(void 0===a)return this._autopaging;this._autopaging=a;!0==this._autopaging?(this.gridNav.visible(!0),this.gridNav.height(22)):(this.gridNav.visible(!1),this.gridNav.height(0))};js.$public.excelPasteEnabled=
function(a){if(void 0===a)return _excelPasteEnabled;this._excelPasteEnabled=a};js.$public.queryUID=function(a){if(null!=a&&""!=a&&"null"!=a){var b=f.app.Workspace.instance().getLoadedFile(a);null==b?(b={x_name:"EntityQuery"},b.uid=a,f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("loadQuery"))):this.queryXml(b)}};js.$public.parentField=function(a){if(void 0===a)return this._parentField;this._parentField=a};js.$public.queryXml=function(a){if(void 0===a)return this._queryXml;this._queryXml=
a;!0==this.created&&this.load(this._queryXml)};js.$protected.dispose=function(){this.$super();wos.script.ScriptProxy.removeHost(this)};js.$public.reset=function(a){wos.script.ScriptProxy.removeHost(this);a||(this.defaultActionButton=null,this.addtionalCondition.length=0,this.isInitializedOK=!1,this.isRendered()&&(this.dgResult.columns([]),this.conditionForm.reset(),this.systemButtons.length=0,this.toolButtons.length=0));this.isInitializing=!1;this.variables={};this.querySql=null;this.selectedRecords_clear();
this.isDataView?this.dataView.count(0):this.recordResult.length=0;this.createEntities.length=0;this.updateEntities.length=0;this.deleteEntities.length=0;this.instructions.length=0;this.isRendered()&&(this.conditionForm.setEntity(null),this.dgResult.invalidate(),this.gridNav.recalc(0,10))};js.$public.reinitialize=function(){this._loaded&&(this.isInitializing=this.isInitializedOK=!1,this.fireQueryEvent("initialize"))};js.$public.getVariable=function(a){return this.variables[a]};js.$public.setVariable=
function(a,b){this.variables[a]=b};js.$public.dataGrid=function(){return this.dgResult};this.data_getItem=function(a){return this.isDataView?this.dataView.getItem(a):this.recordResult[a]};this.data_clear=function(){this.isDataView?this.dataView.count(0):this.recordResult.length=0};this.data_length=function(){return this.isDataView?this.dataView.getLength():this.recordResult.length};this.data_indexOf=function(a){return this.isDataView?this.dataView.indexOf(a):this.recordResult.indexOf(a)};this.data_remove=
function(a){if(this.isDataView)return this.dataView.remove(a);a=this.recordResult.indexOf(a);return-1!=a?(this.recordResult.splice(a,1),!0):!1};this.data_removeAt=function(a){return this.isDataView?this.dataView.removeAt(a):0<=a&&a<this.recordResult.length?(this.recordResult.splice(a,1),!0):!1};this.data_insert=function(a,b){return this.isDataView?this.dataView.insert(a,b):0<=a&&a<=this.recordResult.length?(this.recordResult.splice(a,0,b),!0):!1};this.data_append=function(a){if(this.isDataView)return this.dataView.insert(this.dataView.getLength(),
a);this.recordResult.push(a);return!0};this.selectedRecords_clear=function(){!0==this._selectedPanelMode?(this.lstSelectedRecords.clear(),this.selectedPanel.title("\u5df2\u9009\u62e9\u6570\u636e"),this.selectedPanel.invalidateSize(!0)):this.selectedRecords=[]};this.selectedRecords_add=function(a){!0==this._selectedPanelMode?(this.lstSelectedRecords.addItem(a),this.selectedPanel.title("\u5df2\u9009\u62e9\u6570\u636e("+this.lstSelectedRecords.items().length+")"),this.selectedPanel.invalidateSize(!0)):
this.selectedRecords.push(a)};this.selectedRecords_remove=function(a){!0==this._selectedPanelMode?(this.lstSelectedRecords.removeItem(a),this.selectedPanel.title("\u5df2\u9009\u62e9\u6570\u636e("+this.lstSelectedRecords.items().length+")"),this.selectedPanel.invalidateSize(!0)):(a=this.selectedRecords.indexOf(a),-1!=a&&this.selectedRecords.splice(a,1))};this.selectedRecords_removeAt=function(a){-1!=a&&(!0==this._selectedPanelMode?(this.lstSelectedRecords.removeItemAt(a),this.selectedPanel.title("\u5df2\u9009\u62e9\u6570\u636e("+
this.lstSelectedRecords.items().length+")"),this.selectedPanel.invalidateSize(!0)):this.selectedRecords.splice(a,1))};js.$public.pushAddtionalCondition=function(a,b,e,f,k,m,n,l,q){l=js.param(l,null);q=js.param(q,null);var s={};s.uid="acuid"+this.acuid++;s.type=a;s.option=String(b);s.leftEntity=e;s.leftField=f;s.right=k;s.rightType=m;s.valueType=n;null!=l&&(s.right2=l);null!=q&&(s.rightType2=q);a=!1;for(b=0;b<this.addtionalCondition.length;b++)if(!0==js.equals(this.addtionalCondition[b],s)){a=!0;break}a||
this.addtionalCondition.push(s)};js.$public.setSelectIndex=function(a){-1==a?(this.isMultiSelectable&&this.dgResult.selectAll(!1),this.dgResult.selectedItem(null)):(this.isMultiSelectable&&this.dgResult.selectAll(!1),this.dgResult.selectedIndex(a))};this.onContextMenu=function(a,b){0!=this.ctxMenuData.menuitem.length&&!1!=this._enabled&&(null==this.ctxMenu&&(this.ctxMenu=new f.ui.Menu,this.ctxMenu.menudata(this.ctxMenuData),this.ctxMenu.addEventListener("itemClick",this.onMenuAction,this)),this.ctxMenu.show(f.ui.Mouse.x,
f.ui.Mouse.y))};this.onMenuAction=function(a,b){!0==b.isSystemAction?this.doSystemAction(b):this.doAction(b)};this.onCellLink=function(a,b){var e=b.hyperlink;this.hyperlinkColumn=b.columnDef;if(StringUtil.beginWith(e,"alink://"))this.alinkHandler(wos.ALink.parseALink(e));else if(e=e.split(":"),"toolbutton"==e[0])for(var f,k=0;k<this.toolButtons.length;k++)if(f=this.toolButtons[k],f.label==e[1]){this.doAction(f);break}this.hyperlinkColumn=null};js.$public.alinkHandler=function(a){var b,e,g=null,k;
if(null!=a)if(null==a.param&&(a.param={}),"EntityForm"==a.form){b=a.param.entityName;e=a.param.formUID;k=f.app.Workspace.instance().getFormWindow(e);null==k&&(k=new f.app.FormWindow,f.app.Workspace.instance().addFormWindow(e,k));k.opener(this);null!=this._page?k.application(this._page.application()):null!=this._form&&k.application(this._form.application());js.isNull(this.entityXml)||a.param.entityUID!=this.entityXml.attr("uid")||k.offlineMode(this.formMode());k.editable(!0);if("edit"==a.param.action){if(js.isNull(a.param.entityId)&&
js.isNull(a.param.entity)){if(null==this.dgResult.selectedItem()){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u8981\u7f16\u8f91\u7684\u5bf9\u8c61!","\u63d0\u793a");return}g=this.getRecordEntity(this.dgResult.selectedItem(),b);if(js.isNull(g)||js.isNull(g.id)){f.ui.MessageBox.show("\u65e0\u6cd5\u83b7\u53d6\u5f53\u524d\u9009\u4e2d\u7684\u5bf9\u8c61\u5185\u5bb9!","\u63d0\u793a");return}}}else if("view"==a.param.action){if(js.isNull(a.param.entityId)&&js.isNull(a.param.entity)){if(null==this.dgResult.selectedItem()){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u8981\u67e5\u770b\u7684\u5bf9\u8c61",
"\u63d0\u793a");return}g=this.getRecordEntity(this.dgResult.selectedItem(),b);if(js.isNull(g)||js.isNull(g.id)){f.ui.MessageBox.show("\u65e0\u6cd5\u83b7\u53d6\u5f53\u524d\u9009\u4e2d\u7684\u5bf9\u8c61\u5185\u5bb9!","\u63d0\u793a");return}}k.editable(!1)}a.param.ctx=this.getContextObject();"view"!=a.param.action&&"edit"!=a.param.action||null==g||(0<parseInt(g.id)&&js.isNull(g.$children)?a.param.entityId=g.id:a.param.entity=g);k.open(a,this)}else"EntityQuery"==a.form?(e=a.param.queryUID,b=f.app.Workspace.instance().getPageWindow(e),
null==b&&(b=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(e,b)),b.parentPage(this._page),b.opener(this),null!=this._page?b.application(this._page.application()):null!=this._form&&b.application(this._form.application()),a.param.ctx=this.getContextObject(),b.open(a,this)):"FreeForm"==a.form?(e=a.param.formUID,k=f.app.Workspace.instance().getFormWindow(e),null==k&&(k=new f.app.FormWindow,f.app.Workspace.instance().addFormWindow(e,k)),k.opener(this),null!=this._page?k.application(this._page.application()):
null!=this._form&&k.application(this._form.application()),k.offlineMode(this.formMode()),a.param.ctx=this.getContextObject(),k.open(a,this)):"PageWindow"==a.form?(e=a.param.pageUID,b=f.app.Workspace.instance().getPageWindow(e),null==b&&(b=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(e,b)),b.parentPage(this._page),b.opener(this),null!=this._page?b.application(this._page.application()):null!=this._form&&b.application(this._form.application()),a.param.ctx=this.getContextObject(),b.open(a,
this)):"EntitySelectWindow"==a.form?(b=new f.app.PageWindow,b.parentPage(this._page),b.opener(this),null!=this._page?b.application(this._page.application()):null!=this._form&&b.application(this._form.application()),b.addEventListener(f.app.Page.ENTITY_SELECT_EVENT,this.entitySelectWindowHandler,this),a.param.ctx=this.getContextObject(),b.open(a,this)):"Report"==a.form?(e=a.param.reportUID,b=f.app.Workspace.instance().getPageWindow(e),null==b&&(b=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(e,
b)),b.parentPage(this._page),b.opener(this),null!=this._page?b.application(this._page.application()):null!=this._form&&b.application(this._form.application()),a.param.ctx=this.getContextObject(),b.open(a,this)):(a.param.$winEnv={$opener:this},null==a.param.entityUID&&(a.param.entityUID=this.entityXml.attr("uid")),null==a.param.ctxEntity&&(g=this.getSelectedEntities(a.param.entityName)[0],a.param.ctxEntity=g),a.param.ctx=this.getContextObject(),wos.Desktop.openALinkWindow(a))};this.entitySelectWindowHandler=
function(a,b){this.fireQueryEvent("entitySelect",{selectName:b.selectName,selectedRecords:b.selectedRecords,selectedEntities:b.selectedEntities})};this.isEntityIntegrated=function(a){a=this._queryXml.xpath('xmlQuery/select/Entity[@uid \x3d "'+a+'"]')[0];return js.isNull(a)||"true"!=a.attr("selectAll")?!1:!0};this.onEventConfirmed=function(a){a==f.ui.MessageBox.Yes&&this.fireQueryEvent(this.confirmEvent)};this.fireRemoteEvent=function(a,b,e){var f,k=a.split(".");2==k.length?(f=k[0],a=k[1]):f=this.entityXml.attr("name");
wos.Remoting.call("DynamicEntityService.fireCustomeEvent",[f,a,b],this,new wos.events.AsyncOption("RemoteCallback",e))};this.callRemoteQuery=function(a,b){wos.Remoting.call("QueryService.executeEntityHQL",[a],this,new wos.events.AsyncOption("RemoteCallback",b))};js.$public.getExpressionValue=function(a,b){try{0<=a&&a<this.dgResult.getDataLength()?this.currentRow=this.data_getItem(a):this.currentRow=null;var e=this._expParser.calculate(b);this.currentRow=null;return e.state==wos.expression.ExpressionResult.CALCULATED?
e.value:null}catch(f){return null}};this.invokeExp=function(a,b,e){a=this._expParser.calculate(a);if(a.state!=wos.expression.ExpressionResult.CALCULATED)return null;a=a.value;return null!=a&&js.instanceOf(a,wos.expression.IExpressionValueProvider)?(a=a.getFunctionValue(b,e,null),a.value):null};this.onFormButtonActionEvent=function(a,b){var e=b.action;"refresh"==e?this.refresh():this.fireQueryEvent(e)};this.onFormFireEvent=function(a,b){this.fireQueryEvent(b.changeEvent)};this.cloneSimpleObject=function(a){if(null==
a||void 0==a)return a;var b=js.type(a);if("string"==b||"number"==b||"date"==b||"boolean"==b)return a;if("function"==js.type(a.clone))return a.clone();var e={},g,k;for(k in a)if(g=a[k],b=js.type(g),null==g)e[k]=null;else if("string"==b||"number"==b||"date"==b||"boolean"==b)e[k]=g;else if(!js.instanceOf(g,f.ui.Control))if("array"==b){for(var b=[],m=0;m<g.length;m++)b.push(this.cloneSimpleObject(g[m]));e[k]=b}else e[k]=this.cloneSimpleObject(g);return e};this.getOpenParameter=function(){return null!=
this._openALink&&null!=this._openALink.param?this.cloneSimpleObject(this._openALink.param):null};this.getScriptHost=function(a){a=this._expParser.calculate(a);if(a.state==wos.expression.ExpressionResult.CALCULATED&&(a=a.value,js.instanceOf(a,wos.script.IScriptHost))){var b=wos.script.ScriptProxy.regHost(this,a);if(null!=b)return{hostUID:b,hostName:a.getHostName()}}return null};js.$public.setExpressionRow=function(a){this.currentRow=a};js.$public.validateEditInput=function(a){a=js.param(a,!0);var b=
this.dgResult.validateColumnInput();if(0==b.length)return!0;if(!0==a){a="\u8bf7\u586b\u5199";for(var e=0;e<b.length;e++)0<e&&(a+=","),a+=b[e];f.ui.MessageBox.show(a,"\u63d0\u793a")}return!1};this.setColumnProperty=function(a,b,e){"grouping"==b&&!0==e?(b={},-1==a.indexOf(".")?(b.entity=this.entityXml.attr("name"),b.prop=a):(a=a.split("."),b.entity=a[0],b.prop=a[1]),this.onColumnGrouping(null,b)):(-1==a.indexOf(".")&&(a=this.entityXml.attr("name")+"."+a),this.dgResult.setColumnProperty(a,b,e))};this.setToolButtonProperty=
function(a,b,e){var f=parseInt(a),k=null;if(!isNaN(f)&&0<=f&&f<this.toolButtons.length)k=this.toolButtons[f];else for(var m=0;m<this.toolButtons.length;m++)if(this.toolButtons[m].label==a){k=this.toolButtons[m];f=m;break}null!=k&&(a=this.toolBar.children().get(f),"enabled"==b&&(k.enabled="true"==e||!0==e?!0:!1,js.isNull(a)||a.enabled(k.enabled)),"toolTip"==b&&"null"!=e&&"undefined"!=e&&(k.toolTip=e,js.isNull(a)||a.toolTip(k.toolTip)))};this.messageCloseHandler=function(a){var b={detail:""};switch(a){case f.ui.MessageBox.Yes:b.detail=
"YES";break;case f.ui.MessageBox.No:b.detail="NO";break;case f.ui.MessageBox.OK:b.detail="OK"}this.fireQueryEvent(this.messageCallbackEvent,b)};this.showMessageBox=function(a,b,e,g){var k=f.ui.MessageBox.OK;"YesNo"==e&&(k=f.ui.MessageBox.YesNo);this.messageCallbackEvent=g;f.ui.MessageBox.show(a,b,k,null,this.messageCloseHandler,this)};js.$public.onValueReady=function(a,b){};js.$public.setPropertyValue=function(a,b){var e=this.dgResult.selectedIndex();null==e||void 0==e||0>e||(this.data_getItem(e)[this.entityXml.attr("name")+
f.app.XmlQuery.NAME_SPLIT+a]=b,this.dgResult.invalidateRow(e),this._ruleManager.onPropertyValueUpdated(a,b))};js.$public.setPropertyRequired=function(a,b){var e=this.masterEntityXml(),f=e.xpath('property[@name \x3d "'+a+'"]')[0];js.isNull(f)||this.dgResult.setColumnProperty(e.attr("name")+"."+f.attr("name"),"required",b)};js.$public.setPropertyEnabled=function(a,b){var e=this.masterEntityXml(),f=e.xpath('property[@name \x3d "'+a+'"]')[0];js.isNull(f)||this.dgResult.setColumnEditable(e,f,b)};js.$public.firePropertyUpdateEvent=
function(a,b,e){this.fireQueryEvent(b,e)};js.$public.getVariableValue=function(a,b){var e=null;switch(a){case "this":case "$this":return null==this.currentRow?(e=this.getSelectedEntities(),e=null!=e&&0<e.length?e[0]:null):e=this.getRecordEntity(this.currentRow),new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,e);case "row":case "$row":return null==this.currentRow?(e=this.dgResult.selectedItem(),null!=e&&(e=this.getRecordMap(e))):e=this.getRecordMap(this.currentRow),new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
e);case "condition":case "$condition":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.conditionForm.getEntity(!1,!1));case "page":case "$page":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page);case "opener":case "$opener":return null!=this._page&&js.instanceOf(this._page,f.app.QueryPage)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page.opener()):null!=this._form&&js.instanceOf(this._form,
f.app.FormWindow)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._form.opener()):wos.expression.ExpressionResult.InvalideResult;case "openParameter":case "$openParameter":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.getOpenParameter());case "form":case "$form":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._form);case "selectedItem":case "selectedEntity":case "$selectedEntity":return null==
this.dgResult.selectedItem()?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.getRecordEntity(this.dgResult.selectedItem()));case "totalRow":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.gridNav.getTotalRow())}e=this.getProperty(a);return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,e)};js.$public.getFunctionValue=
function(a,b,e){e=null;switch(a){case "entity":case "$entity":return null==this.currentRow?(e=this.getSelectedEntities(b[0]),e=null!=e&&0<e.length?e[0]:null):e=this.getRecordEntity(this.currentRow,b[0]),new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,e);case "selectedEntity":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.getRecordEntity(this.dgResult.selectedItem(),b[0]))}return wos.expression.ExpressionResult.InvalideResult};
js.$public.getHostName=function(){return"ime.appwindow.QueryControl"};js.$public.scriptInvoke=function(a,b){switch(a){case "fireRemoteEvent":this.fireRemoteEvent(b[0],b[1],b[2]);break;case "callRemoteQuery":this.callRemoteQuery(b[0],b[1]);break;case "fireCustomerEvent":this.fireQueryEvent(b[0],b[1]);break;case "getAllRecords":return this.getAllRecords();case "getSelectedRecords":return this.getSelectedRecords();case "getSelectedRecord":if(null==this.dgResult.selectedItem())break;return this.getRecordMap(this.dgResult.selectedItem());
case "getSelectedEntities":return this.getSelectedEntities(b[0]);case "getSelectedEntity":if(null==this.dgResult.selectedItem())break;return this.getRecordEntity(this.dgResult.selectedItem(),b[0]);case "getSelectedIndexes":return this.getSelectedIndexes();case "getAllEntities":return this.getAllEntities(b[0]);case "clearSelection":this.clearSelection();break;case "setSelectedIndex":0<=Number(b[0])&&Number(b[0])<this.data_length()&&this.dgResult.selectedIndex(Number(b[0]));break;case "getRecordAt":return this.getRecordAt(b[0]);
case "getEntityAt":return this.getEntityAt(b[0],b[1]);case "insertRecord":this.insertRecord(b[0],b[1]);break;case "setRecordAt":this.setRecordAt(b[0],b[1]);break;case "deleteRecordAt":this.deleteRecordAt(b[0]);break;case "setEntityAt":this.setEntityAt(b[0],b[1],b[2]);break;case "createEntity":this.createEntity(b[0],b[1]);break;case "updateEntity":this.updateEntity(b[0],b[1]);break;case "addInstruction":this.addInstruction(b[0]);break;case "getQueryCondition":return this.conditionForm.getEntity(!1,
!1);case "setQueryCondition":this.conditionForm.setEntity(b[0]);break;case "setConditionFormProperty":this.conditionForm.setFieldProperty(b[0],b[1],b[2]);break;case "invokeExp":return this.invokeExp(b[0],b[1],b[2]);case "openALink":"string"==js.type(b[0])?this.alinkHandler(wos.ALink.parseALink(b[0])):this.alinkHandler(b[0]);break;case "getOpenParameter":return this.getOpenParameter();case "getExpressionValue":return this.getExpressionValue(this.dgResult.selectedIndex(),b[0]);case "refreshCurrentPage":if(this.isDataView){this.refresh();
break}!0==this.autoClearSelection&&this.selectedRecords_clear();this.gridNav.refresh();break;case "refresh":!0==this.autoClearSelection&&this.selectedRecords_clear();if(!0==b[0]||"true"==b[0]||!1==this._autopaging)this.onRefresh();else this.isDataView?this.refresh():this.gridNav.refresh();break;case "getScriptHost":return this.getScriptHost(b[0]);case "getVariable":return this.getVariable(b[0]);case "setVariable":this.setVariable(b[0],b[1]);break;case "setColumnProperty":this.setColumnProperty(b[0],
b[1],b[2]);break;case "setToolButtonProperty":this.setToolButtonProperty(b[0],b[1],b[2]);break;case "setProperty":this.setProperty(b[0],b[1]);break;case "save":this.dgResult.commitCurrentEdit();"true"==this._queryXml.attr("editable")&&!0!=this.formMode()&&this.fireQueryEvent("preSave");break;case "showColumn":this.dgResult.showColumn(b[0],b[1],b[2]);break;case "hideColumn":this.dgResult.hideColumn(b[0],b[1]);break;case "setEditPosition":this.dgResult.setEditPosition(b[0],b[1]);break;case "showMessageBox":this.showMessageBox(b[0],
b[1],b[2],b[3]);break;case "setStatusHtml":this.gridNav.statusHtml(b[0])}return null};this.preloadALink=function(a){var b;null!=a.param.entityUID&&(b=f.app.Workspace.instance().getLoadedFile(a.param.entityUID),null==b&&(b={x_name:"Entity"},b.uid=a.param.entityUID,f.app.Workspace.instance().loadFile(b,this)));null!=a.param.formUID&&(b=f.app.Workspace.instance().getLoadedFile(a.param.formUID),null==b&&(b={x_name:"EntityForm"},b.uid=a.param.formUID,f.app.Workspace.instance().loadFile(b,this)));null!=
a.param.pageUID&&(b=f.app.Workspace.instance().getLoadedFile(a.param.pageUID),null==b&&(b={x_name:"QueryPage"},b.uid=a.param.pageUID,f.app.Workspace.instance().loadFile(b,this)))};this.loadRequiredFile=function(a){for(var b in a)null!=f.app.Workspace.instance().getLoadedFile(b)&&delete a[b];var e=!1,g;for(b in a)e=!0,g={x_name:a[b]},g.uid=b,f.app.Workspace.instance().loadFile(g,this,new wos.events.AsyncOption("LoadRequiredFile",b));return e};this.getAllRule=function(){var a=[],b;null!=this.entityXml&&
(b=this.entityXml.children("relation")[0],js.isNull(b)||a.push(b));null!=this._queryXml&&(b=this._queryXml.children("editState")[0],js.isNull(b)||a.push(b));return a};this.load=function(a){this.unloadedFile=this.$class.getRequiredFile(a);if(!this.loadRequiredFile(this.unloadedFile)&&!0!=this._loaded&&this.isRendered()){var b;b=a.xpath("conditionForm/Window")[0];!js.isNull(b)&&0<b.children().length&&this.conditionForm.generateForm(b);null!=this._condition&&this.conditionForm.setEntity(this._condition);
this.ctxMenuData.menuitem.length=0;this.systemButtons.length=0;!0==this.formMode()&&null!=this.form&&this.conditionForm.isEmpty()||this.systemButtons.push(this.refreshButton);this.conditionForm.isEmpty()||this.systemButtons.push(this.resetButton);"true"==a.attr("editable")&&!0!=this.formMode()&&this.systemButtons.push(this.saveButton);this.isMultiSelectable="true"==a.attr("multiselect");this.ontimeEdit="true"==a.attr("editable");this.entityXml=null;var e=a.xpath("queryEntities/Entity"),g;for(g=0;g<
e.length;g++)if(b=e[g],"true"==b.attr("master")){this.entityXml=b;break}null==this.entityXml&&(this.entityXml=a.xpath("queryEntities/Entity")[0]);js.isNull(this.entityXml)||(this.entityXml=f.app.Workspace.instance().getLoadedFile(this.entityXml.attr("uid")));js.isNull(this.entityXml)?this.entityXml=new f.Xml("\x3cEntity /\x3e"):wos.Remoting.call("WorkshopService.getEntityItem",[parseInt(this.entityXml.attr("nodeID")),"ReportGroup"],this,new wos.events.AsyncOption("getPrintList"));this.actionMap={};
var e=a.xpath("toolbar/button"),k,m,n=this.toolButtons.length=0;for(g=0;g<e.length;g++){b=e[g];m=Math.uuid();k={};k.uid=m;k.xml=b;k.label=b.attr("label");k.toolTip=b.attr("toolTip");k.action=b.attr("action");k.alink=b.attr("alink");k.event=b.attr("event");k.cmd=b.attr("cmd");k.selection=b.attr("selection");k.permission=b.attr("permission");k.confirmMessage=b.attr("confirmMessage");"false"==b.attr("visiable")?k.visible=!1:n++;if("null"==k.toolTip||"undefined"==k.toolTip)k.toolTip="";"customerALink"==
k.action&&(k.action="alink");var l="";null!=this._page?l=this._page.application().name():null!=this._form&&(l=this._form.application().name());k.enabled=wos.PermissionUtil.instance().hasPermission(l,k.permission);if(null==k.selection||""==k.selection)k.selection="single";"true"==b.attr("defaultAction")&&(this.defaultActionButton=k);"delete"==k.action?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/delete.png"):"insert"==k.action?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/add.png"):"alink"==k.action&&
(b=wos.ALink.parseALink(k.alink),null!=b&&null!=b.param&&(js.isEmpty(k.icon)&&("create"==b.param.action?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/entity_add.png"):"edit"==b.param.action?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/entity_edit.png"):"view"==b.param.action?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/entity_form.png"):"WorkflowTask"==b.form?k.icon=wos.Desktop.getAbsoluteUrl("images/icons/task_start.png"):"TaskForm"==b.form&&(k.icon=wos.Desktop.getAbsoluteUrl("images/icons/task_form.png"))),
this.preloadALink(b)));this.toolButtons.push(k);"single"!=k.selection&&"multi"!=k.selection||this.ctxMenuData.menuitem.push(k);this.actionMap[m]={button:k}}!0==this.formMode()&&null!=this._parentField&&this.pushAddtionalCondition(5,!1,this.entityXml.attr("name"),this._parentField+"_id","$form.this.id","val",3);0==this.systemButtons.length?this.systemBar.visible(!1):this.systemBar.visible(!0);0==n?this.toolBar.visible(!1):this.toolBar.visible(!0);0==n&&1>=this.systemButtons.length?this.bar.visible(!1):
this.bar.visible(!0);this.systemBar.dataProvider(this.systemButtons);this.toolBar.dataProvider(this.toolButtons);if(!0==this._enabled)for(e=this.toolBar.children().toArray(),g=0;g<e.length;g++)!1==this.toolButtons[g].enabled?e[g].enabled(!1):e[g].enabled(!0);this._ruleManager=new f.app.EntityRuleManager(this.entityXml,this.getAllRule(),this,this._expParser);this._ruleManager.onlyCalculateValueExpression=!0;this._ruleManager.onReady();b=a.children("DataGrid")[0];js.isNull(b)||this.dgResult.load(b,
a.xpath("xmlQuery/select")[0],this.isMultiSelectable,this.ontimeEdit);"true"==a.attr("autopaging")?this.autopaging(!0):this.autopaging(!1);this._loaded=!0;this.dispatchEvent(this.$class.LOADED_EVENT);this.editable(this._editable);this.ontimeEdit||!0!=this._autopaging?this.gridNav.canVirtualizePaging(!1):("false"==this._queryXml.attr("virtualizingPagingEnabled")?this.gridNav.canVirtualizePaging(!1):this.gridNav.canVirtualizePaging(!0),"VirtualizingPaging"==this._queryXml.attr("pagingMode")&&(this.gridNav.pagingMode(f.app.query.DataGridNavigator.VIRTUALIZING_PAGING),
this.setDataView(!0)));!0==this._formMode&&this.invalidateSize(!0);if(!0!=this._formMode||null==this._form||!0==this._form.getProperty(f.app.FormWindow.PROP_INITIALIZED))this.fireQueryEvent("initialize"),!this.isMultiSelectable||js.isNull(this._openALink)||js.isNull(this._openALink.param)||js.isNull(this._openALink.param.labelField)||""==this._openALink.param.labelField||"EntitySelectWindow"!=this._openALink.form||this._openALink.param.entityUID!=this.entityXml.attr("uid")||(a=this._openALink.param.labelField,
g=this.entityXml.xpath("property[@name \x3d '"+a+"']")[0],js.isNull(g)?this.selectedEntityLabelField=a:(g=g.attr("type"),this.selectedEntityLabelField="relation"==g?a+"_label":"principal"==g?a+"_name":a),this._selectedPanelMode=!0,this.selectedPanel.visible(!0),this.lstSelectedRecords.dataProvider(this.selectedRecords),this.autoClearSelection=!1,this.invalidateSize(!0))}};this.onSystemButtonClick=function(a,b){!0!=this._designmode&&this.doSystemAction(b.data)};this.doSystemAction=function(a){switch(a.action){case "refresh":if(!0==
this.ontimeEdit&&!0==this.modified()){f.ui.MessageBox.show("\u5f53\u524d\u9875\u9762\u6570\u636e\u5c1a\u672a\u4fdd\u5b58\uff0c\u662f\u5426\u73b0\u5728\u4fdd\u5b58?","\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.savePageHandler,this);this.nextPage=0;break}this.groupingProvider=null;!0==this.autoClearSelection&&(this.selectedRecords_clear(),this.dgResult.setSelectedRows([]));!0!=this.isInitializedOK?this.fireQueryEvent("initialize"):this.canQueryExecute()&&this.fireQueryEvent("preQuery");break;case "save":this.dgResult.commitCurrentEdit();
this.fireQueryEvent("preSave");break;case "reset":this.conditionForm.setEntity(null);break;case "export":this.do_export()}};this.onConditionKeyDown=function(a){if(13==(a.keyCode?a.keyCode:a.which))this.onRefresh()};js.$public.onRefresh=function(){this.groupingProvider=null;!0!=this._designmode&&this._loaded&&(!0!=this.isInitializedOK?this.fireQueryEvent("initialize"):this.canQueryExecute(!1)&&this.fireQueryEvent("preQuery"))};js.$public.fireQueryEvent=function(a,b,e){b=js.param(b,null);e=js.param(e,
null);if(null!=this._queryXml&&!0!=this._designmode){var g=this._queryXml.xpath('queryEvent/event[@name \x3d "'+a+'"]')[0],k=null;js.isNull(g)||(k=g.text());if(null!=k&&""!=k){if("initialize"==a){if(!0==this.isInitializing||null!=this._form&&!0==this.formMode()&&!0!=this._form.getProperty(f.app.FormWindow.PROP_INITIALIZED))return;this.isInitializing=!0}wos.script.ScriptProxy.asyncExecute(this,k,b,new wos.events.AsyncOption(a,e))}else this.eventFinished(a,null,new wos.events.AsyncOption(a,e))}};this.onScriptExecuteFinished=
function(a,b){if("sqlScript"==a.option.asyncName){var e=null,e=f.app.XmlQuery.getSelectList(this._queryXml.children("xmlQuery")[0],this.database);"string"==js.type(a.result)?(this.autopaging(!1),this.querySql=a.result,this.querySql=this.querySql.replace("${selectList}",e),wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),this.querySql,0,1E3],this,new wos.events.AsyncOption("SQLResult"))):null!=a.result&&null!=a.result.querySql?(this.querySql=a.result.querySql,this.querySql=
this.querySql.replace("${selectList}",e),null!=a.result.countSql?(this.autopaging(!0),e=a.result.countSql,wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),e,0,1],this,new wos.events.AsyncOption("SQLCount"))):wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),this.querySql,0,1E3],this,new wos.events.AsyncOption("SQLResult"))):f.ui.MessageBox.show("SQL\u751f\u6210\u811a\u672c\u8fd4\u56de\u9519\u8bef\uff0c\u5fc5\u987b\u8fd4\u56deSQL\u6587\u672c\u6216\u62e5\u6709querySql\u548ccountSql\u7684\u5bf9\u8c61\u3002")}else this.eventFinished(a.option.asyncName,
a.result,a.option)};this.eventFinished=function(a,b,e){e=js.param(e,null);if(null!=b&&b.hasOwnProperty("error")&&!0==b.error)this.updateEntities.length=0,this.createEntities.length=0,this.instructions.length=0,null!=b.message&&""!=b.message&&f.ui.MessageBox.show(b.message,"\u9519\u8bef"),"initialize"==a&&(this.isInitializing=this.isInitializedOK=!1);else if("initialize"==a)if(this.isInitializedOK=!0,this.isInitializing=!1,e=!0,null!=b&&b.hasOwnProperty("refreshNow")&&!1==b.refreshNow&&(e=!1),null!=
this._form&&!0==this.formMode()){if(!0==this._form.getProperty(f.app.FormWindow.PROP_INITIALIZED)&&"create"!=this._form.getProperty(f.app.FormWindow.PROP_SUBMIT_ACTION)&&js.instanceOf(this._form,f.app.FormWindow)&&(b=this._form.getEntity(),null!=b&&0<parseInt(b.id)&&0==this._valueList.length&&e))this.onRefresh()}else{if(e)this.onRefresh()}else if("preSave"==a)this.saveEntities();else if("preQuery"==a)this.refresh();else if("postQuery"==a)a=null,"array"==js.type(b)?a=b:js.isNull(b)||"array"!=js.type(b.recordSet)||
(a=b.recordSet),b=!1,null==e||js.isNull(e.asyncData)||!e.asyncData.IsInGrouping||js.isNull(this.groupingProvider)||(this.groupingProvider.setQueryResult(a,e),this.dgResult.invalidate(),b=!0),b||js.isNull(a)||this.setQueryResult(a,e);else if("preInsert"==a)e=b,null==e&&(e={},b=this._ruleManager.defaultEntity(),null!=b&&null!=this.entityXml&&(e[this.entityXml.attr("name")]=b)),e=this.restoreRecord(e),e.$modified$=!0,this.data_append(e),this.dgResult.invalidate(),this.dgResult.selectedItem(e);else if("onExport"==
a)this.onExport(b);else if("delete"==a||"preDelete"==a)!0==this.ontimeEdit||!0==this.formMode()?this.deleteEntity(this.getSelectedRecords(!0)):null!=b&&null!=b.entityName?this.deleteEntityImmediately(this.getSelectedRecords(!0),b.entityName):this.deleteEntityImmediately(this.getSelectedRecords(!0))};js.$public.updateEntity=function(a,d){var e=null;if(null==d||""==d||"undefined"==d)d=a.$type$;if(null==d||""==d||"undefined"==d)d=this.entityXml.attr("name");if(!0==this.ontimeEdit)if(d==this.entityXml.attr("name")){var g=
d+f.app.XmlQuery.NAME_SPLIT+"id";if(this.isDataView)for(var g=this.dataView.findItems(g,a.id),k=0;k<g.length;k++)e={},e[d]=a,e=this.restoreRecord(e),e.$modified$=!0,b.copy(e,this.dataView.getItem(k)),this.dgResult.invalidateRow(k);else for(k=0;k<this.recordResult.length;k++)if(e=this.recordResult[k],e[g]==a.id){e={};e[d]=a;e=this.restoreRecord(e);e.$modified$=!0;b.copy(e,this.recordResult[k]);this.dgResult.invalidateRow(k);break}}else{delete a.$type$;delete a.$selected$;delete a.$modified$;for(k=
0;k<this.updateEntities.length;k++)if(this.updateEntities[k].entityName==d&&this.updateEntities[k].entity.id==a.id){e=this.updateEntities[k];break}null!=e?b.copy(a,e.entity):this.updateEntities.push({entity:a,entityName:d})}};js.$public.createEntity=function(a,b){if(null==b||""==b||"undefined"==b)b=a.$type$;if(null==b||""==b||"undefined"==b)b=this.entityXml.attr("name");if(!0==this.ontimeEdit)if(null==a.id&&(a.id="$"+Math.uuid()),b==this.entityXml.attr("name")){var e={};e[b]=a;e=this.restoreRecord(e);
e.$modified$=!0;this.data_append(e);this.dgResult.invalidate()}else delete a.$type$,delete a.$selected$,delete a.$modified$,this.createEntities.push({entity:a,entityName:b})};js.$public.insertRecord=function(a,b){b=js.param(b,-1);if(!0==this.ontimeEdit){for(var e in a)null==a[e].id&&(a[e].id="$"+Math.uuid());e=this.restoreRecord(a);e.$modified$=!0;0>b||b>=this.data_length()?this.data_append(e):this.data_insert(b,e);this.dgResult.invalidate()}};js.$public.deleteRecordAt=function(a){0<=a&&a<this.dgResult.getDataLength()&&
(!0==this.ontimeEdit||!0==this.formMode()?this.deleteEntity([this.data_getItem(a)]):this.deleteEntityImmediately([this.data_getItem(a)]))};js.$public.addInstruction=function(a){this.instructions.push(a)};this.deleteEntity=function(a,b){b=js.param(b,null);null==b&&(b=this.entityXml.attr("name"));for(var e,f=a.length-1;0<=f;f--)e=this.getRecordEntity(a[f],b),null!=e&&null!=e.id&&0<Number(e.id)&&this.deleteEntities.push({entity:e,entityName:b}),this.deleteRecord(a[f]);this.dgResult.invalidate()};this.deleteRecord=
function(a){this.data_remove(a);a=this.getSelectedRecordItem(a);null!=a&&this.selectedRecords_remove(a);this.dgResult.invalidate()};this.deleteEntityImmediately=function(a,b){b=js.param(b,null);null==b&&(b=this.entityXml.attr("name"));var e;1<a.length&&wos.Remoting.beginBatchCall(!0);for(var f=a.length-1;0<=f;f--)e=this.getRecordEntity(a[f],b),null!=e&&null!=e.id?wos.Remoting.call("DynamicEntityService.removeEntity",[e.id,b,null],this,new wos.events.AsyncOption("removeEntity",{entity:e,index:this.data_indexOf(a[f])})):
this.deleteRecord(a[f]);1<a.length&&wos.Remoting.endBatchCall()};this.getRecordMap=function(a){var b,e,g={},k,m=this.entityXml.attr("name");g.$masterEntity={$type$:m};for(b in a)e=a[b],k=f.app.XmlQuery.splitRecordKey(b),2!=k.length?g[b]=e:(null==g[k[0]]&&(g[k[0]]={$type$:k[0]}),g[k[0]][k[1]]=e,k[0]==m&&(g.$masterEntity[k[1]]=e));return g};this.restoreRecord=function(a){var b={},e,g,k;for(k in a)if(e=a[k],g=js.type(e),"string"==g||"boolean"==g||"date"==g||"number"==g)b[k]=e;else for(var m in e)b[k+
f.app.XmlQuery.NAME_SPLIT+m]=e[m];return b};this.getRecordAt=function(a){return 0<=a&&a<this.dgResult.getDataLength()?this.getRecordMap(this.data_getItem(a)):null};this.setRecordAt=function(a,d){a.$modified$=!0;this.dgResult.getDataLength()>d&&b.copy(this.restoreRecord(a),this.data_getItem(d));this.dgResult.invalidateRow(d)};this.getEntityAt=function(a,b){if(null==a||""==a||"undefined"==a)a=this.entityXml.attr("name");return this.dgResult.getDataLength()>b?this.getRecordEntity(this.data_getItem(b),
a):null};this.setEntityAt=function(a,d,e){if(null==d||""==d||"undefined"==d)d=this.entityXml.attr("name");if(!(0>e||e>=this.dgResult.getDataLength())){var f={};f[d]=a;a=this.restoreRecord(f);a.$modified$=!0;b.copy(a,this.data_getItem(e));this.dgResult.invalidateRow(e)}};this.getContextObject=function(){var a=this.getSelectedRecords();return 0==a.length?{}:1==a.length?a[0]:a};js.$public.getSelectedRecords=function(a){a=js.param(a,!1);var b=[];if(!0==this.isMultiSelectable){if(!1==a)return this.selectedRecords;
if(this.isDataView)b=this.dataView.findItems("$selected$",!0);else{a=this.dgResult.getSelectedRows();for(var e=0;e<a.length;e++)b.push(this.data_getItem(a[e]))}}else null!=this.dgResult.selectedItem()&&(!0==a?b.push(this.dgResult.selectedItem()):b.push(this.getRecordMap(this.dgResult.selectedItem())));return b};this.getSelectedIndexes=function(){return this.isDataView?this.dataView.findItemIndexes("$selected$",!0):this.dgResult.getSelectedRows()};js.$public.getAllRecords=function(){for(var a=[],b=
0;b<this.data_length();b++)a.push(this.getRecordMap(this.data_getItem(b)));return a};this.clearSelection=function(){this.selectedRecords_clear();if(this.isDataView)for(var a=this.dataView.findItems("$selected$",!0),b=0;b<a.length;b++)delete a[b].$selected$;else for(b=0;b<this.recordResult.length;b++)delete recordResult[b].$selected$;this.dgResult.setSelectedRows([])};js.$public.getSelectedEntities=function(a){a=js.param(a,null);null==a&&(a=this.entityXml.attr("name"));var b=[],e;if(!0==this.isMultiSelectable)for(var f=
0;f<this.selectedRecords.length;f++)e=this.selectedRecords[f][a],null!=e&&b.push(e);else null!=this.dgResult.selectedItem()&&(e=this.getRecordEntity(this.dgResult.selectedItem(),a),null!=e&&b.push(e));return b};this.onRemoveSelectedRecord=function(a){if(!js.isNull(a)){delete a.$selected;var b=a.$raw_record$;js.isNull(b)||delete b.$selected$;this.selectedRecords_remove(a);if(!0==this.isMultiSelectable){a=this.dgResult.getSelectedRows();for(var e=[],f=0;f<a.length;f++)b=this.data_getItem(a[f]),this.isSelectedRecord(b)&&
(b.$selected$=!0,e.push(a[f]));this.dgResult.setSelectedRows(e)}}};js.$public.getAllEntities=function(a){a=js.param(a,null);null==a&&(a=this.entityXml.attr("name"));for(var b=[],e,f=0;f<this.data_length();f++)e=this.getRecordEntity(this.data_getItem(f),a),null!=e&&b.push(e);return b};js.$static.parseRecordName=function(a){var b=a.indexOf(f.app.XmlQuery.NAME_SPLIT);return-1==b?[a]:[a.substr(0,b),a.substr(b+1)]};js.$public.getRecordEntity=function(a,b){b=js.param(b,null);if(null==a)return{};null==b&&
null!=this.entityXml&&(b=this.entityXml.attr("name"));var e,g={};g.$type$=b;if(null!=this.hyperlinkColumn&&!js.isNull(this.hyperlinkColumn.propXml)&&"relation"==this.hyperlinkColumn.propXml.attr("type")&&!js.isNull(this.hyperlinkColumn.propXml.parent())){e=this.hyperlinkColumn.propXml;var k=f.app.Workspace.instance().getLoadedFile(e.attr("entityUID"));if(!js.isNull(k)&&k.attr("name")==b){var m=e.parent().attr("name")+f.app.XmlQuery.NAME_SPLIT+e.attr("name")+"_id";g.id=a[m];return g}}for(m in a)e=
a[m],k=this.$class.parseRecordName(m),k[0]==b&&(g[k[1]]=e);return g};this.modified=function(){if(this.isDataView){if(0<this.dataView.findItems("$modified$",!0).length)return!0}else for(var a=0;a<this.recordResult.length;a++)if(!0==this.recordResult[a].$modified$)return!0;return 0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length||0<this.deleteEntities.length?!0:!1};this.saveEntities=function(){if(!1!=this.modified()){var a,b=0;for(a=0;a<this.recordResult.length;a++)!0==
this.recordResult[a].$modified$&&b++;b+=this.updateEntities.length;b+=this.createEntities.length;b+=this.instructions.length;b+=this.deleteEntities.length;if(0==b)this.onEntitiesSaved();else{wos.Remoting.beginBatchCall(!0);for(a=0;a<this.recordResult.length;a++)if(b=this.recordResult[a],!0==b.$modified$){b=this.getRecordEntity(b);delete b.$type$;delete b.$selected$;delete b.$modified$;var e=b.id,f;null!=e&&(f=parseInt(e));null!=e&&!isNaN(f)&&0<f?wos.Remoting.call("DynamicEntityService.modifyEntity",
[this.entityXml.attr("name"),b,null],this):(delete b.id,wos.Remoting.call("DynamicEntityService.createEntity",[this.entityXml.attr("name"),b,null],this))}for(a=0;a<this.updateEntities.length;a++)wos.Remoting.call("DynamicEntityService.modifyEntity",[this.updateEntities[a].entityName,this.updateEntities[a].entity,null],this);for(a=0;a<this.createEntities.length;a++)wos.Remoting.call("DynamicEntityService.createEntity",[this.createEntities[a].entityName,this.createEntities[a].entity,null],this);for(a=
0;a<this.instructions.length;a++)wos.Remoting.call("DynamicEntityService.executeInstruction",[this.instructions[a]],this);for(a=0;a<this.deleteEntities.length;a++)b=this.deleteEntities[a].entity,wos.Remoting.call("DynamicEntityService.removeEntity",[b.id,this.deleteEntities[a].entityName,null],this,new wos.events.AsyncOption("removeEntity",b));wos.Remoting.endBatchCall(this,new wos.events.AsyncOption("saveEntities"))}}};this.onEntitiesSaved=function(){this.dispatchEvent(this.$class.SAVED_EVENT);for(var a=
0;a<this.recordResult.length;a++)delete this.recordResult[a].$modified$;this.updateEntities.length=0;this.createEntities.length=0;this.instructions.length=0;this.deleteEntities.length=0;this.refresh()};this.onCopy=function(a,b){for(var e,g=this.entityXml.attr("name")+f.app.XmlQuery.NAME_SPLIT+"id",k=this.entityXml.attr("name")+f.app.XmlQuery.NAME_SPLIT+this._parentField+"id",m=0;m<this.data_length();m++)e=this.data_getItem(m),e.$modified$=!0,e[g]="$"+Math.uuid(),!0==this._formMode&&null!=this._parentField&&
delete e[k]};this.onRemotingCallback=function(a){var b;switch(a.option.asyncName){case "saveEntities":this.onEntitiesSaved();break;case "QueryService.getResultCount":this.cb_getResultCount(a.result);break;case "QueryService.executeStatQuery":this.cb_executeStatQuery(a.result,a.option);break;case "QueryService.executeQuery":b=a.result;null==b||"string"==js.type(b[0])&&0==String(b[0]).indexOf("\x3chead\x3e")||(this.recordSetHeadXml=this._queryXml.xpath("xmlQuery/select")[0].copy(),this.recordSetHeadXml.name("head"));
this.cb_executeQuery(a.result,a.option);break;case "SQLResult":this.cb_getSQLResult(a.result,a.option);break;case "SQLCount":this.cb_getSQLCount(a.result);break;case "removeEntity":null!=a.option.asyncData.index&&this.deleteRecord(this.data_getItem(a.option.asyncData.index));wos.Desktop.instance().dispatchEvent("ime.DynamicEntity",{action:"delete",param:a.option.asyncData.entity});!this.isDataView&&!js.isNull(this.recordSetHeadXml)&&1<this.recordSetHeadXml.children().length&&(this.gridNav.recalc(this.gridNav.getTotalRow()-
1,this.getPageSize()),this.gridNav.refresh());this.fireQueryEvent("postDelete",{entities:[a.option.asyncData.entity]});break;case "RemoteCallback":null!=a.option.asyncData&&this.cb_RemoteCall(a.option.asyncData,a.result);break;case "getPrintList":this.cb_getPrintList(a.result)}};this.cb_RemoteCall=function(a,d){if(null!=d&&null!=d.$jsResult){var e=wos.expression.ExpressionFunction.eval(d.$jsResult);null!=e&&b.copy(e,d)}this.fireQueryEvent(a,{result:d})};this.cb_getPrintList=function(a){js.isNull(a)};
this.getPageSize=function(){var a=this.dgResult.outerSize(),b=this.dgResult.options(),a=Math.floor((a.height-b.headerRowHeight)/b.rowHeight);0>a&&(a=20);return a};this.cb_getSQLCount=function(a){var b=this.dgResult.selectedItem();this._lastSelectedItem=b;this._lastSelectedIndex=this.dgResult.selectedIndex();js.isNull(b)||(this.dgResult.selectedItem(null),this.onSelectChange(null));0<this.recordResult.length&&(this.recordResult.length=0);a=a[0];!0==this.ontimeEdit?this.gridNav.recalc(a,a):this.gridNav.recalc(a,
this.getPageSize());this.isDataView?this.dataView.count(a):0<a&&this.gridNav.goPage(0);0==a&&this.fireQueryEvent("postQuery",{recordSet:[]})};this.cb_getResultCount=function(a){var b=this.dgResult.selectedItem();this._lastSelectedItem=b;this._lastSelectedIndex=this.dgResult.selectedIndex();js.isNull(b)||(this.dgResult.selectedItem(null),this.onSelectChange(null));0<this.recordResult.length&&(this.recordResult.length=0,this.dgResult.invalidate());!1==this.autopaging?this.gridNav.recalc(a,a):this.gridNav.recalc(a,
this.getPageSize());js.isNull(this.groupingProvider)?(this.isDataView?this.dataView.count(a):0<a&&this.gridNav.goPage(0),0==a&&this.fireQueryEvent("postQuery",{recordSet:[]})):this.groupingProvider.refresh(this._queryXml,this.addtionalCondition,this.condition())};this.onPageChanged=function(a,b){if(!0!=this.formMode()||"create"!=this._form.getProperty(f.app.FormWindow.PROP_SUBMIT_ACTION))if(!0==this.ontimeEdit&&!0==this.modified())f.ui.MessageBox.show("\u5f53\u524d\u9875\u9762\u6570\u636e\u5c1a\u672a\u4fdd\u5b58\uff0c\u662f\u5426\u73b0\u5728\u4fdd\u5b58?",
"\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.savePageHandler,this),this.nextPage=b.pageNo;else{var e=this.gridNav.getPageRow(),g=this.condition();this.prepareForServerValue(g);null!=this.querySql?wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),this.querySql,b.pageNo*e,e],this,new wos.events.AsyncOption("SQLResult")):wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),this.addtionalCondition,g,b.pageNo*e,e],this);this.currentPage=a.pageNo}};this.savePageHandler=
function(a){if(a==f.ui.MessageBox.Yes)this.doAction({action:"save"}),this.gridNav.goPage(this.currentPage,!1);else if(a==f.ui.MessageBox.No){a=this.gridNav.getPageRow();var b=this.condition();this.prepareForServerValue(b);null!=this.querySql?wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),this.querySql,this.nextPage*a,a],this,new wos.events.AsyncOption("SQLResult")):wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),this.addtionalCondition,b,this.nextPage*
a,a],this)}else this.gridNav.goPage(this.currentPage,!1)};js.$public.getEntityProperty=function(a,b){for(var e=this._queryXml.xpath("queryEntities/Entity"),g,k=0;k<e.length;k++)if(g=e[k],g.attr("name")==a)return g=f.app.Workspace.instance().getLoadedFile(g.attr("uid")).xpath("property[@name \x3d '"+b+"']")[0];return null};this.cb_executeQuery=function(a,b){b=js.param(b,null);var e=f.app.XmlQuery.convertResultSet(a,this.recordSetHeadXml);if(null!=e){var g=this._queryXml.xpath('queryEvent/event[@type \x3d "postQuery"]')[0];
null!=g&&0<StringUtil.trim(g.text()).length?null!=b?this.fireQueryEvent("postQuery",{recordSet:e},b.asyncData):this.fireQueryEvent("postQuery",{recordSet:e}):this.setQueryResult(e,b)}};this.cb_executeStatQuery=function(a,b){js.param(b,null);if("array"==js.type(a)&&0!=a.length){var e=a[0];if("array"==js.type(e)&&0!=e.length){var f=this._queryXml.xpath("StatSetting/Stat");if(e.length==f.length+1){var k=NumberUtil.toInt(e[0]);this.cb_getResultCount(k);for(var k=0,m="",n,l,q,s=0;s<f.length;s++)if(q=f[s],
k++,n=q.text(),q=q.attr("stat_prop").split("."),q=this.getEntityProperty(q[0],q[1]),!js.isNull(q)&&!js.isNull(e[k])){l=e[k];if("long"==q.attr("type")&&"true"==q.attr("currency"))l/=100;else if("double"==q.AttributeValue("type")){var r=NumberUtil.toNumber(l);isNaN(r)||("true"==q.attr("currency")?l=r:(l=q.attr("fraction"),l=""==l?2:parseInt(l),isNaN(l)&&(l=2),l=r.toFixed(l)))}if(js.isNull(n)||""==n)n=q.attr("label")+" : ${stat_value} ";n=n.replace("${stat_value}",l);m+=n+" "}this.gridNav.statusHtml(m)}}}};
this.cb_getSQLResult=function(a,b){b=js.param(b,null);this.recordSetHeadXml=this._queryXml.xpath("xmlQuery/select")[0].copy();this.recordSetHeadXml.name("head");var e=f.app.XmlQuery.convertResultSet(a,this.recordSetHeadXml);if(null!=e){var g=this._queryXml.xpath('queryEvent/event[@type \x3d "postQuery"]')[0];null!=g&&0<StringUtil.trim(g.text()).length?null!=b?this.fireQueryEvent("postQuery",{recordSet:e},b.asyncData):this.fireQueryEvent("postQuery",{recordSet:e}):this.setQueryResult(e,b)}};js.$public.editable=
function(a){var b;for(b=0;b<this.systemButtons.length;b++)"save"==this.systemButtons[b].action&&(this.systemBar.children().get(b).enabled(a),this.systemButtons[b].enabled=a);for(b=0;b<this.toolButtons.length;b++)this.toolBar.children().get(b).enabled(this._enabled&&a&&this.toolButtons[b].enabled),this.toolButtons.enabled=a&&this.toolButtons[b].enabled;this._editable=a;this.dgResult.editable(a)};this.onDoubleClick=function(a){0!=l(a.target).closest(".slick-cell",this._$element).length&&null!=this.defaultActionButton&&
this.doAction(this.defaultActionButton)};js.$public.updateSelectionRecord=function(a,b){if(!js.isNull(a)&&this.isMultiSelectable){var e=this.getRecordMap(a);delete e.$selected$;for(var f=0;f<this.selectedRecords.length;f++)if(this.isRecordEquals(e,this.selectedRecords[f])){this.selectedRecords_removeAt(f);break}!0==b?(js.isNull(this._openALink)||js.isNull(this._openALink.param)||js.isNull(this._openALink.param.labelField)||""==this._openALink.param.labelField||"EntitySelectWindow"!=this._openALink.form||
this._openALink.param.entityUID!=this.entityXml.attr("uid")||(f=e[this.entityXml.attr("name")],js.isNull(f)||(e.Label=f[this.selectedEntityLabelField]),e.$raw_record$=a),this.selectedRecords_add(e)):delete a.$selected$}};this.onSelectChange=function(a){if(null!=this._page)this._page.onPropertyChange(this,this.$class.PROP_SELECTED_ITEM,this.dgResult.selectedItem());a={};null!=this.dgResult.selectedItem()&&(a=this.getRecordMap(this.dgResult.selectedItem()));this.fireQueryEvent("selectedChange",{record:a})};
this.onToolButtonClick=function(a,b){this.doAction(b.data)};this.validateSelection=function(a,b){return"none"!=a&&null==this.dgResult.selectedItem()&&0==b.length?(f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u64cd\u4f5c\u3002","\u63d0\u793a"),!1):!0};this.doAction=function(a){var b,e={};b=null;var g=this.getSelectedEntities(b);if("save"==a.action&&!0==this.ontimeEdit)!0==this.validateEditInput(!0)&&!0!=this.formMode()&&this.saveEntities();else if("export"==a.action)!0==
this.validateEditInput(!0)&&this.do_export();else if("import"==a.action)this.excelImport();else if("selectAll"==a.action&&!0==this.ontimeEdit){for(a=0;a<this.data_length();a++)this.data_getItem(a).$selected$=!0;this.dgResult.selectAll(!0)}else if("insert"==a.action&&!0==this.ontimeEdit)a={},b=this._ruleManager.defaultEntity(),null!=b&&null!=this.entityXml&&(a[this.entityXml.attr("name")]=b),this.fireQueryEvent("preInsert",{record:a});else if("delete"==a.action)0==this.getSelectedEntities().length?
f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u6240\u8981\u5220\u9664\u7684\u8bb0\u5f55\u3002","\u63d0\u793a"):f.ui.MessageBox.show("\u60a8\u786e\u4fe1\u9700\u8981\u5220\u9664\u5f53\u524d\u6240\u9009\u8bb0\u5f55\u5417\uff1f","\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.onDeleteEntity,this);else if("report"==a.action)if(e=null,null!=a.xml&&a.xml.has("entityUID")&&(e=a.xml.attr("entityUID")),b=null,null!=e&&""!=e&&(e=this._queryXml.xpath('xmlQuery/select/Entity[@uid \x3d "'+e+'"]')[0],js.isNull(e)||(b=
e.attr("name"))),b=this.getSelectedEntities(b)[0],js.isNull(b))f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u64cd\u4f5c\u3002","\u63d0\u793a");else{var k;null!=a.xml&&a.xml.has("openMode")&&(k=a.xml.attr("openMode"));if(null!=a.reportUID)g=a.reportUID;else if(null!=a.xml&&a.xml.has("reportUID"))g=a.xml.attr("reportUID");else{f.ui.MessageBox.show("\u672a\u6307\u5b9a\u62a5\u8868\u7c7b\u578b\u3002","\u9519\u8bef");return}var m=new f.app.PageWindow;m.parentPage(this._page);
m.opener(this);null!=this._page?m.application(this._page.application()):null!=this._form&&m.application(this._form.application());e={form:"Report"};e.param={reportUID:g,entityXml:this.entityXml,entity:b,title:a.title,openMode:k};if(null==e.param.title||""==e.param.title)e.param.title=a.label;m.open(e,this)}else if("alink"==a.action&&"string"==js.type(a.alink)&&0==a.alink.indexOf("alink"))if(k=a.alink,e=wos.ALink.parseALink(k),null==e)f.ui.MessageBox.show("\u547d\u4ee4\u683c\u5f0f\u9519\u8bef\uff1a"+
k,"\u9519\u8bef");else{if(null==e.param&&(e.param={}),null==e.param.entityUID&&(e.param.entityUID=this.entityXml.attr("uid")),g=f.app.Workspace.instance().getLoadedFile(e.param.entityUID),null!=g&&(b=g.attr("name")),e.param.entityName=b,g=this.getSelectedEntities(),null==a.selection||""==a.selection||"none"==a.selection||this.validateSelection(a.selection,g))"ime.AppWindow"==e.target?this.alinkHandler(e):(e.param.$winEnv={$opener:this},b=this.getSelectedEntities()[0],e.param.ctxEntity=b,e.param.ctx=
this.getContextObject(),wos.Desktop.openALink("ime.AppWindow",k,e.param))}else if("fireEvent"==a.action&&null!=a.event){if(null==a.selection||""==a.selection||"none"==a.selection||this.validateSelection(a.selection,g))null!=a.confirmMessage&&""!=a.confirmMessage&&"undefined"!=a.confirmMessage&&"null"!=a.confirmMessage?(this.confirmEvent=a.event,f.ui.MessageBox.show(a.confirmMessage,"\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.onEventConfirmed,this)):this.fireQueryEvent(a.event)}else"other"==a.action&&
null!=a.cmd?(null==a.selection||""==a.selection||"none"==a.selection||this.validateSelection(a.selection,g))&&this._expParser.calculate(a.cmd):f.ui.MessageBox.show("\u4e0d\u652f\u6301\u7684\u547d\u4ee4\u683c\u5f0f\uff1a"+a.action,"\u9519\u8bef")};this.onDeleteEntity=function(a){a==f.ui.MessageBox.Yes&&(a=this.getSelectedEntities(this.entityXml.attr("name")),this.fireQueryEvent("preDelete",{entities:a}))};this.onFileLoaded=function(a){var b=a.fileXml;switch(a.option.asyncName){case "LoadRequiredFile":delete this.unloadedFile[a.option.asyncData];
this.hasUnloadedFile()||this.load(this.queryXml());break;case "loadQuery":this.queryXml(b)}};js.$public.refresh=function(){if(null!=this._queryXml&&!0==this._loaded&&!0==this.isInitializedOK&&(!0!=this.formMode()||"create"!=this._form.getProperty(f.app.FormWindow.PROP_SUBMIT_ACTION)))if(!0==this.autoClearSelection&&(this.selectedRecords_clear(),this.dgResult.setSelectedRows([])),0<this._queryXml.xpath("xmlQuery/script").length){this.queryCondition=this.condition();this.prepareForServerValue(this.queryCondition);
var a=this._queryXml.xpath("xmlQuery/script")[0].text();wos.script.ScriptProxy.asyncExecute(this,a,{condition:this.queryCondition},new wos.events.AsyncOption("sqlScript"))}else if(this.queryCondition=this.condition(),this.prepareForServerValue(this.queryCondition),!1==this._autopaging)wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),this.addtionalCondition,this.queryCondition,0,500],this);else if(a=this._queryXml.xpath("StatSetting/Stat"),0<a.length){var b=[],e=[];b.push("count:*");
for(var g,k=0;k<a.length;k++)g=a[k],b.push("sum:"+g.attr("stat_prop")),""!=StringUtil.trim(g.attr("group_prop"))&&e.push(g.attr("group_prop"));wos.Remoting.call("QueryService.executeStatQuery",[this._queryXml.attr("uid"),this.addtionalCondition,this.queryCondition,b,e],this)}else wos.Remoting.call("QueryService.getResultCount",[this._queryXml.attr("uid"),this.addtionalCondition,this.queryCondition],this)};this.do_export=function(){this.fireQueryEvent("onExport")};this.encodeSql=function(a){return"$"+
wos.XXTEA.encrypt(a,"dioJse7s#hsrp")};this.onExport=function(a){var b=this.condition();this.prepareForServerValue(b);var e=null;0<this._queryXml.xpath("xmlQuery/script").length&&(e=this.encodeSql(this.querySql));var g;if("array"==js.type(a)){for(g=0;g<a.length;g++)a[g]=a[g].replace(".","$");g=this.dgResult.getColumnListXml()}else a=[],g=this.dgResult.getColumnListXml(a);var k=new f.app.query.QueryExportForm;k.setQueryDefinition(this._queryXml,g,a,b,this.addtionalCondition,e);k.showDialog()};this.excelImport=
function(){var a=new f.app.query.EntityImportForm;a.setEntityXml(this.entityXml);a.showDialog()};this.isRecordEquals=function(a,b){for(var e in a)if(null!=a[e]&&a[e].hasOwnProperty("id")){if(null==b[e]||!b[e].hasOwnProperty("id")||a[e].id!=b[e].id)return!1}else if(StringUtil.endWith(e,"$id")&&a[e]!=b[e])return!1;return!0};this.isSelectedRecord=function(a){return null!=this.getSelectedRecordItem(a)};this.getSelectedRecordItem=function(a){var b=this._queryXml.xpath("xmlQuery/select/Entity"),e;try{for(var g=
0;g<this.selectedRecords.length;g++){e=!0;for(var k=0;k<b.length;k++)if(null!=a[b[k].attr("name")+f.app.XmlQuery.NAME_SPLIT+"id"]&&null!=this.selectedRecords[g][b[k].attr("name")].id&&a[b[k].attr("name")+f.app.XmlQuery.NAME_SPLIT+"id"]!=this.selectedRecords[g][String(b[k].attr("name"))].id){e=!1;break}if(!0==e)return this.selectedRecords[g]}}catch(m){}return null};this.setQueryResult=function(a,b){b=js.param(b,null);var e=this.entityXml.attr("name")+f.app.XmlQuery.NAME_SPLIT+"id",g;if(!0==this._formMode){var k,
m={};for(g=0;g<a.length;g++)m[a[g][e]]=g;for(g=0;g<this._valueList.length;g++)k=this._valueList[g],null!=m[k[e]]?(k=m[k[e]],a[k]=this._valueList[g]):a.push(this._valueList[g])}k=null;m=this._lastSelectedIndex;js.isNull(this._lastSelectedItem)||(k=this._lastSelectedItem,this.dgResult.selectedItem(null),this.onSelectChange(null),delete k.$selected$);if(this.isDataView){if(null!=b&&!js.isNull(a)){e=[];for(g=0;g<a.length;g++)!0==this.isMultiSelectable&&this.isSelectedRecord(a[g])&&(a[g].$selected$=!0,
e.push(g));g=b.asyncData;js.isNull(g)||this.dataView.putItems(g.start,a,g.group);if(!0==this.isMultiSelectable){for(g=0;g<this.selectedRecords.length;g++)k=this.dataView.indexOf(this.selectedRecords[g].$raw_record$),-1!=k&&-1==e.indexOf(k)&&e.push(k);this.dgResult.setSelectedRows(e)}0<=m&&(this.dgResult.selectedIndex(m),this.onSelectChange(null))}}else if(this.recordResult.length=0,null!=a){m=null;e=[];for(g=0;g<a.length;g++)null!=k&&!0==js.equals(a[g],k)&&(m=a[g]),!0==this.isMultiSelectable&&this.isSelectedRecord(a[g])&&
(a[g].$selected$=!0,e.push(g)),this.recordResult.push(a[g]);this.dgResult.dataProvider(this.recordResult);!0==this.isMultiSelectable&&this.dgResult.setSelectedRows(e);null!=m?(this.dgResult.selectedItem(m),this.onSelectChange(null)):this.dgResult.selectedItem(null)}};this.onColumnSort=function(a,b){this.columnSort=b.entity+","+b.field+","+b.sort;this.onRefresh()};this.onColumnGrouping=function(a,b){var e=b.entity,g=b.prop,k;k=this.getEntityProperty(e,g);if(js.isNull(k))f.ui.MessageBox.show("\u65e0\u6cd5\u627e\u5230\u5206\u7ec4\u7684\u5b9e\u4f53\u5c5e\u6027\uff1a"+
e+"."+g,"\u9519\u8bef",f.ui.MessageBox.Error);else{var e=k.parent(),g=null,m=k.attr("type");"timestamp"==m?g=new f.app.data.DateGroupingProvider:"relation"==m?g=new f.app.data.EntityGroupingProvider:"operator"==m&&(g=new f.app.data.PrincipalGroupingProvider);""!=k.attr("valueProvider")&&(g=new f.app.data.DictionaryGroupingProvider);js.isNull(g)||(this.groupingProvider=g,this.gridNav.pagingMode(f.app.query.DataGridNavigator.VIRTUALIZING_PAGING),this.setDataView(!0),this.groupingProvider.queryControl(this),
this.groupingProvider.dataView(this.dataView),this.groupingProvider.groupingEntity(e),this.groupingProvider.groupingProperty(k),this.refresh())}};this.canQueryExecute=function(a){a=js.param(a,!0);if(!1==this.conditionForm.validateInput(a)||!0==this.formMode()&&"create"==this._form.getProperty(f.app.FormWindow.PROP_SUBMIT_ACTION))return!1;for(var b=this.condition(),e=this._queryXml.xpath("xmlQuery/where//exp"),g,k="",m,n=0;n<e.length;n++)if(g=e[n],"true"!=g.attr("option"))if("param"==g.attr("rightType")&&
null==b[g.attr("right")]){k="\u7f3a\u5c11\u5fc5\u8981\u6761\u4ef6:"+g.attr("leftEntity")+"."+g.attr("leftField");break}else if("val"==g.attr("rightType")&&(m=g.has("uid")?g.attr("uid"):g.attr("leftEntity")+"_"+g.attr("leftField"),null==b[m])){k="\u7f3a\u5c11\u5fc5\u8981\u6761\u4ef6:"+g.attr("leftEntity")+"."+g.attr("leftField");break}for(n=0;n<this.addtionalCondition.length;n++)if(e=this.addtionalCondition[n],!0!=e.option&&"true"!=e.option)if("param"==e.rightType&&null==b[String(e.right)]){k="\u7f3a\u5c11\u5fc5\u8981\u6761\u4ef6:"+
e.leftEntity+"."+e.leftField;break}else if("val"==e.rightType&&(m=null!=e.uid&&0<String(e.uid).length?e.uid:String(e.leftEntity)+"_"+String(e.leftField),null==b[m])){k="\u7f3a\u5c11\u5fc5\u8981\u6761\u4ef6:"+e.leftEntity+"."+e.leftField;break}!0==a&&""!=k&&f.ui.MessageBox.show(k,"\u63d0\u793a");return""!=k?!1:!0};js.$public.condition=function(a){if(void 0===a){a=this.conditionForm.getEntity();var b,e=/[\u4e00-\u9fa5]/;for(b in this._condition)null==b.match(e)&&null==a[b]&&null!=this._condition[b]&&
(a[b]=this._condition[b]);for(var f=this._queryXml.xpath("xmlQuery/where//exp"),k,m,e=0;e<f.length;e++)k=f[e],"val"==k.attr("rightType")&&(m=k.attr("right"),b=null,m=this._expParser.calculate(m),m.state==wos.expression.ExpressionResult.CALCULATED&&(b=m.value),null!=b&&(k.has("uid")?a[k.attr("uid")]=b:(m=k.attr("leftEntity")+"_"+k.attr("leftField"),a[m]=b))),"val"==k.attr("rightType2")&&(m=k.attr("right2"),b=null,m=this._expParser.calculate(m),m.state==wos.expression.ExpressionResult.CALCULATED&&(b=
m.value),null!=b&&(k.has("uid")?a[k.attr("uid")+"2"]=b:(m=k.attr("leftEntity")+"_"+k.attr("leftField")+"2",a[m]=b)));for(e=0;e<this.addtionalCondition.length;e++)f=this.addtionalCondition[e],"val"==f.rightType&&(m=String(f.right),b=null,m=this._expParser.calculate(m),m.state==wos.expression.ExpressionResult.CALCULATED&&(b=m.value),null!=b&&(null!=f.uid&&""!=f.uid?a[f.uid]=b:(m=String(f.leftEntity)+"_"+String(f.leftField),a[m]=b))),null!=f.rightType2&&"val"==f.rightType2&&(m=String(f.right2),b=null,
m=this._expParser.calculate(m),m.state==wos.expression.ExpressionResult.CALCULATED&&(b=m.value),null!=b&&(0<f.uid.length()?a[f.uid+"2"]=b:(m=String(f.leftEntity)+"_"+String(f.leftField)+"2",a[m]=b)));null!=this.columnSort&&(a.$orderBy$=this.columnSort);return a}this._condition=a;this.conditionForm&&this.conditionForm.setEntity(a)};this.prepareForServerValue=function(a){var b=this._queryXml.xpath("xmlQuery/where//exp"),e,f,k,m,n,l,q={};for(m=0;m<b.length;m++)if(e=b[m],"svrval"==e.attr("rightType")&&
(f=e.attr("right"),f=f.match(this.expPattern),null!=f))for(n=0;n<f.length;n++)k=f[n],k=k.substr(2,k.length-3),l=this._expParser.calculate(k),k=null,l.state==wos.expression.ExpressionResult.CALCULATED&&(k=l.value),null!=k&&(q[f[n]]=k);b=this._queryXml.xpath("xmlQuery/other/groupBy/customer");for(m=0;m<b.length;m++){e=b[m];var s=e.attributes();for(e=0;e<s.length;e++)for(f=s[e],f=String(f.value),f=f.match(expPattern),n=0;n<f.length;n++)k=f[n],k=k.substr(2,k.length-3),l=this._expParser.calculate(k),k=
null,l.state==wos.expression.ExpressionResult.CALCULATED&&(k=l.value),null!=k&&(q[f[n]]=k)}var b="",r;for(r in q)0<b.length&&(b+="\r\t"),b+=r+"\x3d"+q[r];a._svrvals_=b};js.$public.page=function(a){if(void 0===a)return this._page;this._page=a};js.$public.getProperty=function(a){switch(a){case this.$class.PROP_SELECTED_ITEM:return this.dgResult.selectedItem();case this.$class.PROP_INITIALIZED:return this.isInitializedOK}return null};js.$public.setProperty=function(a,b){switch(a){case "excelPasteEnabled":this.excelPasteEnabled(b);
break;case "autoClearSelection":this.autoClearSelection=b}};js.$public.onPropertyChange=function(a,b,e){this.isRendered()&&b==this.$class.PROP_SELECTED_ITEM&&(a=this.condition(),this.prepareForServerValue(a),!0!=js.equals(this.queryCondition,a)||0<this._queryXml.children("script").length)&&(this.canQueryExecute(!1)?this.refresh():(this.gridNav.recalc(0,this.getPageSize()),this.data_clear(),this.dgResult.selectedItem(null),this.dgResult.invalidate(),this.queryCondition={}))};js.$public.onEntityChange=
function(a,b,e,g){if(this.entityXml.attr("name")==a){b={};for(var k in e)b[a+f.app.XmlQuery.NAME_SPLIT+k]=e[k];!0==this.formMode()&&(b.$modified$=!0);if("create"==g)js.isNull(this.groupingProvider)?this.data_insert(0,b):this.groupingProvider.addNewChild(b),this.dgResult.invalidate(),this.dgResult.selectedItem(b),this.onSelectChange(null);else if("edit"==g)if(e=a+f.app.XmlQuery.NAME_SPLIT+"id",this.isDataView){var m=this.dataView.findItems(e,b[e]);for(a=0;a<m.length;a++)js.copy(b,m[a]);b=this.dataView.findItemIndexes(e,
b[e]);this.dgResult.invalidateRows(b)}else for(a=0;a<this.recordResult.length;a++){if(this.recordResult[a][e]==b[e]){e=this.recordResult[a];for(m in b)e[m]=b[m];this.recordResult[a]=e;this.dgResult.invalidateRow(a);break}}else"refresh"==g&&(this.ontimeEdit&&this.modified()||f.Timer.callLater(0,this.refresh,this))}};js.$public.form=function(a){if(void 0===a)return this._form;this._form=a};js.$public.value=function(a){if(void 0===a){if(null==this.entityXml||null==this._parentField)return null;var b=
this.entityXml.attr("name");a=[];var e,g,k;if("create"!=this._form.getProperty(f.app.FormWindow.PROP_SUBMIT_ACTION))for(e=0;e<this.deleteEntities.length;e++)this.deleteEntities[e].entityName==b&&(g=this.deleteEntities[e].entity,null!=g.id&&a.push({$delete$:"true",id:g.id}));for(e=0;e<this.dgResult.getDataLength();e++)k=this.data_getItem(e),g=this.getRecordEntity(k),delete g.$type$,delete g.$selected$,!0==Boolean(k.$modified$)&&(g.$modified$=!0),a.push(g);var m={};m.key=this._form.getProperty(f.app.FormWindow.PROP_ENTITYNAME)+
"$"+b+"$"+this._parentField;m.list=a;return m}this.data_clear();this._valueList=[];if(null!=a&&(b=this.entityXml.attr("name"),e=this._form.getProperty(f.app.FormWindow.PROP_ENTITYNAME)+"$"+b+"$"+this._parentField,a=a[e],"array"==js.type(a))){for(e=0;e<a.length;e++)if(g=a[e],!0==Boolean(g.$delete$))this.deleteEntities.push({entityName:b,entity:g});else{k={};for(m in g)k[b+f.app.XmlQuery.NAME_SPLIT+m]=g[m];k.$modified$=!0;this.data_append(k);this._valueList.push(k)}this.dgResult.invalidate()}};this.setDataView=
function(a){this.isDataView=a;if(!0==a){if(js.isNull(this.dataView)){a=this._queryXml.xpath("queryEntities/Entity");for(var b,e=[],g=0;g<a.length;g++)b=a[g],e[g]=b.attr("name")+f.app.XmlQuery.NAME_SPLIT+"id";this.dataView=new f.app.data.DataView(e);this.dataView.addEventListener(f.app.data.DataView.REQUEST_PAGE_EVENT,this.onRequestPage,this);this.dataView.addEventListener(f.app.data.DataView.ROWS_CHANGED_EVENT,this.onUpdateRows,this);this.dataView.addEventListener(f.app.data.DataView.ROW_COUNT_CHANGED_EVENT,
this.onRowCountChanged,this)}this.dgResult.dataProvider(this.dataView)}else this.dgResult.dataProvider(this.recordResult)};this.onUpdateRows=function(a,b){var e=b.beginRow,f=b.endRow;if(0==e&&-1==f)this.dgResult.invalidate();else{for(var k=[];e<=f;e++)k.push(e);this.dgResult.invalidateRows(k)}};this.onRowCountChanged=function(a,b){this.dgResult._grid.updateRowCount();this.dgResult._grid.render();this.dgResult.invalidateSize(!0)};this.onRequestPage=function(a,b){var e=b.DB_Start,f=b.DB_Count,k=b.group;
if(js.isNull(this.groupingProvider)||js.isNull(k)){var m=this.condition();this.prepareForServerValue(m);var n={};n.start=e;n.size=f;n.group=k;js.isNull(this.querySql)?wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),this.addtionalCondition,m,e,f],this,new wos.events.AsyncOption("QueryService.executeQuery",n)):wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),this.querySql,e,f],this,new wos.events.AsyncOption("SQLResult",n))}else this.groupingProvider.fetchChildren(k,
e,f)};this.onPageModeChanged=function(a,b){b.pagingMode==f.app.query.DataGridNavigator.NORMAL_PAGING?this.setDataView(!1):this.setDataView(!0);this.canQueryExecute(!1)&&(this.groupingProvider=null,this.refresh())};js.$public.canGrouping=function(a,b){if(!this._enableGrouping||!1==this.gridNav.canVirtualizePaging()||0<this._queryXml.xpath("xmlQuery/script").length)return!1;var e;e=this.getEntityProperty(a,b);if(js.isNull(e))return!1;var f=e.attr("type");return"timestamp"==f||"relation"==f||"principal"==
f?!0:""!=e.attr("valueProvider")?!0:!1}});js.$class("qs.app.ServiceFilter",[wos.RemotingFilter],function(){js.$public.pre_call=function(a,b){switch(a){case "QueryService.executeEntityHQL":b[0]=this.encodeSql(b[0]);break;case "QueryService.executeSQLQuery":b[1]=this.encodeSql(b[1])}};this.encodeSql=function(a){return"$"+wos.XXTEA.encrypt(a,"dioJse7s#hsrp")}});wos.Remoting.addFilter("ServiceFilter",new f.app.ServiceFilter)})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cContainer xmlns:app\x3d"qs.app" xmlns:report\x3d"qs.app.report" xmlns:html\x3d"qs.html" options\x3d"{classes:\'qs-querycontrol\'}"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" vGap\x3d"2" rows\x3d"[\'auto\', \'auto\', \'*\']"\x3e','\x3cHLayout name\x3d"toolbar" layout\x3d"{rowIndex : 0, innerLayout:{height:\'100%\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButtonBar options\x3d"{classes:\'qs-ctrlbar\'}" margin\x3d"0,0,5,0" height\x3d"23"\x3e',
'\x3cButton icon\x3d"images/icons/refresh.png" text\x3d"\u5237\u65b0" toolTip\x3d"\u67e5\u8be2\u6570\u636e\u5e76\u5237\u65b0\u5f53\u524d\u5185\u5bb9" click\x3d"onRefresh" /\x3e','\x3cButton icon\x3d"images/icons/reset.png" text\x3d"\u91cd\u7f6e" toolTip\x3d"\u91cd\u7f6e\u67e5\u8be2\u6761\u4ef6" click\x3d"onResetCondition" /\x3e',"\x3c/ButtonBar\x3e",'\x3cButtonBar options\x3d"{classes:\'qs-ctrlbar\'}" height\x3d"23"\x3e','\x3cButton name\x3d"btnSave" icon\x3d"images/icons/save.png" text\x3d"\u4fdd\u5b58" toolTip\x3d"\u4fdd\u5b58" click\x3d"onSave" /\x3e',
'\x3cButton name\x3d"btnPrint" icon\x3d"images/icons/printer.png" text\x3d"\u6253\u5370" toolTip\x3d"\u6253\u5370" click\x3d"onPrint" /\x3e','\x3cButton name\x3d"btnExport" icon\x3d"images/icons/word.png" click\x3d"onExport" text\x3d"\u5bfc\u51fa" toolTip\x3d"\u5bfc\u51fa" /\x3e',"\x3c/ButtonBar\x3e","\x3c/HLayout\x3e",'\x3capp:XmlForm name\x3d"conditionForm" useDefaultValidator\x3d"true" queryMode\x3d"true" layout\x3d"{rowIndex : 1}"/\x3e',"\x3cScrollView name\x3d\"scrollView\" layout\x3d\"{rowIndex : 2, width:'100%', height:'*'}\" \x3e",
'\x3creport:ReportView name\x3d"view" /\x3e',"\x3c/ScrollView\x3e",'\x3cHLayout name\x3d"reportAdorner" visible\x3d"false" options.classes\x3d"qs-report-adorner" layout\x3d"{rowIndex : 2, hAlign:\'center\', innerLayout:{vAlign:\'middle\'}, width:400, height:30}"\x3e','\x3cLabel name\x3d"reportTip" layout.width\x3d"*" /\x3e','\x3cButton width\x3d"40" height\x3d"24" text\x3d"\u6e05\u9664" click\x3d"onClear" /\x3e','\x3cButton width\x3d"40" height\x3d"24" text\x3d"\u5173\u95ed" click\x3d"onTipClose" /\x3e',
"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Container\x3e"));js.$class("qs.app.ReportControl",f.ui.Container,[wos.script.IScriptHost,f.app.IPageComponent,wos.expression.IExpressionValueProvider],function(){this.positionForm=this.generator=this._templateXml=null;this.openMode="";this.documentXml=this._form=this._page=this._entity=this._entityXml=null;this.scriptSqlMap={};this.database="";this._condition=this.ctxMenu=this.exporter=null;this.addtionalConditionMap={};this.acuid=0;this._openALink=null;
this.batchMode=!1;this.batchEntities=null;this.currentEntityIndex=0;this.saveMode="None";this.savedReport=null;this.initialize=function(b){this.$super(b);var c=wos.Desktop.getAttribute("loginInfo");js.isNull(c)||(this.database=c.database);this.addEventListener(wos.events.ScriptEvent.ASYNC_EXECUTE_FINISHED,this.onScriptExecuteFinished);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);this.callAfterRendered(function(){this.qxml(a,
null,b);this.ctxMenu=new f.ui.Menu;this.ctxMenu.addEventListener("itemClick",this.onContextMenuClick,this);this.conditionForm.report(this);this.conditionForm.addEventListener(f.app.XmlForm.FIELD_CHANGE_ACTION_EVENT,this.onFormFireEvent,this);this.conditionForm.addEventListener(f.app.XmlForm.BUTTON_ACTION_EVENT,this.onFormButtonActionEvent,this);this.generator=new f.app.report.ReportGenerator(this._page,this);this.view.addEventListener(f.app.report.ReportView.LINK_EVENT,this.onTextLink,this)})};js.$public.render=
function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:"",text:""},this._options,c);this.$super(a,c);this.invalidateSize()};js.$public.reportUID=function(a){if(!js.isNull(a)&&""!=a&&"null"!=a){var c=f.app.Workspace.instance().getLoadedFile(a);null!=c?this.templateXml(c):(desc={x_name:"Report"},desc.uid=a,f.app.Workspace.instance().loadFile(desc,this,new wos.events.AsyncOption("Report")))}};js.$public.form=function(a){if(void 0===a)return this._form;this._form=a};js.$public.page=function(a){if(void 0===
a)return this._page;this._page=a};js.$public.getProperty=function(a){return null};js.$public.setProperty=function(a,c){};js.$public.onPropertyChange=function(a,c,d){};js.$public.onEntityChange=function(a,c,d,e){};js.$public.application=function(){return null!=this._page?this._page.application():null!=this._form?this._form.application():null};js.$public.openALink=function(a){this._openALink=a;js.isNull(this._openALink)||js.isNull(this._openALink.param)||(a=this._openALink.param,!0==a.batchMode&&"array"==
js.type(a.entities)&&(this.batchMode=!0,this.currentEntityIndex=0,this.batchEntities=a.entities))};js.$public.pushAddtionalCondition=function(a,c,d,e,f,k,m,n,l,q){l=js.param(l,null);q=js.param(q,null);var s=this.addtionalConditionMap[a];js.isNull(s)&&(s=[],this.addtionalConditionMap[a]=s);a={};a.uid="acuid"+this.acuid++;a.type=c;a.option=d;a.leftEntity=e;a.leftField=f;a.right=k;a.rightType=m;a.valueType=n;null!=l&&(a.right2=l);null!=q&&(a.rightType2=q);c=!1;for(d=0;d<s.length;d++)if(js.equals(s[d],
a)){c=!0;break}c||s.push(a)};this.onContextMenuClick=function(a,c){var d="",d=js.instanceOf(c,f.Xml)?c.attr("action"):c.action;null!=d&&""!=d&&(0==d.indexOf("event:")?(d=d.substr(6),this.doLinkEvent(d)):0==d.indexOf("alink://")&&this.alinkHandler(d))};this.showContextMenu=function(a){this.ctxMenu.menudata({menuitem:a});this.ctxMenu.show(f.ui.Mouse.x,f.ui.Mouse.y)};js.$static.getRequiredFile=function(a){var c={},d,e,f,k=a.xpath("dataSource/Entity");for(f=0;f<k.length;f++)e=k[f],d=e.name(),e=e.attr("uid"),
c[e]=d;k=a.xpath("dataSource/xmlQuery/select/Entity");for(f=0;f<k.length;f++)e=k[f],d=e.name(),e=e.attr("uid"),c[e]=d;return c};js.$public.open=function(a,c){this.entity(c);this.templateXml(a)};js.$public.entityXml=function(a){this._entityXml=a};js.$public.entity=function(a){this._entity=a};js.$public.templateXml=function(a){this._templateXml=a;this.callAfterRendered(function(){if(!js.isNull(this._templateXml)){switch(this._templateXml.attr("save")){case "true":case "auto":this.saveMode="Auto";break;
case "manual":this.saveMode="Manual";break;default:this.saveMode="None"}"true"==this._templateXml.attr("editOnReview")&&this.view.editable(!0);"true"==this._templateXml.attr("onlyShowContent")&&(js.isNull(this.toolbar)||this.toolbar.parent()!=this||(this.removeChild(this.toolbar),this.toolbar.remove(),this.toolbar=null),js.isNull(this.conditionForm)||this.conditionForm.parent()!=this||(this.removeChild(this.conditionForm),this.conditionForm.remove(),this.conditionForm=null),this.view.onlyShowContent(!0));
"true"==this._templateXml.attr("autoResize")&&this.view.autosize(!0);"false"==this._templateXml.attr("breakPage")&&this.view.breakPage(!1);"false"==this._templateXml.attr("showPageNo")?this.view.showPageNo(!1):this.view.showPageNo(!0);if(this._templateXml.has("permission")){var a="";null!=this._page?a=this._page.application().name():null!=this._form&&(a=this._form.application().name());a=wos.PermissionUtil.instance().hasPermission(a,this._templateXml.attr("permission"));this.btnSave.enabled(a);this.btnPrint.enabled(a);
this.btnExport.enabled(a)}"Manual"==this.saveMode&&!0!=this.batchMode?this.btnSave.visible(!0):(this.btnSave.visible(!1),this.btnSave.parent().updateButtons());this.generator.template(this._templateXml);this.invalidateSize(!0)}this.init()})};this.doLinkEvent=function(a){var c,d=a.indexOf("?");if(-1==d)this.fireEvent(a);else{c=a.substring(0,d);var e={};a=a.substring(d+1).split("\x26");for(var f,k,d=0;d<a.length;d++)if(f=a[d].split("\x3d"),2==f.length)if("dsRef"==f[0]){if(k=f[1].split(":"),3==k.length){var m=
k[0];f=parseInt(k[1]);e.dsRef={dataSource:m,index:f,dataField:k[2]};k=this.getDataSource(k[0]);"array"==js.type(k)&&f<k.length&&(e.dsRef.data=k[f])}}else e[f[0]]=f[1];this.fireEvent(c,{args:e})}};this.onFormFireEvent=function(a,c){this.fireEvent(c.changeEvent)};this.onFormButtonActionEvent=function(a,c){this.fireEvent(c.action)};this.onTextLink=function(a,c){var d=c.href;js.isNull(d)||""==d||(0==d.indexOf("alink://")?this.alinkHandler(text):0==d.indexOf("event:")?this.doLinkEvent(d.substr(6)):0==
d.indexOf("http://")&&window.open(d))};this.init=function(){if(this.isRendered()&&!js.isNull(this._templateXml)&&null!=this.parent()){if(null!=this.conditionForm){this.conditionForm.reset();null!=this._page&&this.conditionForm.application(this._page.application());var a=this._templateXml.xpath("conditionForm/Window")[0];js.isNull(a)||(this.conditionForm.generateForm(a),null!=this._condition&&this.conditionForm.setEntity(this._condition))}this.fireEvent("initialize")}};js.$protected.dispose=function(){this.$super();
wos.script.ScriptProxy.removeHost(this)};this.onSave=function(){this.saveReport()};this.onExport=function(){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u5bfc\u51fa\u65b9\u5f0f\u3002","\u63d0\u793a",{choices:[{text:"Word",icon:"images/icons/word.png"},{text:"Excel",icon:"images/icons/excel.png"}]},f.ui.MessageBox.Question,function(a){"Excel"==a?f.app.ReportExporter.exportExcel(l(this.view._$content[0])):f.app.ReportExporter.exportWord(l(this.view._$content[0]))},this)};this.onPrint=function(){this.view.print();
this.fireEvent("printed")};this.onFileLoaded=function(a){var c=a.fileXml;switch(a.option.asyncName){case "Report":this.templateXml(c)}};this.onRefresh=function(){if(null==this.conditionForm||this.conditionForm.validateInput(!0))if("None"!=this.saveMode)this.findReport(this._entity);else this.onGenerte()};this.onGenerte=function(){if(null==this.conditionForm||this.conditionForm.validateInput()){this.scrollView.scrollTo(0,0);var a={};null!=this.conditionForm&&(a=this.conditionForm.getEntity());var c=
this._entity;!0==this.batchMode&&null!=this.batchEntities&&(this.currentEntityIndex=0,c=this.batchEntities[0]);this.generator.generate(a,this.addtionalConditionMap,null,this._entityXml,c)}};this.findReport=function(a){if(null==this.conditionForm||this.conditionForm.validateInput()){var c={};null!=this.conditionForm&&(c=this.conditionForm.getEntity());var d=this.getReportFileUID(a),c=wos.MD5(JSON.stringify(c)),e=new wos.events.AsyncOption("FindReport",a);e.showWaitingBox=!1;wos.Remoting.call("QueryService.executeSQLQuery",
[null,null==a?"select id, FM_UpdateTime, FM_UpdatePrinName, content_xml from DYNA_ReportFile where report_uid\x3d'"+d+"' and condition_md5\x3d'"+c+"'":"select id, FM_UpdateTime, FM_UpdatePrinName, content_xml, condition_md5 from DYNA_ReportFile where report_uid\x3d'"+d+"' ",0,1],this,e)}};this.getReportFileUID=function(a){var c="qsweb-"+this._templateXml.attr("uid");"None"!=this.saveMode&&null!=a&&0<a.id&&(c+="_"+a.id);return c};this.saveReport=function(){if(!js.isNull(this.documentXml)&&"None"!=
this.saveMode&&!0!=this.batchMode){var a=this.getReportFileUID(this._entity),c=this._templateXml.attr("name"),d=JSON.stringify(this.condition()),e=this.view.contentHtml();null!=this._entity&&0<this._entity.id?(d+=JSON.stringify(this._entity),js.isNull(this.savedReport)?(f.app.report.ReportDocumentService.instance().reportControl=this,f.app.report.ReportDocumentService.instance().create(a,c,d,e)):(f.app.report.ReportDocumentService.instance().reportControl=this,f.app.report.ReportDocumentService.instance().update(this.savedReport.id,
a,c,d,e)),this.reportAdorner.visible(!1)):(f.app.report.ReportDocumentService.instance().save(a,c,d,e),this.reportAdorner.visible(!1),this.savedReport=null)}};this.cb_RemoteCall=function(a,c){if(!js.isNull(c)&&!js.isNull(c.$jsResult)){var d=wos.expression.ExpressionFunction.eval(c.$jsResult);null!=d&&js.copy(d,c)}this.fireEvent(a,{result:c})};this.onRemotingCallback=function(a,c){switch(a.option.asyncName){case "FindReport":this.cb_FindReport(a.result,a.option.asyncData);break;case "RemoteEventCallback":null!=
a.option.asyncData&&this.cb_RemoteCall(a.option.asyncData,a.result)}};this.cb_FindReport=function(a,c){var d=null,e=null;"array"==js.type(a)&&0<a.length&&(e=a[0],d={},d.id=e[0],d.time=e[1],d.name=e[2],null!=c&&5<=e.length&&(d.condition_md5=e[4]),e=e[3],js.isNull(e)?d=null:d.content_xml=e);if(null==d)if(!0==this.batchMode)e=this.batchEntities[this.currentEntityIndex],d={},null!=this.conditionForm&&(d=this.conditionForm.getEntity()),this.generator.generate(d,this.addtionalConditionMap,null,this._entityXml,
e);else this.onGenerte();else{this.savedReport=d;if(!js.isNull(c)&&!js.isNull(this.savedReport.condition_md5)&&(d=JSON.stringify(this.condition()),d+=JSON.stringify(c),wos.MD5(d)!=this.savedReport.condition_md5&&"Auto"==this.saveMode)){if(!0==this.batchMode)e=this.batchEntities[this.currentEntityIndex],d={},null!=this.conditionForm&&(d=this.conditionForm.getEntity()),this.generator.generate(d,this.addtionalConditionMap,null,this._entityXml,e);else this.onGenerte();return}d="\u672c\u6b21\u62a5\u8868\u7531"+
this.savedReport.name+"\u5728"+DateUtil.format(this.savedReport.time,"YYYY-MM-DD HH:MI:SS")+"\u751f\u6210\u3002";e=(new f.Xml(this.savedReport.content_xml)).children("Content")[0];!0==this.batchMode?(this.view.contentHtml(e.text()),this.doNextEntityReport(!1)):(this.view.contentHtml(e.text()),this.reportTip.text(d),this.reportAdorner.visible(!0),this.reportAdorner.height(30),this.invalidateSize(!0))}};this.doNextEntityReport=function(a){(a=js.param(a,!0))&&(0==this.currentEntityIndex?this.view.load(this.documentXml,
this.generator.dataSourceMap(),this.generator.getTableMap()):this.view.load(this.documentXml,this.generator.dataSourceMap(),this.generator.getTableMap(),!0));this.currentEntityIndex++;if(this.currentEntityIndex!=this.batchEntities.length)if(a=this.batchEntities[this.currentEntityIndex],"None"!=this.saveMode)this.findReport(a);else{var c={};null!=this.conditionForm&&(c=this.conditionForm.getEntity());this.generator.generate(c,this.addtionalConditionMap,null,this._entityXml,a)}};this.onClear=function(){js.isNull(this.savedReport)||
f.ui.MessageBox.show("\u786e\u5b9a\u8981\u6e05\u9664\u62a5\u8868\u7f13\u5b58,\u5e76\u91cd\u65b0\u751f\u6210\u62a5\u8868\u5417\uff1f","\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.clearEventHandler,this)};this.clearEventHandler=function(a){a==f.ui.MessageBox.Yes&&(this.reportAdorner.visible(!1),f.app.report.ReportDocumentService.instance().remove(this.savedReport.id),this.onGenerte())};this.onTipClose=function(){this.reportAdorner.visible(!1)};this.onResetCondition=function(){null!=this.conditionForm&&
this.conditionForm.setEntity(null)};js.$public.condition=function(a){if(void 0===a)return null!=this.conditionForm?this.conditionForm.getEntity(!1,!1):{};this._condition=a;js.isNull(this.conditionForm)||this.conditionForm.setEntity(a)};js.$public.fireEvent=function(a,c){c=js.param(c,null);var d=this._templateXml.xpath('events/event[@name \x3d "'+a+'"]')[0],e=null;js.isNull(d)||(e=d.text());null!=e&&""!=e?wos.script.ScriptProxy.asyncExecute(this,e,c,new wos.events.AsyncOption(a)):this.eventFinished(a,
null)};this.onScriptExecuteFinished=function(a){if("sqlScript"==a.option.asyncName){var c=a.option.asyncData,d,e;d=f.app.XmlQuery.getSelectList(this.scriptSqlMap[c].dsXml,this.database);if("string"==js.type(a.result))a=a.result;else{if(js.isNull(a.result)||js.isNull(a.result.querySql)||js.isNull(a.result.countSql)){f.ui.MessageBox.show("SQL\u751f\u6210\u811a\u672c\u8fd4\u56de\u9519\u8bef\uff0c\u5fc5\u987b\u8fd4\u56deSQL\u6587\u672c\u6216\u62e5\u6709querySql\u548ccountSql\u7684\u5bf9\u8c61\u3002");
return}a=a.result.querySql}e=!0;-1!=a.indexOf("${selectList}")?a=a.replace("${selectList}",d):e=!1;this.scriptSqlMap[c].querySql=a;this.generator.putScriptSql(c,a,e);d=!0;for(c in this.scriptSqlMap)if(js.isNull(this.scriptSqlMap[c].querySql)){d=!1;break}!0==d&&this.generator.doQuery()}else this.eventFinished(a.option.asyncName,a.result)};this.eventFinished=function(a,c){if(!js.isNull(c)&&c.hasOwnProperty("error")&&!0==c.error)f.ui.MessageBox.show(c.message,"\u9519\u8bef");else if("initialize"==a)if(!js.isNull(c)&&
c.hasOwnProperty("refreshNow")&&!1==c.refreshNow)this.view.documentXml(this._templateXml.children("Document")[0]);else if(null==this.conditionForm||this.conditionForm.validateInput(!1))this.onRefresh();else this.view.documentXml(this.generator.generateBlankDocument());else if("preQuery"==a){for(var d=!1,e=this._templateXml.xpath("dataSource/xmlQuery"),g,k,m=0;m<e.length;m++)g=e[m],k=g.children("script"),0<k.length&&(this.scriptSqlMap[g.attr("uid")]={dsXml:g,script:k[0].text()},d=!0);if(d)for(var n in this.scriptSqlMap)wos.script.ScriptProxy.asyncExecute(this,
this.scriptSqlMap[n].script,null,new wos.events.AsyncOption("sqlScript",n));else this.generator.doQuery()}else"postQuery"==a?(this.documentXml=this.generator.generateReport(),this.fireEvent("reportCreated")):"reportCreated"==a&&(!0==this.batchMode?this.doNextEntityReport():this.view.load(this.documentXml,this.generator.dataSourceMap(),this.generator.getTableMap()),"Auto"==this.saveMode&&this.saveReport())};this.getRecordMap=function(a){var c,d={},e,g;for(g in a)c=a[g],e=f.app.XmlQuery.splitRecordKey(g),
2!=e.length?d[g]=c:(null==d[e[0]]&&(d[e[0]]={}),d[e[0]][e[1]]=c);return d};this.restoreRecord=function(a){var c={},d,e,g;for(g in a)if(d=a[g],e=js.type(d),"string"==e||"boolean"==e||"date"==e||"number"==e)c[g]=d;else for(var k in d)c[g+f.app.XmlQuery.NAME_SPLIT+k]=d[k];return c};this.getDataSource=function(a,c){c=js.param(c,!1);var d=this.generator.dataSourceMap()[a];if(!0!=c&&"array"==js.type(d)){if(0==d.length)return[];for(var e=[],f=0;f<d.length;f++)e.push(this.getRecordMap(d[f]));return e}return d};
this.setDataSource=function(a,c){if("array"==js.type(c)){var d=[];if("array"==js.type(c[0]))d=c;else for(var e=0;e<c.length;e++)d.push(this.restoreRecord(c[e]));this.generator.addDataSource(a,d)}else this.generator.addDataSource(a,c)};this.alinkHandler=function(a){var c;a=wos.ALink.parseALink(a);js.isNull(a.param)&&(a.param={});"EntityForm"==a.form?(c=f.app.Workspace.instance().getFormWindow(a.param.formUID),js.isNull(c)&&(c=new f.app.FormWindow,f.app.Workspace.instance().addFormWindow(a.param.formUID,
c)),c.opener(this),null!=this._page&&c.application(this._page.application()),c.open(a,this)):"EntityQuery"==a.form?(c=f.app.Workspace.instance().getPageWindow(a.param.queryUID),null==c&&(c=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(a.param.queryUID,c)),c.opener(this),null!=this._page&&c.application(this._page.application()),c.open(a,this)):"FreeForm"==a.form?(c=f.app.Workspace.instance().getFormWindow(a.param.formUID),null==c&&(c=new f.app.FormWindow,f.app.Workspace.instance().addFormWindow(a.param.formUID,
c)),c.opener(this),null!=this._page&&c.application(this._page.application()),c.offlineMode(!0),c.open(a,this)):"PageWindow"==a.form?(c=new f.app.PageWindow,c.opener(this),null!=this._page&&c.application(this._page.application()),c.open(a,this)):"EntitySelectWindow"==a.form?(c=f.app.Workspace.instance().getPageWindow(a.param.entityUID),null==c&&(c=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(a.param.entityUID,c)),c.opener(this),null!=this._page&&c.application(this._page.application()),
c.open(a,this)):"Report"==a.form?(c=f.app.Workspace.instance().getPageWindow(a.param.reportUID),null==c&&(c=new f.app.PageWindow,f.app.Workspace.instance().addPageWindow(a.param.reportUID,c)),c.opener(this),null!=this._page&&c.application(this._page.application()),c.open(a,this)):(a.param.$winEnv={$opener:this},wos.Desktop.openALinkWindow(a))};js.$public.getTable=function(a,c){c=js.param(c,!1);if(!0!=c){var d=this.documentXml.xpath('table[@name \x3d "'+a+'"]')[0];if(js.isNull(d))return null;a=d.attr("uid")}return this.generator.getTable(a)};
this.getTableCell=function(a,c,d){a=this.getTable(a);if(js.isNull(a))return null;c=a.getCell(c,d);if(js.isNull(c))return null;c=c.getXml();d=c.toJSON({deep:!1});d.text=c.text();return d};this.setTableCell=function(a,c,d,e){a=this.getTable(a);if(!js.isNull(a)&&(c=a.getCell(c,d),!js.isNull(c)))for(var f in e)"text"==f?c.text(e.text):c.setAttribute(f,e[f])};this.appendTableCol=function(a){a=this.getTable(a);js.isNull(a)||a.appendColumn()};this.appendTableRow=function(a){a=this.getTable(a);js.isNull(a)||
a.appendRow()};this.insertTableColBefor=function(a,c){var d=this.getTable(a);js.isNull(d)||(c=parseInt(c),isNaN(c)||d.insertColumn(c))};this.insertTableRowBefor=function(a,c){var d=this.getTable(a);js.isNull(d)||(c=parseInt(c),isNaN(c)||d.insertRowBefore(c))};this.insertTableRowAfter=function(a,c){var d=this.getTable(a);js.isNull(d)||(c=parseInt(c),isNaN(c)||d.insertRowAfter(c))};this.mergeTableCell=function(a,c,d,e,f){a=this.getTable(a);js.isNull(a)||(c=parseInt(c),d=parseInt(d),e=parseInt(e),f=
parseInt(f),isNaN(c)||isNaN(d)||isNaN(e)||isNaN(f)||a.mergeCell(c,d,e,f))};this.setTableColWidth=function(a,c,d){a=this.getTable(a);js.isNull(a)||(c=parseInt(c),isNaN(c)||(d=parseInt(d),isNaN(d)||a.setColWidth(c,d)))};this.setTableRowHeight=function(a,c,d){a=this.getTable(a);js.isNull(a)||(c=parseInt(c),isNaN(c)||(d=parseInt(d),isNaN(d)||a.setRowHeight(c,d)))};this.getTableProperties=function(a){var c=this.getTable(a);if(js.isNull(c))return null;a=c.getXml().toJSON({deep:!1});a.colCount=c.colCount();
a.rowCount=c.rowCount();c=l(c.generateHtml());l("body").append(c);a.width=c.width();a.height=c.height();c.empty();c.remove();return a};this.cloneSimpleObject=function(a){if(null==a||void 0==a)return a;var c=js.type(a);if("string"==c||"number"==c||"date"==c||"boolean"==c)return a;if("function"==js.type(a.clone))return a.clone();var d={},e,g;for(g in a)if(e=a[g],c=js.type(e),null==e)d[g]=null;else if("string"==c||"number"==c||"date"==c||"boolean"==c)d[g]=e;else if(!js.instanceOf(e,f.ui.Control))if("array"==
c){for(var c=[],k=0;k<e.length;k++)c.push(this.cloneSimpleObject(e[k]));d[g]=c}else d[g]=this.cloneSimpleObject(e);return d};this.getOpenParameter=function(){return null!=this._openALink&&null!=this._openALink.param?this.cloneSimpleObject(this._openALink.param):null};this.getScriptHost=function(a){a=this.generator.expParser().calculate(a);if(a.state==wos.expression.ExpressionResult.CALCULATED&&(a=a.value,js.instanceOf(a,wos.script.IScriptHost))){var c=wos.script.ScriptProxy.regHost(this,a);if(null!=
c)return{hostUID:c,hostName:a.getHostName()}}return null};this.fireRemoteEvent=function(a,c,d,e){wos.Remoting.call("DynamicEntityService.fireCustomeEvent",[a,c,d],this,new wos.events.AsyncOption("RemoteEventCallback",e))};js.$public.getHostName=function(){return"ime.appwindow.ReportControl"};js.$public.scriptInvoke=function(a,c){switch(a){case "getQueryCondition":return null!=this.conditionForm?this.conditionForm.getEntity(!1,!1):{};case "setQueryCondition":null!=this.conditionForm&&this.conditionForm.setEntity(c[0]);
break;case "fireRemoteEvent":this.fireRemoteEvent(c[0],c[1],c[2],c[3]);break;case "fireCustomerEvent":this.fireEvent(c[0],c[1]);break;case "setConditionFormProperty":null!=this.conditionForm&&this.conditionForm.setFieldProperty(c[0],c[1],c[2]);break;case "setDataSource":this.setDataSource(c[0],c[1]);break;case "getDataSource":return this.getDataSource(c[0]);case "setPivotTable":this.generator.setPivotTable(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);break;case "setDataSourceField":"array"!=js.type(this.generator.dataSourceMap()[c[0]])&&
(this.generator.dataSourceMap()[c[0]][c[1]]=c[2]);break;case "openALink":this.alinkHandler(c[0]);break;case "getExpressionValue":return this.generator.getExpressionValue(c[0]);case "getScriptHost":return this.getScriptHost(c[0]);case "showContextMenu":this.showContextMenu(c[0]);break;case "getOpenParameter":return this.getOpenParameter();case "appendTableCol":this.appendTableCol(c[0]);break;case "appendTableRow":this.appendTableRow(c[0]);break;case "insertTableColBefor":this.insertTableColBefor(c[0],
c[1]);break;case "insertTableRowBefor":this.insertTableRowBefor(c[0],c[1]);break;case "insertTableRowAfter":this.insertTableRowAfter(c[0],c[1]);break;case "mergeTableCell":this.mergeTableCell(c[0],c[1],c[2],c[3],c[4]);break;case "setTableColWidth":this.setTableColWidth(c[0],c[1],c[2]);break;case "setTableRowHeight":this.setTableRowHeight(c[0],c[1],c[2]);break;case "getTableCell":return this.getTableCell(c[0],c[1],c[2]);case "setTableCell":this.setTableCell(c[0],c[1],c[2],c[3]);break;case "getTableProperties":return this.getTableProperties(c[0]);
case "refresh":this.onRefresh()}return null};js.$public.getVariableValue=function(a,c){var d;switch(a){case "condition":case "$condition":return d={},null!=this.conditionForm&&(d=this.conditionForm.getEntity(!1,!1)),new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,d);case "page":case "$page":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page);case "parent":case "$parent":return null!=this._page?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this._page.parentPage()):wos.expression.ExpressionResult.InvalideResult;case "form":case "$form":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._form);case "opener":case "$opener":return null!=this._page&&js.instanceOf(this._page,f.app.ReportPage)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page.opener()):null!=this._form&&js.instanceOf(this._form,f.app.FormWindow)?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this._form.opener()):wos.expression.ExpressionResult.InvalideResult;case "openParameter":case "$openParameter":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.getOpenParameter())}d=this.getProperty(a);return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,d)};js.$public.getFunctionValue=function(a,c,d){return wos.expression.ExpressionResult.InvalideResult}})})(qs,jQuery);(function(f,l){js.$class("qs.app.FormWindow",f.ui.Window,[f.app.IForm,f.app.IEntityRuleApplier,wos.expression.IExpressionValueProvider,wos.script.IScriptHost],function(){f.events.register("entityCreate",this);f.events.register("entityModify",this);js.$static.ENTITY_CREATE_EVENT="entityCreate";js.$static.ENTITY_MODIFY_EVENT="entityModify";js.$static.PROP_SUBMIT_ACTION="submitAction";js.$static.PROP_INITIALIZED="isInitialized";js.$static.PROP_ISENTITYFORM="isEntityForm";js.$static.PROP_ENTITYNAME="entityName";
this.entity=this.WF_workItem=this.WF_task=this.WF_mode=this.printList=this.submitList=this.alink=this.formXml=this.entityXml=this._application=this._opener=this.expParser=this.ruleManager=this.submitPanel=this.xmlForm=null;this._offlineMode=!1;this.isEditable=!0;this.isCopyed=this.created=this.isFormCreated=this.isInitializing=this.isInitialized=!1;this.oldSubmit=null;this.validatorMap={};this.updateEntities=[];this.createEntities=[];this.instructions=[];this.codingFieldMap={};this.codingUpdateFieldMap=
{};this.eventResult=null;this.variableMap={};this.waitTimer=new f.Timer(500);this.viewStack=null;this.formMap={};this.entityLoading=this.disableChangeEvent=!1;this.confirmClose=!0;this.lastEnterCtrl=null;this.messageCallbackEvent="";this.relationEntityMap=null;this.initialize=function(a){this.$super();this.resizable(!1);this.expParser=new wos.expression.ExpressionParser(this);this.ruleManager=new f.app.EntityRuleManager(null,null,this,this.expParser);this.waitTimer.addEventListener(f.Timer.TIMER,
this.onTime,this);this.addEventListener("close",this.onClose);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(wos.events.ExceptionEvent.EXCEPTION,this.onRemotingException);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);this.addEventListener(wos.events.ScriptEvent.ASYNC_EXECUTE_FINISHED,this.onScriptExecuteFinished)};js.$public.render=function(a,b){this.$super(a,b);var c=new f.ui.Container({layout:{type:"grid",rows:["*",
"auto"],columns:["*"],hGap:3,vGap:3}});this.xmlForm=new f.app.XmlForm(this);this.xmlForm.addEventListener(f.app.XmlForm.FIELDVALUE_CHANGE_EVENT,this.onFieldValueChange,this);this.xmlForm.addEventListener(f.app.XmlForm.BUTTON_ACTION_EVENT,this.onFormButtonActionEvent,this);this.xmlForm.addEventListener(f.app.XmlForm.FIELD_CHANGE_ACTION_EVENT,this.onFieldChangeAction,this);c.addChild(this.xmlForm);this.submitPanel=new f.app.form.SubmitPanel;var d=this.submitPanel.data("layout")||{},d=l.extend({width:"*",
colIndex:0,rowIndex:1},d);this.submitPanel.data("layout",d);this.submitPanel.padding({left:3,top:3,right:3,bottom:3});this.submitPanel.addEventListener(f.app.form.SubmitPanel.SUBMIT,this.onSubmit,this);this.submitPanel.addEventListener(f.app.form.SubmitPanel.COPY,this.onCopy,this);this.submitPanel.addEventListener(f.app.form.SubmitPanel.CANCEL,this.onCancel,this);this.submitPanel.addEventListener(f.app.form.SubmitPanel.REPORT_PRINT,this.onReportPrint,this);this.submitPanel.addEventListener(f.app.form.SubmitPanel.SUBMIT_CHANGE,
this.onSubmitChange,this);this.submitPanel.addEventListener(f.app.form.SubmitPanel.FORMSTYLE_CHANGE,this.onFormStyleChange,this);c.addChild(this.submitPanel);this.bindEvent("keydown",this.onKeyDown);this.content(c);this.created=!0;this.initForm()};this.onTime=function(a){this.onSubmit(null)};this.onSubmit=function(a){this.submitPanel.setEditable(!1);this.waitTimer.stop();if(wos.script.ScriptProxy.isScriptRunning(this))this.waitTimer.start();else{a=this.xmlForm.getControlDescriptor();for(var b in a)if(js.instanceOf(a[b].input,
f.app.QueryControl)&&wos.script.ScriptProxy.isScriptRunning(a[b].input)){this.waitTimer.start();return}for(b in a)if(js.instanceOf(a[b].input,f.app.QueryControl)&&!0!=a[b].input.validateEditInput(!0)){this.submitPanel.setEditable(!0);return}this.submitPanel.checkFormValidation()?(b={},a=this.submitPanel.getSubmit(),b.submitName=a.attr("name"),b.submitType=a.toJSON(),this.fireFormEvent("preSubmit",b)):this.submitPanel.setEditable(!0)}};this.onCopy=function(a){a=this.xmlForm.getEntity();delete a.id;
delete a.domainId;delete a.WF_State;delete a.WF_StateName;delete a.WF_ProcessId;delete a.WF_ProcessName;delete a.WF_ProcessorPrinId;delete a.WF_ProcessorPrinName;delete a.WF_WorkItemId;this.xmlForm.setEntity(a);this.entity=null;null!=this.alink&&null!=this.alink.param&&(delete this.alink.param.entityId,delete this.alink.param.entity);this.isCopyed=!0;this.alink.param.action="create";this.title(this.title()+"(\u5df2\u590d\u5236)");this.editable(!0);this.submitPanel.setEditable(!0);this.submitPanel.showCopyButton(!1);
a={entity:a};var b=this.xmlForm.getControlDescriptor(),c;for(c in b)js.instanceOf(b[c].input,f.app.QueryControl)&&(a[c]=b[c].input.getAllEntities());this.WF_mode="";this.WF_task=null;this.submitPanel.setWFMode("");this.submitPanel.setSubmitList(null);this.fireFormEvent("copy",a)};this.onReportPrint=function(a){var b=new f.app.PageWindow,c={form:"Report"};c.param={reportUID:a.reportUID,entityXml:this.entityXml,entity:this.xmlForm.getEntity(),title:a.title};b.open(c,this)};this.onCancel=function(a){this.onClose(null)};
this.onClose=function(a){!0!=this.confirmClose||null==this.xmlForm||!this.xmlForm.isModified()||"create"!=this.getSubmitAction()&&"edit"!=this.getSubmitAction()?this.close():f.ui.MessageBox.show("\u6570\u636e\u5c1a\u672a\u4fdd\u5b58, \u662f\u5426\u73b0\u5728\u9000\u51fa?","\u63d0\u793a",f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,function(a){a==f.ui.MessageBox.Yes&&this.close()},this)};js.$public.close=function(a){!1!=a&&this.recycleCoding();this.reset();this.waitTimer.stop();this.$super(!1,!0)};
js.$public.editable=function(a){if(void 0===a)return this.isEditable;this.isEditable=a;this.setPropertyEnabled("*",a);null!=this.submitPanel&&this.submitPanel.setEditable(a)};js.$public.opener=function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.offlineMode=function(a){if(void 0===a)return this._offlineMode;this._offlineMode=a};js.$public.isEntityForm=function(){return null!=this.formXml&&"EntityForm"==this.formXml.name()?!0:!1};js.$public.getFormXml=function(){return this.formXml};
js.$public.getVariable=function(a){return this.variableMap[a]};js.$public.setVariable=function(a,b){this.variableMap[a]=b};js.$protected.dispose=function(){this.$super();wos.script.ScriptProxy.removeHost(this)};js.$public.reset=function(){wos.script.ScriptProxy.removeHost(this);this.entity=this.alink=null;this.WF_mode="";this._opener=this.WF_workItem=this.WF_task=null;this.isEditable=!0;this.oldSubmit=null;this.isInitializing=this.isInitialized=this._offlineMode=this.isCopyed=!1;this.codingFieldMap=
{};this.codingUpdateFieldMap={};this.updateEntities.length=0;this.createEntities.length=0;this.instructions.length=0;this.xmlForm.reset(!0);this.xmlForm.setEntity(null);js.isNull(this.relationEntityMap)||this.xmlForm.setRelationEntities({});for(var a in this.validatorMap)this.validatorMap[a].show(!1);this.setPropertyEnabled("*",!0);this.validatorMap={};this.variableMap={};this.xmlForm.removeValidator();a=this.xmlForm.getControlDescriptor();for(var b in a)js.instanceOf(a[b].input,f.app.QueryControl)&&
a[b].input.reset(!0)};this.recycleCoding=function(){var a,b;for(a in this.codingFieldMap)b=this.codingFieldMap[a],null!=b&&b.recycle()};js.$public.open=function(a){this.alink=a;null==this.alink?this.alink={param:{}}:null==this.alink.param&&(this.alink.param={});null!=a.param.$winEnv&&null!=a.param.$winEnv.$opener&&js.instanceOf(a.param.$winEnv.$opener,f.app.IPageComponent)&&(this._opener=a.param.$winEnv.$opener);var b=!0;null!=a.param&&null!=a.param.$modal&&(b=a.param.$modal);var c={};!0==b?this.showDialog(c):
this.show(c);js.isEmpty(a.param.entity)||this.setEntity(a.param.entity);if(null!=a.param.WF_taskKey&&(this.WF_task=wos.Desktop.getAttribute(a.param.WF_taskKey),null==this.WF_task)){f.ui.MessageBox.show("\u65e0\u6cd5\u627e\u5230\u76f8\u5e94\u7684\u5de5\u4f5c\u6d41\u5bf9\u8c61!","\u6253\u5f00\u5de5\u4f5c\u6d41\u4efb\u52a1\u9519\u8bef");return}null!=a.param.WF_mode&&(this.WF_mode=a.param.WF_mode);null!=a.param.WF_workItem&&(this.WF_workItem=a.param.WF_workItem);b=!1;null!=a.param.WF_workItemId&&null==
a.param.WF_data&&(wos.Remoting.call("WorkflowService.getWorkflowData",[a.param.WF_workItemId],this),b=!0);null!=a.param.entityUID&&(this.entityXml=f.app.Workspace.instance().getLoadedFile(a.param.entityUID),null==this.entityXml&&(c={x_name:"Entity"},c.uid=a.param.entityUID,f.app.Workspace.instance().loadFile(c,this,new wos.events.AsyncOption("loadEntityXml"))));null!=a.param.formUID&&(this.formXml=f.app.Workspace.instance().getLoadedFile(a.param.formUID),null==this.formXml?(c={x_name:"EntityForm"},
c.uid=a.param.formUID,f.app.Workspace.instance().loadFile(c,this,new wos.events.AsyncOption("loadFormXml"))):this.readRelationEntity());b||this.initForm();null!=a.param.title&&""!=a.param.title&&this.title(a.param.title)};js.$public.setSubmitList=function(a){this.submitList=a};js.$public.getSubmitList=function(){return this.submitList};js.$public.setPrintList=function(a){this.printList=a};js.$public.setHumanStartTask=function(a,b){this.WF_task=wos.Desktop.getAttribute("WF_"+a+"."+b);if(null==this.WF_task)wos.Remoting.call("WDService.getTaskWithName",
[b,a],this,new wos.events.AsyncOption("setHumanStartTask",{definitionName:a,taskName:b}));else this.onHumanStartTaskLoaded(this.WF_task)};this.onHumanStartTaskLoaded=function(a){this.WF_mode="HumanStart";this.WF_task=a;this.initForm()};this.isRelationEntityReady=function(){function a(b){if(js.isNull(b.parent))return b.level=1,b.property;var c=this.relationEntityMap[b.parent],d=a(c)+"."+b.property;b.level=c.level+1;return d}if(null==this.relationEntityMap)return!0;var b,c,d;for(d in this.relationEntityMap){b=
this.relationEntityMap[d];if(js.isNull(b.entityXml))return!1;c=js.isNull(b.parent)?this.entityXml:this.relationEntityMap[b.parent].entityXml;js.isNull(c)||(c=c.xpath('property[@uid \x3d "'+b.propertyUID+'"]')[0]||null,null!=c&&(b.property=c.attr("name"),b.propXml=c))}for(d in this.relationEntityMap)b=this.relationEntityMap[d],b.ref=a(b);return!0};this.readRelationEntity=function(){var a=this.formXml.children("relationEntity");if(0<a.length){this.relationEntityMap={};for(var b,c,d=0;d<a.length;d++)b=
a[d],c={},c.alias=b.attr("alias"),c.name=b.attr("name"),c.property=b.attr("property"),c.propertyUID=b.attr("propertyUID"),c.entityUID=b.attr("uid"),b.has("parent")&&(c.parent=b.attr("parent")),this.relationEntityMap[c.alias]=c,c.entityXml=f.app.Workspace.instance().getLoadedFile(c.entityUID),js.isNull(c.entityXml)&&(b={x_name:"Entity"},b.uid=c.entityUID,f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("relationEntityXml",c)))}else this.relationEntityMap=null};this.onFileLoaded=
function(a){switch(a.option.asyncName){case "loadEntityXml":this.entityXml=a.fileXml;this.initForm();break;case "loadFormXml":this.formXml=a.fileXml;this.readRelationEntity();this.initForm();break;case "relationEntityXml":a.option.asyncData.entityXml=a.fileXml;this.initForm();break;case "changeFormStyle":this.changeFormStyle(a.fileXml)}};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "setEntity":this.setEntity(a.result,!1);break;case "setEntityFamily":a=a.result;var b=a.$master;
delete a.$master;this.setEntity(b,!1,a);break;case "DynamicEntityService.createEntity":case "DynamicEntityService.createEntityFamily":this.cb_createEntity(a.result);break;case "DynamicEntityService.modifyEntity":case "DynamicEntityService.modifyEntityFamily":this.cb_modifyEntity(a.result);break;case "WDService.getTaskWithId":this.WF_task=a.result;this.initForm();break;case "WorkflowService.getWorkflowData":a=a.result;this.alink.param.WF_data=a;this.WF_workItem=a.WorkItem;this.WF_task=a.Task;null!=
this.WF_workItem&&this.submitPanel.setSubmitNote(this.WF_workItem.submitNote);this.initForm();break;case "WorkflowService.getWorkItem":this.WF_workItem=a.result;null!=this.WF_workItem&&this.submitPanel.setSubmitNote(this.WF_workItem.submitNote);this.initForm();break;case "setHumanStartTask":this.cb_getTaskWithName(a.option.asyncData.definitionName,a.option.asyncData.taskName,a.result);break;case "RemoteEventCallback":null!=a.option.asyncData&&this.cb_RemoteEvent(a.option.asyncData,a.result);break;
case "getPrintList":this.cb_getPrintList(a.result)}};this.onRemotingException=function(a,b){switch(a.option.asyncName){case "DynamicEntityService.createEntity":case "DynamicEntityService.createEntityFamily":case "DynamicEntityService.modifyEntity":case "DynamicEntityService.modifyEntityFamily":this.submitPanel.setEditable(!0)}};this.setStyle=function(a,b){this._$element.children(".qs-window").children(".win-client").css(a,b)};this.cb_RemoteEvent=function(a,b){if(null!=b&&null!=b.$jsResult){var c=
JSON.parse(b.$jsResult);null!=c&&(b=c)}this.fireFormEvent(a,{result:b})};this.cb_getPrintList=function(a){if(null!=a){for(var b={x_name:"print",menuitem:[]},c,d=0;d<a.length;d++)c=new f.Xml(a[d].privateValue),c=c.toJSON(),c.enabled=wos.PermissionUtil.instance().hasPermission(this._application.name(),c.permission),delete c.isBranch,b.menuitem.push(c);this.printList=b;"create"==this.getSubmitAction()?this.submitPanel.setPrintList(null):this.submitPanel.setPrintList(b)}};this.despatchEntityEvent=function(a,
b){if(null!=this._opener&&js.instanceOf(this._opener,f.app.QueryControl)){var c=this._opener;if(this.entityXml.attr("uid")==c.masterEntityXml().attr("uid")){this._opener.onEntityChange(this.entityXml.attr("name"),this.entityXml.attr("uid"),b,a);return}}wos.Desktop.instance().dispatchEvent("ime.DynamicEntity",{action:a,param:b})};this.cb_createEntity=function(a){null!=a?(a.$type$==this.entityXml.attr("name")&&(this.disableChangeEvent=!0,this.xmlForm.setEntity(a),this.disableChangeEvent=!1,js.isNull(this.alink)||
js.isNull(this.alink.param)||js.isNull(this.alink.param.WF_workItemId)||wos.Desktop.instance().dispatchEvent("ime.WorkItem",{action:"completed",param:this.alink.param.WF_workItemId})),this.despatchEntityEvent("create",a),this.dispatchEvent(this.$class.ENTITY_CREATE_EVENT,a)):a={};this.fireFormEvent("postSubmit",{entity:a})};this.cb_modifyEntity=function(a){a?(a.$type$==this.entityXml.attr("name")&&null!=this.alink.param.WF_workItemId&&wos.Desktop.instance().dispatchEvent("ime.WorkItem",{action:"completed",
param:this.alink.param.WF_workItemId}),this.despatchEntityEvent("edit",a),this.dispatchEvent(this.$class.ENTITY_MODIFY_EVENT,a)):a={};this.fireFormEvent("postSubmit",{entity:a})};this.cb_getTaskWithName=function(a,b,c){null==c?f.ui.MessageBox.show('\u65e0\u6cd5\u627e\u5230\u5de5\u4f5c\u6d41\u5bf9\u8c61"'+a+'"\uff0c\u6216\u5de5\u4f5c\u6d41\u5bf9\u8c61\u4e2d\u4e0d\u5b58\u5728\u4efb\u52a1"'+b+'"',"\u6253\u5f00\u5de5\u4f5c\u6d41\u4efb\u52a1\u9519\u8bef"):(wos.Desktop.setAttribute("WF_"+a+"."+b,c),this.onHumanStartTaskLoaded(c))};
js.$public.getWFContext=function(){var a;a=this.submitPanel.getSubmit();var b={};if("HumanStart"==this.WF_mode){if(b.mode="HumanStart",b.humanStartTaskId=this.WF_task.id,b.processName=this.alink.param.WF_processName,b.params={},null!=this.submitPanel&&(b.submit=a.attr("name"),b.processName=this.submitPanel.getProcessName(),b.formState=parseInt(a.attr("state")),b.formStateName=a.attr("stateName"),a.has("parentFormState")&&(b.parentFormState=a.attr("parentFormState")),a.has("parentFormStateName")&&
(b.parentFormStateName=a.attr("parentFormStateName")),a.has("parentSubmit")&&(b.parentSubmit=a.attr("parentSubmit")),a=this.submitPanel.getSubmitTarget(),null!=a&&0<a.id&&(b.targetPrincipalId=a.id)),b.humanStartTaskId)return b}else if("HumanSubmit"==this.WF_mode&&(b.mode="HumanSubmit",b.processId=this.WF_workItem.processInstanceId,b.workItemId=this.WF_workItem.id,null!=this.submitPanel&&(b.submit=a.attr("name"),b.submitNote=this.submitPanel.getSubmitNote(),b.formState=parseInt(a.attr("state")),b.formStateName=
a.attr("stateName"),a.has("parentFormState")&&(b.parentFormState=a.attr("parentFormState")),a.has("parentFormStateName")&&(b.parentFormStateName=a.attr("parentFormStateName")),a.has("parentSubmit")&&(b.parentSubmit=a.attr("parentSubmit")),a=this.submitPanel.getSubmitTarget(),null!=a&&0<a.id&&(b.targetPrincipalId=a.id),isNaN(b.formState)&&(b.formState=0)),b.processId&&b.workItemId&&b.submit))return b;return null};this.onSubmitChange=function(a){if(null!=this.submitPanel){this.applyRules();this.ruleManager.onReady();
this.validateForm();a=this.submitPanel.getSubmit();var b={};b.submitName=a.attr("name");b.submitType=a.toJSON();this.fireFormEvent("submitChange",b)}};this.onFormStyleChange=function(a,b){var c=b.formUID;if(null!=c&&""!=c){var d=f.app.Workspace.instance().getLoadedFile(c);null==d?(d={x_name:"EntityForm"},d.uid=c,f.app.Workspace.instance().loadFile(d,this,new wos.events.AsyncOption("changeFormStyle"))):this.changeFormStyle(d)}};this.changeFormStyle=function(a){};this.onFormStyleChangeEnd=function(a){};
this.applyRules=function(){var a=this.getAllRule();if(null!=this.submitPanel){var b=this.submitPanel.getSubmit();if(null!=b){var c,d,e=[];for(c in this.validatorMap)e.push(c);for(d=0;d<e.length;d++)this.setPropertyRequired(e[d],!1);if(b!=this.oldSubmit&&null!=this.oldSubmit)for(e=this.oldSubmit.children("rule"),d=0;d<e.length;d++)c=e[d].attr("property"),this.setPropertyRequired(c,!1);this.oldSubmit=b;a.push(b)}}this.ruleManager.rules(a)};js.$public.getSubmitAction=function(){if(null==this.alink||
null==this.alink.param)return"";var a=this.alink.param.action;null==a&&(a=null!=this.alink.param.entityId?"edit":"create");return a};this.getAllRule=function(){var a=[],b;null!=this.entityXml&&(b=this.entityXml.xpath("relation")[0],js.isNull(b)||a.push(b));if(null!=this.formXml&&null!=this.alink.param.formState&&(b=this.formXml.xpath("formState/state[@uid \x3d '"+this.alink.param.formState+"']")[0],js.isNull(b)&&(b=this.formXml.xpath("formState/state[@label \x3d '"+this.alink.param.formState+"']")[0]),
!js.isNull(b))){if("null"!=b.attr("basedOn")){var c=this.formXml.xpath("formState/state[@uid \x3d '"+b.attr("basedOn")+"']")[0];js.isNull(c)||a.push(c)}a.push(b)}null!=this.WF_task&&null!=this.WF_task.formUI&&""!=this.WF_task.formUI&&a.push(new f.Xml(this.WF_task.formUI));return a};js.$public.getFormState=function(){if(null!=this.formXml&&null!=this.alink&&null!=this.alink.param&&null!=this.alink.param.formState){var a=this.formXml.xpath("formState/state[@uid \x3d '"+this.alink.param.formState+"']")[0];
return js.isNull(a)?this.alink.param.formState:a.attr("label")}return""};js.$public.setFormState=function(a){this.alink.param.formState=a;this.applyRules();this.ruleManager.onReady()};this.setFormProperty=function(a,b){var c,d,e;if("copyEnabled"==a)c=js.type(b),"string"==c||"boolean"==c?(c=Boolean(b),d=null):(c=b.enabled,d=b.label),!0==c&&"create"!=this.getSubmitAction()?this.submitPanel.showCopyButton(c,d):this.submitPanel.showCopyButton(!1);else if("formStyles"==a)null!=b&&(d=null!=b.labelName?
b.labelName:null!=b.label?b.label:"\u8868\u5355:",this.submitPanel.setFormStyles(d,b.styles,b.width));else if("currentFormStyle"==a)null!=b&&null!=this.submitPanel&&this.submitPanel.setCurrentFormStyle(String(b));else if("submitTargetList"==a)this.submitPanel&&(!1==b.enabled?this.submitPanel.enableSubmitTarget(!1,!1):null!=b.label&&null!=b.list&&this.submitPanel.setSubmitTargetList(b.label,b.list));else if("submitList"==a){if(this.submitPanel&&("HumanStart"==this.WF_mode||"HumanSubmit"==this.WF_mode)&&
null!=this.WF_task)if(null!=b.mode&&this.submitPanel.setSubmitButtonMode(b.mode),null!=b.list&&"array"==js.type(b.list)){d=new f.Xml("\x3csubmitList /\x3e");var g;for(e=0;e<b.list.length;e++){c=b.list[e];g=d.append("submit");for(var k in c)g.attr(k,c[k])}this.submitPanel.setSubmitList(d)}else null!=b.xml&&(d=new f.Xml(String(b.xml)),null!=d&&this.submitPanel.setSubmitList(d))}else"confirmClose"==a&&(this.confirmClose=Boolean(b))};this.getFormProperty=function(a){switch(a){case "openParameter":return this.getOpenParameter();
case "workitem":return this.WF_workItem;case "workflowTask":return this.WF_task;case "workflowMode":return this.WF_mode;case "formUID":return this.formXml.attr("uid")}return null};this.selectTab=function(a){this.xmlForm.selectedTab(a)};js.$public.setEntity=function(a,b,c){b=js.param(b,!1);c=js.param(c,null);this.entityLoading=!1;this.entity=a;if(null!=a){var d;if(!0==this.created&&!0==this.xmlForm.generated()){var e=a.$children,g=!0;if(null!=e){g=!1;delete a.$children;d=this.xmlForm.getControlDescriptor();
for(var k in d)js.instanceOf(d[k].input,f.app.QueryControl)&&(d[k].input.reset(!0),d[k].input.value(e))}if(!0!=b&&("create"!=this.getSubmitAction()?(this.disableChangeEvent=!0,this.xmlForm.setEntity(a),js.isNull(this.relationEntityMap)||js.isNull(c)||this.xmlForm.setRelationEntities(c),this.disableChangeEvent=!1):this.xmlForm.setEntity(a),this.submitPanel.setEntity(a),this.ruleManager.onReady(),"view"==this.getSubmitAction()&&this.editable(!1),null!=this.formXml&&(js.isNull(this.relationEntityMap)||
js.isNull(c)?this.fireFormEvent("initialize",{entity:a}):this.fireFormEvent("initialize",{entity:c.$master})),g))for(k in d=this.xmlForm.getControlDescriptor(),d)js.instanceOf(d[k].input,f.app.QueryControl)&&d[k].input.refresh()}if(!0==b&&null!=a.id&&null!=a.$type$)if(isNaN(parseInt(a.id)))!0==this.created&&!0==this.xmlForm.generated()&&("create"!=this.getSubmitAction()?(this.disableChangeEvent=!0,this.xmlForm.setEntity(a),this.disableChangeEvent=!1):this.xmlForm.setEntity(a));else if(this.entityLoading=
!0,js.isNull(this.relationEntityMap))wos.Remoting.call("DynamicEntityService.getEntity",[a.id,a.$type$],this,new wos.events.AsyncOption("setEntity"));else{c={};for(var m in this.relationEntityMap)b=this.relationEntityMap[m],c["#"+b.level+"#"+b.ref]=b.name;wos.Remoting.call("DynamicEntityService.getEntityFamily",[a.id,a.$type$,c],this,new wos.events.AsyncOption("setEntityFamily"))}}};js.$public.getEntity=function(){return this.xmlForm.getEntity()};js.$public.autoSize=function(){if(!0==this.isFormCreated){this.invalidateSize(!0);
var a=this._$element.find(".qs-window .win-titlebar"),a={width:this.outerWidth(),height:Math.min(this.xmlForm.maxHeight+this.submitPanel.outerHeight()+a.outerHeight(),f.ui.windowHeight()-40)};this.outerSize(a,!0)}};this.initForm=function(){this.isInitialized=!1;if(!0==this.created&&null!=this.formXml&&("EntityForm"!=this.formXml.name()||null!=this.entityXml)&&(js.isNull(this.relationEntityMap)||this.isRelationEntityReady())&&(this.submitPanel&&this.submitPanel.reinit(),"EntityForm"==this.formXml.name()&&
null!=this.entityXml&&null==this.printList&&wos.Remoting.call("WorkshopService.getEntityItem",[parseInt(this.entityXml.attr("nodeID")),"ReportGroup"],this,new wos.events.AsyncOption("getPrintList")),null==this.alink.param.title||""==this.alink.param.title?""!=this.formXml.attr("label")?this.title(this.formXml.attr("label")):this.title(this.entityXml.attr("label")):this.title(this.alink.param.title),"HumanStart"!=this.WF_mode||null!=this.WF_task)&&("HumanSubmit"!=this.WF_mode||null!=this.WF_workItem&&
null!=this.WF_task)){"HumanStart"!=this.WF_mode&&"HumanSubmit"!=this.WF_mode||null==this.WF_task||this.title(this.title()+"\u2014\u2014"+this.WF_task.name);"HumanSubmit"==this.WF_mode&&(this.entity={id:this.alink.param.entityId,$type$:this.entityXml.attr("name")},this.setEntity(a,!0),this.alink.param.action="edit");if(!0!=this.isFormCreated){this.xmlForm.generateForm(this.formXml.xpath("Window")[0],this.entityXml,this.relationEntityMap);this.isFormCreated=!0;this.autoSize();this.centerScreen();var a=
this.xmlForm.getControlDescriptor(),b;for(b in a)js.instanceOf(a[b].input,f.app.QueryControl)&&a[b].input.addEventListener(f.app.QueryControl.LOADED_EVENT,this.onQueryControlLoaded,this)}else{this.xmlForm.selectedTab(0);a=this.xmlForm.getControlDescriptor();if(null==this.entity&&!this.isCopyed)for(b in a)js.instanceOf(a[b].input,f.app.QueryControl)&&a[b].input.reset(!0);for(b=0;null!=(a=this.xmlForm.getTabAt(b));)js.instanceOf(a,f.ui.ScrollView)&&a.scrollTo(0,0),b++;this.submitPanel.setEditable(!0)}if(null!=
this.WF_task&&null!=this.WF_task.formUI){b=new f.Xml(this.WF_task.formUI);if(0<b.xpath("submit_list").length){a=b.xpath("submit_list")[0];if("true"==b.attr("isBeforeEndTask")){var c=b.attr("endTransition"),d=a.xpath('submit[@name \x3d "'+c+'"]')[0];if(null!=this.alink.param.WF_data){var e=this.alink.param.WF_data.EnterTask;if(null!=e){var g=a.xpath('submit[@name \x3d "'+c+'"]')[0];js.isNull(g)||g.remove();e=(new f.Xml(String(e.formUI))).xpath("submit_list/submit");for(g=0;g<e.length;g++){var k=e[g],
m=d.copy();m.attr("value",c+"--\x3e"+k.attr("name"));m.attr("parentFormState",k.attr("state"));m.attr("parentFormStateName",k.attr("stateName"));m.attr("parentSubmit",k.attr("name"));a.append(m)}}}}this.setSubmitList(a)}b=b.xpath("submit_target")[0];!js.isNull(b)&&b.has("departmentPath")&&(a=!1,"true"==b.attr("required")&&(a=!0),this.submitPanel.enableSubmitTarget(!0,a,b.attr("departmentPath")))}this.submitPanel.task(this.WF_task);this.submitPanel.setSubmitList(this.submitList);"create"==this.getSubmitAction()?
this.submitPanel.setPrintList(null):this.submitPanel.setPrintList(this.printList);this.submitPanel.setWFMode(this.WF_mode);this.submitPanel.setEditable(this.isEditable);!0==this.alink.param.isCopyable&&"create"!=this.getSubmitAction()?this.submitPanel.showCopyButton(!0):this.submitPanel.showCopyButton(!1);null!=this.WF_workItem&&this.submitPanel.setSubmitNote(this.WF_workItem.submitNote);if(null!=this.entityXml)for(b=this.entityXml.xpath('property[@type \x3d "coding"]'),e=0;e<b.length;e++)d=b[e],
c=d.attr("codingPattern"),a=this.getSequenceName(this.entityXml,d),this.regCodingField(d.attr("name"),a,c);this.ruleManager.entityXml(this.entityXml);js.isNull(this.relationEntityMap)||this.ruleManager.relationEntityMap(this.relationEntityMap);this.applyRules();var a=this.entity;if("create"==this.getSubmitAction()){if(this.ruleManager.isDefaultEntityReady()&&!this.isCopyed&&(a=this.ruleManager.defaultEntity(),null!=this.alink.param.defaultEntity&&(a=js.clone(this.alink.param.defaultEntity)),null!=
this.entity?(a=js.clone(this.entity),this.ruleManager.onReady(),this.disableChangeEvent=!0,this.xmlForm.setEntity(a),this.disableChangeEvent=!1):(this.disableChangeEvent=!0,this.xmlForm.setEntity(a),this.disableChangeEvent=!1,this.ruleManager.onReady()),null!=a.WF_ProcessName&&""!=a.WF_ProcessName&&this.submitPanel.setProcessName(a.WF_ProcessName)),this.isCopyed)this.ruleManager.onReady()}else if(null!=this.entity)!1==this.entityLoading&&null==this.xmlForm.getEntity().id&&this.setEntity(this.entity,
!1);else if(null!=this.alink.param.entityId){if(js.isNull(this.relationEntityMap))wos.Remoting.call("DynamicEntityService.getEntity",[this.alink.param.entityId,this.entityXml.attr("name")],this,new wos.events.AsyncOption("setEntity"));else{var a={},n;for(n in this.relationEntityMap)b=this.relationEntityMap[n],a["#"+b.level+"#"+b.ref]=b.name;wos.Remoting.call("DynamicEntityService.getEntityFamily",[this.alink.param.entityId,this.entityXml.attr("name"),a],this,new wos.events.AsyncOption("setEntityFamily"))}return}this.fireFormEvent("initialize",
{entity:a||{}});this.invalidateSize(!0)}};this.setFieldValidator=function(a,b){if(!js.instanceOf(a,f.ui.Label)){var c=null;!1==b?(c=this.validatorMap[a.name()],js.isNull(c)||(c.show(!1),c.source(null)),delete this.validatorMap[a.name()]):null==this.validatorMap[a.name()]&&(js.instanceOf(a,f.ui.IFormControl)&&(c=new f.ui.Validator,c.required(!0),c.source(a),c.message("\u8fd9\u4e2a\u5b57\u6bb5\u5fc5\u987b\u586b\u5199")),null!=c&&(this.validatorMap[a.name()]=c,this.xmlForm.addValidator(a,c),c.validate()||
c.show(!0)))}};this.onFieldValueChange=function(a,b){if(!0!=this.disableChangeEvent){var c=b.fieldName,d=b.fieldValue;if("create"==this.getSubmitAction()||!0==this.isInitialized||!0==this.isInitializing)this.ruleManager.onPropertyValueUpdated(c,d);c=this.codingUpdateFieldMap[c];js.isNull(c)||(c=this.codingFieldMap[c],null!=c&&c.generate())}};this.onFormButtonActionEvent=function(a,b){this.fireFormEvent(b.action)};this.onFieldChangeAction=function(a,b){this.fireFormEvent(b.changeEvent,{fieldName:b.fieldName})};
this.getExpressionValue=function(a){a=this.expParser.calculate(a);return a.state==wos.expression.ExpressionResult.CALCULATED?a.value:null};this.alinkHandler=function(a){var b;a=wos.ALink.parseALink(a);null==a.param&&(a.param={});"EntityForm"==a.form?(b=new f.app.FormWindow,b.opener(this),b.application(this.application()),b.open(a,this)):"EntityQuery"==a.form?(b=new f.app.PageWindow,b.opener(this),b.application(this.application()),b.open(a,this)):"FreeForm"==a.form?(b=new f.app.FormWindow,b.opener(this),
b.application(this.application()),b.offlineMode(!0),b.open(a,this)):"PageWindow"==a.form?(b=new f.app.PageWindow,b.opener(this),b.application(this.application()),b.open(a,this)):"EntitySelectWindow"==a.form?(b=new f.app.PageWindow,b.opener(this),b.application(this.application()),b.open(a,this)):(a.param.$winEnv={$opener:this},wos.Desktop.openALinkWindow(a))};this.getScriptHost=function(a){a=this.expParser.calculate(a);if(a.state==wos.expression.ExpressionResult.CALCULATED&&(a=a.value,js.instanceOf(a,
wos.script.IScriptHost))){var b=wos.script.ScriptProxy.regHost(this,a);if(null!=b)return{hostUID:b,hostName:a.getHostName()}}return null};this.setFieldProperty=function(a,b,c){"focus"==b&&(this.lastEnterCtrl=null);"enabled"==b?this.setPropertyEnabled(a,c):"required"==b?this.setPropertyRequired(a,c):this.xmlForm.setFieldProperty(a,b,c)};this.cloneSimpleObject=function(a){var b=js.type(a);if("string"==b||"number"==b||"date"==b||"boolean"==b)return a;var c={},d,e;for(e in a)if(d=a[e],b=js.type(d),null==
d)c[e]=null;else if("string"==b||"number"==b||"date"==b||"boolean"==b)c[e]=d;else if(!js.instanceOf(d,f.ui.Control))if("array"==b){for(var b=[],g=0;g<d.length;g++)b.push(this.cloneSimpleObject(d[g]));c[e]=b}else c[e]=this.cloneSimpleObject(d);return c};this.getOpenParameter=function(){return null!=this.alink&&null!=this.alink.param?this.cloneSimpleObject(this.alink.param):null};this.messageCloseHandler=function(a){var b={};switch(a){case f.ui.MessageBox.Yes:b.detail="YES";break;case f.ui.MessageBox.No:b.detail=
"NO";break;case f.ui.MessageBox.OK:b.detail="OK"}this.fireFormEvent(this.messageCallbackEvent,b)};this.showMessageBox=function(a,b,c,d){var e=f.ui.MessageBox.OK;"YesNo"==c&&(e=f.ui.MessageBox.YesNo);this.messageCallbackEvent=d;f.ui.MessageBox.show(a,b,e,f.ui.MessageBox.Info,this.messageCloseHandler,this)};js.$public.onValueReady=function(a,b){"defaultEntity"==a&&(this.xmlForm.setEntity(b),this.ruleManager.onReady(),!1==this.isInitialized&&!1==this.isInitializing&&this.fireFormEvent("initialize",{entity:b}))};
js.$public.setPropertyValue=function(a,b,c){c=js.param(c,!0);"WF_ProcessName"==a?this.submitPanel.setProcessName(b):"WF_SubmitNote"==a?this.submitPanel.setSubmitNote(b):"WF_SubmitTarget"==a?this.submitPanel.setSubmitTarget(b):this.xmlForm.setFieldValue(a,b,c)};js.$public.setPropertyRequired=function(a,b){var c=this.xmlForm.getControlDescriptor(),d;if("*"==a)for(var e in c)d=c[e].input,null!=d&&this.setFieldValidator(d,b);else"WF_SubmitNote"==a?this.submitPanel.setSubmitNoteRequired(b):null!=c[a]&&
(d=c[a].input,null!=d&&this.setFieldValidator(d,b))};js.$public.setPropertyEnabled=function(a,b){if(!1!=this.created)if("*"==a){var c=this.xmlForm.getControlDescriptor(),d,e,f;for(f in c)d=c[f].input,e=c[f].property,js.isNull(e)||"true"!=e.attr("systemProperty")||"true"==e.attr("valueEditable")?this.xmlForm.setFieldEnable(d,b):this.xmlForm.setFieldEnable(d,!1)}else"WF_ProcessName"==a?this.submitPanel.setProcessNameEnabled(b):"WF_SubmitNote"==a?this.submitPanel.showSubmitNote(b):this.xmlForm.setFieldProperty(a,
"enabled",b)};js.$public.firePropertyUpdateEvent=function(a,b,c){null==c&&(c={});c.propName=a;c.propValue=this.xmlForm.getEntity()[a];this.fireFormEvent(b,c)};js.$public.getVariableValue=function(a,b){var c,d=wos.expression.ExpressionResult.CALCULATED;switch(a){case "this":case "$this":case "entity":case "$entity":c=this.xmlForm.getEntity(!1,!1);null==c&&!js.isNull(this.alink)&&!js.isNull(this.alink.param)&&0<this.alink.param.entityId&&(c={id:this.alink.param.entityId});if(!js.isNull(this.relationEntityMap)){var e=
this.xmlForm.getRelationEntities(!1,!1);null==c&&(c={});for(a in e)c[a]=e[a]}return new wos.expression.ExpressionResult(d,c);case "opener":case "$opener":return new wos.expression.ExpressionResult(d,this._opener);case "openParameter":case "$openParameter":return new wos.expression.ExpressionResult(d,this.getOpenParameter());case "ctx":case "$ctx":return null==this.alink.param?new wos.expression.ExpressionResult(d,null):new wos.expression.ExpressionResult(d,this.alink.param.ctx);case "alink":case "$alink":return new wos.expression.ExpressionResult(d,
this.alink)}c=this.xmlForm.getFieldInput(a);return null!=c?js.instanceOf(c,wos.expression.IExpressionValueProvider)?new wos.expression.ExpressionResult(d,c):new wos.expression.ExpressionResult(d,this.xmlForm.getFieldValue(a)):wos.expression.ExpressionResult.InvalideResult};js.$public.getFunctionValue=function(a,b,c){switch(a){case "ctx":return null==this.alink.param||null==this.alink.param.ctx?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):0==b.length?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this.alink.param.ctx.master):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.alink.param.ctx[b[0]])}return wos.expression.ExpressionResult.InvalideResult};js.$public.getHostName=function(){return"ime.appwindow.FormWindow"};js.$public.scriptInvoke=function(a,b){var c;switch(a){case "fireRemoteEvent":this.fireRemoteEvent(b[0],b[1],b[2]);break;case "fireCustomerEvent":this.fireFormEvent(b[0],b[1]);break;case "callRemoteQuery":this.callRemoteQuery(b[0],b[1]);break;
case "setHumanStartTask":this.setHumanStartTask(b[0],b[1]);break;case "setFieldValue":this.setPropertyValue(b[0],b[1],b[2]);break;case "getFieldValue":return this.xmlForm.getFieldValue(b[0]);case "setFieldProperty":this.setFieldProperty(b[0],b[1],b[2]);break;case "getEntity":c=this.xmlForm.getEntity();if(!js.isNull(this.relationEntityMap)){var d=this.xmlForm.getRelationEntities(!1,!1),e;for(e in d)c[e]=d[e]}return c;case "updateEntity":this.updateEntity(b[0],b[1]);break;case "createEntity":this.createEntity(b[0],
b[1]);break;case "addInstruction":this.addInstruction(b[0]);break;case "getSubmitAction":return this.getSubmitAction();case "getFormState":return this.getFormState();case "setFormState":this.setFormState(b[0]);break;case "setEditable":this.editable(b[0]);break;case "generateCoding":this.generateCoding(b[0],b[1]);break;case "getExpressionValue":return this.getExpressionValue(b[0]);case "getScriptHost":return this.getScriptHost(b[0]);case "getVariable":return this.getVariable(b[0]);case "setVariable":this.setVariable(b[0],
b[1]);break;case "selectTab":this.selectTab(b[0]);break;case "setTitle":this.title(b[0]);break;case "getOpenParameter":return this.getOpenParameter();case "setStyle":this.setStyle(b[0],b[1]);break;case "openALink":this.alinkHandler(b[0]);break;case "setFormProperty":this.setFormProperty(b[0],b[1]);break;case "getFormProperty":return this.getFormProperty(b[0]);case "validateForm":return this.validateForm();case "showMessageBox":this.showMessageBox(b[0],b[1],b[2],b[3]);break;case "submit":this.eventFinished("preSubmit",
null)}return null};js.$public.application=function(a){if(void 0===a)return this._application;this._application=a};js.$public.getProperty=function(a){switch(a){case this.$class.PROP_SUBMIT_ACTION:return this.getSubmitAction();case this.$class.PROP_INITIALIZED:return this.isInitialized;case this.$class.PROP_ISENTITYFORM:return this.isEntityForm();case this.$class.PROP_ENTITYNAME:return this.entityXml.attr("name")}a=this.expParser.calculate(a);return a.state==wos.expression.ExpressionResult.CALCULATED?
a.value:null};js.$public.setProperty=function(a,b){};this.fireRemoteEvent=function(a,b,c){var d,e=a.split(".");2==e.length?(d=e[0],a=e[1]):d=entityXml.attr("name");wos.Remoting.call("DynamicEntityService.fireCustomeEvent",[d,a,b],this,new wos.events.AsyncOption("RemoteEventCallback",c))};this.callRemoteQuery=function(a,b){wos.Remoting.call("QueryService.executeEntityHQL",[a],this,new wos.events.AsyncOption("RemoteEventCallback",b))};this.onQueryControlLoaded=function(a){a=this.xmlForm.getControlDescriptor();
for(var b in a)if(js.instanceOf(a[b].input,f.app.QueryControl)&&!a[b].input.loaded())return;!0!=this.isInitialized&&!0!=this.entityLoading&&this.fireFormEvent("initialize",{entity:this.entity})};this.fireFormEvent=function(a,b){b=js.param(b,null);var c=this.formXml.xpath('formEvent/event[@name \x3d "'+a+'"]')[0],d=null;js.isNull(c)||(d=StringUtil.trim(c.text()));if(null!=d&&""!=d){if("initialize"==a){var c=this.xmlForm.getControlDescriptor(),e;for(e in c)if(js.instanceOf(c[e].input,f.app.QueryControl)&&
!c[e].input.loaded())return;if(!0==this.isInitializing||!0==this.isInitialized)return;this.isInitializing=!0}wos.script.ScriptProxy.asyncExecute(this,d,b,new wos.events.AsyncOption(a))}else this.eventFinished(a,null)};this.onKeyDown=function(a){var b=a.keyCode?a.keyCode:a.which;if(13==b){var c="";a=f.ui.Control.findOwnerControl(a.target);if(null==a)return;var d=this.xmlForm.getControlDescriptor();if(js.instanceOf(a,f.ui.TextArea)||js.instanceOf(a,f.ui.RichTextEditor))return;c=a.name();if(null!=d[c]&&
a!=this)return this.lastEnterCtrl=a,this.fireFormEvent("enter",{field:c}),!1;js.instanceOf(a,f.ui.Button)&&a.dispatchEvent("click")}if(27==b)this.onClose(null)};this.onScriptExecuteFinished=function(a){this.eventFinished(a.option.asyncName,a.result)};this.recreateHandler=function(a){a==f.ui.MessageBox.No?this.close(!1):(a=this.alink,this.reset(),this.alink=a,this.entity=null!=this.eventResult.entity?eventResult.entity:this.ruleManager.defaultEntity(),null!=this.entity?(this.ruleManager.onReady(),
this.disableChangeEvent=!0,this.xmlForm.setEntity(entity),this.disableChangeEvent=!1):(this.xmlForm.setEntity(null),this.ruleManager.onReady()),this.fireFormEvent("initialize",{entity:this.entity}))};this.eventFinished=function(a,b){var c,d;if(null!=b){if(!0==b.error){null!=b.message&&""!=b.message&&f.ui.MessageBox.show(b.message,"\u9519\u8bef",f.ui.MessageBox.OK);"initialize"==a?this.close():"preSubmit"==a&&this.submitPanel.setEditable(!0);return}if(!0==b.stop){"preSubmit"==a&&this.submitPanel.setEditable(!0);
return}}switch(a){case "initialize":this.isInitialized=!0;this.isInitializing=!1;c=this.xmlForm.getControlDescriptor();for(d in c)js.instanceOf(c[d].input,f.app.QueryControl)?c[d].input.reinitialize():js.instanceOf(c[d].input,f.app.ReportControl)&&(c[d].input.entity(this.entity),c[d].input.entityXml(this.entityXml),c[d].input.reportUID(c[d].xml.attr("reportUID")));this.validateForm();break;case "preSubmit":this.submitPanel.setEditable(!1);this.isEntityForm()?!0==this.offlineMode()?(c=this.xmlForm.getEntity(),
"create"==this.getSubmitAction()?(c.id="$"+Math.uuid(),d=c.id):d=null!=c.id&&"$"==String(c.id).charAt(0)?c.id:"$"+this.entityXml.attr("name")+"."+c.id,d=this.getFamilyChildren(d),null!=d&&(c.$children=d),c.$type$=this.entityXml.attr("name"),this.despatchEntityEvent(this.getSubmitAction(),c),this.close(!1)):this.doSubmitAction():(this.saveEntities(),this.fireFormEvent("postSubmit",{entity:this.xmlForm.getEntity()}));break;case "postSubmit":this.saveEntities();"create"==this.getSubmitAction()&&null!=
b&&"recreate"==b.action?(this.eventResult=b,f.ui.MessageBox.show(b.message,"\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.recreateHandler,this)):(this.reset(),this.close(!1));break;case "copy":c=this.xmlForm.getControlDescriptor();for(d in c)js.instanceOf(c[d].input,f.app.QueryControl)&&c[d].input.dispatchEvent(f.app.form.SubmitPanel.COPY);null!=b&&this.xmlForm.setEntity(b);break;case "enter":null!=this.lastEnterCtrl&&f.ui.FocusManager.focusNext(this.lastEnterCtrl)}};this.getFamilyChildren=function(a){var b=
{},c=!1,d,e,g=this.xmlForm.getControlDescriptor(),k;for(k in g)if(js.instanceOf(g[k].input,f.app.QueryControl)&&(d=g[k].input,e=d.value(),null!=e)){for(var c=e.list,m=0;m<c.length;m++)isNaN(parseInt(c[m].id))&&(c[m][d.parentField()+"_id"]=a+".id",c[m][d.parentField()+"_label"]="$parent.label");if(null!=b[e.key]&&"array"==js.type(b[e.key]))for(d=0;d<c.length;d++)b[e.key].push(c[d]);else b[e.key]=c;c=!0}return!0==c?b:null};this.convertFamilyChildren=function(a,b,c){var d,e,f,k;for(k in a){d=a[k];null==
c["$"+b+"$"+k]?(f=[],c["$"+b+"$"+k]=f):f=c["$"+b+"$"+k];var m;for(e=0;e<d.length;e++)if(m=d[e],null!=m.$children)this.convertFamilyChildren(m.$children,b+1,c),delete m.$children,delete m.$modified$,f.push(m);else if(!0==Boolean(m.$modified$)||!0==Boolean(m.$delete$)||isNaN(parseInt(m.id)))delete m.$modified$,f.push(m)}};this.doSubmitAction=function(){var a=this.getWFContext(),b;b="create"==this.getSubmitAction()?this.xmlForm.getEntity(!1):this.xmlForm.getEntity(!0);a&&(b.WF_State=a.formState,b.WF_StateName=
a.formStateName);var c=null,d=this.getFamilyChildren("$parent");js.isNull(d)||(c={},this.convertFamilyChildren(d,1,c));if(!js.isNull(this.relationEntityMap)){null==c&&(c={});var d="create"==this.getSubmitAction()?this.xmlForm.getRelationEntities(!1):this.xmlForm.getRelationEntities(!0),e,g={},k;for(k in this.relationEntityMap)e=this.relationEntityMap[k],g[e.ref]=e;var m,n;for(n in d)e=g[n],k=1==e.level?b:d[this.relationEntityMap[e.parent].ref],js.isNull(k[e.property+"_id"])&&(k[e.property+"_id"]=
"$"+e.ref+".id",m=e.propXml.attr("labelField"),!js.isEmpty(k[e.property+"_label"])&&js.isEmpty(d[n][m])&&(d[n][m]=k[e.property+"_label"])),c["#"+e.level+"#"+e.ref+"#"+e.name]=[d[n]]}n=this.getSubmitAction();for(var l in this.codingFieldMap)d=this.codingFieldMap[l],null!=d&&d.coding()!=b[d.name()]&&d.recycle();if("create"==n){delete b.id;if(0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length){wos.Remoting.beginBatchCall(!0);for(l=0;l<this.updateEntities.length;l++)wos.Remoting.call("DynamicEntityService.modifyEntity",
[this.updateEntities[l].entityName,this.updateEntities[l].entity,null],this);for(l=0;l<this.createEntities.length;l++)wos.Remoting.call("DynamicEntityService.createEntity",[this.createEntities[l].entityName,this.createEntities[l].entity,null],this);for(l=0;l<this.instructions.length;l++)wos.Remoting.call("DynamicEntityService.executeInstruction",[this.instructions[l]],this)}null!=c?wos.Remoting.call("DynamicEntityService.createEntityFamily",[this.entityXml.attr("name"),b,c,a],this):wos.Remoting.call("DynamicEntityService.createEntity",
[this.entityXml.attr("name"),b,a],this);(0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length)&&wos.Remoting.endBatchCall()}else if("edit"==n){if(0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length){wos.Remoting.beginBatchCall(!0);for(l=0;l<this.updateEntities.length;l++)wos.Remoting.call("DynamicEntityService.modifyEntity",[this.updateEntities[l].entityName,this.updateEntities[l].entity,null],this);for(l=0;l<this.createEntities.length;l++)wos.Remoting.call("DynamicEntityService.createEntity",
[this.createEntities[l].entityName,this.createEntities[l].entity,null],this);for(l=0;l<this.instructions.length;l++)wos.Remoting.call("DynamicEntityService.executeInstruction",[this.instructions[l]],this)}null!=c?wos.Remoting.call("DynamicEntityService.modifyEntityFamily",[this.entityXml.attr("name"),b,c,a],this):wos.Remoting.call("DynamicEntityService.modifyEntity",[this.entityXml.attr("name"),b,a],this);(0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length)&&wos.Remoting.endBatchCall()}else f.ui.MessageBox.show("\u8868\u5355\u7684\u6267\u884c\u52a8\u4f5c\u4e0d\u80fd\u88ab\u8bc6\u522b\uff1a"+
n,"\u9519\u8bef");this.updateEntities.length=0;this.createEntities.length=0;this.instructions.length=0};this.saveEntities=function(){var a;if(0<this.updateEntities.length||0<this.createEntities.length||0<this.instructions.length){wos.Remoting.beginBatchCall(!0);for(a=0;a<this.updateEntities.length;a++)wos.Remoting.call("DynamicEntityService.modifyEntity",[this.updateEntities[a].entityName,this.updateEntities[a].entity,null],this);for(a=0;a<this.createEntities.length;a++)wos.Remoting.call("DynamicEntityService.createEntity",
[this.createEntities[a].entityName,this.createEntities[a].entity,null],this);for(a=0;a<this.instructions.length;a++)wos.Remoting.call("DynamicEntityService.executeInstruction",[this.instructions[a]],this);wos.Remoting.endBatchCall()}this.updateEntities.length=0;this.createEntities.length=0;this.instructions.length=0};js.$public.updateEntity=function(a,b){var c;if(null==b||""==b||"undefined"==b)b=a.$type$;if(null==b||""==b||"undefined"==b)b=this.entityXml.attr("name");delete a.mx_internal_uid;delete a.$type$;
delete a.$selected$;delete a.$modified$;for(var d=0;d<this.updateEntities.length;d++)if(this.updateEntities[d].entityName==b&&this.updateEntities[d].entity.id==a.id){c=this.updateEntities[d];break}null!=c?c.entity=js.clone(a):this.updateEntities.push({entity:a,entityName:b})};js.$public.createEntity=function(a,b){if(null==b||""==b||"undefined"==b)b=a.$type$;if(null==b||""==b||"undefined"==b)b=this.entityXml.attr("name");delete a.mx_internal_uid;delete a.$type$;delete a.$selected$;delete a.$modified$;
this.createEntities.push({entity:a,entityName:b})};js.$public.addInstruction=function(a){this.instructions.push(a)};js.$public.validateForm=function(){if("view"==this.getSubmitAction())return!0;var a=!0,b,c;for(b in this.validatorMap)c=this.validatorMap[b],null==c||c.validate()||(c.show(!0),a=!1);return a};js.$public.getEmptyRequiredFields=function(){var a=[],b,c;for(b in this.validatorMap)c=this.validatorMap[b],null==c||c.validate()||(c=this.entityXml.xpath('property[@name \x3d "'+b+'"]')[0],js.isNull(c)||
a.push({name:String(c.attr("name")),label:String(c.attr("label"))}));return a};this.getSequenceName=function(a,b){return a.attr("uid").split(".")[1]+"."+b.attr("uid")};this.regCodingField=function(a,b,c){b=new f.app.CodingPattern(a,b,c,this.expParser);b.addEventListener(f.app.CodingPattern.CODING_GENERATED_EVENT,this.onCodingGenerated,this);this.codingFieldMap[a]=b;b=b.typecode().split(".");1<b.length&&("this"==b[0]||"$this"==b[0])&&(this.codingUpdateFieldMap[b[1]]=a)};this.onCodingGenerated=function(a,
b){this.xmlForm.setFieldValue(b.name,b.coding)};this.generateCoding=function(a,b){b=js.param(b,"");var c=this.codingFieldMap[a];null!=c&&c.generate(b)}})})(qs,jQuery);(function(f,l){js.$interface("qs.app.IEntityRuleApplier",function(){js.$public.onValueReady=function(a,b){};js.$public.setPropertyValue=function(a,b){};js.$public.setPropertyRequired=function(a,b){};js.$public.setPropertyEnabled=function(a,b){};js.$public.firePropertyUpdateEvent=function(a,b,c){}});js.$class("qs.app.EntityRuleManager",function(){this.valueRule=[];this.eventRule=[];this.requiredRule=[];this.enabledRule=[];this.expParser=this.applier=this._entityXml=null;this.postponedMap={};js.$public.onlyCalculateValueExpression=
!1;this._relationEntityMap=null;this.initialize=function(a,b,c,d){this._entityXml=a;this.applier=c;this.expParser=d;this.expParser.addEventListener(wos.expression.ExpressionEvent.VALUE_PREPARED_EVENT,this.onValuePrepared);null!=b&&this.rules(b)};js.$public.entityXml=function(a){this._entityXml=a};js.$public.rules=function(a){this.valueRule.length=0;this.eventRule.length=0;this.requiredRule.length=0;for(var b=this.enabledRule.length=0;b<a.length;b++)this.parseRule(a[b])};js.$public.parseRule=function(a){if(null!=
a){a=a.xpath("rule");for(var b,c,d,e,f=0;f<a.length;f++)if(b=a[f],c=b.attr("type"),d=b.attr("property"),e=StringUtil.trim(b.attr("rule")),""!=c&&""!=d&&""!=e)switch(c){case "value":b.has("RE")?this.valueRule.push({name:d,rule:e,relationEntity:b.attr("RE")}):this.valueRule.push({name:d,rule:e});break;case "updateEvent":this.eventRule.push({name:d,rule:e});break;case "required":this.requiredRule.push({name:d,rule:e});break;case "enabled":this.enabledRule.push({name:d,rule:e})}}};js.$public.relationEntityMap=
function(a){if(void 0===a)return this._relationEntityMap;this._relationEntityMap=a};js.$public.isDefaultEntityReady=function(){var a,b,c;try{for(var d=0;d<this.valueRule.length;d++)if(a=this.valueRule[d].name,b=this.valueRule[d].rule,0!=this._entityXml.xpath('property[@name \x3d "'+a+'"]').length&&(c=this.expParser.calculate(b),c.state==wos.expression.ExpressionResult.POSTPONED))return addPostponedMap(c.message,{op:"defaultEntity"}),!1;return!0}catch(e){f.ui.MessageBox.show(e.message,"\u9519\u8bef")}return!1};
js.$public.defaultEntity=function(){var a={},b,c,d,e,g,k,m;try{for(var l=0;l<this.valueRule.length;l++){c=this.valueRule[l].name;d=this.valueRule[l].rule;if(js.isEmpty(this.valueRule[l].relationEntity))b=a,m=this._entityXml.xpath('property[@name \x3d "'+c+'"]')[0];else{e=this.valueRule[l].relationEntity;if(js.isNull(this._relationEntityMap)||js.isNull(this._relationEntityMap[e]))continue;g=this._relationEntityMap[e];if(0!=c.indexOf(g.ref))continue;c=c.substr(g.ref.length+1);js.isNull(a.$relationEntities)&&
(a.$relationEntities={});js.isNull(a.$relationEntities[g.ref])&&(a.$relationEntities[g.ref]={});b=a.$relationEntities[g.ref];m=g.entityXml.xpath('property[@name \x3d "'+c+'"]')[0]}null!=m&&void 0!=m&&(k=this.expParser.calculate(d),k.state==wos.expression.ExpressionResult.CALCULATED&&null!=k.value&&("relation"==m.attr("type")?(null!=k.value&&null!=k.value.id&&(b[c+"_id"]=k.value.id),b[c+"_label"]=k.value[m.attr("labelField")]):"principal"==m.attr("type")?(null!=k.value&&null!=k.value.id&&(b[c+"_id"]=
k.value.id),b[c+"_name"]=k.value.name):b[c]=k.value))}return a}catch(p){f.ui.MessageBox.show(p.message,"\u9519\u8bef")}return null};this.getPostponedMap=function(a){return null==this.postponedMap[a]?[]:this.postponedMap[a]};this.addPostponedMap=function(a,b){null==this.postponedMap[a]?this.postponedMap[a]=[b]:this.postponedMap[a].push(b)};this.removePostponedMap=function(a,b){var c=this.postponedMap[a];if(null!=c){var d=c.indexOf(b);-1!=d&&c.splice(d,1)}};js.$public.isPropertyEnabled=function(a){for(var b,
c,d=0;d<this.enabledRule.length;d++)if(b=this.enabledRule[d].name,c=this.enabledRule[d].rule,b==a&&(b=this.expParser.calculate(c),b.state==wos.expression.ExpressionResult.CALCULATED))return b.value;return!0};js.$public.isPropertyRequired=function(a){for(var b,c,d=0;d<this.requiredRule.length;d++)if(b=this.requiredRule[d].name,c=this.requiredRule[d].rule,b==a&&(b=this.expParser.calculate(c),b.state==wos.expression.ExpressionResult.CALCULATED))return b.value;return!1};js.$public.onPropertyValueUpdated=
function(a,b,c,d){c=js.param(c,null);d=js.param(d,null);var e="$this."+a,g,k,m,n;try{var p=!0;js.instanceOf(this.applier,f.app.FormWindow)?p=this.applier.getProperty(f.app.FormWindow.PROP_INITIALIZED):js.instanceOf(this.applier,f.app.QueryControl)&&(p=this.applier.getProperty(f.app.QueryControl.PROP_INITIALIZED));if(!0==p)for(n=0;n<this.valueRule.length;n++){g=this.valueRule[n].name;k=this.valueRule[n].rule;var p=!1,q;if(-1!=(q=k.indexOf(e))){q+=e.length;var s=k.charCodeAt(q),p=65<=s&&90>=s||48<=
s&&57>=s||97<=s&&122>=s||19968<=s&&40869>=s||36==s||95==s?!1:!0}!0==p&&(m=this.expParser.calculate(k),m.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyValue(g,m.value):m.state==wos.expression.ExpressionResult.POSTPONED&&this.addPostponedMap(m.message,{op:"updatePropertyValue",property:g,rule:k}))}for(n=0;n<this.enabledRule.length;n++)g=this.enabledRule[n].name,k=this.enabledRule[n].rule,-1!=k.indexOf(e)&&(!0!=this.onlyCalculateValueExpression?(m=this.expParser.calculate(k),
m.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyEnabled(g,m.value):m.state==wos.expression.ExpressionResult.POSTPONED&&this.addPostponedMap(m.message,{op:"updatePropertyEnabled",property:g,rule:k})):this.applier.setPropertyEnabled(g,k));for(n=0;n<this.requiredRule.length;n++)g=this.requiredRule[n].name,k=this.requiredRule[n].rule,-1!=k.indexOf(e)&&(!0!=this.onlyCalculateValueExpression?(m=this.expParser.calculate(k),m.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyRequired(g,
m.value):m.state==wos.expression.ExpressionResult.POSTPONED&&this.addPostponedMap(m.message,{op:"updatePropertyRequired",property:g,rule:k})):this.applier.setPropertyRequired(g,k));var r;for(n=0;n<this.eventRule.length;n++)this.eventRule[n].name==a&&(r=this.eventRule[n].rule,null!=r&&(d=l.extend({entity:c,propName:a,propValue:b},d),this.applier.firePropertyUpdateEvent(this.eventRule[n].name,r,d)))}catch(t){f.ui.MessageBox.show("\u5c5e\u6027\u66f4\u65b0\u65f6\u51fa\u9519\uff1a"+t.message+"\n"+a+" \x3d "+
b,"\u9519\u8bef")}};this.onValuePrepared=function(a){var b=this.getPostponedMap(a.name),c,d;try{for(var e=b.length-1;0<=e;e--)switch(c=b[e],c.op){case "defaultEntity":if(!0==this.isDefaultEntityReady())this.applier.onValueReady("defaultEntity",this.defaultEntity());this.removePostponedMap(a.name,c);break;case "updatePropertyValue":d=this.expParser.calculate(c.rule);d.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyValue(c.property,d.value):d.state==wos.expression.ExpressionResult.POSTPONED&&
d.message!=c.property&&this.addPostponedMap(d.message,{op:"updatePropertyValue",property:c.property,rule:c.rule});this.removePostponedMap(a.name,c);break;case "updatePropertyEnabled":d=this.expParser.calculate(c.rule);d.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyEnabled(c.property,d.value):d.state==wos.expression.ExpressionResult.POSTPONED&&d.message!=c.property&&this.addPostponedMap(d.message,{op:"updatePropertyEnabled",property:c.property,rule:c.rule});this.removePostponedMap(a.name,
c);break;case "updatePropertyRequired":d=this.expParser.calculate(c.rule),d.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyRequired(c.property,d.value):d.state==wos.expression.ExpressionResult.POSTPONED&&d.message!=c.property&&this.addPostponedMap(d.message,{op:"updatePropertyRequired",property:c.property,rule:c.rule}),this.removePostponedMap(a.name,c)}}catch(g){f.ui.MessageBox.show(g.message,"\u9519\u8bef")}};js.$public.onReady=function(){var a,b,c,d;try{for(d=0;d<this.enabledRule.length;d++)a=
this.enabledRule[d].name,b=this.enabledRule[d].rule,!0!=this.onlyCalculateValueExpression?(c=this.expParser.calculate(b),c.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyEnabled(a,c.value):c.state==wos.expression.ExpressionResult.POSTPONED&&this.addPostponedMap(c.message,{op:"updatePropertyEnabled",property:a,rule:b})):this.applier.setPropertyEnabled(a,b);for(d=0;d<this.requiredRule.length;d++)a=this.requiredRule[d].name,b=this.requiredRule[d].rule,!0!=this.onlyCalculateValueExpression?
(c=this.expParser.calculate(b),c.state==wos.expression.ExpressionResult.CALCULATED?this.applier.setPropertyRequired(a,c.value):c.state==wos.expression.ExpressionResult.POSTPONED&&this.addPostponedMap(c.message,{op:"updatePropertyRequired",property:a,rule:b})):this.applier.setPropertyRequired(a,b)}catch(e){f.ui.MessageBox.show(e.message,"\u9519\u8bef")}}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" width\x3d"260" height\x3d"155" title\x3d"\u4fee\u6539\u5bc6\u7801" resizable\x3d"false"\x3e','\x3cForm name\x3d"form" padding\x3d"5" action\x3d"#"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" columns\x3d"[60, \'*\']" rows\x3d"[27,27,27,30]" hGap\x3d"2" vGap\x3d"2"\x3e','\x3cLabel text\x3d"\u539f\u5bc6\u7801:" layout\x3d"{rowIndex : 0, hAlign : \'right\'}" /\x3e','\x3cTextInput name\x3d"txtOldPwd" password\x3d"true" layout\x3d"{rowIndex : 0, colIndex : 1, width:\'*\'}" validator\x3d"{required:true, showTag:false, message:\'\u8bf7\u8f93\u5165\u539f\u5bc6\u7801\'}"/\x3e',
'\x3cLabel text\x3d"\u65b0\u5bc6\u7801:" layout\x3d"{rowIndex : 1, hAlign : \'right\'}" /\x3e','\x3cTextInput name\x3d"txtNewPwd" password\x3d"true" layout\x3d"{rowIndex : 1, colIndex : 1, width:\'*\'}" validator\x3d"{required:true, showTag:false, message:\'\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\'}"/\x3e','\x3cLabel text\x3d"\u786e\u8ba4\u5bc6\u7801:" layout\x3d"{rowIndex : 2, hAlign : \'right\'}" /\x3e','\x3cTextInput name\x3d"txtNewPwdT" password\x3d"true" layout\x3d"{rowIndex : 2, colIndex : 1, width:\'*\'}" validator\x3d"{required:true, showTag:false, message:\'\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801\'}"/\x3e',
'\x3cHLayout layout\x3d"{rowIndex : 3, colSpan : 2, hAlign : \'right\', innerLayout:{height : 24, vAlign : \'bottom\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButton width\x3d"70" text\x3d"\u786e\u5b9a" click\x3d"onOK" options\x3d"{isDefault:true}" icon\x3d"images/icons/ok.png"/\x3e','\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Form\x3e","\x3c/Window\x3e"));js.$class("qs.app.PasswordWindow",
f.ui.Window,function(){this.initialize=function(b){this.$super(b);this.qxml(a);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};this.isNull=function(a){return void 0==a||null==a||""==a.replace(/\s/g,"")||"null"==a?!0:!1};this.setCookie=function(a,c){c=this.isNull(c)?"":c;var d=arguments,e=arguments.length,f=2<e?d[2]:null,k=3<e?d[3]:null,m=4<e?d[4]:null,d=5<e?d[5]:!1;null==k&&(k=new Date(3E3,1,1));document.cookie=a+"\x3d"+escape(c)+(null==k?"":"; expires\x3d"+k.toGMTString())+
(null==f?"":"; path\x3d"+f)+(null==m?"":"; domain\x3d"+m)+(!0==d?"; secure":"")};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);this.invalidateSize(!0)};js.$public.open=function(a){this.showDialog()};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "changePassword":this.setCookie("password",this.txtNewPwd.value()),this.close()}};this.onOK=function(){if(this.form.validate()){var a=this.txtOldPwd.value(),c=this.txtNewPwd.value(),
d=this.txtNewPwdT.value();c!=d?f.ui.MessageBox.show("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error):(d=wos.Desktop.getAttribute("loginInfo"),wos.Remoting.call("PrincipalService.changePassword",[d.principalId,a,c],this,new wos.events.AsyncOption("changePassword",null)))}};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.OfficeDocumentManager",f.events.EventDispatcher,function(){this.editingFiles=[];this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(wos.events.ExceptionEvent.EXCEPTION,this.onRemotingException)};js.$static.instance=function(){return a};this.getRootPath=function(){return wos.Desktop.getAbsoluteUrl("/svr/fs/")};this.getRelativeUrl=function(a){var c=a.indexOf("?");0<c&&(a=a.substr(0,
c));c=wos.Desktop.getAbsoluteUrl("/svr/fs/");0==a.indexOf(c)&&(a=a.substr(c.length));0<a.length&&"/"!=a[0]&&(a="/"+a);return a};js.$public.getDocumentType=function(a){if(js.isEmpty(a))return 3;var c=a.lastIndexOf("?");-1!=c&&(a=a.substr(0,c));c=a.lastIndexOf(".");if(-1==c)return 3;switch(a.substr(c+1)){case "doc":case "docx":return 1;case "xls":case "xlsx":return 2}return 3};this.cb_editDocument=function(a,c){var d=c.url,e=c.relativeUrl,f=d,k=d.lastIndexOf("/"),m=d.lastIndexOf("?");-1==m?f=d.substring(k+
1):(f=d.substring(k+1,m),d.substring(m));k=e.lastIndexOf("/");d=e.substr(0,k);"/"!=d[0]&&(d="/"+d);k=[];k.push(this.getRootPath());k.push("{key\x3d",a,"}/");k.push("{rn\x3d",f,"}");if(c.param)for(var l in c.param)k.push("/{",l,"\x3d",c.param[l],"}");k.push(d,"/",c.fileName);f=k.join("");this.openDocument(f,!1,!0);this.editingFiles.push(e)};js.$public.editDocument=function(a,c,d){d=js.param(d,{});var e=this.getRelativeUrl(a);a={url:a,fileName:c,relativeUrl:e,param:d};c=wos.Desktop.getAttribute("loginInfo");
wos.Remoting.call("TeamworkService.lockResource",[e,"File",c.principalId],this,new wos.events.AsyncOption("editDocument",a))};this.openHandler=function(a){if(a==f.ui.MessageBox.Yes){var c=this.getRelativeUrl(this._openData.url);a=this._openData.url;var d=this._openData.url.lastIndexOf("/"),e=this._openData.url.lastIndexOf("?");-1==e?a=this._openData.url.substring(d+1):(a=this._openData.url.substring(d+1,e),this._openData.url.substring(e));d=c.lastIndexOf("/");c=c.substr(0,d);"/"!=c[0]&&(c="/"+c);
d=[];d.push(this.getRootPath());d.push("{rn\x3d",a,"}");if(this._openData.param)for(var g in this._openData.param)d.push("/{",g,"\x3d",this._openData.param[g],"}");d.push(c,"/",this._openData.fileName);g=d.join("");this.openDocument(g,!0,!1)}};this.cb_editDocumentError=function(a,c){if("Teamwork.ResourceLocked"==a.errorCode){var d=StringUtil.join('\u6587\u6863"',c.fileName,'"\u5df2\u7ecf\u88ab',a.message,"\u9501\u5b9a\uff0c\u662f\u5426\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\uff1f");this._openData=
c;f.ui.MessageBox.show(d,"\u63d0\u793a",f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,this.openHandler,this)}else f.ui.MessageBox.show(a.message,"\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error)};js.$public.openDocument=function(a,c,d){c=js.param(c,!1);d=js.param(d,!0);var e=wos.Desktop.getAttribute("loginInfo").principalName,g=this.getDocumentType(a);1==g?this.openWord(a,e,c,d):2==g?this.openExcel(a,e,c,d):f.ui.MessageBox.show("\u4e0d\u662f\u6709\u6548\u7684Office\u6587\u6863\uff0c\u65e0\u6cd5\u8fdb\u884c\u5728\u7ebf\u67e5\u770b\u6216\u7f16\u8f91",
"\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Error)};this.openWord=function(a,c,d,e){d=js.param(d,!1);e=js.param(e,!0);if(js.isNull(window.qs_ext)||js.isNull(window.qs_ext.openWord))f.ui.MessageBox.show("\u5f53\u524d\u63d2\u4ef6\u4e0d\u53ef\u7528\uff0c\u8bf7\u5141\u8bb8\u6d4f\u89c8\u5668\u52a0\u8f7d\u63d2\u4ef6\u3002","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error);else try{window.qs_ext.openWord(a,c,d,e)}catch(g){f.ui.MessageBox.show("\u6253\u5f00\u6587\u6863\u65f6\u53d1\u751f\u9519\u8bef\uff1a"+
g+",\u60a8\u53ef\u4ee5\u590d\u5236\u4ee5\u4e0b\u94fe\u63a5\u76f4\u63a5\u5728Word\u4e2d\u6253\u5f00:\x3cbr /\x3e\x3cb\x3e"+a+"\x3c/b\x3e","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error)}};this.openExcel=function(a,c,d,e){d=js.param(d,!1);e=js.param(e,!0);if(js.isNull(window.qs_ext)||js.isNull(window.qs_ext.openExcel))f.ui.MessageBox.show("\u5f53\u524d\u63d2\u4ef6\u4e0d\u53ef\u7528\uff0c\u8bf7\u5141\u8bb8\u6d4f\u89c8\u5668\u52a0\u8f7d\u63d2\u4ef6\u3002","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error);
else try{window.qs_ext.openExcel(a,c,d,e)}catch(g){f.ui.MessageBox.show("\u6253\u5f00\u6587\u6863\u9519\u8bef\uff1a"+g,"\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error)}};this.onRemotingCallback=function(a,c){var d=a.result;switch(a.option.asyncName){case "editDocument":this.cb_editDocument(d,a.option.asyncData)}};this.onRemotingException=function(a,c){switch(a.option.asyncName){case "editDocument":this.cb_editDocumentError(a.exception,a.option.asyncData),a.preventDefault()}}});var a=new f.app.OfficeDocumentManager})(qs,
jQuery);(function(f,l){js.$class("qs.app.ImageViewWindow",f.ui.Window,function(){this.initialize=function(a){this.$super(a);this._resizable=!0;this._title="\u56fe\u7247\u9884\u89c8";this._rotate=0;this._zoom=1};js.$public.rotate=function(a){if(void 0===a)return this._rotate;for(360<=a&&(a%=360);0>a;)a+=360;this._rotate=90*Math.floor(a/90+0.5);isNaN(this._rotate)&&(this._rotate=0);js.isNull(this._$contentImage)||(this._$contentImage.css("transform","rotate("+this._rotate+"deg)"),this.invalidateSize(!0))};
js.$public.zoom=function(a){if(void 0===a)return this._zoom;"number"==js.type(a)&&(this._zoom=a,js.isNull(this._$contentImage)||(this._$contentImage.css("zoom",this._zoom),this.invalidateSize(!0)))};this.getImageWidth=function(){return js.isNull(this._$contentImage)?0:0==this._rotate%180?this._$contentImage.width():this._$contentImage.height()};this.getImageHeight=function(){return js.isNull(this._$contentImage)?0:0==this._rotate%180?this._$contentImage.height():this._$contentImage.width()};js.$public.updateSize=
function(a,b){if(this.isRendered()){var c=this._$element.find(".qs-window .win-titlebar"),c=b-c.height();if(!js.isNull(this._$contentImage)){this._$imageContainer.css({"margin-left":"","margin-top":""});this._$contentImage.css("margin-top","");var d=this.getImageWidth()*this._zoom,e=this.getImageHeight()*this._zoom;this._$imageContainer.width(d);this._$imageContainer.height(e);var f=this._$contentImage.width()*this._zoom,k=this._$contentImage.height()*this._zoom;d<a&&(0==this._rotate%180?this._$imageContainer.css("margin-left",
(a-d)/2):this._$imageContainer.css("margin-left",(a-Math.max(f,k))/2));e<c&&this._$imageContainer.css("margin-top",(c-e)/2);this._$contentImage.css("margin-top",(e-k)/2)}this.$super(a,b)}};js.$static.show=function(a,b){var c=StringUtil.join('\x3cdiv class\x3d"img_container"\x3e','\x3cimg class\x3d"content_img" src\x3d"',a,'"\x3e\x3c/img\x3e',"\x3c/div\x3e"),d=new f.app.ImageViewWindow,c=l(c),e=new f.ui.ScrollView;e.draggable(!0);e.content(c);d.content(e);d._$imageContainer=c;d._$contentImage=c.children(".content_img");
b=l.extend({classes:"qs-ani-popup image-view",width:500,height:500,maximizable:!0},b);d.showDialog(b);d.minWidth(320);var e=d.$element().find(".win-titlebar"),g=l('\x3cdiv class\x3d"zoom" title\x3d"\u56fe\u7247\u7f29\u653e"\x3e\x3c/div\x3e');e.append(g);var k=new f.ui.Slider;k.minimum(0.2);k.maximum(3);k.step(0.05);k.value(1);k.width(100);k.render(g);k.addEventListener("change",function(a){d.zoom(k.value())});g=l('\x3cdiv class\x3d"title-button rotate-left" title\x3d"\u5de6\u8f6c90\u5ea6"\x3e\x3c/div\x3e');
e.append(g);g.bind("click",function(){d.rotate(d.rotate()-90)});g=l('\x3cdiv class\x3d"title-button rotate-right" title\x3d"\u53f3\u8f6c90\u5ea6"\x3e\x3c/div\x3e');e.append(g);g.bind("click",function(){d.rotate(d.rotate()+90)});-1==a.indexOf("data:image")&&(g=l('\x3cdiv class\x3d"title-button download" title\x3d"\u4e0b\u8f7d"\x3e\x3c/div\x3e'),e.append(g),g.bind("click",function(){var b=a,c=a.indexOf("/docroot/attachments/");0<c&&(b=a.substr(c+21+1));b=wos.Desktop.getAbsoluteUrl("/pages/download.jsp?file\x3d")+
encodeURIComponent(b);window.open(b)}));e.children(".title-button").bind("dblclick",function(){return!1});c.load(function(){d.invalidateSize(!0)});d.invalidateSize(!0)}});js.$class("qs.app.ImageField",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._src=this._value="";this._uploading=!1;this._qualityLevel=this._fitSize=this.progressBar=null;this._ATTACHEMENT_ROOT="/docroot/attachments/";this._upload_url="/pages/upload.jsp";this._upload_image_url=
"/pages/upload_image.jsp"};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){var a=this._$element.find(".qs-buttonbar"),c=a.children(".btn-upload"),a=a.children(".btn-delete"),d=c.children("input");this._enabled?(c.removeClass("btn-disabled"),a.removeClass("btn-disabled"),c.addClass("btn"),a.addClass("btn"),d.removeAttr("disabled")):(c.removeClass("btn"),a.removeClass("btn"),c.addClass("btn-disabled"),a.addClass("btn-disabled"),d.attr("disabled",
"true"))})};js.$public.fitSize=function(a){if(void 0===a)return this._fitSize;this._fitSize=a};js.$public.qualityLevel=function(a){if(void 0===a)return this._qualityLevel;this._qualityLevel=a};js.$public.value=function(a){if(void 0===a)return null!=this._$element?this._$element.find('input[type\x3d"hidden"]').val():this._value;this._value=a;if(null!=a){var b=a.indexOf(":");-1!=b?-1!=a.indexOf("http://")?this._src=a:this._src=wos.Desktop.getAbsoluteUrl(this._ATTACHEMENT_ROOT+a.substr(b+1)):""!=a&&
(this._src=wos.Desktop.getAbsoluteUrl(this._ATTACHEMENT_ROOT+a))}else this._src="";if(null!=this._$element){this._$element.find('input[type\x3d"hidden"]').val(this._value);a=this._$element.find(".qs-image img");if(!js.isEmpty(this._src)&&(a.css("display",""),a.attr("src",this._src),0<l(a.parent()).width()))this.onImageLoaded();this.updateButtons()}};this.updateButtons=function(){if(null!=this._$element){var a=this._$element.find(".qs-buttonbar"),b=a.children(".btn-delete"),c=a.children(".btn-dnload"),
a=a.children(".btn-view"),d=this._$element.find(".qs-image img"),e="";js.isEmpty(this._src)&&(e="none");b.css("display",e);c.css("display",e);a.css("display",e);d.css("display",e)}};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-imagefield");c.outerWidth(a);c.outerHeight(b);var d=c.children(".qs-bottombar");d.outerWidth(a);var e=c.border(),f=c.padding(),k=a-e.left-e.right-f.left-f.right,d=b-d.height()-e.top-e.bottom-f.top-f.bottom,c=c.children(".qs-image");
c.width(k);c.height(d);null!=this.progressBar&&this.progressBar.outerWidth(k,!0);this.onImageLoaded()}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-imagefield"\x3e','\x3cinput type\x3d"hidden" name\x3d"',this.name(),'" value\x3d"',this._value,'"\x3e','\x3cdiv class\x3d"qs-image"\x3e','\x3cimg src\x3d"',this._src,'"\x3e\x3c/img\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"qs-loading-progress" style\x3d"display:none"\x3e\x3c/div\x3e','\x3cdiv class\x3d"qs-bottombar"\x3e',
'\x3cdiv class\x3d"qs-buttonbar"\x3e','\x3cdiv class\x3d"btn btn-delete" title\x3d"\u5220\u9664"\x3e\x3c/div\x3e','\x3cdiv class\x3d"btn btn-upload" title\x3d"\u4e0a\u4f20"\x3e','\x3cinput type\x3d"file" name\x3d"files" class\x3d"upload" accept\x3d"image/*"/\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"btn btn-dnload" title\x3d"\u4e0b\u8f7d"\x3e\x3c/div\x3e','\x3cdiv class\x3d"btn btn-view" title\x3d"\u67e5\u770b"\x3e\x3c/div\x3e',"\x3c/div\x3e","\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,
b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-imagefield");this.$styleElement(c);var d=c.find(".qs-image img");this.bindEvent("load",this.onImageLoaded,d);this.bindEvent("click",this.onClick);d=c.find(".qs-loading-progress");this.progressBar=new f.ui.ProgressBar;this.progressBar.render(d);this.progressBar.barHeight(3);0<b.classes.length&&c.addClass(b.classes);this.updateButtons();this.bindEvent("change",this.onChange);this.invalidateSize(!0)};
this.deleteHandler=function(a){if(a==f.ui.MessageBox.Yes)this.onDelete()};this.onClick=function(a){a=l(a.target);if(a.is(".btn-delete"))!0==this._enabled&&f.ui.MessageBox.show("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u56fe\u7247\u5417?","\u63d0\u793a",f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,this.deleteHandler,this);else if(a.is(".btn-dnload"))this.onDownload();else if(a.is(".btn-view"))this.onView();else if(a.is(".qs-image")||a.is("img"))if(js.isEmpty(this._value))this._$element.find('input[type\x3d"file"]').trigger("click");
else this.onView()};this.onDelete=function(){if(this._enabled){this._$element.find(".qs-image img")[0].src="";var a=this._$element.find('input[type\x3d"hidden"]'),b=a.val();a.val("");""!=b&&this.dispatchEvent("change",{oldValue:b,newValue:""})}};this.onDownload=function(){var a=this.value(),b=a.indexOf(":");if(-1!=b){var c=wos.Desktop.getAbsoluteUrl("/pages/download.jsp?file\x3d")+encodeURIComponent(a.substr(b+1)),c=c+("\x26name\x3d"+encodeURIComponent(a.substr(0,b)));window.open(c)}};this.onView=
function(){var a=this.value(),b=null;0==a.indexOf("http://")?b=a:(b=a.indexOf(":"),b=-1!=b?wos.Desktop.getAbsoluteUrl(this._ATTACHEMENT_ROOT)+a.substr(b+1):wos.Desktop.getAbsoluteUrl(this._ATTACHEMENT_ROOT)+a.substr(1));if(null!=b){var c=this._$element.find(".qs-image"),a=c.data("actualWidth"),d=c.data("actualHeight"),c=f.ui.Image.getNatural(c.children("img"));js.isNull(c)||(0<c.width&&(a=c.width),0<c.height&&(d=c.height));c={};0<a&&(c.width=Math.max(Math.min(f.ui.windowWidth()-100,a+40),320));0<
d&&(c.height=Math.max(Math.min(f.ui.windowHeight()-40,d+40),200));f.app.ImageViewWindow.show(b,c)}};this.onImageLoaded=function(){if(this._enabled){var a=this._$element.find(".qs-image"),b=a.find("img");b.css("width","");b.css("height","");var c=b.width(),d=b.height();a.data("actualWidth",c);a.data("actualHeight",d);var e=a.width(),a=a.height();b.css("margin-top","");0==d?b.height(a):d<a?b.css("margin-top",(a-d)/2):e/c>a/d?(b.height(a),b.css("margin-top",0)):e/c<a/d&&(b.width(e),b.css("margin-top",
(a-e/c*d)/2))}};this.onChange=function(a){var b=this._$element.find('input[type\x3d"file"]');if(!(l.browser.msie&&9>=l.browser.version)){if(!b||!b[0].files){f.ui.MessageBox.show("\u56fe\u7247\u63a7\u4ef6\u51fa\u73b0\u5f02\u5e38\u3002","\u63d0\u793a");return}if(!b[0].files[0].type.match(/image.*/)){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u6709\u6548\u7684\u56fe\u7247\u6587\u4ef6\u3002","\u63d0\u793a");return}}var c=this._$element.find('input[type\x3d"hidden"]');c.val("");this._uploading=!0;var d=
this._$element.find(".qs-image").find("img");d.css("height","");d.css("width","");a=d[0].src="";void 0==this._fitSize||""==this._fitSize?a=wos.Desktop.getAbsoluteUrl(this._upload_url):(a=this._fitSize.split("x"),2!=a.length&&(a=this._fitSize.split("X")),2!=a.length&&(a=this._fitSize.split("*")),2==a.length&&(w=a[0],h=a[1]),a=this._upload_image_url,"?"==w?a+="?height\x3d"+h:"?"==h?a+="?width\x3d"+h:"?"!=w&&"?"!=h&&(a+="?width\x3d"+w+"\x26height\x3d"+h),a=wos.Desktop.getAbsoluteUrl(a));var e=this;if(l.browser.msie&&
9>=l.browser.version)a=-1==a.indexOf("?")?a+"?method\x3diframe":a+"\x26method\x3diframe",jQuery.ajaxUpload({url:a,files:b,complete:function(a,d){b.val("");try{var g=new f.Xml(d),k=g.xpath("/uploaded/file")[0];k||(k=g.xpath("/UPLOADED/FILE")[0]);var l=c.val(),r=k.attr("name")+":"+k.attr("url");c.val(r);e.value(r);e._uploading=!1;l!=r&&e.dispatchEvent("change",{oldValue:l,newValue:r})}catch(t){f.ui.MessageBox.show("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25:"+t,"\u9519\u8bef")}}}).send();else{var g=new FileReader;
g.onloadend=function(a){d[0].src=a.target.result;e.onImageLoaded()};g.readAsDataURL(b[0].files[0]);g=new FormData;g.append("images[]",b[0].files[0]);this.progressBar.$element().find(".qs-pbar-bar").css("width","");this.progressBar.$element().css("display","");var k=new XMLHttpRequest;k.open("post",a,!0);k.onload=function(){e.progressBar.$element().css("display","none");var a=(new f.Xml(this.responseText)).xpath("/uploaded/file")[0],b=c.val(),a=a.attr("name")+":"+a.attr("url");c.val(a);e.value(a);
e._uploading=!1;b!=a&&e.dispatchEvent("change",{oldValue:b,newValue:a})};k.onerror=function(){e.progressBar.$element().css("display","none")};k.upload.addEventListener("progress",function(a){e.progressBar.setProgress(a.loaded,a.total)},!1);k.send(g);b.val("")}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.CurrencyInput",f.ui.NumberInput,function(){this._rootPath="";this.initialize=function(a){this.$super(a);this._valueType="long";this.precision(2);this.stepSize(100)};js.$public.valueType=function(a){if(void 0===a)return this._valueType;this._valueType=a;"double"==a?this.stepSize(1):this.stepSize(100)};js.$public.value=function(a){if(void 0===a)return a=this.$super(),"long"==this._valueType?Math.floor(100*a+0.5):a;"long"==this._valueType&&(a/=100);this.$super(a)}})})(qs,
jQuery);(function(f,l){js.$class("qs.app.AttachmentList",f.ui.FormControl,function(){f.events.register("change",this);this.initialize=function(a){this.$super(a);this._value="";this._maxFile=10;this._files=[];this._accept=null};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a;this.callAfterRendered(function(){!1==a?this._$element.find(".qs-add-file").css("display","none"):this._$element.find(".qs-add-file").css("display","")})};js.$public.accept=function(a){if(void 0===a)return this._accept;
this._accept=a;this.callAfterRendered(function(){js.isNull(a)?this._$element.find(".qs-add-file input").removeAttr("accept"):this._$element.find(".qs-add-file input").attr("accept",a)})};js.$public.value=function(a){if(void 0===a){a=[];for(var b=0;b<this._files.length;b++)a.push(this._files[b].label+":"+this._files[b].url);return a.join("|")}this._value=a;this.callAfterRendered(function(){this._files.length=0;for(var a=this._$element.find(".qs-file"),b,e=0;e<a.length;e++)b=l(a[e]),b.hasClass("qs-add-file")||
(b.empty(),b.remove());this._$element.find("input[type\x3dfile]").val("");if(""!=this._value&&!js.isNull(this._value)){a=this._value.split("|");for(e=0;e<a.length;e++){var f=a[e].split(":");if(2==f.length){b=f[0];var f=f[1],k=b.lastIndexOf("."),k=b.substring(k+1,b.length),m={};m.label=b;m.type=k;0==f.indexOf("[nf]")?m.isNetFile=!0:m.isNetFile=!1;m.url=f;this.addFile(m)}}0<a.length&&this.invalidateSize(!0)}})};this.addFile=function(a){if(this._files.length>=this._maxFile)this._$element.find(".qs-add-file").css("display",
"none");else{switch(a.type){case "jpg":case "jpeg":case "gif":case "png":case "tif":case "bmp":a.imageUrl=a.url?wos.Desktop.getAbsoluteUrl("/docroot/attachments/")+a.url:"";a.view="image";break;case "doc":case "docx":case "dot":case "wps":a.imageUrl="images/icons/icon-word.png";a.view="office";break;case "xlsx":case "xls":case "xlt":case "csv":a.imageUrl="images/icons/icon-excel.png";a.view="office";break;case "ppt":case "pptx":a.imageUrl="images/icons/icon-ppt.png";a.view="office";break;case "pdf":a.imageUrl=
"images/icons/icon-pdf.png";a.view="url";break;case "rar":case "zip":a.imageUrl="images/icons/icon-rar.png";a.view="url";break;default:a.imageUrl="images/icons/icon-file.png",a.view="url"}var b=StringUtil.join('\x3cdiv class\x3d"qs-file"\x3e','\x3cimg src\x3d"',a.imageUrl,'" /\x3e','\x3cdiv class\x3d"qs-loading-progress"\x3e\x3c/div\x3e','\x3cdiv class\x3d"qs-text" title\x3d"',a.label,'"\x3e',a.label,"\x3c/div\x3e",'\x3cdiv class\x3d"qs-remove" style\x3d"display:none" title\x3d"\u5220\u9664"\x3e\x3c/div\x3e',
"\x3c/div\x3e"),c=this._$element.find(".qs-add-file"),b=l(b);b.data("file",a);c.before(b);this._files.push(a);var d=this,e=b.children(".qs-remove");b.mouseenter(function(a){!0==d._enabled&&e.css("display","")});b.mouseleave(function(a){e.css("display","none")});return b}};this.removeFile=function(a){a=this._files.indexOf(a);if(-1!=a){var b=this._$element.find(".qs-file")[a];js.isNull(b)||(b=l(b),b.empty(),b.remove(),this._files.splice(a,1));this._$element.find(".qs-add-file").css("display","")}};
js.$public.maxFile=function(a){if(void 0===a)return this._maxFile;0<a&&(this._maxFile=a)};js.$public.updateSize=function(a,b){this.$super(a,b);if(this.isRendered()){var c=this._$element.children(".qs-attachment-list"),d=c.children(".sv-content");f.Timer.callLater(0,function(){f.ui.ScrollView.updateScrollBar.call(this,c,d,a,b)},this)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-attachment-list"\x3e','\x3cinput type\x3d"hidden" name\x3d"',this.name(),'" value\x3d"',
this._value,'"\x3e','\x3cdiv class\x3d"sv-content"\x3e','\x3cdiv class\x3d"qs-file qs-add-file"\x3e','\x3cinput type\x3d"file" name\x3d"files" multiple\x3d"true" class\x3d"upload"/\x3e','\x3cimg src\x3d"images/icons/icon-addfile.png" /\x3e','\x3cdiv class\x3d"qs-text"\x3e\u4e0a\u4f20\u6587\u4ef6\x3c/div\x3e',"\x3c/div\x3e","\x3c/div\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-attachment-list");
this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=this;c.bind("mousewheel",function(a,b){js.isNull(d._verticalScrollBar)||d._verticalScrollBar.value(d._verticalScrollBar.value()-30*b);return!1});this.bindEvent("click",this.click);this.bindEvent("change",this.onChange);this.invalidateSize()};this.deleteHandler=function(a){a==f.ui.MessageBox.Yes&&(this.removeFile(this._deleteItem),this.dispatchEvent("change",{newValue:this.value()}),this.invalidateSize(!0))};this.click=function(a){var b=
l(a.target).closest(".qs-file",this._$element),c=b.data("file");if(!js.isNull(c))if(l(a.target).is(".qs-text,img"))if("image"==c.view)this.onViewImage(b.children("img"));else if("office"==c.view)if(!0!=this._enabled||js.isNull(window.qs_ext))c=wos.Desktop.getAbsoluteUrl("/docroot/attachments/")+c.url,window.open(c);else{a={};var d=this.findAncestor(f.app.XmlForm);js.isNull(d)||(b=d.getEntityXml(),d=d.getEntity(!0,!0),!js.isNull(b)&&!js.isNull(d)&&0<d.id&&(a.id=d.id,a.entity=b.attr("name")));f.app.OfficeDocumentManager.instance().editDocument(c.url,
c.label,a)}else"url"==c.view&&(c=wos.Desktop.getAbsoluteUrl("/docroot/attachments/")+c.url,window.open(c));else l(a.target).is(".qs-remove")&&(this._deleteItem=b.data("file"),f.ui.MessageBox.show('\u60a8\u786e\u5b9a\u8981\u5220\u9664"'+this._deleteItem.label+'"\u5417?',"\u63d0\u793a",f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,this.deleteHandler,this))};this.onDownload=function(a){if(-1!=this.value().indexOf(":")){var b=wos.Desktop.getAbsoluteUrl("/pages/download.jsp?file\x3d")+encodeURIComponent(a.url),
b=b+("\x26name\x3d"+encodeURIComponent(a.label));window.open(b)}};this.onViewImage=function(a){var b=a.data("actualWidth"),c=a.data("actualHeight"),d=f.ui.Image.getNatural(a);js.isNull(d)||(0<d.width&&(b=d.width),0<d.height&&(c=d.height));d={};0<b&&(d.width=Math.max(Math.min(f.ui.windowWidth()-100,b+40),400));0<c&&(d.height=Math.max(Math.min(f.ui.windowHeight()-40,c+40),200));f.app.ImageViewWindow.show(a.attr("src"),d)};this.uploadFile=function(a,b){var c=this.addFile(b);b.uploading=!0;if("image"==
b.view){var d=new FileReader,e=this,g=c.children("img");d.onloadend=function(a){g[0].src=a.target.result};d.readAsDataURL(a)}this.invalidateSize(!0);d=new FormData;d.append("files[]",a);var c=c.children(".qs-loading-progress"),k=new f.ui.ProgressBar;k.render(c);k.barHeight(3);e=this;c=new XMLHttpRequest;c.open("post",wos.Desktop.getAbsoluteUrl("/pages/upload.jsp"),!0);c.onload=function(){k.remove();var a=(new f.Xml(this.responseText)).xpath("/uploaded/file")[0];b.uploading=!1;b.url=a.attr("url");
b.url?e.dispatchEvent("change",{newValue:e.value()}):(f.ui.MessageBox.show("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002","\u9519\u8bef"),e.removeFile(b))};c.onerror=function(a){k.remove();f.ui.MessageBox.show("\u6587\u4ef6\u4e0a\u4f20\u9519\u8bef.","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error)};c.upload.addEventListener("progress",function(a){k.setProgress(a.loaded,a.total)},!1);c.send(d)};this.onChange=function(a){var b=l(a.target),c;if(l.browser.msie&&9>=l.browser.version){c=
b.val();var d=c.lastIndexOf("."),e=c.substring(d+1,c.length).toLowerCase(),d=c.lastIndexOf("\\");0<d&&(c=c.substring(d+1));var g={};g.label=c;g.type=e;var k=this.addFile(g);k.children(".qs-loading-progress").remove();var m=this;a={url:wos.Desktop.getAbsoluteUrl("/pages/upload.jsp?method\x3diframe"),files:b,complete:function(a,c){b.val("");try{var d=new f.Xml(c),e=d.xpath("/uploaded/file")[0];e||(e=d.xpath("/UPLOADED/FILE")[0]);g.uploading=!1;g.url=e.attr("url");g.url||(g.url=e.attr("URL"));g.url?
(m.dispatchEvent("change",{newValue:m.value()}),"image"==g.view&&(k.children("img")[0].src=wos.Desktop.getAbsoluteUrl("/docroot/attachments/")+g.url)):(f.ui.MessageBox.show("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002","\u9519\u8bef"),m.removeFile(g))}catch(l){f.ui.MessageBox.show("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25:"+l,"\u9519\u8bef")}}};jQuery.ajaxUpload(a).send()}else for(var n=0;n<b[0].files.length;n++)a=b[0].files[n],c=a.name,d=c.lastIndexOf("."),e=c.substring(d+1,c.length).toLowerCase(),
d={},d.label=c,d.type=e,this.uploadFile(a,d)};js.$static.getFirstFileHtml=function(a){a=a.split("|");return 0<a.length&&(a=a[0].split(":"),2==a.length)?'\x3cfont color\x3d"#0000FF"\x3e\x3cU\x3e\x3ca href\x3d"'+wos.Desktop.getAbsoluteUrl("/docroot/attachments/")+a[1]+'" target\x3d"_blank"\x3e'+a[0]+"\x3c/a\x3e\x3c/U\x3e\x3c/font\x3e":""}})})(qs,jQuery);(function(f,l){js.$class("qs.app.EntityField",f.ui.FormControl,[wos.expression.IExpressionValueProvider],function(){f.events.register("change",this);this._parentContainer=this._formUID=this._pageUID=this._queryUID=this._entityUID=null;this._entityLabelField="name";this._shortCutLabelField=this._entityLabel="";this._entityId=0;this._value=null;this._editable=!1;this._queryWindow=this._queryXml=this._entityXml=null;this._fieldName="";this._application=null;this._mode="select";this._maxList=50;this._shortcutCondition=
[];this._editable=this._forceAssociation=!0;this._expParser=null;this._queryParameter={};this._$valinput=this._$input=null;this._array=[];this.initialize=function(a){this.$super(a);this._text="";this._value=null;this._expParser=new wos.expression.ExpressionParser(this);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded)};js.$protected.dispose=function(){null!=this._queryWindow&&f.app.Workspace.instance().removeCacheWindow(this._queryWindow)};
js.$public.shortcutCondition=function(a){this._shortcutCondition=a};js.$public.fieldName=function(a){if(void 0===a)return this._fieldName;this._fieldName=a};js.$public.enabled=function(a){if(void 0===a)return this.$super();this.$super(a);this.callAfterRendered(function(){if(null!=this._value&&!this._enabled&&!this._editable&&"dropdown"!=this._mode){var a=this._$element.children(".qs-disabled-mask"),c=this._$element.find(".qs-entityfield .qs-dropdown_button");a.css({left:this._$element.find(".qs-linktext").width()+
4,width:c.css("width")})}})};js.$public.editable=function(a){if(void 0===a)return this._editable;this._editable=a;this._$element&&(a?(this._$element.find(".qs-entityfield input.qs-form-input").css("display",""),this._$element.find(".qs-entityfield .qs-text").removeClass("qs-dropdown")):(this._$element.find(".qs-entityfield input.qs-form-input").css("display","none"),"dropdown"==this._mode?(this._$element.find(".qs-entityfield .qs-text").addClass("qs-dropdown"),this._$element.find(".qs-text").removeClass("qs-linktext")):
(this._$element.find(".qs-entityfield .qs-text").removeClass("qs-dropdown"),this._$element.find(".qs-text").addClass("qs-linktext"))))};js.$public.focus=function(){null!=this._$element&&("dropdown"==this._mode?this._$element.find(".qs-entityfield .qs-dropdown").focus():f.ui.FocusManager.focus(this))};js.$public.mode=function(a){if(void 0===a)return this._mode;this._mode=a;this.callAfterRendered(function(){"input"==this._mode?this.editable(!0):"dropdown"==this._mode?this.editable(!1):null!=this._shortCutLabelField&&
"null"!=this._shortCutLabelField&&""!=this._shortCutLabelField?this.editable(!0):this.editable(!1)})};js.$public.maxList=function(a){if(void 0===a)return this._maxList;this._maxList=a};js.$public.forceAssociation=function(a){if(void 0===a)return this._forceAssociation;this._forceAssociation=a};js.$public.shortCut=function(a){if(void 0===a)return this._shortCutLabelField;this._shortCutLabelField=StringUtil.trim(a)};js.$public.entityUID=function(a){if(void 0===a)return this._entityUID;this._entityUID=
a;null!=this._entityUID&&""!=this._entityUID&&"null"!=this._entityUID&&(this.entityXml(f.app.Workspace.instance().getLoadedFile(this._entityUID)),null==this.entityXml()&&(a={x_name:"Entity"},a.uid=this._entityUID,f.app.Workspace.instance().loadFile(a,this)))};js.$public.queryUID=function(a){if(void 0===a)return this._queryUID;this._queryUID=a;null!=this._queryUID&&""!=this._queryUID&&"null"!=this._queryUID&&"undefined"!=this._queryUID&&(this._queryXml=f.app.Workspace.instance().getLoadedFile(this._queryUID),
null==this._queryXml&&(a={x_name:"EntityQuery"},a.uid=this._queryUID,f.app.Workspace.instance().loadFile(a,this)))};js.$public.pageUID=function(a){if(void 0===a)return this._pageUID;this._pageUID=a};js.$public.formUID=function(a){if(void 0===a)return this._formUID;this._formUID=a};js.$public.parentContainer=function(a){if(void 0===a)return this._parentContainer;this._parentContainer=a;null==this._application&&null!=this._parentContainer&&"function"==js.type(this._parentContainer.application)&&(this._application=
this._parentContainer.application())};js.$public.application=function(a){if(void 0===a)return js.isNull(this._application)?js.isNull(this._parentContainer)?null:this._parentContainer.application():this._application;this._application=a};js.$public.entityXml=function(a){if(void 0===a)return this._entityXml;this._entityXml=a;null!=this._entityXml&&(a=this._entityXml.xpath('property[@name \x3d "'+this._entityLabelField+'"]')[0],js.isNull(a)||("relation"==a.attr("type")?this._entityLabelField+="_label":
"principal"==a.attr("type")&&(this._entityLabelField+="_name")))};js.$public.value=function(a,b,c){if(void 0===a)return!0!=this._editable||0!=this._entityId&&!js.isNull(this._value)||!1!=this._forceAssociation?0==this._entityId&&""==this._entityLabel||js.isNull(this._value)||!(!0!=this._forceAssociation||!js.isNull(this._value)&&0<parseInt(this._value.id))?null:this._value:(a=StringUtil.trim(this._$input.val()),""!=a?(c={},c[this._entityLabelField]=a,c):null);b=js.param(b,!0);c=js.param(c,!0);null!=
a&&(void 0==a.id&&delete a.id,void 0==a[this._entityLabelField]&&delete a[this._entityLabelField]);js.isNull(a)||js.isNull(a.id)||"null"==a.id?this._entityId=0:this._entityId=a.id;this._entityLabel="";js.isNull(a)||js.isNull(a[this._entityLabelField])||(this._entityLabel=a[this._entityLabelField]);!0==b&&this._$input.val(this._entityLabel);this._$text.html(this._entityLabel);""==this._entityLabel?this._$text.removeAttr("title"):this._$text.attr("title",this._entityLabel);b=this._value;this._value=
a;if(js.isNull(a))this._$valinput.val("");else{var d={};0<a.id&&(d.id=a.id);d[this._entityLabelField]=a[this._entityLabelField];this._$valinput.val(JSON.stringify(d))}js.isNull(b)&&js.isNull(a)||!0==c&&(null==b&&null!=a||null!=b&&null==a||b.id!=a.id||b[this._entityLabelField]!=a[this._entityLabelField])&&this.dispatchEvent("change",{oldValue:b,newValue:a})};js.$public.entityLabelField=function(a){if(void 0===a)return this._entityLabelField;this._entityLabelField=a};js.$public.updateSize=function(a,
b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-entityfield");c.css("line-height",this.outerHeight()-2+"px");var d=c.children(".qs-dropdown_button");d.children(".qs-icon").css("top",(this.outerHeight()-16)/2-1);var e=c.children(".qs-text");e.width(a-d.width()-5);e.height(b-2);c.children(".qs-clear-button").height(b-2);c.children(".qs-detail-button").height(b-2)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-entityfield"\x3e','\x3cdiv class\x3d"qs-text qs-linktext"\x3e\x26nbsp;',
this._text,"\x3c/div\x3e",'\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e','\x3cinput type\x3d"text" class\x3d"qs-form-input qs-input" value\x3d"',this._text,'" style\x3d"display:none"\x3e\x3c/input\x3e','\x3cspan class\x3d"qs-detail-button" style\x3d"display:none" title\x3d"\u67e5\u8be2\u8be6\u7ec6\u4fe1\u606f"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-clear-button" style\x3d"display:none" title\x3d"\u6e05\u7a7a"\x3e\x3c/span\x3e','\x3cspan class\x3d"qs-dropdown_button qs-button-default"\x3e',
'\x3cspan class\x3d"qs-icon" title\x3d"\u9009\u62e9\u6570\u636e"\x3e\x3c/span\x3e',"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-entityfield");this.$styleElement(c);0<b.classes.length&&c.addClass(b.classes);var d=c.children(".qs-text");this.bindEvent("click",function(){if(d.hasClass("qs-linktext"))if(null!=this._value)this.openDetail();else this.onQuery()},d);this._$text=d;
this._$input=c.children("input.qs-form-input");this._$valinput=c.children('input[type\x3d"hidden"]');var e=c.find(".qs-dropdown_button .qs-icon"),f=this;this._$input.focusin(function(a){c.addClass("qs-input-focused");f.isEditing=!0;f._sholdQuery=!1});this._$input.focusout(function(a){c.removeClass("qs-input-focused");f.isEditing=!1;if("shortcutQuery"==f._mode&&!0==f._sholdQuery||!1==f._forceAssociation)a=f.value(),js.isNull(a)||a[f._entityLabelField]==f._$input.val()||(a={},a[f._entityLabelField]=
f._$input.val(),f.value(a))});this.bindEvent("input",function(a){if("shortcutQuery"==this._mode)this._sholdQuery=!0;else{var b={};b[this._entityLabelField]=this._$input.val();this.value(b,!1)}a.stopPropagation()},this._$input);this.bindEvent("keydown",function(a){if(""!=this._shortCutLabelField&&13==a.keyCode)return this.onDropdownSearch(this._$input.val()),a.stopPropagation(),!1;40==a.keyCode&&(js.isNull(this._dropdownList)||(this._dropdownList.$element().focus(),this._dropdownList.selectedIndex(0)),
a.stopPropagation())},this._$input);this.bindEvent("click",function(a){a=l(a.target);if(a.is(".qs-detail-button"))this.openDetail();else if(a.is(".qs-clear-button"))this.value(null);else if(a.is(".qs-dropdown_button")||a.parent().is(".qs-dropdown_button"))this.onQuery();else if("dropdown"==this._mode)this.onDropdownSearch()});var k=c.children(".qs-clear-button"),m=c.children(".qs-detail-button");this.bindEvent("mouseenter",function(){null!=this._value&&(k.css("display",""),m.css("display",""))},e);
this.bindEvent("mouseleave",function(){k.css("display","none");m.css("display","none")},c);this.mode(this._mode);e=c.children(".qs-entityfield .qs-dropdown");e.focusin(function(a){c.addClass("qs-input-focused")});e.focusout(function(a){c.removeClass("qs-input-focused")});this.bindEvent("keydown",function(a){40==a.keyCode&&(this.onDropdownSearch(),a.stopPropagation())},e);this.invalidateSize()};this.openDetail=function(){if(0<this._entityId)if(js.isNull(this._formUID)||""==this._formUID||"null"==this._formUID)wos.Remoting.call("WorkshopService.getEntityItem",
[parseInt(this._entityXml.attr("nodeID")),"FormGroup"],this,new wos.events.AsyncOption("getFormList"));else{var a=wos.ALink.parseALink("alink://ime.AppWindow/EntityForm");js.isNull(a.param)&&(a.param={});a.param.entityUID=this._entityXml.attr("uid");a.param.formUID=this._formUID;a.param.action="view";var b=f.app.Workspace.instance().getFormWindow(this._formUID);null==b&&(b=new f.app.FormWindow,b.opener(this._parentContainer),b.application(this.application()),f.app.Workspace.instance().addFormWindow(this._formUID,
b));a.param.entityId=this._entityId;b.open(a,this)}};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "getFormList":null!=a.result&&0<a.result.length&&(a=new f.Xml(a.result[0].privateValue),""!=a.attr("uid")&&(this._formUID=a.attr("uid"),(js.isNull(this._formUID)||""==this._formUID||"null"==this._formUID)&&this.openDetail()));break;case "QueryService.executeQuery":a=f.app.XmlQuery.convertResultSet(a.result);for(var b=[],c=this._entityXml.attr("name"),d=0;d<a.length;d++)b.push(f.app.XmlQuery.getRecordEntity(a[d],
c));this.cb_executeXmlQuery(b);break;case "QueryService.executeXmlQuery":this.cb_executeXmlQuery(this.convertResultSet(a.result))}};this.cb_executeXmlQuery=function(a){this._array.length=0;if(null==a||0==a.length)"dropdown"!=this._mode&&f.ui.MessageBox.show("\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\u3002","\u63d0\u793a");else{for(var b=0;b<a.length;b++)this._array.push(a[b]);var c=null;if("dropdown"==this._mode){var d={id:0};d[this._entityLabelField]="";this._array.splice(0,
0,d);d=!1;if(0<this._entityId)for(b=0;b<a.length;b++)if(a[b].id==this._entityId){c=a[b];d=!0;break}b=this.value();d||null==b||(this._array.push(b),c=b)}a.length>=this._maxList&&(d={id:0},d[this._entityLabelField]="\u66f4\u591a...",this._array.push(d));var e=new f.ui.List;e.labelField(this._entityLabelField);e.dataProvider(this._array);var g=new f.ui.ScrollView;g.content(e);f.ui.popup.show(g,{x:0,y:this.outerHeight()+1,classes:"qs-combobox-list",innerClasses:"sv-combobox-list qs-ani-fadein",$relative:this._$element});
a={width:Math.max(this.outerWidth(),e.$element()[0].scrollWidth+f.ui.theme.scrollbar_width+10),height:Math.min(200,e.outerHeight()+10)};g.contentSize(a);js.isNull(c)?e.selectedIndex(0):e.selectedItem(c);e.focus();0<e.selectedIndex()&&(a=f.ui.popup.$element(),c=a.find(".qs-scrollview .sv-content"),a=a.find(".qs-list ul li[index\x3d"+e.selectedIndex()+"]"),a=a.offset().top-c.offset().top+a.height(),a>c.height()&&(a-=c.height(),g.scrollTo(null,a)));e.addEventListener("change",function(){var a=f.ui.popup.$element(),
b=a.find(".qs-scrollview .sv-content"),a=a.find(".qs-list ul li[index\x3d"+e.selectedIndex()+"]"),c=b.offset(),d=a.offset();d.top+a.height()>c.top+b.height()?(a=d.top-c.top+a.height()+g.verticalScrollBar().value(),a>b.height()&&(a-=b.height(),g.scrollTo(null,a))):d.top<c.top&&(a=g.verticalScrollBar().value()-(c.top-d.top),g.scrollTo(null,a))});this._dropdownList=e;var k=this;f.ui.popup.$element().bind("change",function(){k.onDropdownChanged(e.selectedItem());k._dropdownList=null;f.ui.popup.hide();
k.focus()})}};this.onDropdownChanged=function(a){if("\u66f4\u591a..."==a[this._entityLabelField])if(""!=this._shortCutLabelField)this.onQuery(this._$input.val());else this.onQuery();else!js.isNull(a)&&0<a.id?this.value(a):this.value(null)};this.convertResultSet=function(a){if(null!=a&&0!=a.length&&"array"==js.type(a[0])){var b;for(b=0;b<a[0].length;b++)if("string"!=js.type(a[0][b]))return a;var c,d=[];for(b=1;b<a.length;b++){c={};for(var e=0;e<a[b].length;e++)c[a[0][e]]=a[b][e];d.push(c)}return d}return a};
this.getQueryParameter=function(){var a={};if(js.isNull(this._queryXml))return a;var b=this._queryXml.xpath("xmlQuery/where//exp"),c,d,e,f;for(f=0;f<b.length;f++)c=b[f],"val"==c.attr("rightType")&&(d=c.attr("right"),e=null,d=this._expParser.calculate(d),d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value),js.isNull(e)||(c.has("uid")?a[c.attr("uid")]=e:(d=c.attr("leftEntity")+"_"+c.attr("leftField"),a[d]=e))),"val"==c.attr("rightType2")&&(d=c.attr("right2"),e=null,d=this._expParser.calculate(d),
d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value),js.isNull(e)||(c.has("uid")?a[c.attr("uid")+"2"]=e:(d=c.attr("leftEntity")+"_"+c.attr("leftField")+"2",a[d]=e)));for(f=0;f<this._shortcutCondition.length;f++)b=this._shortcutCondition[f],"val"==b.rightType&&(d=b.right,e=null,"string"==js.type(d)?(d=this._expParser.calculate(d),d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value)):e=d,js.isNull(e)||(null!=b.uid&&""!=b.uid&&void 0!=b.uid?a[b.uid]=e:(d=b.leftEntity+"_"+b.leftField,
a[d]=e))),"val"==b.rightType2&&(d=b.right2,e=null,"string"==js.type(d)?(d=this._expParser.calculate(d),d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value)):e=d,js.isNull(e)||(null!=b.uid&&""!=b.uid&&void 0!=b.uid?a[b.uid+"2"]=e:(d=b.leftEntity+"_"+b.leftField+"2",a[d]=e)));return a};this.onDropdownSearch=function(a){a=js.param(a,"");a=f.app.SQLUtil.filter(a);if(!js.isNull(this._entityUID)&&!js.isNull(this._entityXml)){this._queryParameter=this.getQueryParameter();var b=js.clone(this._queryParameter);
"dropdown"!=this._mode&&(b[this._shortCutLabelField]="'%"+a+"%'");if(null==this._queryUID||""==this._queryUID||"null"==this._queryUID||"undefined"==this._queryUID){a=new f.Xml('\x3cxmlQuery version\x3d"1.0" /\x3e');var c=a.create("select");c.attr("domainScope","true");a.append(c);c=a.create("from");c.text(this._entityXml.attr("name")+" a");a.append(c);a.append("where").append("exp").attr("type","19").attr("valueType","1").attr("option","true").attr("rightType","param").attr("left","a."+this._shortCutLabelField).attr("right",
this._shortCutLabelField);wos.Remoting.call("QueryService.executeXmlQuery",['\x3c?xml version\x3d"1.0" encoding\x3d"utf-8" ?\x3e'+a.toString(),this._shortcutCondition,b,0,this._maxList],this)}else c=js.clone(this._shortcutCondition),null!=this._shortCutLabelField&&"null"!=this._shortCutLabelField&&""!=this._shortCutLabelField&&(a={uid:"acuid1000",type:19,option:!0},a.leftEntity=this._entityXml.attr("name"),a.leftField=this._shortCutLabelField,a.right=this._shortCutLabelField,a.rightType="param",a.valueType=
1,c.push(a)),wos.Remoting.call("QueryService.executeQuery",[this._queryUID,c,b,0,this._maxList],this)}};this.onQuery=function(a){a=js.param(a,"");a=f.app.SQLUtil.filter(a);if(null!=this._entityUID&&null!=this._entityXml){var b=!0,c="";js.isNull(this._queryUID)||""==this._queryUID||"null"==this._queryUID||(c=this._queryUID);js.isNull(this._pageUID)||""==this._pageUID||"null"==this._pageUID||(c=this._pageUID);""==c&&(c=this._entityXml.attr("uid"));var c="EntityField_"+c,d=f.app.Workspace.instance().getCacheWindow(c);
null==d?(null!=this._queryWindow&&(f.app.Workspace.instance().removeCacheWindow(this._queryWindow),this._queryWindow.close(!1,!1)),this._queryWindow=new f.app.EntityQueryWindow,this._queryWindow.title("\u6d4f\u89c8"+this._entityXml.attr("label")+"\u4fe1\u606f"),this._queryWindow.setWindow(this._entityXml,this._entityLabelField,this._queryUID,this._pageUID,this._parentContainer),f.app.Workspace.instance().addCacheWindow(c,this._queryWindow)):this._queryWindow!=d&&(null!=this._queryWindow&&(f.app.Workspace.instance().removeCacheWindow(this._queryWindow),
this._queryWindow.close(!1,!1)),this._queryWindow=d,this._queryWindow.setWindow(this._entityXml,this._entityLabelField,this._queryUID,this._pageUID,this._parentContainer),b=!1);this._queryWindow.opener(this._parentContainer);""!=a&&null!=this._shortCutLabelField&&""!=this._shortCutLabelField&&"null"!=this._shortCutLabelField&&this._queryWindow.shortCut(a,this._entityXml,this._shortCutLabelField,this._shortcutCondition);this._queryWindow.show();var e=this._$element.offset(),c=500;a=Math.min(800,f.ui.windowWidth()-
50);c=Math.min(c,f.ui.windowHeight()-50);d=Math.max(Math.min(e.top,f.ui.windowHeight()-c-30),20);e=Math.max(Math.min(e.left,f.ui.windowWidth()-a-5),20);this._queryWindow.move(e,d+this._$element.outerHeight()+2,a,c);this._queryWindow.addEventListener(f.app.Page.ENTITY_SELECT_EVENT,this.onEntitySelected,this);!0==b&&this._queryWindow.refresh()}};this.onEntitySelected=function(a,b){this._queryWindow.close();0<b.selectedEntities.length&&this.value(b.selectedEntities[0])};this.onFileLoaded=function(a,
b){"Entity"==a.fileXml.name()?this.entityXml(a.fileXml):"EntityQuery"==a.fileXml.name()&&(this._queryXml=a.fileXml)};js.$public.getVariableValue=function(a,b){switch(a){case "opener":case "$opener":case "parent":case "$parent":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._parentContainer);case "$page":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this)}return wos.expression.ExpressionResult.InvalideResult};js.$public.getFunctionValue=
function(a,b,c){return wos.expression.ExpressionResult.InvalideResult}});js.$class("qs.app.EntityQueryWindow",f.ui.Window,function(){this._entityXml=null;this._pageUID=this._queryUID=this._labelField="";this._application=this._page=this._alink=this._opener=null;this._queryName="";this.initialize=function(a){a=l.extend({classes:"qs-entity-query-window qs-ani-fadein"},a);this.$super(a);this._queryName=Math.uuid();this._page=new f.app.Page;this._page.padding(3);this.content(this._page);this.addEventListener(wos.events.CallbackEvent.CALLBACK,
this.onRemotingCallback)};js.$public.application=function(a){if(void 0===a)return js.isNull(this._application)?null!=this._opener&&null!=this._opener.application()?this._opener.application():null:this._application;this._application=a};js.$public.opener=function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.shortCut=function(a,b,c,d){this._alink=wos.ALink.parseALink("alink://ime.AppWindow/EntityQuery");js.isNull(this._alink.param)&&(this._alink.param={});this._alink.param.conditionMap=
{};var e=[];"array"==js.type(d)&&(e=js.clone(d));cond={uid:"acuid1000",type:19,option:!0};cond.leftEntity=b.attr("name");cond.leftField=c;cond.right=c;cond.rightType="param";cond.valueType=1;e.push(cond);d={};d[c]=a;this._alink.param.conditionMap[this._queryName]={addtionalList:e,condition:d};a=this._page.getQueryPage();js.isNull(a)||(b=a.findQueryControl(b.attr("uid")),js.isNull(b)||b.condition(d))};js.$public.refresh=function(){this._page.refreshQuery()};js.$public.setWindow=function(a,b,c,d,e){this._entityXml=
a;this._labelField=b;this._queryUID=c;this._pageUID=d;this._opener=e;!js.isNull(c)&&""!=c&&"null"!=c||!js.isNull(d)&&""!=d&&"null"!=d||wos.Remoting.call("WorkshopService.getEntityItem",[parseInt(a.attr("nodeID")),"QueryGroup"],this,new wos.events.AsyncOption("getQueryList"));this._page.opener(this._opener);this._page.application(this.application());this._page.setSelectEntity(this._entityXml.attr("uid"));null!=d&&""!=d&&"null"!=d?(a={x_name:"Page"},a.uid=d,this._page.openPage(a,this._alink)):""!=c&&
null!=c&&"null"!=c&&(d=new f.Xml(StringUtil.join('\x3cQueryPage control\x3d"VBox"\x3e','\x3cQueryControl width\x3d"100%" height\x3d"100%" name\x3d"',this._queryName,'" uid\x3d"',c,'"/\x3e',"\x3c/QueryPage\x3e")),this._page.openPage(d,this._alink))};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "getQueryList":null!=a.result&&0<a.result.length&&(a=new f.Xml(a.result[0].privateValue),this._queryUID=a.attr("uid"),a=new f.Xml(StringUtil.join('\x3cQueryPage control\x3d"VBox"\x3e',
'\x3cQueryControl width\x3d"100%" height\x3d"100%" name\x3d"',this._queryName,'" uid\x3d"',this._queryUID,'"/\x3e',"\x3c/QueryPage\x3e")),this._page.openPage(a))}};js.$public.show=function(a){this.$super(a)};js.$public.close=function(a,b){a=js.param(a,!1);b=js.param(b,!0);this.removeEventListener(f.app.Page.ENTITY_SELECT_EVENT);this.$super(a,b)}})})(qs,jQuery);(function(f,l){js.$class("qs.app.MultilevelTreeDataProvider",f.ui.JsonTreeDataProvider,function(){this.initialize=function(a,b){this.$super(a,b)};js.$public.labelField=function(a){if(void 0===a)return this._labelField;this._labelField=a};js.$public.label=function(a,b){if(void 0===b)return b=this.$super(a,b),js.isNull(b)||""==b?a.label||"":b;this.$super(a,b)};js.$public.isBranch=function(a){return!0}});js.$class("qs.app.MultilevelTree",f.ui.TreeView,[f.app.IPageComponent,wos.expression.IExpressionValueProvider],
function(){js.$static.FIELD_ML_CODE="_ml_code_";js.$static.FIELD_ML_LEVEL="_ml_level_";this.maxLevel=-1;this._formUid=this._queryUID=this._entityUid="";this._entityLabelField="name";this.treeData={$children:[{label:"",id:0,domainId:-1,$parent:null}]};this.currentNode=this.formXml=this.queryXml=this.entityXml=null;this.menudata={label:"",menuitem:[{label:"\u6dfb\u52a0",action:"create",iconUrl:"images/icons/add.png"},{label:"\u7f16\u8f91",action:"edit",iconUrl:"images/icons/entity_edit.png"},{label:"\u5220\u9664",
action:"remove",iconUrl:"images/icons/delete.png"}]};this._page=this.ctxMenu=null;this._editable=!0;this._editPermission=null;this._domainLimit=!0;this._parentIdField="ml_parent";this.multilevel=0;this._expParser=null;this._maxList=500;this.initialize=function(a){a=l.extend({classes:"qs-app-ml-tree",checkable:!1,showRoot:!1},a);this.$super(a);var b=this;a=new f.app.MultilevelTreeDataProvider(this.treeData,{labelField:this._entityLabelField,childrenField:"$children",load:function(a){b.onLoadNode.call(b,
a)}});a.labelField(this._entityLabelField);this.dataProvider(a);a=wos.Desktop.getAttribute("loginInfo");"Oracle"==a.database&&(FIELD_ML_CODE="ml_code_",FIELD_ML_LEVEL="ml_level_");this.treeData.$children[0].domainId=a.domainId;this.ctxMenu=new f.ui.Menu;this.ctxMenu.addEventListener("itemClick",this.onMenuAction,this);this._expParser=new wos.expression.ExpressionParser(this);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded);this.addEventListener(wos.events.CallbackEvent.CALLBACK,
this.onRemotingCallback);this.addEventListener("change",this.onSelectChange);this.callAfterRendered(function(){this.bindEvent("mousedown",this.mouseDown);this.bindEvent("dblclick",this.doubleClick);var a=this.findAncestor(f.app.Page);js.isNull(a)||(this._containerPage=a,a.addEventListener(f.app.Page.PAGE_LOADED_EVENT,this.onPageLoaded,this))})};this.onPageLoaded=function(a){this._isPageLoaded=!0;this._containerPage.removeEventListener(f.app.Page.PAGE_LOADED_EVENT,this.onPageLoaded);js.isNull(this.entityXml)||
this.expand(this.treeData.$children[0])};this.mouseDown=function(a){if(2==a.button&&null!=this.selectedItem()){var b=!0;null!=this._page&&null!=this._editPermission&&(b=wos.PermissionUtil.instance().hasPermission(this._page.application().name(),this._editPermission));for(var c=0;c<this.menudata.menuitem.length;c++)this.menudata.menuitem[c].enabled=b;this.ctxMenu.menudata(this.menudata);this.ctxMenu.show(a.pageX,a.pageY);a.stopImmediatePropagation();a.stopPropagation();return!1}};js.$public.permission=
function(a){this._editPermission=a;a=!0;null!=this._page&&null!=this._editPermission&&(a=wos.PermissionUtil.instance().hasPermission(this._page.application().name(),this._editPermission));for(var b=0;b<this.menudata.menuitem.length;b++)this.menudata.menuitem[b].enabled=a};js.$public.domainLimit=function(a){if(void 0===a)return this._domainLimit;this._domainLimit=a};js.$public.parentIdField=function(a){if(void 0===a)return this._parentIdField;null!=a&&""!=a&&"null"!=a&&"undefined"!=a&&(this._parentIdField=
a)};js.$public.entityUid=function(a){if(void 0===a)return this._entityUid;if(""!=a&&null!=a&&"null"!=a)if(this._entityUid=a,this.entityXml=f.app.Workspace.instance().getLoadedFile(a),js.isNull(this.entityXml)){var b={x_name:"Entity"};b.uid=a;f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("LoadEntity"))}else""==this.treeData.$children[0].label&&(this.treeData.$children[0].label=this.entityXml.attr("label"),this.invalidateItem(this.treeData.$children[0]))};js.$public.queryUID=
function(a){if(void 0===a)return this._queryUID;this._queryUID=a;null!=this._queryUID&&""!=this._queryUID&&"null"!=this._queryUID&&"undefined"!=this._queryUID&&(this.queryXml=f.app.Workspace.instance().getLoadedFile(this._queryUID),js.isNull(this.queryXml)&&(a={x_name:"EntityQuery"},a.uid=this._queryUID,f.app.Workspace.instance().loadFile(a,this,new wos.events.AsyncOption("LoadQuery"))))};js.$public.selectedEntity=function(){var a=this.selectedItem();return null==a?null:this.getEntity(a)};js.$public.formUid=
function(a){if(void 0===a)return this._formUid;if(""!=a&&null!=a&&"null"!=a&&(this._formUid=a,this.formXml=f.app.Workspace.instance().getLoadedFile(a),js.isNull(this.formXml)&&""!=a)){var b={x_name:"Form"};b.uid=a;f.app.Workspace.instance().loadFile(b,this,new wos.events.AsyncOption("LoadForm"))}};js.$public.entityLabelField=function(a){if(void 0===a)return this._entityLabelField;this._entityLabelField=a;this.dataProvider().labelField(this._entityLabelField)};this.onFileLoaded=function(a,b){switch(a.option.asyncName){case "LoadEntity":this.entityXml=
a.fileXml;""==this.treeData.$children[0].label&&(this.treeData.$children[0].label=this.entityXml.attr("label"),this.invalidateItem(this.treeData.$children[0]));this.entityXml.has("multilevel")&&(this.multilevel=parseInt(this.entityXml.attr("multilevel")));this._isPageLoaded&&this.expand(this.treeData.$children[0]);break;case "LoadForm":this.formXml=a.fileXml;break;case "LoadQuery":this.queryXml=a.fileXml;if(!js.isNull(this._paddingNodeLoad))this.onLoadNode(this._paddingNodeLoad);this._paddingNodeLoad=
null}};this.getDomainId=function(a){for(;null!=a&&null!=a.$parent;)a=a.$parent;return null!=a?parseInt(a.domainId):wos.Desktop.getAttribute("loginInfo").domainId};this.onLoadNode=function(a){if(!js.isNull(a)&&null!=this.entityXml&&""!=this._entityLabelField){this.selectedItem(a);this.currentNode=a;var b=this.getDomainId(a),c=parseInt(a.id),d;if(null==this._queryUID||""==this._queryUID||"null"==this._queryUID||"undefined"==this._queryUID)d=0<this.multilevel?"select "+f.app.XmlQuery.getEntitySelectList(this.entityXml)+
","+f.app.MultilevelTree.FIELD_ML_CODE+", "+f.app.MultilevelTree.FIELD_ML_LEVEL+" from DYNA_"+this.entityXml.attr("name")+" where "+this._parentIdField+" \x3d "+c:"select "+f.app.XmlQuery.getEntitySelectList(this.entityXml)+" from DYNA_"+this.entityXml.attr("name")+" where "+this._parentIdField+" \x3d "+c,!0==this._domainLimit&&(d+=" and domainId \x3d "+b),wos.Remoting.call("QueryService.executeSQLQuery",[this.entityXml.attr("name"),d,0,this._maxList],this,new wos.events.AsyncOption(null,a));else{if(null==
this.queryXml){this._paddingNodeLoad=a;return}d=this.getQueryParameter();var e=[];d[this._parentIdField]=c;c={uid:"acuid1000",type:5,option:!0};c.leftEntity=this.entityXml.attr("name");c.leftField=this._parentIdField;c.right=this._parentIdField;c.rightType="param";c.valueType=3;e.push(c);!0==this._domainLimit&&(c={uid:"acuid1001",type:5,option:!0},c.leftEntity=this.entityXml.attr("name"),c.leftField="domainId",c.right=b,c.rightType="val",c.valueType=3,e.push(c));wos.Remoting.call("QueryService.executeQuery",
[this._queryUID,e,d,0,this._maxList],this,new wos.events.AsyncOption(null,a))}this.onSelectChange()}};this.onSelectChange=function(a){a=this.selectedItem();if(null!=this._page)if(null!=a)this._page.onPropertyChange(this,"selectedItem",this.getEntity(a));else this._page.onPropertyChange(this,"selectedItem",null)};this.getRootNode=function(a){for(;null!=a&&null!=a.$parent;)a=a.$parent;return a};this.onMenuAction=function(a,b){this.currentNode=this.selectedItem();if(null!=this.currentNode&&!js.isNull(b)){var c=
parseInt(this.currentNode.id);if(!isNaN(c))switch(b.action){case "create":this.onCreateEntity(c);break;case "edit":if(0<c)this.onEditEntity(c);break;case "remove":if(0<c)this.onRemoveEntity(c,this.currentNode[this._entityLabelField])}}};this.doubleClick=function(a){this.currentNode=this.selectedItem();if(null!=this.currentNode){var b=parseInt(this.currentNode.id);if(!isNaN(b)){if(0<b)this.onEditEntity(b);a.preventDefault();return!1}}};this.cb_executeSQLQuery=function(a,b){null==b&&(b=[]);var c,d,
e,g,k;delete a.$children;a.$children=[];for(var m=this.entityXml.children("property"),l=0;l<b.length;l++){c=b[l];g={$parent:a};k=0;chs=[];for(var p=0;p<m.length;p++)e=m[p],d=e.attr("name"),e=e.attr("type"),"relation"==e?(g[d+"_id"]=c[k],k++,g[d+"_label"]=c[k]):"principal"==e?(g[d+"_id"]=c[k],k++,g[d+"_name"]=c[k]):g[d]=c[k],k++;0<this.multilevel&&(g[f.app.MultilevelTree.FIELD_ML_CODE]=c[k],k++,g[f.app.MultilevelTree.FIELD_ML_LEVEL]=c[k]);a.$children.push(g)}this.invalidateItem(a,!0)};this.cb_executeQuery=
function(a,b){null==b&&(b=[]);b=f.app.XmlQuery.convertResultSet(b);var c,d=this.entityXml.attr("name");delete a.$children;a.$children=[];for(var e=0;e<b.length;e++)c=f.app.XmlQuery.getRecordEntity(b[e],d),c.$parent=a,a.$children.push(c);this.invalidateItem(a,!0)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "QueryService.executeSQLQuery":this.cb_executeSQLQuery(a.option.asyncData,a.result);break;case "QueryService.executeQuery":this.cb_executeQuery(a.option.asyncData,a.result);
break;case "removeEntity":this.removeItem(this.currentNode)}};this.onCreateEntity=function(a){var b=f.app.Workspace.instance().getFormWindow(this._formUid);js.isNull(b)&&(b=new f.app.FormWindow,b.opener(this),null!=this._page&&b.application(this._page.application()),f.app.Workspace.instance().addFormWindow(this._formUid,b));b.editable(!0);var c=wos.ALink.parseALink("alink://ime.AppWindow/EntityForm?{}");null==c.param&&(c.param={});c.param.action="create";c.param.entityUID=this._entityUid;c.param.formUID=
this._formUid;c.param.defaultEntity={};c.param.defaultEntity[this._parentIdField]=a;b.open(c)};this.onEditEntity=function(a){var b=f.app.Workspace.instance().getFormWindow(this._formUid);null==b&&(b=new f.app.FormWindow,b.opener(this),null!=this._page&&b.application(this._page.application()),f.app.Workspace.instance().addFormWindow(this._formUid,b));b.editable(!0);var c=wos.ALink.parseALink("alink://ime.AppWindow/EntityForm?{}");null==c.param&&(c.param={});c.param.action="edit";c.param.entityUID=
this._entityUid;c.param.formUID=this._formUid;b.open(c);b.setEntity({id:a,$type$:this.entityXml.attr("name")},!0)};this.onRemoveEntity=function(a,b){f.ui.MessageBox.show('\u786e\u5b9a\u8981\u5220\u9664\u8bb0\u5f55"'+b+'"\u7801\uff1f',"\u63d0\u793a",f.ui.MessageBox.YesNo,null,this.removeEntity,this)};this.removeEntity=function(a){a==f.ui.MessageBox.Yes&&null!=this.currentNode&&(a=parseInt(this.currentNode.id),isNaN(a)||wos.Remoting.call("DynamicEntityService.removeEntity",[a,this.entityXml.attr("name"),
null],this,new wos.events.AsyncOption("removeEntity")))};this.getEntity=function(a){a=js.clone(a);delete a.$parent;delete a.$children;return 0<a.id?a:null};this.getFullName=function(a){for(var b="";null!=a&&null!=a.$parent;)b="/"+a[this._entityLabelField]+b,a=a.$parent;return b};this.getQueryParameter=function(){var a={};if(null==this.queryXml)return a;var b=this.queryXml.xpath("xmlQuery/where//exp"),c,d,e,f;for(f=0;f<b.length;f++)c=b[f],"val"==c.attr("rightType")&&(d=c.attr("right"),e=null,d=this._expParser.calculate(d),
d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value),null!=e&&(c.has("uid")?a[c.attr("uid")]=e:(d=c.attr("leftEntity")+"_"+c.attr("leftField"),a[d]=e))),"val"==c.attr("rightType2")&&(d=c.attr("right2"),e=null,d=this._expParser.calculate(d),d.state==wos.expression.ExpressionResult.CALCULATED&&(e=d.value),null!=e&&(c.has("uid")?a[c.attr("uid")+"2"]=e:(d=c.attr("leftEntity")+"_"+c.attr("leftField")+"2",a[d]=e)));return a};this.findNode=function(a,b){void 0===b&&(b=this.treeData);for(var c,
d=0;d<b.$children.length;d++)if(c=b.$children[d],c.id==a||c.$children&&(c=this.findNode(a,c),null!=c))return c;return null};js.$public.page=function(a){if(void 0===a)return this._page;this._page=a};js.$public.getProperty=function(a){return null};js.$public.setProperty=function(a,b){};js.$public.onPropertyChange=function(a,b,c){};js.$public.onEntityChange=function(a,b,c,d){b=this.findAncestor(f.app.Page);if(null!=b){var e=b.findAncestor(f.ui.TabView);if(null!=e&&(e=e.selectedItem(),null!=e&&e.content!=
b))return}if(a==this.entityXml.attr("name"))if("create"==d){d=parseInt(this.treeData.$children[0].id);b=parseInt(c[this._parentIdField]);a=null;if(0<b){if(a=this.findNode(b),null==a)return}else if(0==d||isNaN(d))a=this.treeData.$children[0];d=js.clone(c);this.dataProvider().addChild(a,d);this.invalidateItem(a);this.selectedItem(d);this.onSelectChange(null)}else"edit"==d?(d=this.findNode(c.id),null!=d&&(js.copy(c,d),this.invalidateItem(d),this.selectedItem(d),this.onSelectChange(null))):"delete"==
d&&(d=this.findNode(c.id),null!=d&&this.removeItem(d))};js.$public.getVariableValue=function(a,b){var c;switch(a){case "page":case "$page":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page);case "selectedItem":case "$selectedItem":case "selectedEntity":case "$selectedEntity":case "$this":return c=this.selectedItem(),null==c?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this.getEntity(c));case "selectedRoot":case "$selectedRoot":return c=this.selectedItem(),null!=c&&(c=this.getRootNode(c)),null!=c?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this.getEntity(c)):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null);case "selectedFullName":case "$selectedFullName":return c=this.selectedItem(),null==c?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,null):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this.getFullName(c))}c=this.getProperty(a);return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,c)};js.$public.getFunctionValue=function(a,b,c){switch(a){case "setRootNode":this.treeData.$children[0].label=b[0];this.treeData.$children[0].domainId=b[1];2<b.length&&null!=b[2]&&(this.treeData.$children[0].id=b[2]);this.selectedItem(this.treeData.$children[0]);this.dataProvider(this.dataProvider());break;case "addRootNode":a={};a.label=b[0];a.domainId=b[1];2<b.length&&
null!=b[2]&&(a.id=b[2]);this.treeData.$children.push(a);this.dataProvider(this.dataProvider());break;case "setEditable":this._editable="true"==b[0]||!0==b[0]?!0:!1;break;case "setEnabled":"true"==b[0]||!0==b[0]?this.enabled(!0):(this.enabled(!1),this.selectedItem(null));break;case "expandRoot":this.expand(this.treeData.$children[0]);break;case "hasChildren":return(a=this.findNode(parseInt(b[0])))&&a.$children&&0<a.$children.length?new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
!0):new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,!1)}return wos.expression.ExpressionResult.InvalideResult}})})(qs,jQuery);(function(f,l){js.$class("qs.app.PrincipalSelectField",f.ui.FormControl,function(){f.events.register("change",this);this._fieldName=this._rootPath="";this._principalId=0;this._groupName=this._principalLabel="";this._domain=!1;this._value=null;this._editable=!0;this._$text=this._$valinput=this._$input=null;this.initialize=function(a){this.$super(a);this._text="";this._value=null;this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.principal=function(a){if(void 0===
a){if(0==this._principalId)return null;a={};a.id=this._principalId;a.name=this._principalLabel;a.groupName=this._groupName;return a}var b=this._value;this._value=a;js.isNull(a)?(this._principalId=0,this._groupName=this._principalLabel=""):(this._principalId=a.id,this._principalLabel=a.name,this._groupName=a.groupName);js.isNull(a)&&this._$valinput.val("");js.isNull(b)&&js.isNull(a)||(void 0!=this._$text&&(this._$text.val(this._principalLabel),this._$valinput.val(JSON.stringify(this.principal()))),
(null==b&&null!=a||null!=b&&null==a||b.id!=a.id||b.name!=a.name)&&this.dispatchEvent("change",{oldValue:b,newValue:a}))};js.$public.value=function(a){if(void 0===a)return this.principal();"string"==typeof a?this.findPrincipal(a):this.principal(a)};js.$public.principalId=function(a){if(void 0===a)return this._principalId;this._principalId=a;js.isNull(this._principalId)||this.value(this.principal())};js.$public.principalLabel=function(a){if(void 0===a)return this._principalLabel;this._principalLabel=
a;js.isNull(this._principalLabel)||this.value(this.principal())};js.$public.groupName=function(a){if(void 0===a)return this._groupName;this._groupName=a};js.$public.rootPath=function(a){if(void 0===a)return this._rootPath;this._rootPath=a};js.$public.fieldName=function(a){if(void 0===a)return this._fieldName;this._fieldName=a};js.$public.editable=function(a){if(void 0===a)return this._editable;this._editable=a;this._$element&&(a?(this._$element.find(".qs-principalfield input.qs-input").css("display",
""),this._$element.find(".qs-principalfield").removeClass("qs-button-normal")):(this._$element.find(".qs-principalfield input.qs-input").css("display","none"),this._$element.find(".qs-principalfield").addClass("qs-button-normal")))};js.$public.updateSize=function(a,b){this.$super();if(this.isRendered()){var c=this._$element.children(".qs-principalfield");c.css("height",this.outerHeight()-2+"px");var d=c.children(".qs-user_button");d.children(".qs-icon").css("top",(this.outerHeight()-16)/2-1);c=c.children(".qs-text");
c.width(a-d.width()-5);c.height(b-2)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-principalfield"\x3e','\x3cinput name\x3d"',this.name(),'" type\x3d"hidden" /\x3e','\x3cinput type\x3d"text" class\x3d"qs-input qs-text" value\x3d"',this._text,'"\x3e\x3c/input\x3e','\x3cspan class\x3d"qs-user_button qs-button-default"\x3e','\x3cspan class\x3d"qs-icon" title\x3d"\u9009\u62e9\u6570\u636e"\x3e\x3c/span\x3e',"\x3c/span\x3e","\x3c/div\x3e")};js.$public.render=function(a,
b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-principalfield");0<b.classes.length&&c.addClass(b.classes);this._$text=c.children(".qs-text");this._$valinput=c.children('input[type\x3d"hidden"]');c=c.children(".qs-user_button");this.bindEvent("click",function(){this.openDetail()},c);this.bindEvent("keyup",function(a){13==a.keyCode&&(a=this._$text.val(),js.isNull(a)||this.findPrincipal(a))},this._$text);this.invalidateSize()};this.openDetail=
function(){var a=new f.app.PrincipalFieldWindow;a.setRootPath(this._rootPath,this._domain,this);a.showDialog({classes:"qs-ani-popup"});a.invalidateSize(!0)};this.callback=function(a){js.isNull(a)||this.value(a)};this.findPrincipal=function(a){js.isNull(a)||(js.isNull(this._value)||this._value.name!=a)&&wos.Remoting.call("PrincipalService.getPrincipal",[a],this,new wos.events.AsyncOption("getPrincipal"))};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "getPrincipal":if(js.isNull(a.result)){f.ui.MessageBox.show("\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4eba\u5458\u3002",
"\u63d0\u793a");break}var b={};b.id=a.result.id;b.name=a.result.name;b.groupName=a.result.groupName;this.value(b)}}});js.$class("qs.app.PrincipalDataProvider",f.ui.JsonTreeDataProvider,function(){this.initialize=function(a,b){this.$super(a,b)};js.$public.labelField=function(a){if(void 0===a)return this._labelField;this._labelField=a};js.$public.label=function(a,b){if(void 0===b)return b=this.$super(a,b),js.isNull(b)||""==b?a.label||"":b;this.$super(a,b)};js.$public.isBranch=function(a){return a.$children&&
0==a.$children.length?!1:!0};js.$public.icon=function(a){return"P"==a.type?"images/icons/user.png":""}});js.$class("qs.ui.PrincipalTree",f.ui.TreeView,function(){this._IsMultiple=!1;this.treeData={$children:[{label:"",type:null,id:0,$parent:null,entity:null,IsLoading:!1}]};this.currentNode=null;this._labelField="name";this._rootPath="";this._domain=!1;this.initialize=function(a){a=l.extend({classes:"qs-app-ml-tree",checkable:this._IsMultiple,showRoot:!1},a);this.$super(a);var b=this;a=new f.app.PrincipalDataProvider(this.treeData,
{labelField:this._labelField,childrenField:"$children",load:function(a){b.onLoadNode.call(b,a)}});a.labelField(this._labelField);this.dataProvider(a);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.callAfterRendered(function(){this.afterRendered()})};js.$public.setRootPath=function(a,b){this._rootPath=a;this._domain=b};this.afterRendered=function(){this._domain?wos.Remoting.call("DomainService.getDomainTree",[],this,new wos.events.AsyncOption("getDomainTree")):
wos.Remoting.call("DepartmentService.findDepartmentGroup",[this._rootPath],this,new wos.events.AsyncOption("findDepartmentGroup"))};this.onLoadNode=function(a){if(!js.isNull(a))if(this.selectedItem(a),this.currentNode=a,!1==a.IsLoading&&"D"==a.type){var b=parseInt(a.id);this.getChildDep(b,a);this.getChildPri(b,a);a.IsLoading=!0}else"P"==a.type&&this.invalidateItem(a)};this.getChildDep=function(a,b){wos.Remoting.call("DepartmentService.getChildren",[a],this,new wos.events.AsyncOption("getChildDep",
b))};this.getChildPri=function(a,b){wos.Remoting.call("PrincipalService.getPrincipals",[a,0,99999],this,new wos.events.AsyncOption("getChildPri",b))};this.cb_getChildDep=function(a,b){null==b&&(b=[]);void 0==a.$children&&(a.$children=[]);for(var c=0;c<b.length;c++){var d=b[c],e={};e.id=d.id;e.label=d.name;e.type="D";e.entity=d;e.$parent=a;e.IsLoading=!1;a.$children.push(e)}this.invalidateItem(a)};this.cb_getChildPri=function(a,b){null==b&&(b=[]);void 0==a.$children&&(a.$children=[]);for(var c=0;c<
b.length;c++){var d=b[c],e={};e.id=d.id;e.label=d.name;e.type="P";e.entity=d;e.$parent=a;e.$children=[];e.IsLoading=!0;a.$children.push(e)}this.invalidateItem(a)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "findDepartmentGroup":if(null!=a.result){a=a.result;var b=this.treeData.$children[0];b.id=a.id;b.label="%DepartmentRoot%"==a.name?"\u90e8\u95e8":a.name;b.type="D";b.entity=a;b.IsLoading=!1;this.invalidateItem(b);this.expand(b)}break;case "getChildDep":this.cb_getChildDep(a.option.asyncData,
a.result);break;case "getChildPri":this.cb_getChildPri(a.option.asyncData,a.result)}}});js.$class("qs.app.PrincipalFieldWindow",f.ui.Window,function(){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" width\x3d"250" height\x3d"405" title\x3d"\u804c\u5458\u9009\u62e9" resizable\x3d"false"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" columns\x3d"[\'*\']" rows\x3d"[\'*\', 27]" hGap\x3d"2" vGap\x3d"2"\x3e',"\x3cScrollView\x3e",'\x3cPrincipalTree name\x3d"principalTree"/\x3e',
"\x3c/ScrollView\x3e",'\x3cHLayout layout\x3d"{rowIndex : 1, hAlign : \'right\', innerLayout:{height : 24, vAlign : \'bottom\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButton width\x3d"70" text\x3d"\u786e\u5b9a" click\x3d"onOK" options\x3d"{isDefault:true}" icon\x3d"images/icons/ok.png"/\x3e','\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Window\x3e"));this._opener=null;this._rootPath=
"";this._IsMultiple=this._domain=!1;this.initialize=function(b){b=l.extend({classes:"qs-principalfield-window qs-ani-fadein"},b);this.$super(b);this.qxml(a);this.principalTree.setRootPath(this._rootPath,this._domain)};js.$public.opener=function(a){if(void 0===a)return this._opener;this._opener=a};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});this.$super(a,c);this.invalidateSize(!0)};js.$public.setRootPath=function(a,c,d){this._rootPath=a;this._opener=d;this._domain=c};this.onOK=function(){var a=
this.principalTree.selectedItem();if(js.isNull(a)||"P"!=a.type)f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u804c\u5458\u3002","\u63d0\u793a");else{if(void 0!=this._opener){var c={};c.id=a.id;c.name=a.label;c.groupName="";js.isNull(a.$parent)||(c.groupName=a.$parent.label);this._opener.callback(c)}this.close()}};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.XmlForm",f.ui.Form,function(){js.$static.FIELDVALUE_CHANGE_EVENT="fieldValueChange";js.$static.FIELD_CHANGE_ACTION_EVENT="fieldChangeAction";js.$static.BUTTON_ACTION_EVENT="buttonActionEvent";f.events.register("fieldValueChange",this);f.events.register("fieldChangeAction",this);f.events.register("buttonActionEvent",this);this.created=!1;this.entity={};this.rtEntity={};this.modifiedMap={};this._application=this._report=this._query=this._form=null;this._editable=!0;
this.defaultTab=null;this._useDefaultValidator=this._generated=this.isEntitySetting=!1;this.formEntityXml=this.formXml=null;this.queryMode=!1;this.queryDefaultComboxValue="";this.controlDescriptor={};this.comboBoxRelation={};this.relationEntityMap=this.tabNavigator=null;this.relationEntities={};this._paddingBottom=this._paddingTop=this._paddingRight=this._paddingLeft=1;this.initialize=function(a){a=js.param(a,null);this.$super();this._form=a;this.maxHeight=this.maxWidth=0;this.bindEvent("keydown",
this.onKeyDown)};js.$public.useDefaultValidator=function(a){if(void 0===a)return this._useDefaultValidator;this._useDefaultValidator=a};js.$public.form=function(a){if(void 0===a)return this._form;this._form=a};js.$public.query=function(a){if(void 0===a)return this._query;this._query=a};js.$public.report=function(a){if(void 0===a)return this._report;this._report=a};js.$public.application=function(a){if(void 0===a)return this._application;this._application=a};js.$public.paddingLeft=function(a){if(void 0===
a)return this._paddingLeft;this._paddingLeft=a};js.$public.paddingTop=function(a){if(void 0===a)return this._paddingTop;this._paddingTop=a};js.$public.paddingRight=function(a){if(void 0===a)return this._paddingRight;this._paddingRight=a};js.$public.paddingBottom=function(a){if(void 0===a)return this._paddingBottom;this._paddingBottom=a};js.$public.generated=function(){return this._generated};js.$public.enabled=function(a){if(void 0===a)return this._enabled;this._enabled=a};js.$public.editable=function(a){if(void 0===
a)return this._editable;this._editable=a;for(var b in this.controlDescriptor)a=this.controlDescriptor[b].input,null!=a&&this.setFieldEnable(a,this._editable)};this.onKeyDown=function(a){};js.$public.isEmpty=function(){var a,b;for(b in this.controlDescriptor)if(a=this.controlDescriptor[b].input,js.instanceOf(a,f.ui.IFormControl)||js.instanceOf(a,f.ui.Button))return!1;return!0};js.$public.getControlDescriptor=function(){return this.controlDescriptor};js.$public.isModified=function(){var a=this.getEntity(!0,
!0),b;for(b in a)if(a[b]!=this.entity[b])return!0;return!1};js.$public.reset=function(a){a=js.param(a,!1);this.entity={};this.rtEntity={};this.modifiedMap={};this.relationEntities={};!0!=a&&(this.controlDescriptor={},this.formEntityXml=this.formXml=null,this.removeAllChildren(),this.tabView=null)};js.$public.getEntityXml=function(){return this.formEntityXml};js.$public.getEntity=function(a,b){a=js.param(a,!1);b=js.param(b,!0);var c={};null!=this.entity&&(!0==a?0<this.entity.id&&(c.id=this.entity.id):
(c=js.clone(this.entity),delete c[f.UID_PROPERTY],delete c.$type$,delete c.$selected$,delete c.$modified$));var d=this.controlDescriptor,e=!1,g,k;null!=this._form&&(e=this._form.getProperty("isEntityForm"));for(var m in d)!0==d[m].isRelation||!0==a&&!0!=this.modifiedMap[m]||!d[m].input||null!=d[m].property&&"true"==d[m].property.attr("buildin")||"QueryControl"==d[m].xml.name()||e&&null==d[m].property||(g=this.getInputValue(d[m].input,d[m].xml,d[m].property),js.instanceOf(d[m].input,f.app.EntityField)?
null!=g?(k=g.id,isNaN(k)?c[m+"_id"]=null:c[m+"_id"]=g.id,k=g[d[m].input.entityLabelField()],"undefined"==k&&(k=""),c[m+"_label"]=k):(c[m+"_id"]=null,c[m+"_label"]=null):js.instanceOf(d[m].input,f.app.PrincipalSelectField)?null!=g?(k=g.id,isNaN(k)||(c[m+"_id"]=g.id),c[m+"_name"]=g.name):(c[m+"_id"]=null,c[m+"_name"]=null):c[m]=g,!1==b&&(c[m]=g));for(m in this.rtEntity)if(!0!=a||!0==this.modifiedMap[m])null!=d[m]||null!=this.relationEntityMap&&-1!=m.indexOf(".")||(c[m]=this.rtEntity[m]);return c};js.$public.setEntity=
function(a){var b=this.controlDescriptor;this.isEntitySetting=!0;var c=null,d=a;null==d&&(d={});js.isNull(d.$relationEntities)||(c=d.$relationEntities,delete d.$relationEntities);this.entity=d;for(var e in b)if(!0!=b[e].isRelation&&b[e].input)if(js.instanceOf(b[e].input,f.app.EntityField)){var g={};null==d[e+"_id"]&&null==d[e+"_label"]?g=null!=d[e]?d[e]:null:(g.id=d[e+"_id"],g[b[e].input.entityLabelField()]=d[e+"_label"]);b[e].input.value(g)}else js.instanceOf(b[e].input,f.app.PrincipalSelectField)?
(b[e].input.principalId(d[e+"_id"]),b[e].input.principalLabel(d[e+"_name"])):null!=a?d.hasOwnProperty(e)&&this.setInputValue(b[e].input,d[e],b[e].xml,b[e].property):this.setInputValue(b[e].input,null,b[e].xml,b[e].property);for(var k in this.comboBoxRelation)for(a=this.comboBoxRelation[k];null!=a&&null!=a.comboBox;)this.setComboBoxRelation(k,a.comboBox,a.template,d[k]),a=js.isNull(a.next)?null:a.next;this.isEntitySetting=!1;null!=c&&this.setRelationEntities(c)};js.$public.getRelationEntities=function(a,
b){a=js.param(a,!1);b=js.param(b,!0);if(js.isNull(this.relationEntityMap))return null;var c={},d,e,g,k,m,l;for(l in this.controlDescriptor)g=this.controlDescriptor[l],!0!=g.isRelation||!0==a&&!0!=this.modifiedMap[l]||(d=c[g.relationEntity.ref],js.isNull(d)&&(e=this.relationEntities[g.relationEntity.ref],js.isNull(e)?d={}:!0==a?(d={},0<e.id&&(d.id=e.id)):d=js.clone(e),c[g.relationEntity.ref]=d),g.input&&null!=g.property&&"true"!=g.property.attr("buildin")&&"QueryControl"!=g.xml.name()&&(e=this.getInputValue(g.input,
g.xml,g.property),m=g.property.attr("name"),js.instanceOf(g.input,f.app.EntityField)?null!=e?(k=e.id,isNaN(k)?d[m+"_id"]=null:d[m+"_id"]=e.id,g=e[g.input.entityLabelField()],"undefined"==g&&(g=""),d[m+"_label"]=g):(d[m+"_id"]=null,d[m+"_label"]=null):js.instanceOf(g.input,f.app.PrincipalSelectField)?null!=e?(k=e.id,isNaN(k)||(d[m+"_id"]=e.id),d[m+"_name"]=e.name):(d[m+"_id"]=null,d[m+"_name"]=null):d[m]=e,!1==b&&(d[m]=e)));var p;for(l in this.rtEntity)!0==a&&!0!=this.modifiedMap[l]||!js.isNull(this.controlDescriptor[l])||
js.isNull(this.relationEntityMap)||-1==l.indexOf(".")||(g=l.lastIndexOf("."),p=l.substr(0,g),d=c[p],js.isNull(d)&&(d={},c[p]=d),d[l.substr(g+1)]=this.rtEntity[l]);if(!1==b){l=[];for(p in c)l.push(p);for(e=0;e<l.length;e++)if(p=l[e],g=p.split("."),1!=g.length){d=c;for(m=0;e<g.length-1;m++)js.isNull(c[g[m]])?(d={},c[g[m]]=d):d=c[g[m]];d[g[g.length-1]]=c[p]}}return c};js.$public.setRelationEntities=function(a){if(null!=this.relationEntityMap){this.isEntitySetting=!0;this.relationEntities=a;var b,c,d,
e;for(e in this.controlDescriptor)if(b=this.controlDescriptor[e],!0==b.isRelation&&(c=a[b.relationEntity.ref],b.input))if(d=b.property.attr("name"),js.instanceOf(b.input,f.app.EntityField)){var g=null;null!=c&&(g={},null==c[d+"_id"]&&null==c[d+"_label"]?g=null!=c[d]?c[d]:null:(g.id=c[d+"_id"],g[b.input.entityLabelField()]=c[d+"_label"]));b.input.value(g)}else js.instanceOf(b.input,f.app.PrincipalSelectField)?null!=c?(b.input.principalId(c[d+"_id"]),b.input.principalLabel(c[d+"_name"])):(b.input.principalId(null),
b.input.principalLabel(null)):null!=c?c.hasOwnProperty(d)&&this.setInputValue(b.input,c[d],b.xml,b.property):this.setInputValue(b.input,null,b.xml,b.property);for(e in this.comboBoxRelation)for(b=this.comboBoxRelation[e];null!=b&&null!=b.comboBox;)c=e.lastIndexOf("."),c=e.substr(0,c),c=a[c],null!=c&&this.setComboBoxRelation(e,b.comboBox,b.template,c[e]),b=js.isNull(b.next)?null:b.next;this.isEntitySetting=!1}};js.$public.refreshAllQuery=function(){var a=this.getControlDescriptor(),b;for(b in a)js.instanceOf(a[b].input,
f.app.QueryControl)&&a[b].input.refresh()};js.$public.setFieldValue=function(a,b,c){c=js.param(c,!0);var d=this.isEntitySetting;c||(this.isEntitySetting=!0);var e=this.controlDescriptor[a];null==this.rtEntity&&(this.rtEntity={});this.rtEntity[a]=b;this.modifiedMap[a]=!0;if(null!=e&&null!=e.input)if(js.instanceOf(e.input,f.app.EntityField))if(null!=b){var g={};g.id=null!=b[a+"_id"]?b[a+"_id"]:b.id;null!=b[a+"_label"]?g[e.input.entityLabelField()]=b[a+"_label"]:null!=b.label?g[e.input.entityLabelField()]=
b.label:g[e.input.entityLabelField()]=b[e.input.entityLabelField()];e.input.value(g)}else e.input.value(b);else js.instanceOf(e.input,f.app.PrincipalSelectField)?null!=b?"string"==js.type(b)?e.input.value(b):(js.isNull(b[a+"_id"])?e.input.principalId(b.id):e.input.principalId(b[a+"_id"]),js.isNull(b[a+"_name"])?e.input.principalLabel(b.name):e.input.principalLabel(b[a+"_name"])):e.input.value(b):this.setInputValue(e.input,b,e.xml,e.property);else for(e=this.comboBoxRelation[a];null!=e&&null!=e.comboBox;)this.setComboBoxRelation(a,
e.comboBox,e.template,b),e=js.Null(e.next)?null:e.next;!0==c&&(c={},c.fieldName=a,c.fieldValue=b,this.dispatchEvent(f.app.XmlForm.FIELDVALUE_CHANGE_EVENT,c));this.isEntitySetting=d};this.updateRelationEntityInputs=function(a,b){if(!js.isNull(b)){var c=a.property.attr("name");!0==a.isRelation&&(c=a.relationEntity.ref+"."+a.property.attr("name"));if(js.isNull(this.relationEntities[c])){var d=!1,e;for(e in this.relationEntityMap)if(this.relationEntityMap[e].ref==c){this.relationEntities[c]=b;d=!0;break}if(!d)return}else this.relationEntities[c]=
b;for(var f in this.controlDescriptor)a=this.controlDescriptor[f],!0==a.isRelation&&a.relationEntity.ref==c&&(d=a.property.attr("name"),this.setInputValue(a.input,b[d],a.xml,a.property))}};this.updateRelationEntityField=function(a,b){var c,d=null,e;for(e in this.controlDescriptor)if(c=this.controlDescriptor[e],js.isNull(a.relationEntity.parent)){if(js.instanceOf(c.input,f.app.EntityField)&&c.property.attr("name")==a.relationEntity.property){d=c;break}}else if(!0==c.isRelation&&a.relationEntity.ref==
this.relationEntityMap[a.relationEntity.parent].ref&&js.instanceOf(c.input,f.app.EntityField)&&c.property.attr("name")==a.relationEntity.property){d=c;break}null!=d&&(c=d.input.entityLabelField(),c==a.property.attr("name")&&(e=d.input.value(),null==e&&(e={}),e[c]=b,d.input.value(e,!0,!1)))};this.onFieldChange=function(a){if(!0!=this.isEntitySetting){a=a.target().name();var b=this.getFieldValue(a),c=this.controlDescriptor[a];js.isNull(this.relationEntityMap)||(js.instanceOf(c.input,f.app.EntityField)?
this.updateRelationEntityInputs(c,b):!0==c.isRelation&&this.updateRelationEntityField(c,b));if(null!=c.property){var d={};d.fieldName=a;d.fieldValue=b;this.modifiedMap[a]=!0;this.dispatchEvent(f.app.XmlForm.FIELDVALUE_CHANGE_EVENT,d)}null!=c.xml&&""!=c.xml.attr("changeEvent")&&(d={},d.fieldName=a,d.changeEvent=c.xml.attr("changeEvent"),this.dispatchEvent(f.app.XmlForm.FIELD_CHANGE_ACTION_EVENT,d))}};js.$public.getFieldValue=function(a){a=this.controlDescriptor[a];return null!=a&&null!=a.input?this.getInputValue(a.input,
a.xml,a.property):null};js.$public.getFieldInput=function(a){a=this.controlDescriptor[a];return null==a||js.isNull(a.input)?null:a.input};this.getInputValue=function(a,b,c){var d;if(js.instanceOf(a,f.ui.TextInput)){d=StringUtil.trim(a.text());if(0==d.length)return null;b=b.attr("type");""==b&&null!=c&&(b=c.attr("type"));return"long"==b?(a=parseInt(d),isNaN(a)?null:a):"double"==b?(a=parseFloat(d),isNaN(a)?null:a):!0==this.queryMode?f.app.SQLUtil.filter(a.text()):a.text()}if(js.instanceOf(a,f.ui.TextArea))return d=
!0==this.queryMode?f.app.SQLUtil.filter(a.text()):StringUtil.trim(a.text()),0==d.length?null:d;if(js.instanceOf(a,f.ui.ComboBox)){if(c=a.selectedItem(),null==c&&!0==a.editable()?c=a.text():null!=c&&"string"!=js.type(c)&&(c=c.value),"$null"!=c)return c}else{if(js.instanceOf(a,f.ui.RichTextEditor))return d=!0==this.queryMode?f.app.SQLUtil.filter(a.text()):StringUtil.trim(a.text()),0==d.length?null:d;if(js.instanceOf(a,f.ui.IFormControl))return a.value()}return null};this.getFraction=function(a){if(js.isNull(a))return 2;
a=parseInt(a.attr("fraction"));return isNaN(a)?2:a};this.setInputValue=function(a,b,c,d){if(js.instanceOf(a,f.ui.TextInput))null!=b?js.isNull(d)||"double"!=d.attr("type")||"number"!=js.type("value")?a.text(b):a.text(Number(b).toFixed(this.getFraction(d))):a.text("");else if(js.instanceOf(a,f.ui.NumberInput))null!=b?a.value(b):a.value(0);else if(js.instanceOf(a,f.ui.ComboBox)){c=!1;if(null!=b)if(d=a.dataProvider(),null!=d){for(var e=0;e<d.length;e++)if(d[e]&&d[e].value==b){a.selectedItem(d[e]);c=!0;
break}c||(a.selectedItem({label:b,value:b}),!0==a.editable()&&a.text(b))}else a.text(b);else a.selectedItem(null);for(c=this.comboBoxRelation[a.name()];null!=c&&null!=c.comboBox;)this.setComboBoxRelation(a.name(),c.comboBox,c.template,b),c=js.isNull(c.next)?null:c.next}else js.instanceOf(a,f.ui.IFormControl)&&a.value(b);return null};js.$public.validateInput=function(a){a=js.param(a,!0);!0==this._useDefaultValidator&&this.validate();var b=this.controlDescriptor,c,d;for(d in b)if(b[d].input&&(c=this.getInputValue(b[d].input,
b[d].xml,b[d].property),null==c&&!0==b[d].required))return!0==a&&f.ui.MessageBox.show("\u60a8\u8f93\u5165\u7684\u6761\u4ef6\u4e0d\u8db3\uff01","\u63d0\u793a"),!1;return!0};js.$public.updateSize=function(a,b){this.$super(a,b);this.isRendered()};js.$public.preferredSize=function(a,b){var c={};c.width=this.maxWidth;c.height=this.maxHeight;!0==this.queryMode&&this.maxWidth>a-13&&(c.height+=5);return c};js.$public.generateForm=function(a,b,c){b=js.param(b,null);c=js.param(c,null);this.formXml=a;this.formEntityXml=
b;this.relationEntityMap=c;null==this.formEntityXml&&(this.formEntityXml=new f.Xml("\x3cEntity /\x3e"));this._paddingLeft=parseInt(this.formXml.attr("paddingLeft"))||0;this._paddingRight=parseInt(this.formXml.attr("paddingRight"))||0;this._paddingTop=parseInt(this.formXml.attr("paddingTop"))||0;this._paddingBottom=parseInt(this.formXml.attr("paddingBottom"))||0;null==this.layout()&&this.layout(new f.layout.GridLayout);a=this.formXml.xpath("TabNavigator/tab");c=b=0;if(1==a.length){if(0==a[0].children().length)return;
var d=new f.ui.Container;this.generateTab(a[0],this.formEntityXml,d);var e=new f.ui.ScrollView;!0==this.queryMode&&(e.flat(!0),e.draggable(!0));e.content(d);this.addChild(e);b=Math.max(b,d.width());c=d.height();this.margin({left:5});!0!=this.queryMode?this.width(b+20):d.width(b+8);this.maxWidth=b;this.maxHeight=c+2}else{var g=new f.ui.TabView({delayRender:!1});this.addChild(g);for(var k=0;k<a.length;k++)d=new f.ui.Container,d.name("tab"+k),this.generateTab(a[k],this.formEntityXml,d),d.height(d.height()+
2),b=Math.max(b,d.width()),e=new f.ui.ScrollView,!0==this.queryMode&&(e.flat(!0),e.draggable(!0)),e.content(d),g.addTab(a[k].attr("label"),e),c=Math.max(c,d.height());this.tabView=g;c+=30;g.padding(2);this.tabView=g;g.move(NaN,NaN,b+22);!0!=this.queryMode?this.width(b+20):g.width(b+8);this.maxWidth=b+20;this.maxHeight=c+22;g.selectedTab(0);g.addEventListener("selectedItemChanged",function(){var a=this.getControlDescriptor(),b;for(b in a)js.instanceOf(a[b].input,f.app.QueryControl)&&a[b].input.dgResult.invalidateSize(!0)},
this)}5>this.maxHeight&&(this.maxHeight=0);this._generated=!0};js.$public.selectedTab=function(a){this.tabView&&this.tabView.selectedTab(a)};js.$public.getTabAt=function(a){if(this.tabView){if(0<=a&&a<this.tabView.items().length)return this.tabView.items()[a].content}else if(0==a)return this.children().get(0);return null};js.$protected.generateTab=function(a,b,c){c.removeAllChildren();var d=parseInt(a.attr("width")),e=parseInt(a.attr("height"));!isNaN(d)&&0<d&&c.width(d);!isNaN(e)&&0<e&&c.height(e);
var g=0,k=0,m,n,p,q=[],s,r,t,v=r="",z=!0,A,B=a.children(),y;for(p=0;p<B.length;p++){a=B[p];m=A=null;if(a.has("RE")){if(js.isNull(this.relationEntityMap))continue;A=this.relationEntityMap[a.attr("RE")];if(js.isNull(A)||js.isNull(A.entityXml))continue;s=a.attr("propertyUID");n=s.indexOf(".");m=A.entityXml.xpath('property[@uid \x3d "'+s.substr(n+1)+'"]')[0]||null;if(js.isNull(m))continue;a.attr("name",A.ref+"."+m.attr("name"))}else b?a.has("propertyUID")?m=b.xpath('property[@uid \x3d "'+a.attr("propertyUID")+
'"]')[0]||null:a.has("name")&&(m=b.xpath('property[@name \x3d "'+a.attr("name")+'"]')[0]||null):m=null;t=null;a.has("name")?t=a.attr("name"):m&&(t=m.attr("name"));if(null==t||0==t.length)t=c.name()+p;v="";a.has("toolTip")&&(v=a.attr("toolTip"));"null"==v&&(v="");""==v&&null!=m&&m.has("toolTip")&&(v=m.attr("toolTip"));"null"==v&&(v="");null==this.controlDescriptor[t]?(y={},this.controlDescriptor[t]=y):y=this.controlDescriptor[t];y.tooltip=v;js.isNull(A)||(y.isRelation=!0,y.relationEntity=A);A=!0;switch(a.name()){case "TextInput":var u;
null!=m&&"true"==m.attr("currency")?(u=new f.app.CurrencyInput,"double"==m.attr("type")&&u.valueType("double")):u=new f.ui.TextInput;a.has("restrict")&&(u.restrict=a.attr("restrict"));null!=m&&(0<Number(m.attr("length"))&&u.maxChars(Number(m.attr("length"))/2-1),"long"==m.attr("type")&&"true"!=m.attr("currency")?u.restrict="0-9\\-":"double"==m.attr("type")&&(u.restrict="0-9.\\-"));n=u;y.input=u;y.property=m;break;case "Password":u=new f.ui.TextInput;u.password(!0);n=u;y.input=u;y.property=m;break;
case "TextArea":n=u=new f.ui.TextArea;null!=m&&0<Number(m.attr("length"))&&u.maxChars(Number(m.attr("length"))/2-1);y.input=u;y.property=m;break;case "Text":A=new f.ui.ContentControl;u=l('\x3cdiv class\x3d"qs-xmlform-text"\x3e\x3c/div\x3e');null!=m&&"tooltip"==a.attr("text")?u.html(m.attr("tooltip")):u.html(a.attr("text").replace(/\n/g,"\x3cbr/\x3e"));n=A;A.content(u);null!=m&&"tooltip"==a.attr("text")&&(y.tooltip=m.attr("tooltip"));y.property=m;A=!1;break;case "Label":A=new f.ui.Label;null!=m&&"label"==
a.attr("text")?A.text(m.attr("label")+":"):A.text(a.attr("text"));n=A;y.label=A;y.property=m;js.isNull(y.input)&&js.isNull(m)&&(y.input=A);A=!1;break;case "Button":u=new f.ui.Button;u.text(a.attr("label"));n=u;u.addEventListener("click",this.onButtonClick,this);y.input=n;break;case "FieldSet":A=new f.ui.FieldSet;A.text(a.attr("label"));n=A;A=!1;break;case "VRule":n=new f.ui.VRule;A=!1;break;case "HRule":n=new f.ui.HRule;A=!1;break;case "NumericStepper":u=new f.ui.NumberInput;a.has("maximum")&&u.maximum(parseInt(a.attr("maximum")));
a.has("minimum")&&u.minimum(parseInt(a.attr("minimum")));n=u;y.input=u;y.property=m;break;case "Numeric":n=u=new f.ui.TextInput;y.input=u;y.property=m;break;case "MultiSelectBox":u=new f.ui.CheckGroup;""!=a.attr("valueProvider")?r=a.attr("valueProvider"):null!=m&&""!=m.attr("valueProvider")&&(r=m.attr("valueProvider"));null!=r&&0<r.length&&u.dataProvider(wos.DictionaryLoader.getValueList(r));n=u;y.input=u;y.property=m;break;case "SingleSelectBox":u=new f.ui.RadioGroup;""!=a.attr("valueProvider")?
r=a.attr("valueProvider"):null!=m&&""!=m.attr("valueProvider")&&(r=m.attr("valueProvider"));null!=r&&0<r.length&&u.dataProvider(wos.DictionaryLoader.getValueList(r));n=u;y.input=u;y.property=m;break;case "ComboBox":case "ComboBoxEx":u=new f.ui.ComboBox;a.has("valueProvider")?r=a.attr("valueProvider"):null!=m&&m.has("valueProvider")&&(r=m.attr("valueProvider"));if(null!=r&&0<r.length)if(-1!=r.indexOf("!rela:")){s=r.substr(6);n=s.indexOf(":");-1!=n?(r=s.substr(n+1),s=s.substring(0,n)):r="?";if(js.isNull(this.comboBoxRelation[s]))this.comboBoxRelation[s]=
{comboBox:u,template:r};else{for(n=this.comboBoxRelation[s];!js.isNull(n.next);)n=n.next;n.next={comboBox:u,template:r}}r="";u.dataProvider([{label:"",value:"$null"}])}else this.setComboBoxDataProvider(u,r);u.addEventListener("change",this.onComboBoxChange,this);n=u;y.input=u;y.property=m;y.dataProvider=r;break;case "CheckBox":u=new f.ui.CheckBox;u.text(a.attr("label"));n=u;y.input=u;y.property=m;break;case "DateField":u=new f.ui.DateField;u.formatDate="yyyy\u5e74MM\u6708dd\u65e5";n=u;y.input=u;y.property=
m;break;case "ImageField":n=u=new f.app.ImageField;y.input=u;y.property=m;break;case "AttachmentList":u=new f.app.AttachmentList;a.has("length")?u.maxFile(parseInt(a.attr("length"))):null!=m&&m.has("length")&&u.maxFile(parseInt(m.attr("length")));if(""!=a.attr("imageFile"))try{var D=JSON.parse(a.attr("imageFile")).$is_checked;!0!=D&&"true"!=D||u.accept("image/*")}catch(C){}n=u;y.input=u;y.property=m;break;case "DateTimeEntry":u=new f.ui.DateField;u.showTime=!0;n=u;y.input=u;y.property=m;break;case "TimeEntry":u=
new f.ui.DateField;u.showDate=!1;u.showTime=!0;n=u;y.input=u;y.property=m;break;case "EntityField":u=new f.app.EntityField;var E=n=null,F=null;null!=m&&(n=m.attr("entityUID"),E=m.attr("labelField"),F=m.attr("shortcutField"));""!=a.attr("entityUID")&&(n=a.attr("entityUID"));""!=a.attr("labelField")&&(E=a.attr("labelField"));""!=a.attr("shortcutField")&&(F=a.attr("shortcutField"));null!=n&&""!=n&&u.entityUID(n);null!=E&&""!=E&&u.entityLabelField(E);null!=F&&""!=F&&u.shortCut(F);""!=a.attr("queryUID")&&
u.queryUID(a.attr("queryUID"));""!=a.attr("formUID")&&u.formUID(a.attr("formUID"));""!=a.attr("forceAssociation")&&"null"!=a.attr("forceAssociation")?u.forceAssociation("true"==a.attr("forceAssociation")?!0:!1):u.forceAssociation(!this.queryMode);this.queryMode?null!=this._query?u.parentContainer(this._query):null!=this._report&&u.parentContainer(this._report):u.parentContainer(this._form);u.application(this._application);n=u;y.input=u;y.property=m;break;case "PrincipalSelectField":u=new f.app.PrincipalSelectField;
""!=a.attr("departmentPath")?u.rootPath(a.attr("departmentPath")):null!=m&&""!=a.attr("departmentPath")?u.rootPath(m.attr("departmentPath")):u.rootPath("/");n=u;y.input=u;y.property=m;break;case "RichTextEditor":n=u=new f.ext.UEditor({toolbars:"richTextBars"});y.input=u;y.property=m;break;case "QueryControl":u=new f.app.QueryControl;u.form(this._form);u.formMode(!0);u.parentField(a.attr("parentField"));u.queryUID(a.attr("queryUID"));n=u;y.input=u;y.property=m;break;case "ReportControl":u=new f.app.ReportControl;
u.form(this._form);n=u;y.input=u;y.property=m;break;default:n=wos.Desktop.getCustomerControl(a.name());if(js.isNull(n))continue;u=null;try{if(u=js.newInstance(n),!js.instanceOf(u,f.ui.FormControl)){f.ui.MessageBox.show("\u81ea\u5b9a\u4e49\u63a7\u4ef6\u5fc5\u987b\u7ee7\u627f\u81eaqs.ui.FormControl\u63a7\u4ef6\u3002","\u81ea\u5b9a\u4e49\u63a7\u4ef6\u9519\u8bef");continue}}catch(G){f.ui.MessageBox.show(G.message,"\u81ea\u5b9a\u4e49\u63a7\u4ef6\u9519\u8bef");continue}this.setCustomerControlProperty(u,
a.attr("properties"));n=u;y.input=u;y.property=m}null!=y&&(y.xml=a,"true"==a.attr("required")?(!0==this._useDefaultValidator&&js.instanceOf(y.input,f.ui.IFormControl)&&(validator=new f.ui.Validator,validator.required(!0),validator.source(y.input),validator.message("\u8fd9\u4e2a\u5b57\u6bb5\u5fc5\u987b\u586b\u5199"),this.addValidator(y.input,validator)),y.required=!0):y.required=!1);null!=n&&(null!=v&&void 0!=v&&""!=v&&n.toolTip(v),n.addEventListener("change",this.onFieldChange,this),c.addChild(n),
a.attr("tabIndex")&&(z=!1),this.setControlProperty(n,a),v=n.left(),y=n.top(),u=n.outerSize(),0<v+u.width&&(g=Math.max(g,v+u.width)),0<y+u.height&&(k=Math.max(k,y+u.height)),"Label"==a.name()?n.name(t+"_label"):"Text"==a.name()?n.name(t+"_tooltip"):(n.name(t),null!=m&&"true"==m.attr("systemProperty")&&"true"!=m.attr("valueEditable")&&this.setFieldEnable(n,!1)),A&&q.push(n))}if(!0==z)for(q.sort(this.compareTabIndex),p=0;p<q.length;p++)q[p].tabIndex(p);for(s in this.comboBoxRelation)for(n=this.comboBoxRelation[s];null!=
n&&null!=n.comboBox;)this.setComboBoxRelation(s,n.comboBox,n.template),n=js.isNull(n.next)?null:n.next;isNaN(d)&&c.width(g);isNaN(e)&&c.height(k);this.invalidateSize()};this.setCustomerControlProperty=function(a,b){for(var c=b.split(";"),d,e,g=0;g<c.length;g++)if(d=c[g].split("\x3d"),2==d.length){e=StringUtil.trim(d[0]);d=StringUtil.trim(d[1]);try{if("function"==f.type(a[e]))a[e](d);else a[e]=d}catch(k){}}};this.compareTabIndex=function(a,b){var c=a.left(),d=a.top(),e=b.left(),f=b.top();return d+
a.height()<f?-1:d>f+b.height()?1:c<e?-1:c>e?1:0};this.setControlStyle=function(a,b){for(var c=b.split(";"),d,e={},f=0;f<c.length;f++)d=c[f],d=d.split(":"),2==d.length&&""!=d[1].trim()&&"null"!=d[1]&&"undefined"!=d[1]&&(e[d[0]]=d[1]);a.css(e)};this.setControlProperty=function(a,b){for(var c,d,e={},g=0;g<b.attributes.length;g++)switch(c=b.attributes[g].name,d=b.attributes[g].value,"true"==d?d=!0:"false"==d?d=!1:NumberUtil.isNumber(d)&&(d=NumberUtil.toNumber(d)),c){case "name":break;case "x":a.left(parseInt(d)+
this._paddingLeft);break;case "y":a.top(parseInt(d)+this._paddingTop);break;case "width":case "height":d=parseInt(String(d));isNaN(Number(d))||(e[c]=d);break;case "style":this.setControlStyle(a,d);break;default:if("null"!=d&&""!=d&&!js.instanceOf(a,f.app.ReportControl))if("function"==f.type(a[c]))a[c](d);else a[c]=d}void 0!==e.width&&a.outerWidth(e.width,!1);void 0!==e.height&&a.outerHeight(e.height,!1)};this.onComboBoxChange=function(a){a=a.target().name();for(var b=this.comboBoxRelation[a];null!=
b&&null!=b.comboBox;)this.setComboBoxRelation(a,b.comboBox,b.template),b=js.isNull(b.next)?null:b.next};this.setComboBoxRelation=function(a,b,c,d){d=js.param(d,null);var e=null;null!=d&&(e=d);"$null"==e&&(e=null);d=this.controlDescriptor[a];if(null==e){if(null==d||null==d.input||null==d.dataProvider||""==d.dataProvider)return;a=d.input.selectedItem();null!=a&&(e=a.value)}"$null"==e&&(e=null);if(null!=e){a="";e=c.replace("?",e);-1!=e.indexOf(".")?a=e:(c=d.dataProvider.indexOf("."),-1!=c&&(a=d.dataProvider.substring(0,
c)),a+="."+e);e=wos.Desktop.getDictionary(a);!0==this.queryMode?(c=[],c.push({label:this.queryDefaultComboxValue,value:"$null"})):(c=[],c.push({label:"",value:"$null"}));for(d=0;d<e.length;d++)c.push(e[d]);e=c;b.dictionary=a;b.dataProvider(e);b.selectedItem(null);c=null;null==this.entity?this.queryMode||(c=wos.DictionaryLoader.getDefaultValue(e,!1)):(d=this.rtEntity[b.name()],null==d&&(d=this.entity[b.name()]),null!=d&&(c=wos.DictionaryLoader.getValueItem(e,d)));null==c&&(c=e[0]);b.selectedItem(c);
null!=this.controlDescriptor[b.name()]&&(this.controlDescriptor[b.name()].dataProvider=a)}else b.dataProvider(null),b.selectedItem(null)};js.$public.setFieldEnable=function(a,b){null!=a&&(js.instanceOf(a,f.ui.Label)||(js.instanceOf(a,f.ui.ComboBox)?a.enabled(b):"function"==js.type(a.enabled)&&a.enabled(b)))};js.$public.setFieldProperty=function(a,b,c){var d=this.getFieldInput(a);if(null!=d){var e=this.controlDescriptor[a],g=e.property;if("enabled"==b)null!=g&&"true"==g.attr("systemProperty")&&"true"!=
g.attr("valueEditable")&&(c=!1),c="true"==c||!0==c?!0:!1,this.setFieldEnable(d,c),null!=e.label&&e.label.enabled(c);else if("visible"==b)null!=d&&d.visible(c),null!=e.label&&e.label.visible(c);else if("value"==b)this.setFieldValue(a,c);else if("focus"==b)js.instanceOf(d,f.ui.Control)&&d.isRendered()&&!0==c&&d.focus();else if(js.instanceOf(d,f.ui.ComboBox))switch(b){case "dataProvider":b=this.getFieldValue(a);this.setComboBoxDataProvider(d,c);null!=b&&this.setFieldValue(a,b);break;default:if("function"==
js.type(d[b]))d[b](c)}else if(js.instanceOf(d,f.ui.RadioGroup))switch(b){case "dataProvider":"array"==js.type(c)?d.dataProvider(c):d.dataProvider(wos.DictionaryLoader.getValueList(c));break;default:if("function"==js.type(d[b]))d[b](c)}else if("function"==js.type(d[b]))d[b](c);else d[b]=c}};this.setComboBoxDataProvider=function(a,b){var c,d="";"array"==js.type(b)?c=b:(d=b,c=wos.DictionaryLoader.getValueList(d));!0==this.queryMode?c.splice(0,0,{label:this.queryDefaultComboxValue,value:"$null"}):c.splice(0,
0,{label:"",value:"$null"});a.dictionary=d;a.dataProvider(c);var e=null;""!=d&&(e=wos.DictionaryLoader.getDefaultValue(c,!1));null==e&&(e=c[0]);a.selectedItem(e)};js.$public.onDictionaryUpdated=function(a){var b=this.controlDescriptor,c,d;for(d in b)null!=b[d].input&&js.instanceOf(b[d].input,f.ui.ComboBox)&&(c=b[d].input,c.dictionary==a&&this.setComboBoxDataProvider(c,a))};this.onButtonClick=function(a){a=this.controlDescriptor[a.target().name()];if(!js.isNull(a)&&(a=a.xml,null!=a&&""!=a.attr("action"))){var b=
{};b.action=a.attr("action");this.dispatchEvent(f.app.XmlForm.BUTTON_ACTION_EVENT,b)}};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-xmlform qs-container"\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){this.$super(a,b);"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);var c=a.find(".qs-xmlform");0<b.classes.length&&c.addClass(b.classes);this.invalidateSize()}});f.app.IFormComponent=js.Interface("qs.app.IFormComponent",function(){js.$public.getValue=
function(){};js.$public.setValue=function(a){}});f.app.FormControl=new js.Class("qs.app.FormControl",f.ui.FormControl,[f.app.IFormComponent],function(){js.$public.getValue=function(){return this.value()};js.$public.setValue=function(a){this.value(a)};js.$public.fireChangeEvent=function(){f.runtime&&"HtmlControlRuntime"==f.runtime.type&&invoke_runtime(f.runtime,"setValue",this.getValue())}})})(qs,jQuery);(function(f,l){function a(a,b){var e=parseFloat(a.attr("order"))||0,f=parseFloat(b.attr("order"))||0;return e>f?1:e<f?-1:0}function b(a,b){var e=parseFloat(a.order)||0,f=parseFloat(b.order)||0;return e>f?1:e<f?-1:0}js.$class("qs.app.NavigateBarTreeDataProvider",f.ui.JsonTreeDataProvider,function(){this.initialize=function(a,b){this.$super(a,b)};js.$public.icon=function(a,b){return null==a||void 0==a?"":"QueryPage"==a.xmlName?wos.Desktop.getAbsoluteUrl("images/icons/entity-query.png"):"ReportPage"==
a.xmlName?wos.Desktop.getAbsoluteUrl("images/icons/report.png"):"WebPage"==a.xmlName?wos.Desktop.getAbsoluteUrl("images/icons/file.png"):""}});js.$class("qs.app.NavigateBar",f.ui.Accordion,function(){f.events.register("selectChange",this);this.initialize=function(a){a=l.extend({classes:"qs-navbar"},a);this.$super(a);this._menuXml=null;this.addEventListener("change",this.onChange)};this.onChange=function(a,b){var e=a.target();if(e!=this&&!js.isNull(b.newValue)){for(var g=this.items(),k=0;k<g.length;k++)g[k].content!=
e&&(js.instanceOf(g[k].content,f.ui.TreeView)||js.instanceOf(g[k].content,f.ui.List))&&g[k].content.selectedItem(null);f.Timer.callLater(100,function(){this.dispatchEvent("selectChange",b)},this)}};js.$public.menuXml=function(b){if(void 0===b)return this._menuXml;this._menuXml=b;if(js.instanceOf(this._menuXml,f.Xml)){b=this._menuXml.children();b=b.sort(a);for(var d,e,g=[],k=0;k<b.length;k++)d=b[k],e={},e.label=d.attr("label"),0<d.xpath("menuitem/menuitem").length?e.content=this.createNavTree(d):e.content=
this.createNavList(d),g.push(e);this.items(g)}};this.sortOrder=function(a){if("array"==js.type(a.menuitem)){a.menuitem=a.menuitem.sort(b);for(var d=0;d<a.menuitem.length;d++)this.sortOrder(a.menuitem[d])}};this.createNavTree=function(a){var b=new f.ui.TreeView({classes:"nav-menu"});a=a.toJSON({childArray:!0});this.sortOrder(a);a=new f.app.NavigateBarTreeDataProvider(a,{childrenField:"menuitem"});b.dataProvider(a);return b};this.createNavList=function(a){a=a.toJSON();this.sortOrder(a);if(!js.isNull(a.menuitem)){var b=
new f.ui.List({classes:"nav-menu"});b.itemRenderer(function(a,b,c,d){"QueryPage"==b.xmlName?a.append('\x3cimg class\x3d"icon" src\x3d"'+wos.Desktop.getAbsoluteUrl("images/icons/entity-query.png")+'"\x3e\x3c/img\x3e'):"ReportPage"==b.xmlName?a.append('\x3cimg class\x3d"icon" src\x3d"'+wos.Desktop.getAbsoluteUrl("images/icons/report.png")+'"\x3e\x3c/img\x3e'):"WebPage"==b.xmlName?a.append('\x3cimg class\x3d"icon" src\x3d"'+wos.Desktop.getAbsoluteUrl("images/icons/file.png")+'"\x3e\x3c/img\x3e'):"PageGroup"==
b.xmlName&&a.append('\x3cimg class\x3d"icon" src\x3d"'+wos.Desktop.getAbsoluteUrl("images/icons/folder.png")+'"\x3e\x3c/img\x3e');a.append(b.label)});"array"==js.type(a.menuitem)?b.dataProvider(a.menuitem):b.dataProvider([a.menuitem]);return b}};js.$public.selectedFirst=function(){var a=this.items();if(0!=a.length){var b=a[0].content;this.selectedIndex(0);if(js.instanceOf(b,f.ui.List)){var e=b.dataProvider();f.Timer.callLater(400,function(){b.selectedItem(e[0])})}else if(js.instanceOf(b,f.ui.TreeView)){for(var e=
b.dataProvider(),a=e.children(null),g;"array"==js.type(a);)g=a[0],a=e.children(g);js.isNull(g)||f.Timer.callLater(400,function(){b.selectedItem(g)})}}};js.$public.selectedMenu=function(a){"/"==a[0]&&(a=a.substr(1));a=a.split("/");for(var b=this.items(),e=null,g=0;g<b.length;g++)if(b[g].label==a[0]){e=b[g].content;this.selectedIndex(g);break}if(js.instanceOf(e,f.ui.List))for(var k=e.dataProvider(),g=0;g<k.length;g++){if(k[g].label==a[1]){f.Timer.callLater(400,function(){e.selectedItem(k[g])});break}}else if(js.instanceOf(e,
f.ui.TreeView)){for(var k=e.dataProvider(),b=k.children(null),m,g=1;g<a.length;g++){if("array"!=js.type(b))return;for(var l=0;l<b.length;l++)if(a[g]==b[l].label){m=b[l];b=k.children(m);break}}js.isNull(m)||f.Timer.callLater(400,function(){e.selectedItem(m)})}};js.$public.selectedItem=function(a){if(void 0===a)return this.$super();if(null==a){var b=this.$super();null!=b&&null!=b.content&&b.content.selectedItem(null)}else for(var e=this.items(),g=0;g<e.length;g++)if(js.instanceOf(e[g].content,f.ui.List)){if(b=
e[g].content.dataProvider(),-1!=b.indexOf(a)){this.selectedIndex(g);e[g].content.selectedItem(a);break}}else if(js.instanceOf(e[g].content,f.ui.TreeView)){var b=e[g].content.dataProvider(),k=function(a,b,c){if(a==b)return a;b=c.children(b);var d;if("array"==js.type(b))for(var e=0;e<b.length;e++)if(d=k(a,b[e],c),!js.isNull(d))return d;return null},b=k(a,b.root(),b);if(!js.isNull(b)){this.selectedIndex(g);e[g].content.selectedItem(a);break}}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.form.SubmitButton",f.ui.Control,function(){f.events.register("change",this);f.events.register("submit",this);this.submitMenu=null;this.submitList=[];this._label="";this._currentSubmit=null;this._mode="";this.menuButton=this.buttonBar=this.okButton=null;this.initialize=function(a){this.$super()};js.$public.enabled=function(a){this.$super(a);if(void 0===a)return this._enabled;this._enabled=a;null!=this.okButton&&this.okButton.enabled(a);null!=this.buttonBar&&this.buttonBar.enabled(a);
null!=this.menuButton&&this.menuButton.enabled(a)};this.onSubmitMenuClick=function(a){this._currentSubmit=this.menuButton.selectedItem().xml;this.dispatchEvent("submit")};this.onSubmitMenuChange=function(a){this._currentSubmit=this.menuButton.selectedItem().xml;this.dispatchEvent("change")};this.onButtonClick=function(a){this._currentSubmit=new f.Xml('\x3csubmit name\x3d"\u786e\u5b9a" /\x3e');this.dispatchEvent("submit")};this.onButtonBarClick=function(a,b){this._currentSubmit=b.data.xml;this.dispatchEvent("change");
this.dispatchEvent("submit")};this.createButton=function(){if("bar"==this._mode){if(null==this.buttonBar){this._$element.empty();this.buttonBar=new f.ui.ButtonBar;var a=this._$element.append("\x3cdiv\x3e\x3c/div\x3e");this.buttonBar.render(a);this.buttonBar.addEventListener("buttonClick",this.onButtonBarClick,this)}this.buttonBar.toolTip("\u8bf7\u9009\u62e9\u63d0\u4ea4\u65b9\u5f0f");this.buttonBar.dataProvider(this.submitList);1==this.submitList.length?this.buttonBar.$element().addClass("qs-single"):
this.buttonBar.$element().removeClass("qs-single")}else"list"==this._mode?(null==this.menuButton&&(this._$element.empty(),this.menuButton=new f.ui.MenuButton,a=this._$element.append("\x3cdiv\x3e\x3c/div\x3e"),this.menuButton.render(a),this.menuButton.addEventListener("change",this.onSubmitMenuChange,this),this.menuButton.addEventListener("click",this.onSubmitMenuClick,this)),this.menuButton.text("\u8bf7\u9009\u62e9..."),this.menuButton.toolTip("\u8bf7\u9009\u62e9\u63d0\u4ea4\u65b9\u5f0f"),this.menuButton.menudata(this.submitList)):
null==this.okButton&&(this._$element.empty(),this.okButton=new f.ui.Button({text:"\u786e\u5b9a"}),a=this._$element.append("\x3cdiv\x3e\x3c/div\x3e"),this.okButton.render(a,{isDefault:!0,icon:"images/icons/ok.png"}),this.okButton.addEventListener("click",this.onButtonClick,this));a=this.findAncestor(f.app.FormWindow);js.isNull(a)||a.invalidateSize(!0)};js.$public.label=function(a){this._label=a;"list"==this._mode&&null!=this.menuButton?this.menuButton.text(a):""==this._mode&&null!=this.okButton&&this.okButton.text(a)};
js.$public.currentSubmit=function(a){if(void 0===a)return this._currentSubmit;this._currentSubmit=a;null!=this.popupButton&&null!=a&&this.popupButton.text(a.name)};js.$public.mode=function(a){this._mode=a;"bar"==this._mode?this.width(NaN):"list"==this._mode?this.width(100):this.width(70);this.createButton()};js.$public.setSubmitList=function(a){if(null==a||0==a.length)this._mode="",this.width(70),this.createButton();else{this.submitList.length=0;for(var b,c=0;c<a.length;c++){b={};if(""!=a[c].attr("value")){b.name=
a[c].attr("value");b.label=b.name;var d=a[c];d.attr("name",d.attr("value"));a[c]=d;b.xml=d}else b.name=a[c].attr("name"),b.label=b.name,b.xml=a[c];this.submitList.push(b)}null!=this.buttonBar?(this.buttonBar.dataProvider(this.submitList),1==this.submitList.length?this.buttonBar.$element().addClass("qs-single"):this.buttonBar.$element().removeClass("qs-single")):null!=this.menuButton&&this.menuButton.menudata(this.submitList);"list"!=this._mode&&this.mode("bar")}};js.$public.updateSize=function(a,
b){this.$super(a,b);this.isRendered()&&(null!=this.okButton&&this.okButton.outerSize({width:a,height:b}),null!=this.buttonBar&&this.buttonBar.height(b),null!=this.menuButton&&this.menuButton.outerSize({width:a,height:b}))};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"qs-submit-button",src:""},this._options,b);this.$super(a,b);0<b.classes.length&&a.addClass(b.classes);this.createButton();this.invalidateSize()}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cContainer xmlns:app\x3d"qs.app" xmlns:form\x3d"qs.app.form"\x3e','\x3cVLayout vGap\x3d"3"\x3e','\x3cGridLayout width\x3d"100%" columns\x3d"[\'*\', 100]" rows\x3d"[\'23\', \'23\']" hGap\x3d"2" vGap\x3d"2"\x3e','\x3cTextArea name\x3d"txtSubmitNote" layout\x3d"{rowSpan : 2}" visible\x3d"false" /\x3e','\x3cButton name\x3d"btnActivityLog" text\x3d"\u6d41\u7a0b\u65e5\u5fd7" height\x3d"23" visible\x3d"false" layout\x3d"{rowIndex : 0, colIndex : 1}" click\x3d"onOpenActivityLog"/\x3e',
'\x3cCheckBox name\x3d"cbActivityRemark" text\x3d"\u4fdd\u7559\u6d41\u7a0b\u5907\u6ce8" visible\x3d"false" height\x3d"23" layout\x3d"{rowIndex : 1, colIndex : 1}"/\x3e','\x3cTextInput name\x3d"txtProcessName" height\x3d"23" layout\x3d"{colSpan : 2, rowSpan : 2}" visible\x3d"false" /\x3e',"\x3c/GridLayout\x3e",'\x3cGridLayout height\x3d"24" width\x3d"100%" \x3e','\x3cHLayout height\x3d"24" hAlign\x3d"left" \x3e','\x3cLabel name\x3d"lbFormStyle" text\x3d"\u8868\u5355\u6837\u5f0f:" visible\x3d"false" /\x3e',
'\x3cComboBox name\x3d"cboFormStyle" minSize\x3d"{width:60}" visible\x3d"false" change\x3d"cboFormStyle_SelectionChanged" /\x3e',"\x3c/HLayout\x3e",'\x3cHLayout name\x3d"submitTools" height\x3d"24" hAlign\x3d"right" hGap\x3d"3" innerLayout\x3d"{height:\'100%\'}"\x3e','\x3cLabel name\x3d"lbSubmitTarget" text\x3d"\u63d0\u4ea4\u7ed9:" visible\x3d"false" /\x3e','\x3capp:PrincipalSelectField name\x3d"psfSubmitTarget" visible\x3d"false" /\x3e','\x3cComboBox name\x3d"cboSubmitTarget" labelField\x3d"name" valueField\x3d"id" minSize\x3d"{width:60}" visible\x3d"false" change\x3d"onSubmitTargetChange" /\x3e',
'\x3cButton name\x3d"btnCopy" click\x3d"onCopy" toolTip\x3d"\u590d\u5236\u5f53\u524d\u6570\u636e\u5e76\u8fdb\u5165\u65b0\u5efa\u6570\u636e\u72b6\u6001" visible\x3d"false" icon\x3d"images/icons/edit-copy.png" /\x3e','\x3cMenuButton name\x3d"btnPrint" toolTip\x3d"\u6253\u5f00\u76f8\u5173\u62a5\u8868" layout\x3d"{height:\'100%\'}" visible\x3d"false" /\x3e','\x3cform:SubmitButton name\x3d"btnSubmit" minSize\x3d"{width:70}" change\x3d"onSubmitChange" submit\x3d"onSubmit"/\x3e','\x3cButton name\x3d"btnCancel" text\x3d"\u53d6\u6d88" click\x3d"onCancel" width\x3d"60" icon\x3d"images/icons/cancel.png" /\x3e',
"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/VLayout\x3e","\x3c/Container\x3e"));js.$class("qs.app.form.SubmitPanel",f.ui.Container,function(){f.events.register("cancel",this);f.events.register("copy",this);f.events.register("submit_change",this);f.events.register("template_print",this);f.events.register("form_style_change",this);js.$static.SUBMIT="submit";js.$static.CANCEL="cancel";js.$static.COPY="copy";js.$static.SUBMIT_CHANGE="submit_change";js.$static.REPORT_PRINT="report_print";js.$static.FORMSTYLE_CHANGE=
"form_style_change";this.printList=this.submitDefXml=this.phraseMenu=this.printMenu=null;this.phraseList=[];this.dynamicForm=this.contextMenuXml=null;this.WF_mode="";this.isSubmitTargetRequired=!1;this.defaultSubmitNote="\u5728\u6b64\u5904\u8f93\u5165\u63d0\u4ea4\u8bf4\u660e";this.defaultProcessName="\u5728\u6b64\u8f93\u5165\u5de5\u4f5c\u6d41\u5b9e\u4f8b\u540d\u79f0";this.colorGray=8421504;this.colorBlack=0;this.editSubmitNote=!1;this.editEntity=null;this.isProcessNameRequired=!0;this.isSubmitNoteRequired=
this.isSubmitNoteVisiable=!1;this._task=this.submitTargetList=this.submitTargetValidator=this.processNameValidator=this.submitNoteValidator=null;this.phraseKey="";this.initialize=function(b){this.$super();this.qxml(a);this._currentState="";var c=this;this.txtSubmitNote.bindEvent("focusin",function(a){c.cbActivityRemark.isChecked()&&""!=c.defaultSubmitNote&&"\u5728\u6b64\u5904\u8f93\u5165\u63d0\u4ea4\u8bf4\u660e"!=c.defaultSubmitNote&&c.txtSubmitNote.text(c.defaultSubmitNote)});this.txtProcessName.textMask(this.defaultProcessName);
this.txtSubmitNote.textMask(this.defaultSubmitNote)};js.$public.currentState=function(a){if(void 0===a)return this._currentState;this._currentState=a;if(""==a){a=[this.txtSubmitNote,this.btnActivityLog,this.cbActivityRemark,this.txtProcessName,this.lbFormStyle,this.cboFormStyle,this.lbSubmitTarget,this.psfSubmitTarget,this.cboSubmitTarget,this.btnCopy,this.btnPrint];for(var c=0;c<a.length;c++)a[c].visible(!1)}else"show_process_name"==a?this.txtProcessName.visible(!0):"show_submit_note"==a&&(this.txtSubmitNote.visible(!0),
this.btnActivityLog.visible(!0),this.cbActivityRemark.visible(!0),this.txtProcessName.visible(!1));a=this.findAncestor(f.app.FormWindow);null!=a&&a.autoSize()};js.$public.task=function(a){if(void 0===a)return this._task;this._task=a;null!=this._task&&this._task.uid&&(this.phraseKey="\u5e38\u7528\u8bed(\u5de5\u4f5c\u6d41)."+this._task.uid,this.phraseList=wos.Desktop.getDictionary(this.phraseKey))};this.onSubmitChange=function(){this.setSubmit(this.btnSubmit.currentSubmit())};this.printMenuClickHandler=
function(a,c){var d={};d.reportUID=c.uid;d.title=c.label;this.dispatchEvent(this.$class.REPORT_PRINT,d)};this.setSubmit=function(a){this.btnSubmit.label(a.attr("name"));a=a.xpath("submit_target");"array"==js.type(a)&&(a=a[0]);a?(this.lbSubmitTarget.visible(!0),this.lbSubmitTarget.width(NaN),null!=this.submitTargetList?(this.cboSubmitTarget.visible(!0),this.psfSubmitTarget.visible(!1),this.cboSubmitTarget.width(92),this.psfSubmitTarget.width(0)):(this.psfSubmitTarget.visible(!0),this.cboSubmitTarget.visible(!1),
this.cboSubmitTarget.width(0),this.psfSubmitTarget.width(92),this.psfSubmitTarget.rootPath(a.attr("departmentPath"))),"true"==a.attr("required")?this.isSubmitTargetRequired=!0:this.isSubmitTargetRequired=!1):(this.lbSubmitTarget.visible(!1),this.psfSubmitTarget.visible(!1),this.psfSubmitTarget.rootPath("/"),this.cboSubmitTarget.visible(!1),this.isSubmitTargetRequired=!1);this.invalidateSize(!0);a=this.findAncestor(f.app.FormWindow);null!=a&&a.autoSize();this.dispatchEvent(this.$class.SUBMIT_CHANGE)};
js.$public.reinit=function(){this.currentState("");this.txtSubmitNote.text("");this.txtProcessName.text("");this.txtProcessName.enabled(!0);this.psfSubmitTarget.value(null);this.cboSubmitTarget.dataProvider(null);this.submitTargetList=null;this.btnSubmit.currentSubmit(null);this.phraseKey="";this._task=null};js.$public.showSubmitNote=function(a){(this.isSubmitNoteVisiable=a)&&"HumanSubmit"==this.WF_mode&&this.currentState("show_submit_note");a||("HumanStart"==this.WF_mode&&!0==this.isProcessNameRequired?
this.currentState("show_process_name"):this.currentState(""))};js.$public.setSubmitNoteRequired=function(a){(this.isSubmitNoteRequired=a)&&this.showSubmitNote(!0)};js.$public.setWFMode=function(a){this.WF_mode=a;this.currentState("");"HumanStart"==this.WF_mode&&!0==this.isProcessNameRequired?this.currentState("show_process_name"):"HumanSubmit"==this.WF_mode?this.isSubmitNoteVisiable&&this.currentState("show_submit_note"):"SimpleSubmit"==this.WF_mode?this.enableSubmitTarget(!0):this.enableSubmitTarget(!1,
!1);""!=this.WF_mode&&null!=this.WF_mode&&this.btnCopy.visible(!1)};js.$public.setEntity=function(a){this.editEntity=a};js.$public.setSubmitTargetList=function(a,c,d){d=js.param(d,NaN);if(null==c)this.lbSubmitTarget.visible(!1),this.cboSubmitTarget.visible(!1);else{var e=!1;null!=this.btnSubmit.currentSubmit()&&this.btnSubmit.currentSubmit().xpath("submit_target")&&(e=!0);c.splice(0,0,null);if(null==a||""==a)a="\u63d0\u4ea4\u7ed9:";this.lbSubmitTarget.visible(e);this.lbSubmitTarget.width(NaN);this.lbSubmitTarget.text(a);
this.cboSubmitTarget.visible(e);this.cboSubmitTarget.width(d);this.psfSubmitTarget.visible(!1);this.cboSubmitTarget.dataProvider(c)}this.submitTargetList=c;this.invalidateSize(!0)};js.$public.enableSubmitTarget=function(a,c,d){c=js.param(c,!0);d=js.param(d,"/");this.lbSubmitTarget.visible(a);this.psfSubmitTarget.visible(a);this.psfSubmitTarget.rootPath(d);this.isSubmitTargetRequired=c;!0==a?(this.lbSubmitTarget.width(NaN),this.psfSubmitTarget.width(92)):(this.lbSubmitTarget.width(0),this.psfSubmitTarget.width(0));
this.cboSubmitTarget.width(0);this.cboSubmitTarget.visible(!1)};js.$public.getSubmitTarget=function(){return!0==this.psfSubmitTarget.visible()?this.psfSubmitTarget.principal():!0==this.cboSubmitTarget.visible()?this.cboSubmitTarget.selectedItem():null};js.$public.setSubmitTarget=function(a){this.psfSubmitTarget&&!0==this.psfSubmitTarget.visible()?this.psfSubmitTarget.value(a):this.cboSubmitTarget&&!0==this.cboSubmitTarget.visible()&&this.cboSubmitTarget.dataProvider().forEach(function(c){if(null!=
c&&c.name==a)return this.cboSubmitTarget.selectedItem(c),!1},this)};js.$public.setPrintList=function(a){this.printList=a;null==a||0==a.length?this.btnPrint.visible(!1):this.btnPrint.menudata(a)};js.$public.setDynamicForm=function(a){this.dynamicForm=a};js.$public.setSubmitButtonMode=function(a){this.btnSubmit.mode(a)};js.$public.setSubmitList=function(a){if(null!=a){"true"==a.attr("requireSubmitNote")?this.setSubmitNoteRequired(!0):this.setSubmitNoteRequired(!1);var c=a.xpath("submit");0<c.length&&
("false"==a.attr("requireProcessName")?this.isProcessNameRequired=!1:this.isProcessNameRequired=!0,"array"==js.type(c)?this.btnSubmit.setSubmitList(c):this.btnSubmit.setSubmitList([c]))}else this.btnSubmit.setSubmitList(null)};js.$public.showCopyButton=function(a,c){c=js.param(c,"");this.btnCopy.visible(a);a&&(""!=c&&null!=c?(this.btnCopy.text(c),this.btnCopy.width(70),this.btnCopy.height(24)):(this.btnCopy.text(""),this.btnCopy.width(22)))};js.$public.setEditable=function(a){this.btnSubmit.enabled(a);
this.txtSubmitNote.enabled(a)};js.$public.getSubmit=function(){return this.btnSubmit.currentSubmit()};js.$public.getSubmitNote=function(){if(this.txtSubmitNote){var a=this.txtSubmitNote.text();return this.cbActivityRemark.isChecked()&&""==a&&"\u5728\u6b64\u5904\u8f93\u5165\u63d0\u4ea4\u8bf4\u660e"!=this.defaultSubmitNote?this.defaultSubmitNote:a}return""};js.$public.setSubmitNote=function(a){null!=a&&""!=a&&(this.currentState("show_submit_note"),this.defaultSubmitNote=a,this.txtSubmitNote.textMask(this.defaultSubmitNote))};
js.$public.getProcessName=function(){return this.txtProcessName.text()!=this.defaultProcessName?this.txtProcessName.text():""};js.$public.setProcessName=function(a){this.txtProcessName.text(a)};js.$public.setProcessNameEnabled=function(a){this.txtProcessName.enabled(a)};this.onSubmit=function(a){a.stopPropagation();a.stopImmediatePropagation();null==this.btnSubmit.currentSubmit()?f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u63d0\u4ea4\u65b9\u5f0f\uff01","\u63d0\u793a"):this.checkFormValidation()&&this.dispatchEvent(this.$class.SUBMIT)};
js.$public.checkFormValidation=function(){var a="\u8bf7\u786e\u8ba4\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u5df2\u586b\u5199\u5b8c\u6574\uff0c\u7136\u540e\u518d\u63d0\u4ea4!",c=!0;this.isSubmitNoteRequired&&""==this.getSubmitNote()&&(this.txtSubmitNote.focus(),this.txtSubmitNote.text(""),null==this.submitNoteValidator&&(this.submitNoteValidator=new f.ui.Validator({required:!0,source:this.txtSubmitNote,message:"\u5fc5\u987b\u586b\u5199\u6d41\u7a0b\u5907\u6ce8"})),this.submitNoteValidator.show(),a+="\n\u5fc5\u987b\u586b\u5199\u6d41\u7a0b\u5907\u6ce8!",
c=!1);var d=this.findAncestor(f.app.FormWindow);if(null!=d&&(d=d.getEmptyRequiredFields(),0<d.length)){a="";for(c=0;c<d.length;c++)""!=a&&(a+=", "),a+=d[c].label;a="\u8bf7\u786e\u8ba4\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u5df2\u586b\u5199\u5b8c\u6574,\u4ee5\u4e0b\u5b57\u6bb5\u5fc5\u987b\u586b\u5199:\n"+(a+"\n");c=!1}!0==this.isProcessNameRequired&&"HumanStart"==this.WF_mode&&""==this.getProcessName()&&(this.txtProcessName.focus(),this.txtProcessName.text(""),null==this.processNameValidator&&(this.processNameValidator=
new f.ui.Validator({required:!0,source:this.txtProcessName,message:"\u5fc5\u987b\u586b\u5199\u6d41\u7a0b\u5b9e\u4f8b\u540d\u79f0"})),this.processNameValidator.show(),c=!1,a+="\n\u5fc5\u987b\u586b\u5199\u6d41\u7a0b\u5b9e\u4f8b\u540d\u79f0!");!0==this.isSubmitTargetRequired&&null==this.getSubmitTarget()&&(null==this.submitTargetValidator&&(this.submitTargetValidator=new f.ui.Validator({required:!0,message:"\u5fc5\u987b\u9009\u62e9\u63d0\u4ea4\u7528\u6237"}),!0==this.psfSubmitTarget.visible()?this.submitTargetValidator.source(this.psfSubmitTarget):
this.submitTargetValidator.source(this.cboSubmitTarget)),this.submitTargetValidator.show(),c=!1,a+="\n\u5fc5\u987b\u9009\u62e9\u63d0\u4ea4\u7528\u6237!");!1==c&&f.ui.MessageBox.show(a,"\u63d0\u793a");return c};this.onCancel=function(){this.dispatchEvent(this.$class.CANCEL)};this.onCopy=function(){this.dispatchEvent(this.$class.COPY)};this.onOpenActivityLog=function(){null!=this.editEntity&&wos.Desktop.openALink("wos.FormWindow","alink://ime.AppWindow/WorkflowActivityLog",{ctxEntity:this.editEntity})};
this.onSubmitTargetChange=function(a,c){this.invalidateSize(!0)}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" title\x3d"\u9009\u62e9\u663e\u793a\u4f8b" width\x3d"250" height\x3d"300"\x3e','\x3cVLayout width\x3d"100%" vGap\x3d"2" padding\x3d"2"\x3e',"\x3cScrollView layout\x3d\"{width:'100%', height:'*'}\" options\x3d\"{classes:'qs-treeview-border'}\"\x3e",'\x3cTreeView name\x3d"tree" options\x3d"{checkable:true}"/\x3e',"\x3c/ScrollView\x3e",'\x3cHLayout width\x3d"100%" hGap\x3d"10" height\x3d"24" hAlign\x3d"right" innerLayout\x3d"{height:\'100%\'}"\x3e',
'\x3cButton text\x3d"\u786e\u5b9a" width\x3d"70" click\x3d"onOK" options\x3d"{isDefault:true}" /\x3e','\x3cButton text\x3d"\u53d6\u6d88" width\x3d"70" click\x3d"onCancel" /\x3e',"\x3c/HLayout\x3e","\x3c/VLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.query.ColumnVisibleForm",f.ui.Window,function(){this._grid=this._columnListXml=null;this.initialize=function(b,c){this.$super();this.qxml(a);this._grid=b;this._columnListXml=c;this.init()};this.init=function(){if(null!=this.tree){var a=new f.ui.XmlTreeDataProvider(this._columnListXml);
this.tree.dataProvider(a);xmlList=this._columnListXml.children();for(i=0;i<xmlList.length;i++)this.tree.expand(xmlList[i],!1)}};js.$public.render=function(a,c){this.$super(a,c);this.invalidateSize(!0)};this.onOK=function(){this._grid.updateColumnVisible(this._columnListXml);this.close()};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){f.app.XmlQuery={NAME_SPLIT:"$",getSelectList:function(a,b){var c,d,e,f="",k=0,m,l,p;p=a.xpath("select/other/field");var q;for(m=0;m<p.length;m++)e=p[m],c=e.attr("name"),d=e.attr("alias"),q=e.attr(b+"Name"),null!=q&&""!=q&&(c=q),null!=c&&""!=c&&(0<f.length&&(f+=","),f+=c,f+=" ",null!=d&&""!=d&&(f+="as "+d+" "));q=a.xpath("select/Entity");for(m=0;m<q.length;m++)if(p=q[m],c=p.attr("name"),d=p.attr("alias"),null!=c&&""!=c){if(null==d||""==d)d="a"+k++;p=p.children("field");for(l=0;l<p.length;l++)e=
p[l],c=e.attr("name"),e=e.attr("type"),0<f.length&&(f+=","),"relation"==e?(f+=d+"."+c+"_id as "+d+"$"+c+"_id, ",f+=d+"."+c+"_label as "+d+"$"+c+"_label "):"principal"==e?(f+=d+"."+c+"_id as "+d+"$"+c+"_id, ",f+=d+"."+c+"_name as "+d+"$"+c+"_name "):f+=d+"."+c+" as "+d+"$"+c+" "}return f},getEntitySelectList:function(a){var b,c="",d,e=a.children("property");for(d=0;d<e.length;d++)b=e[d],a=b.attr("name"),b=b.attr("type"),0<c.length&&(c+=","),"relation"==b?(c+=a+"_id, ",c+=a+"_label "):"principal"==
b?(c+=a+"_id, ",c+=a+"_name "):c+=a+" ";return c},convertResultSet:function(a,b){b=js.param(b,null);if(null==a||0==a.length)return[];var c=0;"string"==js.type(a[0])&&0==a[0].indexOf("\x3chead\x3e")&&(b=new f.Xml(a[0]),c=1);for(var d=[];c<a.length;c++)"array"!=js.type(a[c])&&(a[c]=[a[c]]),d.push(f.app.XmlQuery.getRecordObject(a[c],b));return d},getRecordObject:function(a,b){var c,d,e,g,k,m,l={},p,q,s=0,r;c=b.children();for(p=0;p<c.length;p++)if(d=c[p],m=d.children("field"),"Entity"==d.name())for(e=
f.app.Workspace.instance().getLoadedFile(d.attr("uid")),q=0;q<m.length;q++)k=m[q],js.isNull(e)?(g=k,r=d.attr("name")):(g=e.xpath('property[@uid \x3d "'+k.attr("uid")+'"]')[0],r=e.attr("name")),js.isNull(g)&&(g=k),"relation"==k.attr("type")?(k=r+f.app.XmlQuery.NAME_SPLIT+g.attr("name")+"_id",l[k]=a[s],s++,k=r+f.app.XmlQuery.NAME_SPLIT+g.attr("name")+"_label"):"principal"==k.attr("type")?(k=r+f.app.XmlQuery.NAME_SPLIT+g.attr("name")+"_id",l[k]=a[s],s++,k=r+f.app.XmlQuery.NAME_SPLIT+g.attr("name")+"_name"):
k=r+f.app.XmlQuery.NAME_SPLIT+g.attr("name"),l[k]=a[s],s++;else if("other"==d.name())for(q=0;q<m.length;q++)k=m[q],k="other"+f.app.XmlQuery.NAME_SPLIT+k.attr("alias"),l[k]=a[s],s++;else"field"==d.name()&&(k=""!=d.attr("alias")?d.attr("alias"):d.attr("name"),l[k]=a[s],s++);return l},getRecordEntity:function(a,b){if(null==a)return{};var c,d={},e,f;for(f in a)c=a[f],e=this.splitRecordKey(f),e[0]==b&&(d[e[1]]=c);d.$type$=b;return d},getRecordName:function(a,b){return"otherField"==b.attr("fieldType")?
a.attr("name")+f.app.XmlQuery.NAME_SPLIT+b.attr("alias"):a.attr("name")+f.app.XmlQuery.NAME_SPLIT+b.attr("name")},splitRecordKey:function(a){var b=[],c=a.indexOf(f.app.XmlQuery.NAME_SPLIT);if(0>=c)return b[0]=a,b;b[0]=a.substr(0,c);b[1]=a.substr(c+1);return b}}})(qs,jQuery);(function(f,l){var a=function(a){var c=null,d=null,e=null;this.init=function(){var d=l(a.container),k=d.outerWidth()-2,m=d.outerHeight()-2,n=a.column,p=null,q=null,s=null,r=null;if(!js.isNull(n.def)){r=n.def.editorXml;p=n.def.columnXml;q=n.def.propXml;s=n.def.entityXml;e=n.def._grid;if(js.isNull(r))c=new f.ui.TextInput;else switch(r.name()){case "TextInput":c=js.isNull(q)?new f.ui.TextInput:"true"==q.attr("currency")&&"long"==q.attr("type")?new f.app.CurrencyInput:new f.ui.TextInput;break;case "NumberInput":js.isNull(q)?
c=new f.ui.NumberInput:"true"==q.attr("currency")?(c=new f.app.CurrencyInput,"double"==q.attr("type")&&c.valueType("double")):c=new f.ui.NumberInput;r=parseInt(r.attr("fraction"));!js.isNull(e.columnProp[n.field])&&0<e.columnProp[n.field].fraction&&(r=e.columnProp[n.field].fraction);0<r?c.precision(r):"double"==q.attr("type")&&c.precision(2);break;case "DateField":c=new f.ui.DateField;c.formatDate="yyyy\u5e74MM\u6708dd\u65e5";break;case "TimeEntry":c=new f.ui.DateField;c.showDate=!1;c.showTime=!0;
break;case "DateTimeEntry":c=new f.ui.DateField;c.showTime=!0;break;case "CheckBox":c=new f.ui.CheckBox;break;case "ComboBox":c=new f.ui.ComboBox;break;case "EntityField":c=e._editors.EntityField;js.isNull(c)||c.remove();c=new f.app.EntityField;e._editors.EntityField=c;c.entityUID(q.attr("entityUID"));c.entityLabelField(q.attr("labelField"));c.formUID(r.attr("formUID"));c.queryUID(r.attr("queryUID"));c.pageUID(r.attr("pageUID"));c.shortCut(r.attr("shortcutField"));""==c.shortCut()&&c.shortCut(c.entityLabelField());
""!=r.attr("mode")&&c.mode(r.attr("mode"));"false"==r.attr("forceAssociation")&&c.forceAssociation(!1);break;case "PrincipalSelectField":c=e._editors.PrincipalSelectField;js.isNull(c)||c.remove();c=new f.app.PrincipalSelectField;e._editors.PrincipalSelectField=c;break;default:c=new f.ui.TextInput}js.isNull(e.columnProp[n.field])||js.isNull(e.columnProp[n.field].dataProvider)&&js.isNull(e.columnProp[n.field].expDataProvider)||js.instanceOf(c,f.ui.ComboBox)||(c=new f.ui.ComboBox);if(js.instanceOf(c,
f.app.EntityField)||js.instanceOf(c,f.app.PrincipalSelectField))k-=8;js.instanceOf(c,f.ui.ComboBox)&&(k-=8,m+=2);r=l("\x3cdiv\x3e\x3c/div\x3e");d.append(r);c.render(r,{classes:"dg-input-editor",position:"relative"});c.outerSize({width:k,height:m});this.onBeginEditor(c,a.item,e,n,p,s,q);c.focus()}};this.onBeginEditor=function(a,b,c,d,e,l,s){var r;if(js.instanceOf(a,f.ui.ComboBox)){if(e=c.query.getRecordEntity(b,l.attr("name")),""!=s.attr("valueProvider")&&(r=s.attr("valueProvider"),r=-1!=r.indexOf("!rela:")?
wos.DictionaryLoader.getRelationValueList(r,e):wos.DictionaryLoader.getValueList(r)),js.isNull(c.columnProp[d.field])||("array"==js.type(c.columnProp[d.field].dataProvider)?r=c.columnProp[d.field].dataProvider:js.isNull(c.columnProp[d.field].expDataProvider)||(r=c.getExpDataProvider(c.columnProp[d.field].expDataProvider,-1,b))),null!=r[0]&&"$null"!=r[0].value&&r.splice(0,0,{label:"",value:"$null"}),a.dataProvider(r),b=b[d.field],!js.isNull(b))for(c=0;c<r.length;c++)if(r[c].value==b){a.selectedItem(r[c]);
break}}else js.instanceOf(a,f.app.EntityField)?(a.data("data",b),e=c.query.getRecordEntity(b,l.attr("name")),a.fieldName(s.attr("name")),0<e[s.attr("name")+"_id"]?(b={},b.id=e[s.attr("name")+"_id"],b[s.attr("labelField")]=e[s.attr("name")+"_label"],a.value(b)):a.value(null),null!=c.query.page()?a.application(c.query.page().application()):null!=c.query.form()&&a.application(c.query.form().application()),a.parentContainer(c.query),a.addEventListener("change",c.onEntityFieldChange,c)):js.instanceOf(a,
f.app.PrincipalSelectField)&&(e=c.query.getRecordEntity(b,l.attr("name")),a.fieldName(s.attr("name")),0<e[s.attr("name")+"_id"]?(b={},b.id=e[s.attr("name")+"_id"],b.name=e[s.attr("name")+"_name"],a.value(b)):a.value(null),a.addEventListener("change",c.onPrincipalFieldChange,c))};this.destroy=function(){js.instanceOf(c,f.app.EntityField)||js.instanceOf(c,f.app.PrincipalSelectField)?c.$element().detach():c.remove()};this.focus=function(){c.focus()};this.getValue=function(){return c.value()};this.setValue=
function(a){c.value(a)};this.loadValue=function(e){if(!js.instanceOf(c,f.app.EntityField)&&!js.instanceOf(c,f.app.PrincipalSelectField)){d=e[a.column.field]||null;c.value(d);e=c.$element().find("input");var k=e.val();e.setSelectionRange(0,k.length)}};this.serializeValue=function(){return c.value()};this.applyValue=function(d,k){js.instanceOf(c,f.app.EntityField)||js.instanceOf(c,f.app.PrincipalSelectField)||(d[a.column.field]!=k&&(d.$modified$=!0),d[a.column.field]=k,js.callInternal(e,e.onRecordFieldChange,
[d,a.column.field,k]))};this.isValueChanged=function(){return c.value()!=d};this.validate=function(){if(a.column.validator){var d=a.column.validator(c.value());if(!d.valid)return d}return{valid:!0,msg:null}};this.init()};js.$class("qs.app.query.DataGridEx",f.ui.DataGrid,function(){js.$static.COLUMN_SORT_EVENT="column_sort";js.$static.COLUMN_GROUPING_EVENT="column_grouping";js.$static.CELL_LINK_EVENT="cell_link";this._gridXml=null;this.isMultiSelectable=!1;this.query=null;this.definitionMap={};this.colorRows=
[];this.colorCellMap={};this.columnMenu=null;this._editors={};this.columnMenuData={menuitem:[{label:"\u5347\u5e8f",action:"sortAsc",iconUrl:"images/icons/sort_asc.png"},{label:"\u964d\u5e8f",action:"sortDesc",iconUrl:"images/icons/sort_des.png"},{label:"\u5206\u7ec4",action:"grouping",iconUrl:"images/icons/grouping.png"},{type:"separator"},{label:"\u663e\u793a\u5217",action:"showColumns",iconUrl:"images/icons/columns.png"}]};this.columnListXml=this.activeColumn=null;this.columnProp={};this.isExcelPasteEnabled=
!1;this.initialize=function(a){var c={};f.app.theme&&f.app.theme.datagrid&&(c=f.app.theme.datagrid);this.$super(c);this.query=a;this.addEventListener("change",this.onFieldValueChange);this.columnMenu=new f.ui.Menu;this.columnMenu.addEventListener("itemClick",function(a,b){js.callInternal(this,this.onHeaderMenu,[a,b])},this);var d=this;this._cellFormatter=function(a,b,c,f,l){if("$orderNo$"==f.id)return a+1;if("$action_column$"==f.id){var p="";if("array"==js.type(f.actions)){p='\x3cdiv class\x3d"action_column"\x3e';
for(a=0;a<f.actions.length;a++)p+=StringUtil.join('\x3cspan class\x3d"qs-hyperlink-cell" hyperlink\x3d"',f.actions[a].hyperlink,'"\x3e',f.actions[a].name,"\x3c/span\x3e");p+="\x3c/div\x3e"}return p}p=d.definitionMap[f.field].columnXml;a=d.getColumnLabel(a,b,c,f,l);return p.has("hyperlink")?(p=p.attr("hyperlink"),StringUtil.join('\x3cspan class\x3d"qs-hyperlink-cell" field\x3d"',f.field,'" hyperlink\x3d"',p,'"\x3e',a,"\x3c/span\x3e")):a};this.callAfterRendered(function(){this.bindEvent("click",this._click)})};
js.$protected.onKeyDown=function(a,c){13==a.which&&(c.cell<this._columns.length-1?this._grid.navigateNext():this.commitCurrentEdit(),a.stopImmediatePropagation())};this._click=function(a){a=l(a.target);if(a.is(".qs-hyperlink-cell")){var c=a.attr("hyperlink"),d=this.definitionMap[a.attr("field")];f.Timer.callLater(0,function(){this.dispatchEvent(f.app.query.DataGridEx.CELL_LINK_EVENT,{hyperlink:c,columnDef:d})},this)}};js.$protected.dispose=function(){if(this._editors){var a,c;for(c in this._editors)a=
this._editors[c],js.instanceOf(a,f.ui.Control)&&a.remove()}};this.onFieldValueChange=function(a){a.stopPropagation()};js.$protected.onShowColumnMenu=function(a,c){if(this.editable()){var d=c.column,e=c.$el,g=d.field.split(f.app.XmlQuery.NAME_SPLIT),g=this.query.canGrouping(g[0],g[1]);this.activeColumn=d;for(var d=this.isColumnSortable(this.activeColumn),k,m=this.columnMenuData.menuitem,l=0;l<m.length;l++)k=m[l],"sortAsc"==k.action||"sortDesc"==k.action?k.enabled=d:"grouping"==k.action&&(k.enabled=
g);this.columnMenu.menudata(this.columnMenuData);g=e.offset();this.columnMenu.show(g.left,g.top+e.height());a.preventDefault();a.stopPropagation()}};js.$protected.onHeaderMenu=function(a,c){var d;switch(c.action){case "sortAsc":this.onColumnSort(this.activeColumn,"asc");break;case "sortDesc":this.onColumnSort(this.activeColumn,"desc");break;case "grouping":this.onColumnGrouping(this.activeColumn);break;case "showColumns":d=new f.app.query.ColumnVisibleForm(this,this.columnListXml),d.show()}};js.$public.load=
function(a,c,d,e){d=js.param(d,!1);e=js.param(e,!1);this._gridXml=a;this.isMultiSelectable=d;this.editable(e);this.generateColumnList(c);null!=this._gridXml&&null!=c&&this.createColumns()};this.generateColumnList=function(a){var c,d,e,f,k,m;if(null!=a){this.columnListXml=a.copy();d=this.columnListXml.xpath("Entity");for(f=0;f<d.length;f++)for(a=d[f],e=a.xpath("field"),k=0;k<e.length;k++)c=e[k],m=this.getDataField(a,c),c.attr("dataField",m),c.attr("checked","0");a=this.columnListXml.xpath("other")[0];
if(null!=a)if(e=a.xpath("field"),0==e.length)a.remove();else for(k=0;k<e.length;k++)c=e[k],m=this.getDataField(a,c),c.attr("dataField",m),c.attr("checked","0")}};this.getDataField=function(a,c){if("other"==a.name())return"other"+f.app.XmlQuery.NAME_SPLIT+c.attr("alias");var d=c.attr("type");return"relation"==d?a.attr("name")+f.app.XmlQuery.NAME_SPLIT+c.attr("name")+"_label":"principal"==d?a.attr("name")+f.app.XmlQuery.NAME_SPLIT+c.attr("name")+"_name":a.attr("name")+f.app.XmlQuery.NAME_SPLIT+c.attr("name")};
js.$public.setColumnProperty=function(a,c,d){a=a.replace(".",f.app.XmlQuery.NAME_SPLIT);js.isNull(this.columnProp[a])&&(this.columnProp[a]={});switch(c){case "editable":this.setColumnEditable(a,d);break;case "required":this.setColumnRequired(a,d);break;case "dataProvider":"array"==js.type(d)?this.columnProp[a].dataProvider=d:delete columnProp[a].dataProvider;break;case "expDataProvider":"array"==js.type(d)&&(this.columnProp[a].expDataProvider=d);break;case "fraction":this.columnProp[a].fraction=d;
break;case "unit":this.columnProp[a].unit=d;break;case "formatter":"function"==js.type(d)&&(c=this.definitionMap[a],js.isNull(c)||js.isNull(c.column)||(c.column.formatter=d,this.invalidate()));break;case "editor":"function"==js.type(d)&&(c=this.definitionMap[a],js.isNull(c)||js.isNull(c.column)||(c.column.editor=d))}};js.$public.setEditPosition=function(a,c){if(isNaN(Number(c))){var d=String(c).replace(".",f.app.XmlQuery.NAME_SPLIT),d=this.definitionMap[d];if(!js.isNull(d)&&(d=d.column,null!=d))for(var e=
0;e<this._columns.length;e++)if(d==this._columns[e]){this._grid.gotoCell(a,e,!0);break}}else this._grid.gotoCell(a,Number(c),!0)};this.getExpDataProvider=function(a,c,d){d=js.param(d,null);if(0<=c)for(d=0;d<a.length;d++){if(!0==this.query.getExpressionValue(c,a[d].exp))return a[d].dataProvider}else if(null!=d)for(this.query.setExpressionRow(d),d=0;d<a.length;d++)if(c=this.query.expParser().calculate(a[d].exp),c.state==wos.expression.ExpressionResult.CALCULATED&&!0==c.value)return a[d].dataProvider;
return[]};this.setColumnEditable=function(a,c){var d=this.definitionMap[a];if(null!=d){var e=d.propXml;null!=e&&"true"==e.attr("systemProperty")&&"true"!=e.attr("valueEditable")&&(c=!1)}js.isNull(this.columnProp[a])&&(this.columnProp[a]={});this.columnProp[a].editable=c;for(var e=this.columns(),f,k=0;k<e.length;k++)if(f=e[k],f.field==a){f.editable=c;!0!=c||js.isNull(d)||(d.editorXml=this.getEditorXml(d.columnXml,d.propXml),js.isNull(d.editorXml)?f.editable=!1:js.isNull(d.propXml)||"ComboBox"==d.editorXml.name()||
js.isNull(this.columnProp[a])||js.isNull(this.columnProp[a].dataProvider)||(d.editorXml=d.propXml.create("ComboBox"),d.editorXml.attr("valueProvider",this.columnProp[a].dataProvider)));break}this.columns(e)};this.setColumnRequired=function(a,c){js.isNull(this.columnProp[a])&&(this.columnProp[a]={});this.columnProp[a].required=c;this.commitCurrentEdit();this._grid.invalidate()};js.$public.validateColumnInput=function(){if(!0!=this.editable())return[];var a=[],c,d,e;this.commitCurrentEdit();for(var f in this.columnProp){e=
this.definitionMap[f];for(var k=0;k<this.getDataLength();k++)if(c=!1,!0==this.columnProp[f].required?c=!0:"string"==js.type(this.columnProp[f].required)?!0==this.query.getExpressionValue(k,this.columnProp[f].required)&&(c=!0):null!=e&&(this.query.setExpressionRow(this.getDataItem(k)),d=e.propXml,null!=d&&!0==this.query.ruleManager().isPropertyRequired(d.attr("name"))&&(c=!0)),!0==c&&(c=this.getDataItem(k),d=c[f],null==e||null==e.propXml||"relation"!=e.propXml.attr("type")&&"principal"!=e.propXml.attr("type")||
null!=d&&""!=String(d)||(d=c[f+"_id"]),null==d||""==String(d))){null!=e?a.push(e.columnXml.attr("label")):a.push(f);break}}this._grid.invalidate();return a};this.getEditorXml=function(a,c){if(js.isNull(c)||"true"==c.attr("systemProperty"))return null;var d=a.children("itemEditor")[0];js.isNull(d)||(d=d.children()[0]);if(js.isNull(d)){switch(c.attr("type")){case "string":d="TextInput";break;case "long":case "double":d="NumberInput";break;case "timestamp":d="DateField";break;case "boolean":d="CheckBox";
break;case "relation":d="EntityField";break;case "principal":d="PrincipalSelectField";break;default:d="TextInput"}var e=c.attr("valueProvider");""!=e?(d=c.create("ComboBox"),d.attr("valueProvider",e)):d=c.create(d)}return js.isNull(d)?c.create("TextInput"):d};this.getRowNumColumn=function(){var a={id:"$orderNo$",field:"$orderNo$",name:"",cssClass:"grid_order_column",headerCssClass:"grid_order_column",editable:!1,sortable:!1,resizable:!0,width:30};a.formatter=this._cellFormatter;return a};this.createColumns=
function(){var b,c,d,e=[];e.push(this.getRowNumColumn());this.isMultiSelectable&&(d={id:"$selected$",field:"$selected$",name:"",header:{checkbox:!0},width:20,editable:!1,sortable:!1,resizable:!1},e.push(d));var g,k,m,l=this._gridXml.xpath("column"),p;for(b=0;b<l.length;b++)if(c=l[b],"$action_column$"==c.attr("name")){d={id:"$action_column$",field:"$action_column$"};d.name=c.attr("label");d.width=parseInt(c.attr("width"));d.editable=!1;d.sortable=!1;d.headerCssClass="action_header";try{d.actions=JSON.parse(c.attr("actions"))}catch(q){}d.formatter=
this._cellFormatter;e.push(d)}else{m=k=g=null;d=c.attr("uid").split(".");"other"!=d[0]&&(g=f.app.Workspace.instance().getLoadedFile(d[0]+"."+d[1]),k=g.xpath('property[@uid \x3d "'+d[2]+'"]')[0]);p=this.getColumnDataField(c,g,k);d="other"==d[0]?this.columnListXml.xpath('other/field[@dataField \x3d "'+p+'"]')[0]:this.columnListXml.xpath('Entity/field[@dataField \x3d "'+p+'"]')[0];js.isNull(d)||(d.attr("checked","1"),d.attr("defined","true"));c.attr("dataField",p);d={};d.id=p;d.field=p;d.name=c.attr("label");
d.width=parseInt(c.attr("width"));d.sortable=!1;d.formatter=this._cellFormatter;d.editable=this.editable();!1==this.editable()&&"false"!=c.attr("sortable")&&(d.sortable=!0);switch(c.attr("textAlign")){case "left":d.cssClass="qs-dgtext-left";break;case "center":d.cssClass="qs-dgtext-center";break;case "right":d.cssClass="qs-dgtext-right"}js.isNull(this.columnProp[p])||!1!=this.columnProp[p].editable||(d.editable=!1);!0==d.editable&&"false"!=c.attr("editable")&&null!=g&&g.attr("uid")==this.query.masterEntityXml().attr("uid")?
(m=this.getEditorXml(c,k),js.isNull(m)&&(d.editable=!1)):d.editable=!1;d.header={menu:!this.editable()&&!d.editable};p={columnXml:c,column:d,entityXml:g,propXml:k,editorXml:m};this.definitionMap[d.field]=p;null==g||null==k||"relation"!=k.attr("type")&&"principal"!=k.attr("type")||(this.definitionMap[g.attr("name")+f.app.XmlQuery.NAME_SPLIT+k.attr("name")]=p);d.def={columnXml:c,entityXml:g,propXml:k,editorXml:m,_grid:this};!0==d.editable&&(d.editor=a);e.push(d);g=d.field;k=this._gridXml.xpath('color/condition[@column \x3d "'+
c.attr("uid")+'"]');for(m=0;m<k.length;m++)c=k[m],null==this.colorCellMap[g]&&(this.colorCellMap[g]=[]),this.colorCellMap[g].push(this.getColorObject(c))}this.columns(e);l=this._gridXml.xpath('color/condition[@column \x3d "$row"]');for(b=0;b<l.length;b++)this.colorRows.push(this.getColorObject(l[b]))};js.$public.getColumnXml=function(a){a=this.definitionMap[a];return js.isNull(a)?null:a.columnXml};this.getColorObject=function(a){var c={};c.expression=a.attr("expression");c.color=NumberUtil.toColorString(parseInt(a.attr("color").substr(1),
16));c.backgroundColor=NumberUtil.toColorString(parseInt(a.attr("backgroundColor").substr(1),16));return c};this.getColumnDataField=function(a,c,d){var e=a.attr("uid");return"other"==e.split(".")[0]?"other"+f.app.XmlQuery.NAME_SPLIT+a.attr("name"):null!=c&&null!=d?a="relation"==d.attr("type")?c.attr("name")+f.app.XmlQuery.NAME_SPLIT+d.attr("name")+"_label":"principal"==d.attr("type")?c.attr("name")+f.app.XmlQuery.NAME_SPLIT+d.attr("name")+"_name":c.attr("name")+f.app.XmlQuery.NAME_SPLIT+d.attr("name"):
e};js.$public.onBeforeEditCell=function(a,c){var d=c.column,e=null,f=null;js.isNull(d.def)||(editorXml=d.def.editorXml,e=d.def.columnXml,f=d.def.propXml);if(null==f||null==e)return!1;if(!js.isNull(this.columnProp[d.field])){if("string"==js.type(this.columnProp[d.field].editable)&&!1==this.query.getExpressionValue(c.row,this.columnProp[d.field].editable))return!1;if(!0==this.columnProp[d.field].editable)return}this.query.setExpressionRow(c.item);if(!1==this.query.ruleManager().isPropertyEnabled(f.attr("name")))return!1};
this.onEntityFieldChange=function(a,c){var d=a.target(),e=d.fieldName(),g=d.value(),k=d.data("data");null!=k&&(k.$modified$=!0,null==g?(delete k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_id"],delete k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_label"]):(k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_id"]=g.id,k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_label"]=g[d.entityLabelField()]));
!0==this.editable()&&(d=this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e,k[d]=g,this.query.setExpressionRow(k),c={index:this._dataProvider.indexOf(k)},this.query.ruleManager().onPropertyValueUpdated(e,g,this.query.getRecordEntity(k,this.query.masterEntityXml().attr("name")),c),delete k[d]);(e=this._grid.getActiveCell())&&0<=e.row&&this.invalidateRow(e.row)};this.onPrincipalFieldChange=function(a,c){var d=a.target(),e=d.fieldName(),g=d.value(),k=d.data("data");null!=k&&(k.$modified$=
!0,null==g?(delete k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_id"],delete k[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_name"]):(d.data[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_id"]=g.id,d.data[this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e+"_name"]=g.name));if(!0==this.editable()){var m=this.query.masterEntityXml().attr("name")+f.app.XmlQuery.NAME_SPLIT+e;k[m]=g;this.query.setExpressionRow(k);
c={index:this._dataProvider.indexOf(k)};this.query.ruleManager().onPropertyValueUpdated(e,g,this.query.getRecordEntity(k,this.query.masterEntityXml().attr("name")),c);delete d.data[m]}(d=this._grid.getActiveCell())&&0<=d.row&&this.invalidateRow(d.row)};this.onRecordFieldChange=function(a,c,d){if(!0==this.editable()&&(this.query.setExpressionRow(a),c=c.split(f.app.XmlQuery.NAME_SPLIT),2==c.length)){var e=this.query.getRecordEntity(a,c[0]);a={index:this._dataProvider.indexOf(a)};this.query.ruleManager().onPropertyValueUpdated(c[1],
d,e,a)}};this.getFraction=function(a){if(null==a)return 2;a=parseInt(a.attr("fraction"));return isNaN(a)?2:a};this.getColumnLabel=function(a,c,d,e,g){if(null==g||null==e.field||void 0==e.field)return"";c=this.definitionMap[e.field].propXml;if(null==d||void 0==d)return"";if("number"==js.type(d)&&isNaN(d))return 0;if(null!=c){var k=c.attr("type");if("id"==c.attr("name"))return isNaN(Number(d))?"":d;if("attachments"==k)return f.app.AttachmentList.getFirstFileHtml(d);if("boolean"==k)return"true"==d||
!0==d||"1"==d||1==d?"\u662f":"\u5426";if("image"==k)return String(d).split(":")[0];if("long"==k&&"true"==c.attr("currency"))return js.isNull(this.columnProp[e.field])||"fen"!=this.columnProp[e.field].unit?(d/100).toFixed(2):d}var m=null;null!=c&&(m=c.attr("valueProvider"));a=null;js.isNull(this.columnProp[e.field])||(js.isNull(this.columnProp[e.field].dataProvider)?js.isNull(this.columnProp[e.field].expDataProvider)||(a=this.getExpDataProvider(this.columnProp[e.field].expDataProvider,-1,g)):a=this.columnProp[e.field].dataProvider);
k=js.type(d);if("date"==k)return 1900>d.getFullYear()?DateUtil.format(d,"HH:MI:SS"):0==d.getHours()&&0==d.getMinutes()&&0==d.getSeconds()?DateUtil.format(d,"YYYY-MM-DD"):DateUtil.format(d,"YYYY-MM-DD HH:MI:SS");if("boolean "==k)return!0==d?"\u662f":"\u5426";if(null!=m&&0<m.length){if(-1!=m.indexOf("!rela:")?(e=wos.DictionaryLoader.getRelationValueList(m,this.query.getRecordEntity(g)),e=wos.DictionaryLoader.getValueItem(e,d)):e=wos.DictionaryLoader.getValueItem(m,d),null!=e)return e.label}else if(null!=
a)for(e=0;e<a.length;e++){if(a[e].value==d)return a[e].label}else if(null!=c&&"double"==c.attr("type"))return"number"!=js.type(d)&&(d=parseFloat(d)),null==d||isNaN(d)?"":!js.isNull(this.columnProp[e.field])&&0<=this.columnProp[e.field].fraction?Number(d).toFixed(this.columnProp[e.field].fraction):Number(d).toFixed(this.getFraction(c));d=d.toString();return"[object Object]"==d?"...":d};js.$protected.onCellPostRender=function(a,c,d,e){js.isEmpty(d)||(d=l(a),e==this.columns()[0]&&(a=this.getRowColor(c),
js.isNull(a)||"#FFFFFF"==a.backgroundColor?(d.parent().css("backgroundColor",""),d.parent().css("backgroundImage","")):(d.parent().css("backgroundColor",a.backgroundColor),d.parent().css("backgroundImage","linear-gradient("+a.backgroundColor+", "+a.backgroundColor+")"))),a=this.getCellColor(e.field,c),js.isNull(a)||"#FFFFFF"==a.backgroundColor?(d.css("backgroundColor",""),d.css("backgroundImage","")):(d.css("backgroundColor",a.backgroundColor),d.css("backgroundImage","linear-gradient("+a.backgroundColor+
", "+a.backgroundColor+")")),js.isNull(a)||"#000000"==a.color?d.css("color",""):d.css("color",a.color))};this.getRowColor=function(a){for(var c,d,e=0;e<this.colorRows.length;e++)if(c=this.colorRows[e],d=c.expression,""!=d&&!0==this.query.getExpressionValue(a,d))return c;return null};this.getCellColor=function(a,c){var d=this.colorCellMap[a],e;if(!js.isNull(this.columnProp[a])&&this.getDataLength()>c){e=!1;if(!0==this.columnProp[a].required)e=!0;else if("string"==js.type(this.columnProp[a].required))!0==
this.query.getExpressionValue(c,this.columnProp[a].required)&&(e=!0);else{this.query.setExpressionRow(this.getDataItem(c));var f=this.definitionMap[a].propXml;null!=f&&!0==this.query.ruleManager().isPropertyRequired(f.attr("name"))&&(e=!0)}if(!0==e&&(e=this.getDataItem(c)[a],null==e||""==e))return{backgroundColor:"#FF0000"}}if(null!=d)for(f=0;f<d.length;f++)if(e=d[f].expression,""!=e&&!0==this.query.getExpressionValue(c,e))return d[f];d=this.getRowColor(c);null!=d&&(d=js.clone(d),delete d.backgroundColor);
return d};js.$public.isColumnSortable=function(a){a=this.definitionMap[a.field];var c=!0;null!=a&&null!=a.columnXml&&(c="false"!=a.columnXml.attr("sortable"));return c};js.$public.onColumnSort=function(a,c){"asc"==c?this._grid.setSortColumn(a.id,!0):this._grid.setSortColumn(a.id,!1);var d=a.field.split(f.app.XmlQuery.NAME_SPLIT),e={};e.entity=d[0];e.field=d[1];e.sort=c;this.dispatchEvent(f.app.query.DataGridEx.COLUMN_SORT_EVENT,e)};this.onColumnGrouping=function(a){a=a.field.split(f.app.XmlQuery.NAME_SPLIT);
var c={};c.entity=a[0];c.prop=a[1];this.dispatchEvent(f.app.query.DataGridEx.COLUMN_GROUPING_EVENT,c)};js.$public.updateColumnVisible=function(a){var c,d,e,g,k,m,l,p,q=[],s;this.columnListXml=a;q.push(this.getRowNumColumn());this.isMultiSelectable&&(s={id:"$selected$",field:"$selected$",name:"",header:{checkbox:!0},width:20,editable:!1,sortable:!1,resizable:!1},q.push(s));k=this._gridXml.xpath("column");for(m=0;m<k.length;m++)if(d=k[m],"$action_column$"==d.attr("name")){s={id:"$action_column$",field:"$action_column$"};
s.name=d.attr("label");s.width=parseInt(d.attr("width"));s.editable=!1;s.sortable=!1;s.headerCssClass="action_header";try{s.actions=JSON.parse(d.attr("actions"))}catch(r){}s.formatter=this._cellFormatter;q.push(s)}else p=d.attr("dataField"),e=this.definitionMap[p],c=d.attr("uid").split("."),d="other"==c[0]?a.xpath('other/field[@dataField \x3d "'+p+'"]')[0]:a.xpath('Entity/field[@dataField \x3d "'+p+'"]')[0],js.isNull(d)||"1"!=d.attr("checked")||q.push(e.column);g=a.xpath("Entity");for(m=0;m<g.length;m++)for(c=
g[m],k=c.xpath("field"),l=0;l<k.length;l++)if(d=k[l],"true"!=d.attr("defined")&&(p=d.attr("dataField"),e=this.definitionMap[p],"1"==d.attr("checked")))if(null==e){e=null;var t=f.app.Workspace.instance().getLoadedFile(c.attr("uid"));js.isNull(t)?t=c:e=t.xpath('property[@uid \x3d "'+d.attr("uid")+'"]')[0];js.isNull(e)&&(e=d);s={};s.id=p;s.field=p;s.name=d.attr("label");s.sortable=!1;s.editable=!1;s.formatter=this._cellFormatter;s.header={menu:!0};!1==this.editable()&&"false"!=d.attr("sortable")&&(s.sortable=
!0);q.push(s);this.definitionMap[p]={columnXml:d,column:s,entityXml:t,propXml:e}}else q.push(e.column);c=a.xpath("other")[0];if(!js.isNull(c))for(k=c.xpath("field"),l=0;l<k.length;l++)d=k[l],"true"!=d.attr("defined")&&(p=d.attr("dataField"),e=this.definitionMap[p],"1"==d.attr("checked")&&(null==e?(s={},s.id=p,s.field=p,s.name=d.attr("label"),s.sortable=!1,s.editable=!1,s.formatter=this._cellFormatter,s.header={menu:!0},!1==this.editable()&&"false"!=d.attr("sortable")&&(s.sortable=!0),q.push(s),this.definitionMap[p]=
{columnXml:d,column:s,entityXml:c,propXml:d}):q.push(e.column)));this.columns(q);this.invalidateSize(!0)};js.$public.showColumn=function(b,c,d){c=b+f.app.XmlQuery.NAME_SPLIT+c;var e=this.definitionMap[c],g=[],k;for(k=0;k<this._columns.length;k++)g.push(this._columns[k]);if(js.isNull(e)){var m=e=null,l=null;"other"==b?k=this.columnListXml.xpath('other/field[@dataField \x3d "'+c+'"]')[0]:(k=this.columnListXml.xpath('Entity/field[@dataField \x3d "'+c+'"]')[0],l=this.columnListXml.xpath('Entity[@name \x3d "'+
b+'"]')[0],js.isNull(l)||(l=f.app.Workspace.instance().getLoadedFile(l.attr("uid")),js.isNull(l)||(e=l.xpath("property[@uid \x3d '"+k.attr("uid")+"']")[0])));if(js.isNull(k))return;js.isNull(e)&&(e=k);if(null==d||""==d)d=k.attr("label");b={};b.id=c;b.field=c;b.name=d;b.sortable=!1;b.editable=this.editable();b.formatter=this._cellFormatter;js.isNull(this.columnProp[c])||!1!=this.columnProp[c].editable||(b.editable=!1);!0==b.editable&&"false"!=k.attr("editable")&&null!=l&&l.attr("uid")==this.query.masterEntityXml().attr("uid")?
(m=this.getEditorXml(k,e),js.isNull(m)&&(b.editable=!1)):b.editable=!1;b.header={menu:!b.editable};b.def={columnXml:k,entityXml:l,propXml:e,editorXml:m,_grid:this};!0==b.editable&&(b.editor=a);g.push(b);this.definitionMap[c]={columnXml:k,column:b,entityXml:l,propXml:e,editorXml:m}}else{b=this.definitionMap[c].column;for(k=0;k<g.length;k++)if(g[k]==b)return;null!=d&&""!=d&&(b.name=d);g.push(b)}this.columns(g)};js.$public.hideColumn=function(a,c){var d=a+f.app.XmlQuery.NAME_SPLIT+c,e=[],g;if(null!=
this.definitionMap[d]){for(g=0;g<this._columns.length;g++)e.push(this._columns[g]);d=this.definitionMap[d].column;for(g=0;g<e.length;g++)e[g]==d&&e.splice(g,1);this.columns(e)}};js.$public.selectAll=function(a){var c=[];if(!0==a)for(a=0;a<this._grid.getDataLength();a++)c.push(a);this._grid.setSelectedRows(c)};js.$public.getColumnListXml=function(a){if("array"==js.type(a))for(var c,d=0;d<this._columns.length;d++)c=this._columns[d].def,js.isNull(c)||js.isNull(c.entityXml)||js.isNull(c.propXml)||("other"==
c.entityXml.name()?a.push("other"+f.app.XmlQuery.NAME_SPLIT+c.propXml.attr("alias")):a.push(c.entityXml.attr("name")+f.app.XmlQuery.NAME_SPLIT+c.propXml.attr("name")));return this.columnListXml};js.$protected.onRowSelectionChange=function(a,c){var d=this.getDataItem(a);js.isEmpty(d)||this.query.updateSelectionRecord(d,c)}})})(qs,jQuery);(function(f,l){js.$class("qs.app.query.DataGridNavigator",f.ui.Control,function(){js.$static.PAGE_CHANGED_EVENT="pageChanged";js.$static.PAGINGMODE_CHANGED_EVENT="pagingModeChanged";js.$static.NORMAL_PAGING="NormalPaging";js.$static.VIRTUALIZING_PAGING="VirtualizingPaging";f.events.register("pageChanged",this);this.totalRow=this.lastPage=this.currentPage=this.basePage=0;this.rowPerPage=20;this._isVPaging=!1;this._canVirtualizePaging=!0;this._pagingMode="NormalPaging";this._statusHtml="";this.initialize=
function(a){this.$super(a)};js.$public.canVirtualizePaging=function(a){if(void 0===a)return this._canVirtualizePaging;this._canVirtualizePaging=a;js.isNull(this.$vpaging)||(!0==a?this.$vpaging.removeClass("disabled"):this.$vpaging.addClass("disabled"))};js.$public.pagingMode=function(a){if(void 0===a)return this._pagingMode;this._pagingMode=a;"VirtualizingPaging"==this._pagingMode?this.isVPaging(!0):(this.isVPaging(!1),this.currentPage=0,this.recalc(this.totalRow,this.rowPerPage))};js.$public.statusHtml=
function(a){if(void 0===a)return this._statusHtml;this._statusHtml=a;js.isNull(this.$lbStatus)||this.$lbStatus.html(this._statusHtml)};js.$public.recalc=function(a,b){this.totalRow=a;this.rowPerPage=b;this.lastPage=Math.floor(a/b);0==a%b&&this.lastPage--;0>this.lastPage&&(this.lastPage=0);!0==this._isVPaging?this.$lbInfo.html("\u5171"+this.totalRow+"\u884c"):this.$lbInfo.html("\u5171"+(this.lastPage+1)+"\u9875,"+this.totalRow+"\u884c");this.$lbStatus.html(this._statusHtml);this.setBasePage(0);4<this.lastPage&&
(this.$lbPage.removeClass("disabled"),this.$txtPage.attr("readonly",!1),this.$btnGo.removeClass("disabled"))};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-grid-nav"\x3e','\x3cdiv class\x3d"nav-button nav-first disabled" title\x3d"\u9996\u9875"\x3e\x26nbsp;\x3c/div\x3e','\x3cdiv class\x3d"nav-button nav-prev disabled" title\x3d"\u4e0a\u4e00\u9875"\x3e\x26nbsp;\x3c/div\x3e','\x3cdiv class\x3d"nav-button disabled"\x3e1\x3c/div\x3e','\x3cdiv class\x3d"nav-button disabled"\x3e2\x3c/div\x3e',
'\x3cdiv class\x3d"nav-button disabled"\x3e3\x3c/div\x3e','\x3cdiv class\x3d"nav-button disabled"\x3e4\x3c/div\x3e','\x3cdiv class\x3d"nav-button disabled"\x3e5\x3c/div\x3e','\x3cdiv class\x3d"nav-button nav-next disabled" title\x3d"\u4e0b\u4e00\u9875"\x3e\x26nbsp;\x3c/div\x3e','\x3cdiv class\x3d"nav-button nav-last disabled" title\x3d"\u5c3e\u9875"\x3e\x26nbsp;\x3c/div\x3e','\x3cspan class\x3d"nav-label disabled"\x3e\u8f6c\u5230:\x3c/span\x3e','\x3cinput type\x3d"text" class\x3d"nav-pageno" readonly\x3d"true" /\x3e',
'\x3cdiv class\x3d"nav-button nav-goto disabled" title\x3d"\u8f6c\u5230"\x3e\x26nbsp;\x3c/div\x3e','\x3cspan class\x3d"nav-label nav-info"\x3e\x3c/span\x3e','\x3cspan class\x3d"nav-label nav-status"\x3e\x3c/span\x3e','\x3cdiv class\x3d"nav-button nav-vpaging" title\x3d"\u5207\u6362\u5230\u865a\u62df\u5206\u9875\u6a21\u5f0f"\x3e\x26nbsp;\x3c/div\x3e',"\x3c/div\x3e")};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.children(".qs-grid-nav"),
d=c.children(".nav-button");this.$btnFirst=l(d[0]);this.$btnPrev=l(d[1]);this.$btnPage1=l(d[2]);this.$btnPage2=l(d[3]);this.$btnPage3=l(d[4]);this.$btnPage4=l(d[5]);this.$btnPage5=l(d[6]);this.$btnNext=l(d[7]);this.$btnLast=l(d[8]);d=c.children(".nav-label");this.$lbPage=l(d[0]);this.$lbInfo=l(d[1]);this.$lbStatus=c.children(".nav-status");this.$btnGo=c.children(".nav-goto");this.$txtPage=c.children(".nav-pageno");this.$vpaging=c.children(".nav-vpaging");this._canVirtualizePaging||this.$vpaging.addClass("disabled");
0<b.classes.length&&c.addClass(b.classes);this.bindEvent("click",this.onClick);this.invalidateSize()};this.onClick=function(a){a=l(a.target);if(!a.hasClass("disabled")){if(a[0]==this.$btnFirst[0])this.onFirstPage();else if(a[0]==this.$btnPrev[0])this.onPrevPage();else if(a[0]==this.$btnPage1[0])this.onNavPage(this.basePage);else if(a[0]==this.$btnPage2[0])this.onNavPage(this.basePage+1);else if(a[0]==this.$btnPage3[0])this.onNavPage(this.basePage+2);else if(a[0]==this.$btnPage4[0])this.onNavPage(this.basePage+
3);else if(a[0]==this.$btnPage5[0])this.onNavPage(this.basePage+4);else if(a[0]==this.$btnNext[0])this.onNextPage();else if(a[0]==this.$btnLast[0])this.onLastPage();else if(a[0]==this.$btnGo[0])this.onPageEnter();a.is(".nav-vpaging")&&(this.isVPaging(!this._isVPaging),this._isVPaging?this.dispatchEvent(f.app.query.DataGridNavigator.PAGINGMODE_CHANGED_EVENT,{pagingMode:f.app.query.DataGridNavigator.VIRTUALIZING_PAGING}):this.dispatchEvent(f.app.query.DataGridNavigator.PAGINGMODE_CHANGED_EVENT,{pagingMode:f.app.query.DataGridNavigator.NORMAL_PAGING}))}};
js.$public.isVPaging=function(a){if(void 0===a)return this._isVPaging;this._isVPaging!=a&&(this._isVPaging=a,!0==this._isVPaging?(this.$btnFirst.css("display","none"),this.$btnPrev.css("display","none"),this.$btnPage1.css("display","none"),this.$btnPage2.css("display","none"),this.$btnPage3.css("display","none"),this.$btnPage4.css("display","none"),this.$btnPage5.css("display","none"),this.$btnNext.css("display","none"),this.$btnLast.css("display","none"),this.$lbPage.css("display","none"),this.$btnGo.css("display",
"none"),this.$txtPage.css("display","none"),this.$vpaging.addClass("selected"),this.$vpaging.attr("title","\u5207\u6362\u5230\u666e\u901a\u5206\u9875\u6a21\u5f0f"),this.$lbInfo.html("\u5171"+this.totalRow+"\u884c")):(this.$btnFirst.css("display",""),this.$btnPrev.css("display",""),this.$btnPage1.css("display",""),this.$btnPage2.css("display",""),this.$btnPage3.css("display",""),this.$btnPage4.css("display",""),this.$btnPage5.css("display",""),this.$btnNext.css("display",""),this.$btnLast.css("display",
""),this.$lbPage.css("display",""),this.$btnGo.css("display",""),this.$txtPage.css("display",""),this.$vpaging.removeClass("selected"),this.$vpaging.attr("title","\u5207\u6362\u5230\u865a\u62df\u5206\u9875\u6a21\u5f0f"),this.$lbInfo.html("\u5171"+(this.lastPage+1)+"\u9875,"+this.totalRow+"\u884c")))};js.$public.getPageRow=function(){return this.rowPerPage};js.$public.getTotalRow=function(){return this.totalRow};js.$public.getCurrentPageNo=function(){return this.currentPage};js.$public.getLastPageNo=
function(){return this.lastPage};this.onFirstPage=function(){this.setBasePage(0);this.currentPage=0;this.onNavPage(0)};this.onPrevPage=function(){0!=this.currentPage&&(this.currentPage--,this.currentPage<this.basePage&&this.setBasePage(this.basePage-5),this.onNavPage(this.currentPage))};this.onNextPage=function(){this.currentPage!=this.lastPage&&(this.currentPage++,this.currentPage>this.basePage+4&&this.setBasePage(this.basePage+5),this.onNavPage(this.currentPage))};this.onLastPage=function(){this.setBasePage(5*
Math.floor(this.lastPage/5));this.currentPage=this.lastPage;this.onNavPage(this.basePage+this.lastPage%5)};this.setBasePage=function(a){0>a&&(a=0);this.basePage=a;this.$btnPage1.html(this.basePage+1);this.$btnPage2.html(this.basePage+2);this.$btnPage3.html(this.basePage+3);this.$btnPage4.html(this.basePage+4);this.$btnPage5.html(this.basePage+5);this.basePage>this.lastPage?this.$btnPage1.addClass("disabled"):this.$btnPage1.removeClass("disabled");this.basePage+1>this.lastPage?this.$btnPage2.addClass("disabled"):
this.$btnPage2.removeClass("disabled");this.basePage+2>this.lastPage?this.$btnPage3.addClass("disabled"):this.$btnPage3.removeClass("disabled");this.basePage+3>this.lastPage?this.$btnPage4.addClass("disabled"):this.$btnPage4.removeClass("disabled");this.basePage+4>this.lastPage?this.$btnPage5.addClass("disabled"):this.$btnPage5.removeClass("disabled")};this.onNavPage=function(a,b){b=js.param(b,!0);this.selectButton(a-this.basePage+1);this.currentPage=a;0==a?(this.$btnFirst.addClass("disabled"),this.$btnPrev.addClass("disabled")):
(this.$btnFirst.removeClass("disabled"),this.$btnPrev.removeClass("disabled"));a==this.lastPage?(this.$btnLast.addClass("disabled"),this.$btnNext.addClass("disabled")):(this.$btnLast.removeClass("disabled"),this.$btnNext.removeClass("disabled"));!0==b&&this.dispatchEvent(f.app.query.DataGridNavigator.PAGE_CHANGED_EVENT,{pageNo:this.currentPage})};js.$public.refresh=function(){this.dispatchEvent(f.app.query.DataGridNavigator.PAGE_CHANGED_EVENT,{pageNo:this.currentPage})};this.selectButton=function(a){1==
a?this.$btnPage1.addClass("selected"):this.$btnPage1.removeClass("selected");2==a?this.$btnPage2.addClass("selected"):this.$btnPage2.removeClass("selected");3==a?this.$btnPage3.addClass("selected"):this.$btnPage3.removeClass("selected");4==a?this.$btnPage4.addClass("selected"):this.$btnPage4.removeClass("selected");5==a?this.$btnPage5.addClass("selected"):this.$btnPage5.removeClass("selected")};js.$public.goPage=function(a,b){b=js.param(b,!0);0>a&&(a=0);a>this.lastPage&&(a=this.lastPage);this.onNavPage(a,
b);return a};js.$public.goLastPage=function(){return this.goPage(this.lastPage)};this.onPageEnter=function(){var a=parseInt(this.$txtPage.val());isNaN(a)||(a-=1,0>a&&(a=0),a>this.lastPage&&(a=this.lastPage),a<this.basePage&&this.setBasePage(Math.max(a-2,0)),a>this.basePage+4&&this.setBasePage(Math.min(a-2,this.lastPage)),this.goPage(a))}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" xmlns:q\x3d"qs.app.query" title\x3d"\u6570\u636e\u5bfc\u51fa" width\x3d"250" height\x3d"300"\x3e','\x3cVLayout width\x3d"100%" vGap\x3d"2" padding\x3d"2"\x3e',"\x3cScrollView layout\x3d\"{width:'100%', height:'*'}\" options\x3d\"{classes:'qs-treeview-border'}\"\x3e",'\x3cTreeView name\x3d"tree" options\x3d"{checkable:true}"/\x3e',"\x3c/ScrollView\x3e",'\x3cHLayout width\x3d"100%" hGap\x3d"10" height\x3d"24" hAlign\x3d"right" innerLayout\x3d"{height:\'100%\'}"\x3e',
'\x3cButton text\x3d"\u786e\u5b9a" width\x3d"70" click\x3d"onOK" options\x3d"{isDefault:true}" /\x3e','\x3cButton text\x3d"\u53d6\u6d88" width\x3d"70" click\x3d"onCancel" /\x3e',"\x3c/HLayout\x3e","\x3c/VLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.query.QueryExportForm",f.ui.Window,function(){this._fields=this._selectXml=this._queryXml=this._querySql=this._addtionalCondition=this._condition=null;this.initialize=function(b){this.$super(b);this.qxml(a)};js.$public.render=function(a,c){this.$super(a,
c);this.invalidateSize(!0)};js.$public.setQueryDefinition=function(a,c,d,e,g,k){this._queryXml=a;this._condition=e;this._querySql=k;this._addtionalCondition=g;this._fields=d;if(js.isNull(c)||!js.isNull(d)&&0!=d.length){if(this._selectXml=a.xpath("xmlQuery/select")[0],!js.isNull(this._selectXml)){this._selectXml=this._selectXml.copy();a=this._selectXml.xpath("//field");if(js.isNull(d)||0==d.length)for(c=0;c<a.length;c++)e=a[c],0==e.attr("uid").indexOf("id_")&&e.attr("checked",f.ui.CheckBox.CHECKED);
else for(c=0;c<a.length;c++)e=a[c],g=e.parent().attr("name")+f.app.XmlQuery.NAME_SPLIT+e.attr("name"),0<=d.indexOf(g)&&e.attr("checked",f.ui.CheckBox.CHECKED);d=this._selectXml.xpath("other")[0];js.isNull(d)||0==d.xpath("field").length&&d.remove()}}else this._selectXml=c.copy();if(null!=this.tree)for(d=new f.ui.XmlTreeDataProvider(this._selectXml),this.tree.dataProvider(d),a=this._selectXml.children(),c=0;c<a.length;c++)this.tree.expand(a[c])};this.onOK=function(){var a=[],c=0,d,e,g=this._selectXml.xpath("//field");
if("array"==js.type(this._fields))for(c=0;c<this._fields.length;c++)a.push(this._fields[c]);for(c=0;c<g.length;c++)d=g[c],e="other"==d.parent().name()?"other"+f.app.XmlQuery.NAME_SPLIT+d.attr("alias"):d.parent().attr("name")+f.app.XmlQuery.NAME_SPLIT+d.attr("name"),parseInt(d.attr("checked"))==f.ui.CheckBox.CHECKED?-1==a.indexOf(e)&&a.push(e):(d=a.indexOf(e),-1!=d&&a.splice(d,1));0==a.length?f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u8981\u5bfc\u51fa\u7684\u5b57\u6bb5","\u63d0\u793a"):this.exportFile(a)};
this.toMapString=function(a){var c="";if(js.isNull(a))return"";for(var d in a)null!=a[d]&&(c="date"==js.type(a[d])?c+(d+":"+a[d].getTime()):c+(d+":"+a[d].toString()),c+=";");return c};this.toMapArrayString=function(a){if(js.isNull(a))return"";for(var c="",d=0;d<a.length;d++)c+=this.toMapString(a[d])+"#";return c};this.ajax_download=function(a,c){var d,e;0===(d=l("#download_iframe")).length&&(d=l("\x3ciframe id\x3d'download_iframe' style\x3d'display: none' src\x3d'about:blank'\x3e\x3c/iframe\x3e").appendTo("body"));
d=d[0].contentWindow||d[0].contentDocument;d.document&&(d=d.document);e="\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3e\x3cform method\x3d'POST' action\x3d'"+a+"'\x3e";for(var f in c)e+="\x3cinput type\x3dhidden name\x3d'"+f+"' value\x3d'"+c[f]+"'/\x3e";e+="\x3c/form\x3e\x3c/body\x3e\x3c/html\x3e";d.open();d.write(e);l(d).find("form").submit()};this.exportFile=function(a){for(var c="",d=0;d<a.length;d++)c=d==a.length-1?c+a[d]:c+(a[d]+",");a=wos.Desktop.getAbsoluteUrl("/svr/export");d={type:"query",
fileName:"export.xls"};d.condition=this.toMapString(this._condition);d.addtionalCondition=this.toMapArrayString(this._addtionalCondition);null!=this._querySql&&(d.querySql=this._querySql);""!=c&&(d.field=c);d.queryUID=this._queryXml.attr("uid");this.ajax_download(a,d);this.close()};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){var a=RegExp("'","g");f.app.SQLUtil={getSelectXml:function(a){var c=a.toLowerCase(),d,e;d=c.indexOf("select");e=c.indexOf("from");if(-1!=d&&-1!=e){c=new f.Xml("\x3cselect /\x3e");d=a.substring(d+7,e);if("*"==StringUtil.trim(d))return null;a=[];var g,k,m=0;for(e=k=0;e<d.length;e++)g=d.charAt(e),"("==g?k++:")"==g?k--:","==g&&0==k&&(g=d.substring(m,e),a.push(g),m=e+1);m<e&&(g=d.substr(m),a.push(g));for(e=0;e<a.length;e++)g=a[e],d=g.toLowerCase(),d=d.indexOf(" as "),-1!=d?(k=StringUtil.trim(g.substring(0,
d)),g=StringUtil.trim(g.substring(d+4))):(k=StringUtil.trim(g),g=null),d=c.append("field"),d.attr("name",k),null!=g&&d.attr("alias",g);return c}return null},filter:function(b){return b.replace(a,"")}}})(qs,jQuery);(function(f,l){js.$class("qs.app.table.XmlCell",function(){js.$static.NO_FILL=0;js.$static.VERTICAL_FILL=1;js.$static.HORIZONTAL_FILL=2;js.$static.SINGLE_FILL=3;js.$static.VH_FILL=4;js.$static.SPLIT_TEXT_POLICY_SPLIT=0;js.$static.SPLIT_TEXT_POLICY_COPY=1;this.table=null;this._editable=!0;this._fillColor=16777215;this._rowSpan=this._colSpan=1;this._height=this._width=this._colIndex=this._rowIndex=0;this._dataField=this._labelField=this._dataSource="";this._fillMode=0;this._value=null;this._explicitHeight=
this._explicitWidth=0;this._text="";this._selected=!1;this.xml=null;this.initialize=function(a,b){a=js.param(a,null);b=js.param(b,null);this.xml=a;this.table=b;js.isNull(a)||this.parseXml(a)};js.$public.colSpan=function(){return this._colSpan};js.$public.rowSpan=function(){return this._rowSpan};js.$public.rowIndex=function(){return this._rowIndex};js.$public.colIndex=function(){return this._colIndex};js.$public.width=function(a){if(void 0===a)return this._width;this._width=a};js.$public.height=function(a){if(void 0===
a)return this._height;this._height=a};js.$public.text=function(a){if(void 0===a)return this._text;this._text=a;js.isNull(this.xml)||this.xml.text(a)};js.$public.explicitWidth=function(a){if(void 0===a)return this._explicitWidth;this._explicitWidth=a};js.$public.explicitHeight=function(a){if(void 0===a)return this._explicitHeight;this._explicitHeight=a};js.$public.selected=function(a){if(void 0===a)return this._selected;this._selected=a};js.$public.borderWidth=function(a){if(void 0===a){a=this.xml.attr("borderWidth");
if(null==a||""==a){var b;a=b=1;0<this._colIndex&&(a=0);0<this._rowIndex&&(b=0);a=0==a&&0==b?"0 1 1 0":0==a?"1 1 1 0":0==b?"0 1 1 1":"1 1 1 1"}return a}this.xml.attr("borderWidth",a);a=a.split(" ");0<this._colIndex?table.getCell(this._rowIndex,this._colIndex-1).setBorderWidth(a[0],"right"):this.setBorderWidth(a[0],"left");0<this._rowIndex?table.getCell(this._rowIndex-1,this._colIndex).setBorderWidth(a[1],"bottom"):this.setBorderWidth(a[1],"top");this.setBorderWidth(a[2],"right");this.setBorderWidth(a[3],
"bottom")};js.$public.setBorderWidth=function(a,b){var c=this.borderWidth().split(" ");switch(b){case "top":c[0]=a;break;case "right":c[1]=a;break;case "bottom":c[2]=a;break;case "left":c[3]=a}this.xml.attr("borderWidth",c.join(" "))};js.$public.dataSource=function(a){if(void 0===a)return this._dataSource;null==a&&(a="");this._dataSource=a;this.xml.attr("dataSource",a)};js.$public.labelField=function(a){if(void 0===a)return this._labelField;null==a&&(a="");this._labelField=a;this.xml.attr("labelField",
a)};js.$public.dataField=function(a){if(void 0===a)return this._dataField;null==a&&(a="");this._dataField=a;this.xml.attr("dataField",a)};js.$public.value=function(a){if(void 0===a)return this._value;null==a&&(a="");this._value=a;this.xml.attr("value",a)};js.$public.fillMode=function(a){if(void 0===a)return this._fillMode;null==a||""==a||a==this.$class.NO_FILL?(this._fillMode=this.$class.NO_FILL,this.xml.attr("fillMode","")):this.xml.attr("fillMode",a)};js.$public.getAttribute=function(a){return this.xml.attr(a)};
js.$public.setAttribute=function(a,b){this.xml.attr(a,b)};this.parseXml=function(a){a.has("rowSpan")&&(this._rowSpan=parseInt(a.attr("rowSpan")));a.has("colSpan")&&(this._colSpan=parseInt(a.attr("colSpan")));a.has("width")&&(this._width=parseInt(a.attr("width")));a.has("height")&&(this._height=parseInt(a.attr("height")));a.has("dataSource")&&(this._dataSource=a.attr("dataSource"));a.has("labelField")&&(this._labelField=a.attr("labelField"));a.has("dataField")&&(this._dataField=a.attr("dataField"));
a.has("fillMode")&&(this._fillMode=parseInt(a.attr("fillMode")));a.has("value")&&(this._value=a.attr("value"));this._text=a.text()};js.$public.getXml=function(){1<this._rowSpan?this.xml.attr("rowSpan",this._rowSpan):this.xml.attr("rowSpan",null);1<this._colSpan?this.xml.attr("colSpan",this._colSpan):this.xml.attr("colSpan",null);0<this._width?this.xml.attr("width",this._width):this.xml.attr("width",null);0<this._height?this.xml.attr("height",this._height):this.xml.attr("height",null);this.xml.attr("rowIndex",
this._rowIndex);this.xml.attr("colIndex",this._colIndex);return this.xml};this.doInnerTable=function(a){var b=l(a);a=this.parseHtmlTable(b);b.attr("width",this.table.getColWidth(this._colIndex));b.attr("height",this.table.getRowHeight(this._rowIndex));for(var c,d,e,f,k,m=0;m<a.length;m++)for(var n=0;n<a[m].length;n++)!0!=a[m][n].handled&&(c=a[m][n],d=e=f=k="0",0==m?(0==n?e=f="1px":n==a[m].length-1?f="1px":e=f="1px",1==a.length&&(f="0")):m==a.length-1?0==n?e="1px":n!=a[m].length-1&&(e="1px"):0==n?
e=f="1px":f=n==a[m].length-1?"1px":k="1px",c.css({border:"1px solid black","border-width":StringUtil.join(d," ",e," ",f," ",k)}),a[m][n].handled=!0);a=b[0].outerHTML;b.remove();return a};this.parseHtmlTable=function(a){var b=[],c,d,e=0,f=0;c=a[0].rows[0];for(var k=0;k<c.cells.length;k++){d=c.cells[k];for(var m=0;m<d.colSpan;m++){for(var n=0;n<d.rowSpan;n++)b[e+n]||(b[e+n]=[]),b[e+n][f]=l(d);f++}}for(var p=e=1;p<a[0].rows.length;p++){c=a[0].rows[p];b[e]||(b[e]=[]);for(k=f=0;k<c.cells.length;k++){for(d=
c.cells[k];b[e][f];)f++;for(m=0;m<d.colSpan;m++){for(n=0;n<d.rowSpan;n++)b[e+n]||(b[e+n]=[]),b[e+n][f]=l(d);f++}}e++}return b};js.$public.getHtml=function(){var a=this.xml.attr("viewMode");""==a&&"true"==this.xml.attr("isHtmlText")&&(a="html");var b="",c=[];c.push("\x3ctd ");1<this._rowSpan&&c.push('rowSpan\x3d"',this._rowSpan,'" ');1<this._colSpan&&c.push('colSpan\x3d"',this._colSpan,'" ');c.push('width\x3d"',this._width,'" ');c.push('style\x3d"',this.getHtmlStyle(),";width:",this._width,'px" ');
var d=this.xml.attr("href");if(""!=d){var e=this.xml.attr("dsRef"),d=-1==d.indexOf("?")?d+"?":d+",",b="qs-link";c.push(' href\x3d"event:',d+("dsRef\x3d"+e),'" ')}"equation"==a&&(b+=" equation");c.push(' class\x3d"',b,'"');c.push(" \x3e");"html"==a?(a=StringUtil.trim(this.xml.text()),StringUtil.beginWith(a,"\x3ctable")&&StringUtil.endWith(a,"table\x3e")&&(a=this.doInnerTable(a)),c.push(a)):"equation"==a?c.push("\x3cspan\x3e",this.xml.text(),"\x3c/span\x3e"):(a=this.xml.text().replace(/\n/g,"\x3cbr/\x3e").replace(/\x20/g,
"\x26nbsp;"),c.push(a));c.push("\x3c/td\x3e");return c.join("")};this.getHtmlStyle=function(){var a="";"bold"==this.xml.attr("fontWeight")&&(a+="font-weight:bold;");"italic"==this.xml.attr("fontStyle")&&(a+="font-style:italic;");"underline"==this.xml.attr("textDecoration")&&(a+="text-decoration:underline;");this.xml.has("textAlign")&&(a+="text-align:"+this.xml.attr("textAlign")+";");this.xml.has("verticalAlign")&&(a+="vertical-align:"+this.xml.attr("verticalAlign")+";");this.xml.has("fontFamily")&&
(a+="font-family:"+this.xml.attr("fontFamily")+";");this.xml.has("fontSize")&&(a+="font-size:"+this.xml.attr("fontSize")+"px;");this.xml.has("color")&&(a+="color:"+this.xml.attr("color")+";");this.xml.has("fillColor")&&(a+="background-color:"+this.xml.attr("fillColor")+";");this.xml.has("style")&&(a+=this.xml.attr("style")+";");var b=this.borderWidth().split(" ");return a+="border:1px solid black;border-width:"+b.join("px ")+"px"};js.$public.fillColor=function(a){if(void 0===a)return this._fillColor;
this._fillColor=a;this.xml.attr("fillColor","#"+Number(a).toString(16))};this.remove=function(){this.xml.remove()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.table.XmlTable",function(){js.$static.DEFAULT_WIDTH=600;js.$static.DEFAULT_COLWIDTH=60;js.$static.DEFAULT_ROWHEIGHT=22;js.$static.MIN_COLWIDTH=20;js.$static.MIN_ROWHEIGHT=20;this.xml=null;this.rows=[];this.rowHeight=[];this.colWidth=[];this._height=this._width=this._colCount=this._rowCount=0;this.initialize=function(a){this.xml=a=js.param(a,null);null!=a&&this.parseXml(a)};js.$public.loadTable=function(a){js.isNull(a)||(this.xml=a,parseXml(a))};js.$public.x=function(a){if(void 0===
a)return parseInt(this.xml.attr("x"));this.xml.attr("x",a)};js.$public.y=function(a){if(void 0===a)return parseInt(this.xml.attr("y"));this.xml.attr("y",a)};js.$public.createTable=function(a,b,c){c=js.param(c,0);this.xml=new f.Xml("\x3ctable /\x3e");var d,e,g,k;k=0>=c?f.app.table.XmlTable.DEFAULT_WIDTH/b:c/b;for(e=0;e<b;e++)this.colWidth[e]=k;for(e=0;e<a;e++)this.rowHeight[e]=f.app.table.XmlTable.DEFAULT_ROWHEIGHT;for(e=this.rows.length=0;e<a;e++)for(c=xml.append("tr"),this.rows[e]=[],g=0;g<b;g++)d=
c.append("td"),d=new f.app.table.XmlCell(d,this),d._rowIndex=e,d._colIndex=g,d._width=k,d._height=f.app.table.XmlTable.DEFAULT_ROWHEIGHT,this.rows[e][g]=d;this._rowCount=a;this._colCount=b;this._width=b*k;this._height=a*f.app.table.XmlTable.DEFAULT_ROWHEIGHT};js.$public.rowCount=function(){return this._rowCount};js.$public.colCount=function(){return this._colCount};js.$public.width=function(){return this._width};js.$public.height=function(){return this._height};js.$public.deleteColumn=function(a){if(!(a>=
this._colCount||1>=this._colCount)){var b,c,d;for(b=0;b<this._rowCount;b++)for(d=this.rows[b][a],js.isNull(d)||d._rowIndex!=b||(d._colIndex==a&&1<d._colSpan?(d._colIndex++,d._colSpan--,d._width-=this.colWidth[a]):d._colIndex<a?(d._colSpan--,d._width-=this.colWidth[a]):d._colIndex==a&&1==d._colSpan&&(c=d.getXml(),c=c.parent(),d.remove(),0==c.children("td")&&c.remove())),this.rows[b].splice(a,1),c=a;c<this._colCount-1;c++)d=this.rows[b][c],!js.isNull(d)&&d._colIndex>a&&d._colIndex--;this._width-=this.colWidth[a];
this.colWidth.splice(a,1);this._colCount--}};js.$public.deleteRow=function(a){if(!(a>=this._rowCount||1>=this._rowCount)){var b,c,d,e,f,k;for(b=0;b<this._colCount;b++)d=this.rows[a][b],js.isNull(d)||d._colIndex!=b||(d._rowIndex==a&&1<d._rowSpan?(e=d.getXml(),c=e.parent(),e=this.getNextTD(a+1,0),js.isNull(e)?(e=this.getNextTR(a+1),k=js.isNull(e)?xml.append("tr"):xml.insertBefore("tr",e),e=d.getXml(),e.parent(),e.remove(),k.append(e)):(k=e.parent(),e=d.getXml(),e.parent(),e.remove(),f=this.getNextTD(a+
1,d._colIndex),js.isNull(f)?k.append(e):k.insertBefore(e,f)),d._rowIndex++,d._rowSpan--,d._height-=this.rowHeight[a]):d._rowIndex<a?(d._rowSpan--,d._height-=this.rowHeight[a]):d._rowIndex==a&&1==d._rowSpan&&(e=d.getXml(),c=e.parent(),d.remove()));js.isNull(c)||c.remove();this.rows.splice(a,1);for(b=this._rowCount-2;b>=a;b--)for(c=0;c<this._colCount;c++)d=this.rows[b][c],js.isNull(d)||d._rowIndex!=b+1||d._colIndex!=c||d._rowIndex--;this._height-=this.rowHeight[a];this.rowHeight.splice(a,1);this._rowCount--}};
js.$public.getCell=function(a,b){return js.isNull(this.rows[a])?null:this.rows[a][b]};js.$public.insertColumn=function(a,b){b=js.param(b,null);0>a&&(a=0);if(!(a>=this._colCount)){var c,d,e,g;this.colWidth.splice(a,0,DEFAULT_COLWIDTH);for(g=0;g<this._rowCount;g++)d=this.rows[g][a],js.isNull(d)||(d._colIndex==a?(c=this.getTR(g),js.isNull(c)&&(c=xml.append("tr")),e=null!=b?b.copy():d.getXml().copy(),d=this.getNextTD(g,a),null!=d?c.insertBefore(e,d):c.append(e),c=new f.app.table.XmlCell(e,this),c._rowIndex=
g,c._colIndex=a,c._colSpan=1,c._rowSpan=1,c._width=this.colWidth[a],c._height=this.rowHeight[g],c.text(""),c._dataSource="",c.fillMode(f.app.table.XmlCell.NO_FILL),c._labelField="",c._dataField="",this.rows[g].splice(a,0,c)):(d._rowIndex==g&&(d._colSpan++,d._width+=this.colWidth[a]),this.rows[g].splice(a,0,d)));for(g=0;g<this._rowCount;g++)for(c=this._colCount;c>a;c--)d=this.rows[g][c],js.isNull(d)||d._rowIndex!=g||d._colIndex!=c-1||d._colIndex++;this._width+=this.colWidth[a];this._colCount++}};js.$public.appendColumn=
function(a){a=js.param(a,null);var b,c,d,e,g,k;k=this._colCount;this.colWidth.push(f.app.table.XmlTable.DEFAULT_COLWIDTH);for(e=0;e<this._rowCount;){d=this.rows[e][k-1];c=this.getTR(e);js.isNull(c)&&(c=xml.append(b,"tr"));b=c;c=null!=a?a.copy():js.isNull(d)?b.create("td"):d.getXml().copy();b.append(c);c=new f.app.table.XmlCell(c,this);c._rowIndex=e;c._colIndex=k;c._rowSpan=d._rowSpan;c._colSpan=1;c._width=this.colWidth[k];c._height=0;c.text("");c._dataSource="";c.fillMode(f.app.table.XmlCell.NO_FILL);
c._labelField="";c._dataField="";for(g=e;g<e+d._rowSpan;g++)c._height+=this.rowHeight[g];this.rows[e].push(c);e+=d._rowSpan}this._width+=this.colWidth[k];this._colCount++};this.getTR=function(a){for(var b,c=0;c<this._colCount;c++)if(b=this.rows[a][c],!js.isNull(b)&&b._rowIndex==a)return b.getXml().parent();return null};this.getNextTD=function(a,b){for(var c,d=b;d<this._colCount;d++)if(c=this.rows[a][d],!js.isNull(c)&&c._rowIndex==a)return c.getXml();return null};this.getNextTR=function(a){for(var b=
a;b<this._rowCount;b++)if(a=this.getNextTD(b,0),null!=a)return a.parent();return null};js.$public.insertRowBefore=function(a,b){b=js.param(b,null);0>a&&(a=0);if(!(a>=this._rowCount)){var c,d,e,g,k,m;c=this.getNextTR(a);this.rowHeight.splice(a,0,this.rowHeight[a]);d=this.xml.create("tr");this.rows.splice(a,0,[]);for(k=0;k<this._colCount;k++)if(g=this.rows[a+1][k],!js.isNull(g)&&g._colIndex==k)if(g._rowIndex==a)for(e=null!=b?b.copy():g.getXml().copy(),d.append(e),e=new f.app.table.XmlCell(e,this),e._rowIndex=
a,e._colIndex=k,e._width=g._width,e._height=g._height,e.text(""),e.dataSource(""),e.fillMode(f.app.table.XmlCell.NO_FILL),e._labelField="",e._dataField="",this.rows[a][k]=e,m=k;m<k+g._colSpan;m++)this.rows[a][m]=e;else g._colIndex==k&&(g._rowSpan++,g._height+=this.rowHeight[a]),this.rows[a][k]=g;0<d.children("td").length&&(js.isNull(c)?this.xml.append(d):this.xml.insertBefore(d,c));for(k=this._rowCount;k>a;k--)for(m=0;m<this._colCount;m++)g=this.rows[k][m],js.isNull(g)||g._rowIndex!=k-1||g._colIndex!=
m||g._rowIndex++;this._height+=this.rowHeight[a];this._rowCount++}};js.$public.insertRowAfter=function(a,b){b=js.param(b,null);0>a&&(a=0);if(!(a>=this._rowCount)){var c,d,e,g,k;this.rowHeight.splice(a+1,0,this.rowHeight[a]);d=this.xml.create("tr");this.rows.splice(a+1,0,[]);for(g=0;g<this._colCount;g++)if(c=this.rows[a][g],!js.isNull(c)&&c._colIndex==g)if(1==c._rowSpan)for(e=null!=b?b.copy():c.getXml().copy(),d.append(e),e=new f.app.table.XmlCell(e,this),e._rowIndex=a+1,e._colIndex=g,e._width=c._width,
e._height=c._height,e.text(""),e.dataSource(""),e.fillMode(f.app.table.XmlCell.NO_FILL),e._labelField="",e._dataField="",this.rows[a+1][g]=e,k=g;k<g+c._colSpan;k++)this.rows[a+1][k]=e;else c._colIndex==g&&(c._rowSpan++,c._height+=this.rowHeight[a+1]),this.rows[a+1][g]=c;0<d.children("td").length&&(c=this.getNextTR(a),js.isNull(c)?this.xml.append(d):this.xml.insertAfter(d,c));for(g=this._rowCount;g>a+1;g--)for(k=0;k<this._colCount;k++)c=this.rows[g][k],js.isNull(c)||c._rowIndex!=g-1||c._colIndex!=
k||c._rowIndex++;this._height+=this.rowHeight[a+1];this._rowCount++}};js.$public.appendRow=function(a){a=js.param(a,null);var b,c,d,e,g,k;k=this._rowCount;this.rowHeight.push(f.app.table.XmlTable.DEFAULT_ROWHEIGHT);this.rows.push([]);b=this.xml.create("tr");for(e=0;e<this._colCount;){d=this.rows[k-1][e];c=null!=a?a.copy():d.getXml().copy();b.append(c);c=new f.app.table.XmlCell(c,this);c._rowIndex=k;c._colIndex=e;c._width=0;c._height=this.rowHeight[k];c._colSpan=d._colSpan;c._rowSpan=1;c.text("");
c._dataSource="";c.fillMode(f.app.table.XmlCell.NO_FILL);c._labelField="";c._dataField="";for(g=e;g<e+d._colSpan;g++)c._width+=this.colWidth[g],this.rows[k][g]=c;e+=d._colSpan}this.xml.append(b);this._height+=this.rowHeight[k];this._rowCount++};js.$public.mergeCell=function(a,b,c,d){if(0>a||0>b||c<a||d<b||c>=this._colCount||d>=this._rowCount||a==c&&b==d)return null;var e,f,k;for(e=b;e<=d;e++)for(f=a;f<=c;f++)if(k=this.rows[e][f],a!=c&&k._colIndex+k._colSpan-1>c||b!=d&&k._rowIndex+k._rowSpan-1>d)return null;
var m=0,l=0;for(e=a;e<=c;e++)m+=this.colWidth[e];for(e=b;e<=d;e++)l+=this.rowHeight[e];k=this.rows[b][a];if(!js.isNull(k)){k._rowSpan=d-b+1;k._colSpan=c-a+1;for(e=b;e<=d;e++)for(f=a;f<=c;f++)b=this.rows[e][f],b!=k&&(null!=b&&k.text(k.text()+b.text()),this.deleteCell(b)),this.rows[e][f]=k;k._width=m;k._height=l}return k};this.deleteCell=function(a){if(null!=a){var b,c;b=a.getXml().parent();null!=a&&a.remove();0==b.children("td").length&&b.remove();for(b=a._rowIndex;b<a._rowIndex+a._rowSpan;b++)for(c=
a._colIndex;c<a._colIndex+a._colSpan;c++)this.rows[b][c]=null}};js.$public.unmergeCell=function(a,b){if(!(0>b||b>=this._rowCount||0>a||a>=this._colCount)){var c;c=this.rows[b][a];if(!(js.isNull(c)||1==c._colSpan&&1==c._rowSpan)){var d,e,g,k,m,l,p,q;l=c._colSpan;p=c._rowSpan;c._colSpan=1;c._rowSpan=1;c._width=this.colWidth[c._colIndex];c._height=this.rowHeight[c._rowIndex];g=c.getXml();k=g.parent();for(d=c._colIndex+1;d<c._colIndex+l;d++)m=this.xml.create("td"),q=new f.app.table.XmlCell(m,this),q._rowIndex=
c._rowIndex,q._colIndex=d,q._width=this.colWidth[q._colIndex],q._height=this.rowHeight[q._rowIndex],this.rows[c._rowIndex][d]=q,k.insertAfter(m,g);for(d=c._rowIndex+1;d<c._rowIndex+p;d++){g=null;for(e=0;e<this._colCount;e++)if(m=this.rows[d][e],null!=m&&m._rowIndex==d){g=m.getXml().parent();break}null==g&&(g=xml.insertAfter("tr",k));k=g;g=null;for(e=c._colIndex+l;e<this._colCount;e++)if(m=this.rows[d][e],null!=m&&m._rowIndex==d){g=m.getXml();break}for(e=c._colIndex;e<c._colIndex+l;e++)m=this.xml.create("td"),
q=new f.app.table.XmlCell(m,this),q._rowIndex=d,q._colIndex=e,q._width=this.colWidth[q._colIndex],q._height=this.rowHeight[q._rowIndex],rows[d][e]=q,null==g?k.append(m):k.insertBefore(m,g)}}}};this.parseXml=function(a){var b,c,d,e,g,k;this._height=this._width=this._colCount=this._rowCount=this.rows.length=0;this.rowHeight.length=0;this.colWidth.length=0;var m=a.children("tr");if(0!=m.length){a.has("width")&&(this._width=parseInt(a.attr("width")));a.has("height")&&(this._height=parseInt(a.attr("height")));
d=a=0;b=m[0];this.rows[0]=[];b=b.children("td");for(g=0;g<b.length;g++){c=b[g];e=new f.app.table.XmlCell(c,this);e._rowIndex=a;e._colIndex=d;js.isNull(this.colWidth[d])&&1==e._colSpan&&0<e._width&&(this.colWidth[d]=e._width);js.isNull(this.rowHeight[a])&&1==e._rowSpan&&0<e._height&&(this.rowHeight[a]=e._height);this.rows[0][d]=e;for(c=a;c<a+e._rowSpan;c++)for(js.isNull(this.rows[c])&&(this.rows[c]=[]),this.rows[c][d]=e,k=d;k<d+e._colSpan;k++)this.rows[c][k]=e;d+=e._colSpan}this._colCount=d;a=1;d=
0;for(g=1;g<m.length;g++){b=m[g];for(e=!1;!e;)js.isNull(this.rows[a])&&(this.rows[a]=[]),js.isNull(this.rows[a][d])?e=!0:(d++,d>=this._colCount&&(a++,d=0));b=b.children("td");for(var l=0;l<b.length;l++){c=b[l];for(e=!1;!e;)null==this.rows[a][d]?e=!0:d++;e=new f.app.table.XmlCell(c,this);e._rowIndex=a;e._colIndex=d;js.isNull(this.colWidth[d])&&1==e._colSpan&&0<e._width&&(this.colWidth[d]=e._width);js.isNull(this.rowHeight[a])&&1==e._rowSpan&&0<e._height&&(this.rowHeight[a]=e._height);this.rows[a][d]=
e;for(c=a;c<a+e._rowSpan;c++)for(null==this.rows[c]&&(this.rows[c]=[]),k=d;k<d+e._colSpan;k++)this.rows[c][k]=e;d+e._colSpan>this._colCount&&(e._colSpan=this._colCount-d);d+=e._colSpan}a++;d=0}this._rowCount=a;for(g=0;g<this._colCount;g++)for(c=0;c<this._rowCount;c++){if(0==this.colWidth[g]&&(e=this.rows[c][g],null!=e&&0<e._width&&e._colIndex==g))for(k=e._colIndex;k<e._colIndex+e._colSpan;k++)this.colWidth[k]=e._width/e._colSpan;if(0==this.rowHeight[c]&&(e=this.rows[c][g],null!=e&&0<e._height&&e._rowIndex==
c))for(k=e._rowIndex;k<e._rowIndex+e._rowSpan;k++)this.rowHeight[k]=e._height/e._rowSpan}}};js.$public.getXml=function(){return this.xml};js.$public.generateXml=function(){var a;0<this._width&&this.xml.attr("width",this._width);0<this._height&&this.xml.attr("height",this._height);for(var b=0;b<this._rowCount;b++)for(var c=0;c<this._colCount;c++)a=this.rows[b][c],js.isNull(a)||a.getXml();return xml};js.$public.generateHtml=function(){var a,b=[];b.push('\x3ctable class\x3d"',this.xml.attr("class"),
'" width\x3d"',this._width,'"\x3e');for(var c=0;c<this._rowCount;c++){b.push("\x3ctr ");b.push('style\x3d"height:',this.rowHeight[c],'px"');b.push("\x3e");for(var d=0;d<this._colCount;d++)a=this.rows[c][d],js.isNull(a)||a.rowIndex()!=c||a.colIndex()!=d||b.push(a.getHtml());b.push("\x3c/tr\x3e")}b.push("\x3c/table\x3e");return b.join("")};js.$public.setColWidth=function(a,b){if(!(a>=this._colCount)){b<this.$class.MIN_COLWIDTH&&(b=this.$class.MIN_COLWIDTH);var c=b-this.colWidth[a];if(0!=c&&!isNaN(c)){for(var d,
e=0;e<this._rowCount;e++)d=this.rows[e][a],js.isNull(d)||d._rowIndex!=e||(d._width+=c);this._width+=c;this.colWidth[a]=b}}};js.$public.setRowHeight=function(a,b){if(!(a>=this._rowCount)){b<this.$class.MIN_ROWHEIGHT&&(b=this.$class.MIN_ROWHEIGHT);var c=b-this.rowHeight[a];if(0!=c&&!isNaN(c)){for(var d,e=0;e<this._colCount;e++)d=this.rows[a][e],js.isNull(d)||d._colIndex!=e||(d._height+=c);this._height+=c;this.rowHeight[a]=b}}};js.$public.getRowHeight=function(a){return this.rowHeight[a]};js.$public.getColWidth=
function(a){return this.colWidth[a]}})})(qs,jQuery);(function(f,l){js.$class("qs.app.report.FillArea",function(){this._table=null;this._fillMode=f.app.table.XmlCell.VERTICAL_FILL;this._headCell=null;this._fillHeight=this._fillWidth=0;this._dataField=this._labelField=this._dataSource="";this.generator=null;this.initialize=function(){};js.$static.getFillAreas=function(a){var b={},c,d,e,g=[],k,m;for(k=0;k<a.rowCount();k++)for(m=0;m<a.colCount();)c=a.getCell(k,m),c.rowIndex()==k&&c.colIndex()==m&&c.fillMode()!=f.app.table.XmlCell.NO_FILL&&""!=c.dataSource()&&
(c.text(""),null==b[c.dataSource()]&&(b[c.dataSource()]=[]),e=b[c.dataSource()],e.push(c)),m+=c.colSpan();var l,p,q;for(q in b)for(e=b[q];0<e.length;){c=e[0];if(c.fillMode()==f.app.table.XmlCell.SINGLE_FILL)k=new f.app.report.FillArea,k._table=a,k._fillMode=f.app.table.XmlCell.SINGLE_FILL,k._dataSource=c.dataSource(),k._labelField=c.labelField(),k._dataField=c.dataField(),k._headCell=c,k._fillWidth=1,k._fillHeight=1,g.push(k);else if(c.fillMode()==f.app.table.XmlCell.VERTICAL_FILL){l=c.rowIndex();
p=c.colIndex();m=1;for(k=p+1;k<a.colCount();k++)if(d=a.getCell(l,k),d.dataSource()==c.dataSource()&&d.fillMode()==c.fillMode())d=e.indexOf(d),-1!=d&&e.splice(d,1),m++;else break;k=new f.app.report.FillArea;k._table=a;k._fillMode=f.app.table.XmlCell.VERTICAL_FILL;k._dataSource=c.dataSource();k._headCell=c;k._fillWidth=m;k._fillHeight=0;g.push(k)}else if(c.fillMode==f.app.table.XmlCell.HORIZONTAL_FILL){l=c.rowIndex();p=c.colIndex();m=1;for(k=l+1;k<a.rowCount();k++)if(d=a.getCell(k,p),d.dataSource()==
c.dataSource()&&d.fillMode()==c.fillMode())d=e.indexOf(d),-1!=d&&e.splice(d,1),m++;else break;k=new f.app.report.FillArea;k._table=a;k._fillMode=f.app.table.XmlCell.HORIZONTAL_FILL;k._dataSource=c.dataSource();k._headCell=c;k._fillWidth=0;k._fillHeight=m;g.push(k)}else c.fillMode()==f.app.table.XmlCell.VH_FILL&&(k=new f.app.report.FillArea,k._table=a,k._fillMode=f.app.table.XmlCell.VH_FILL,k._dataSource=c.dataSource(),k._headCell=c,k._fillWidth=1,k._fillHeight=1,g.push(k));d=e.indexOf(c);-1!=d&&e.splice(d,
1)}return g};js.$public.fillData=function(a){if(null!=a&&0!=a.length)switch(this._fillMode){case f.app.table.XmlCell.SINGLE_FILL:this.singleFill(this._headCell,a[0],this._labelField,this._dataField);break;case f.app.table.XmlCell.VERTICAL_FILL:this.verticalFill(a);break;case f.app.table.XmlCell.HORIZONTAL_FILL:this.horizontalFill(a);break;case f.app.table.XmlCell.VH_FILL:this.vhFill(a)}};this.vhFill=function(a){if("array"==js.type(a)&&0!=a.length){var b=a[0];if("array"==js.type(b)&&0!=b.length){var c=
this._headCell.rowIndex(),d=this._headCell.colIndex();this._headCell.labelField("[0]");this._headCell.dataField("[0]");this._fillWidth=1;this.verticalFill(a);for(var e,f,k=1;k<b.length;k++)insert=!1,f=d+k,f>=this._table.colCount()?(this._table.appendColumn(),f=this._table.colCount()-1):(e=this._table.getCell(c,f),this.canFill(e)||this._table.insertColumn(f)),this._headCell=this._table.getCell(c,f),this._headCell.labelField("["+k+"]"),this._headCell.dataField("["+k+"]"),this._fillWidth=1,this.verticalFill(a);
this._headCell=this._table.getCell(c,d)}}};this.verticalFill=function(a){var b,c,d,e,f,k,m=[];b=a[0];e=this._headCell.rowIndex();for(c=f=this._headCell.colIndex();c<f+this._fillWidth;c++)k=this._table.getCell(e,c),js.isNull(k)||(this.singleFill(k,b,k.labelField(),k.dataField(),0),m[c]=k);var l,p;for(c=1;c<a.length;c++){b=a[c];l=!1;p=e+c;if(p>=this._table.rowCount())this._table.appendRow(),p=this._table.rowCount()-1,this._table.setRowHeight(p,this._table.getRowHeight(p-1));else{for(d=f;d<f+this._fillWidth;d++)if(k=
this._table.getCell(p,d),!this.canFill(k)){l=!0;break}!0==l&&(this._table.insertRowAfter(p-1),this._table.setRowHeight(p,this._table.getRowHeight(p-1)))}for(d=f;d<f+this._fillWidth;d++)k=this._table.getCell(p,d),null!=k&&this.singleFill(k,b,m[d].labelField(),m[d].dataField(),c)}var q,s;null!=this.generator&&(q=this.generator.expParser());for(c=f;c<f+this._fillWidth;c++)if(d=this._table.getCell(e,c),null!=d&&"true"==d.getAttribute("sameMerge"))for(b=d,m=d.getAttribute("mergeExp"),d=1;d<a.length;d++)p=
e+d,k=this._table.getCell(p,c),null!=b&&null!=k&&b!=k&&b.text()==k.text()&&(p=k.text(),l=!0,null!=q&&null!=m&&0<StringUtil.trim(m).length?(this.generator.setExpValue("$A",this.generator.getRecordMap(a[d-1])),this.generator.setExpValue("$B",this.generator.getRecordMap(a[d])),s=q.calculate(m),s.state==wos.expression.ExpressionResult.CALCULATED&&!1==s.value&&(l=!1)):""==k.text()&&(l=!1),l&&(b=this._table.mergeCell(b.colIndex(),b.rowIndex(),k.colIndex(),k.rowIndex()),null!=b&&(b.text(p),k=b))),b=k};this.horizontalFill=
function(a){var b,c,d,e,f,k,m=[];b=a[0];e=this._headCell.rowIndex();f=this._headCell.colIndex();for(c=e;c<e+this._fillHeight;c++)k=this._table.getCell(c,f),null!=k&&(this.singleFill(k,b,k.labelField(),k.dataField(),0),m[c]=k);var l,p;for(c=1;c<a.length;c++){b=a[c];l=!1;p=f+c;if(p>=this._table.colCount())this._table.appendColumn(),p=this._table.colCount()-1;else{for(d=e;d<e+this._fillHeight;d++)if(k=this._table.getCell(d,p),!this.canFill(k)){l=!0;break}!0==l&&this._table.insertColumn(p)}for(d=e;d<
e+this._fillHeight;d++)k=this._table.getCell(d,p),js.isNull(k)||this.singleFill(k,b,m[d].labelField(),m[d].dataField(),c)}for(c=e;c<e+this._fillHeight;c++)if(d=this._table.getCell(c,f),!js.isNull(d)&&"true"==d.getAttribute("sameMerge"))for(b=d,d=1;d<a.length;d++)p=f+d,k=this._table.getCell(d,p),js.isNull(b)||js.isNull(k)||b==k||b.text()!=k.text()||""==k.text()||(p=k.text(),b=this._table.mergeCell(b.colIndex(),b.rowIndex(),k.colIndex(),k.rowIndex()),null!=b&&(b.text(p),k=b)),b=k};this.canFill=function(a){return""!=
a.text()||0<a.getAttribute("formula").length||a.fillMode()!=f.app.table.XmlCell.NO_FILL?!1:!0};this.singleFill=function(a,b,c,d,e){e=js.param(e,0);var g=null,k="";if(!js.isNull(a)){a.dataSource("");if("array"==js.type(b)){var m=/\[(\d+)\]/,l;""!=c&&(l=c.match(m),null!=l&&2==l.length&&(k=b[l[1]]));""!=d&&(l=d.match(m),null!=l&&2==l.length&&(g=b[l[1]]))}else""!=d&&(d=d.replace(".",f.app.XmlQuery.NAME_SPLIT),g=b[d]),""==c&&(c=d+f.app.XmlQuery.NAME_SPLIT+"label"),c=c.replace(".",f.app.XmlQuery.NAME_SPLIT),
k=null!=b[c+"_label"]?b[c+"_label"]:null!=b[c+"_name"]?b[c+"_name"]:b[c],null==k&&(k="");null!=k&&""!=k||null==g||(k=g);"date"==js.type(k)&&(k=0==k.getHours()&&0==k.getMinutes()&&0==k.getSeconds()?DateUtil.format(k,"YYYY-MM-DD"):DateUtil.format(k,"YYYY-MM-DD HH:MI:SS"));a.value(g);null!=d&&""!=d?a.setAttribute("dsRef",this._dataSource+":"+e+":"+d):null!=c&&""!=c&&a.setAttribute("dsRef",this._dataSource+":"+e+":"+c);null!=k?a.text(k):a.text("")}};js.$public.table=function(){return this._table};js.$public.fillMode=
function(){return this._fillMode};js.$public.fillRow=function(){return this._headCell.rowIndex()};js.$public.fillColumn=function(){return this._headCell.colIndex()};js.$public.fillWidth=function(){return this._fillWidth};js.$public.fillHeight=function(){return this._fillHeight};js.$public.dataSource=function(){return this._dataSource};js.$public.labelField=function(){return this._labelField};js.$public.dataField=function(){return this._dataField}})})(qs,jQuery);(function(f,l){js.$class("qs.app.report.PivotTable",function(){this.recordSet=this.dataField=this.yPivots=this.xPivots=this.style=this.name=null;this.CELL_PADDING=10;this.yHeadWidth=this.xHeadHeight=0;this.xKey={};this.yKey={};this.cellStyle={};this.calcTotal=!0;this.initialize=function(a,b,c,d,e,f){this.name=a;this.style=f;this.xPivots=b;this.yPivots=c;this.dataField=d;this.recordSet=e;null==this.style&&(this.style={});this.cellStyle=this.getCellStyle(this.style);this.calcTotal=!1==this.style.calcTotal?
!1:!0};js.$static.getPivotData=function(a,b){for(var c=[],d=[],e=a.xpath("xAxis/axis"),f=a.xpath("yAxis/axis"),k,m,l=0;l<e.length;l++)m=e[l],k={},k.field=m.attr("field"),m.has("dataProvider")&&(k.dataProvider=m.attr("dataProvider")),c.push(k);for(l=0;l<f.length;l++)m=f[l],k={},k.field=m.attr("field"),m.has("dataProvider")&&(k.dataProvider=m.attr("dataProvider")),d.push(k);e={};e.dataField=a.attr("dataField");e.xPivots=c;e.yPivots=d;c={};a.has("dataLink")&&(c.dataLink=a.attr("dataLink"));c.calcTotal=
"true"==a.attr("calcTotal");e.style=c;e.table=a.attr("name");e.recordSet=b[a.attr("dataProvider")];return e};this.getCellStyle=function(a){var b={};if(js.isNull(a))return b;js.isNull(a.dataStyle)||(b.dataStyle=this.getStyleObject(a.dataStyle));js.isNull(a.colHeadStyle)||(b.colHeadStyle=this.getStyleObject(a.colHeadStyle));js.isNull(a.rowHeadStyle)||(b.rowHeadStyle=this.getStyleObject(a.rowHeadStyle));return b};this.getStyleObject=function(a){var b={};a=a.split(";");var c,d,e;for(d=0;d<a.length;d++)c=
a[d].split(":"),2==c.length&&(e=StringUtil.trim(c[0]),c=StringUtil.trim(c[1]),""!=e&&(b[e]=c));return b};js.$public.generate=function(a){a=js.param(a,null);if(null==a){var b=new f.Xml('\x3ctable class\x3d"qs-pivottable"\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e');a=new f.app.XmlTable(b)}else{for(var c=a.rowCount()-1;1<=c;c--)a.deleteRow(c);for(c=a.colCount()-1;1<=c;c--)a.deleteColumn(c);b=a.getXml();b=b.attr("class");a.getXml().attr("class",b+" qs-pivottable")}var c=this.getPivotsMap(this.recordSet,
this.xPivots,this.yPivots,this.dataField),b=c.dataMap,d=c.xHead,c=c.yHead,e,g,k;this.yHeadWidth=this.xHeadHeight=1;var m=[];m.length=0;for(k in c)m.push(c[k]);ArrayUtil.sortOn(m,"value");for(c=0;c<m.length;c++)e=m[c].label,a.appendRow(),g=a.getCell(a.rowCount()-1,0),js.isNull(this.cellStyle.rowHeadStyle)||this.setCellStyle(g,this.cellStyle.rowHeadStyle),this.yKey[a.rowCount()-1-this.xHeadHeight]="_"+e,"null"!=e&&g.text(e),this.genSubRowHead(a,m[c].child,g.rowIndex(),g.colIndex(),"_"+e);m.length=0;
for(k in d)m.push(d[k]);ArrayUtil.sortOn(m,"value");for(c=0;c<m.length;c++)e=m[c].label,a.appendColumn(),g=a.getCell(0,a.colCount()-1),js.isNull(this.cellStyle.colHeadStyle)||this.setCellStyle(g,this.cellStyle.colHeadStyle),this.xKey[a.colCount()-1-this.yHeadWidth]="_"+e,"null"!=e&&g.text(e),this.genSubColumnHead(a,m[c].child,g.rowIndex(),g.colIndex(),"_"+e);var l,m=[];k=[];for(c=this.yHeadWidth;c<a.colCount();c++)for(d=this.xHeadHeight;d<a.rowCount();d++)g=a.getCell(d,c),js.isNull(this.cellStyle.dataStyle)||
this.setCellStyle(g,this.cellStyle.dataStyle),e=this.xKey[c-this.yHeadWidth]+this.yKey[d-this.xHeadHeight],l=b[e],js.isNull(l)||(e=l.value,js.isNull(e)||(g.text(e.toString()),g.setAttribute("dsRef",this.name+":"+l.index+":"),js.isNull(this.style.dataLink)||g.setAttribute("href",this.style.dataLink),NumberUtil.isNumber(e)&&(js.isNull(m[d])?m[d]=NumberUtil.toNumber(e):m[d]+=NumberUtil.toNumber(e),js.isNull(k[c])?k[c]=NumberUtil.toNumber(e):k[c]+=NumberUtil.toNumber(e))));if(!0==this.calcTotal){a.appendColumn();
1<this.xHeadHeight&&a.mergeCell(a.colCount()-1,0,a.colCount()-1,this.xHeadHeight-1);g=a.getCell(0,a.colCount()-1);g.text("\u5408\u8ba1");js.isNull(this.cellStyle.colHeadStyle)||this.setCellStyle(g,this.cellStyle.colHeadStyle);g.setAttribute("fontWeight","bold");for(c=this.xHeadHeight;c<a.rowCount();c++)g=a.getCell(c,a.colCount()-1),g.setAttribute("href",""),js.isNull(m[c])||g.text(m[c]);a.appendRow();1<this.yHeadWidth&&a.mergeCell(0,a.rowCount()-1,this.yHeadWidth-1,a.rowCount()-1);g=a.getCell(a.rowCount()-
1,0);g.text("\u5408\u8ba1");js.isNull(this.cellStyle.rowHeadStyle)||this.setCellStyle(g,this.cellStyle.rowHeadStyle);g.setAttribute("fontWeight","bold");b=0;for(c=this.yHeadWidth;c<a.colCount();c++)g=a.getCell(a.rowCount()-1,c),g.setAttribute("href",""),js.isNull(k[c])||(g.text(k[c]),b+=k[c]);g=a.getCell(a.rowCount()-1,a.colCount()-1);g.text(b)}return a};this.setCellStyle=function(a,b){for(var c in b)a.setAttribute(c,b[c])};this.genSubRowHead=function(a,b,c,d,e){var f,k=[];for(f in b)k.push(b[f]);
if(0!=k.length){ArrayUtil.sortOn(k,"value");this.yHeadWidth<=d+1&&(a.appendColumn(),this.yHeadWidth+=1);for(var m,l=0;l<k.length;l++)f=k[l].label,1<=l&&(a.appendRow(),a.mergeCell(d,c,d,a.rowCount()-1)),b=a.getCell(a.rowCount()-1,d+1),js.isNull(this.cellStyle.rowHeadStyle)||this.setCellStyle(b,this.cellStyle.rowHeadStyle),m=e+"_"+f,this.yKey[a.rowCount()-1-this.xHeadHeight]=m,"null"!=f&&b.text(f),this.genSubRowHead(a,k[l].child,b.rowIndex(),b.colIndex(),m)}};this.genSubColumnHead=function(a,b,c,d,
e){var f,k=[];for(f in b)k.push(b[f]);if(0!=k.length){ArrayUtil.sortOn(k,"value");this.xHeadHeight<=c+1&&(a.insertRowAfter(c),this.xHeadHeight+=1);for(var m,l=0;l<k.length;l++)f=k[l].label,1<=l&&(a.appendColumn(),a.mergeCell(d,c,a.colCount()-1,c)),b=a.getCell(c+1,a.colCount()-1),js.isNull(this.cellStyle.colHeadStyle)||this.setCellStyle(b,this.cellStyle.colHeadStyle),m=e+"_"+f,this.xKey[a.colCount()-1-this.yHeadWidth]=m,"null"!=f&&b.text(f),this.genSubColumnHead(a,k[l].child,b.rowIndex(),b.colIndex(),
m)}};this.getPivotsMap=function(a,b,c,d){var e={},f,k,m,l,p,q,s={},r={},t,v;for(f=0;f<a.length;f++){m=a[f];l="";t=s;for(k=0;k<b.length;k++)q=b[k],p=m[q.field],js.isNull(q.dataProvider)||""==q.dataProvider||(js.isNull(q.dictMap)&&(q.dictMap=this.getDictionaryMap(q.dataProvider)),js.isNull(q.dictMap[p])||(p=q.dictMap[p])),p="date"==js.type(p)?0==p.getHours()&&0==p.getMinutes()&&0==p.getSeconds()?DateUtil.format(p,"YYYY-MM-DD"):DateUtil.format(p,"YYYY-MM-DD HH:MI:SS"):StringUtil.trim(p),l+="_"+p,js.isNull(t[p])&&
(v={},v.label=p,v.value=m[q.field],v.child={},t[p]=v),t=t[p].child;t=r;for(k=0;k<c.length;k++)q=c[k],p=m[q.field],js.isNull(q.dataProvider)||""==q.dataProvider||(js.isNull(q.dictMap)&&(q.dictMap=this.getDictionaryMap(q.dataProvider)),js.isNull(q.dictMap[p])||(p=q.dictMap[p])),p="date"==js.type(p)?0==p.getHours()&&0==p.getMinutes()&&0==p.getSeconds()?DateUtil.format(p,"YYYY-MM-DD"):DateUtil.format(p,"YYYY-MM-DD HH:MI:SS"):StringUtil.trim(p),l+="_"+p,js.isNull(t[p])&&(v={},v.label=p,v.value=m[q.field],
v.child={},t[p]=v),t=t[p].child;js.isNull(e[l])?e[l]={value:m[d],index:f,record:m}:(NumberUtil.isNumber(e[l].value)&&NumberUtil.isNumber(m[d])?e[l].value=NumberUtil.toNumber(e[l].value)+NumberUtil.toNumber(m[d]):e[l].value+=m[d],e[l].index=f,e[l].record=m)}return{dataMap:e,xHead:s,yHead:r}};this.getDictionaryMap=function(a){a=wos.DictionaryLoader.getValueList(a);if(js.isNull(a))return{};for(var b={},c=0;c<a.length;c++)b[a[c].value]=a[c].label;return b}})})(qs,jQuery);(function(f,l){js.$class("qs.app.report.ReportGenerator",f.events.EventDispatcher,function(){this._dataSourceMap={};this._condition=this.templateXml=this.entityMap=null;this.expPattern=/\$\{[\x20-\x7A|\x7C|\x7E|\u4e00-\u9fa5]*\}/g;this.refPattern=/[a-z|A-Z|\u4e00-\u9fa5|_]{1}[\w|\u4e00-\u9fa5]*(\.[\w|\u4e00-\u9fa5]*)*/g;this.entityXml=this.entity=null;this.isQueryCompleted=!1;this.tableMap={};this._expParser=null;this._expValue={};this.workingDS={};this.scriptSqlMap={};this._reportControl=this._page=
null;this._pageBreak=!0;this.addtionalConditionMap={};this.pivotTableList=[];this.initialize=function(a,b){this.$super();this._page=a;this._reportControl=b;this._expParser=new wos.expression.ExpressionParser(this);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.addEventListener(f.app.WSFileLoadEvent.WSFILE_LOAD,this.onFileLoaded)};js.$public.dataSourceMap=function(){return this._dataSourceMap};js.$public.addDataSource=function(a,b){if(js.isNull(this._dataSourceMap[a]))this._dataSourceMap[a]=
b;else{var c=this._dataSourceMap[a],d;for(d in this._dataSourceMap)this._dataSourceMap[d]==c&&(this._dataSourceMap[d]=b)}};js.$public.expParser=function(){return this._expParser};js.$public.setExpValue=function(a,b){this._expValue[a]=b};js.$public.setPivotTable=function(a,b,c,d,e,g,k){k=js.param(k,null);var m,l=null;null!=e&&(l=f.app.SQLUtil.getSelectXml(e));null!=k&&(this._dataSourceMap[a]=k);for(var p=0;p<this.pivotTableList.length;p++)if(m=this.pivotTableList[p],m.table==a){m.xPivots=b;m.yPivots=
c;m.dataField=d;m.sql=e;m.recordSet=k;m.style=g;m.headXml=l;return}this.pivotTableList.push({table:a,xPivots:b,yPivots:c,dataField:d,sql:e,recordSet:k,headXml:l,style:g})};js.$public.putScriptSql=function(a,b,c){for(var d="",e=this.templateXml.xpath('dataSource/xmlQuery[@uid \x3d "'+a+'"]')[0],g=e.xpath("select[0]/Entity"),k=0;k<g.length;k++)d=g[k],d=d.attr("name")+",";-1!=d.lastIndexOf(",")&&(d=d.substring(0,d.lastIndexOf(",")));!0==c?(c=e.children("select")[0].copy(),c.name("head")):c=f.app.SQLUtil.getSelectXml(b);
this.scriptSqlMap[a]={sql:b,headXml:c,entities:d}};js.$public.getTable=function(a){return this.tableMap[a]};js.$public.getTableMap=function(){return this.tableMap};js.$public.getExpressionValue=function(a){a=this._expParser.calculate(a);return a.state==wos.expression.ExpressionResult.CALCULATED?a.value:null};js.$public.template=function(a){if(void 0===a)return this.templateXml;this.templateXml=a;var b,c;a=this.templateXml.xpath("Document/text");for(c=0;c<a.length;c++)b=a[c],b.attr("uid",Math.uuid());
a=this.templateXml.xpath("Document/table");for(c=0;c<a.length;c++)b=a[c],b.attr("uid",Math.uuid())};js.$public.generate=function(a,b,c,d,e){this._condition=a;this.addtionalConditionMap=b;this.tableMap={};this.entityMap={};this._dataSourceMap={};js.copy(c,this._dataSourceMap);this.entity=js.clone(e);null!=e&&(this._dataSourceMap.$this=this.entity,this._dataSourceMap["this"]=this.entity);this.entityXml=d;if(!js.isNull(this.entityXml)&&!js.isNull(this.entity)){this._dataSourceMap[this.entityXml.attr("name")]=
this.entity;a=d.xpath('property[@type \x3d "relation"]');for(c=0;c<a.length;c++)b=a[c],this.entity[b.attr("name")]=this.entity[b.attr("name")+"_label"];a=d.xpath('property[@type \x3d "principal"]');for(c=0;c<a.length;c++)b=a[c],this.entity[b.attr("name")]=this.entity[b.attr("name")+"_name"]}this._reportControl.fireEvent("preQuery")};js.$public.doQuery=function(){var a=0,b,c,d=this.getDataSourceAction(),e;e=this.templateXml.xpath("dataSource/xmlQuery");var g=!1;if(0<e.length||0<d.length||0<this.pivotTableList.length)g=
!0;if(!0==g){this.isQueryCompleted=!1;wos.Remoting.beginBatchCall();try{js.isNull(this.entity)||js.isNull(this.entityXml)||wos.Remoting.call("DynamicEntityService.getEntity",[this.entity.id,this.entityXml.attr("name")],this,new wos.events.AsyncOption("getMasterEntity"));for(var k,a=0;a<e.length;a++)if(b=e[a],0<b.children("script").length){var m=this.scriptSqlMap[b.attr("uid")],l=m.sql;null!=l&&wos.Remoting.call("QueryService.executeSQLQuery",[m.entities,l,0,-1],this,new wos.events.AsyncOption("scriptQueryDS",
{queryDS:b,headXml:m.headXml}))}else g='\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e',g+=b.toString(),k=js.clone(this.getCondition(b)),this.prepareForServerValue(k,b),wos.Remoting.call("QueryService.executeXmlQuery",[g,this.addtionalConditionMap[b.attr("name")],k,0,-1],this,new wos.events.AsyncOption("queryDS",b));for(var p,a=0;a<d.length;a++)p=d[a],this.entityMap[p.entityUID]=null,c=f.app.Workspace.instance().getLoadedFile(p.entityUID),js.isNull(c)?(b={x_name:"Entity"},b.uid=p.entityUID,f.app.Workspace.instance().loadFile(b,
this,new wos.events.AsyncOption("getEntity",p))):wos.Remoting.call("DynamicEntityService.getEntity",[p.entityId,c.attr("name")],this,new wos.events.AsyncOption("getEntity",p));for(a=0;a<this.pivotTableList.length;a++)null!=this.pivotTableList[a].sql&&wos.Remoting.call("QueryService.executeSQLQuery",["",this.pivotTableList[a].sql,0,-1],this,new wos.events.AsyncOption("PivotTableDS",this.pivotTableList[a]))}catch(q){f.ui.MessageBox.show(q.message,"\u9519\u8bef")}wos.Remoting.endBatchCall(this,new wos.events.AsyncOption("queryComplete"))}else this._reportControl.fireEvent("postQuery")};
this.prepareForServerValue=function(a,b){var c=b.xpath("where//exp"),d,e,f,k,m,l,p={};for(m=0;m<c.length;m++)if(d=c[m],"svrval"==d.attr("rightType"))for(e=d.attr("right"),e=e.match(this.expPattern),l=0;l<e.length;l++)f=e[l],f=f.substr(2,f.length-3),f=this._expParser.calculate(f),f.state==wos.expression.ExpressionResult.CALCULATED&&(k=f.value),null!=k&&(p[e[l]]=k);var q,c=b.xpath("other/groupBy/customer");for(m=0;m<c.length;m++)for(d=c[m],d=d.attributes(),q=0;q<d.length;q++)for(e=d[q],e=e.value,e=
e.match(this.expPattern),l=0;l<e.length;l++)f=e[l],f=f.substr(2,f.length-3),f=this._expParser.calculate(f),f.state==wos.expression.ExpressionResult.CALCULATED&&(k=f.value),null!=k&&(p[e[l]]=k);var c="",s;for(s in p)0<c.length&&(c+="\r\t"),c+=s+"\x3d"+p[s];a._svrvals_=c};this.getDataSourceAction=function(){var a=[],b,c;if(js.isNull(this.entityXml)||js.isNull(this.entity))return a;var d=this.templateXml.xpath("Document/text");for(c=0;c<d.length;c++)b=d[c],this.addDataSourceAction(b,a);d=this.templateXml.xpath("Document/table/tr/td");
for(c=0;c<d.length;c++)b=d[c],this.addDataSourceAction(b,a);return a};this.addDataSourceAction=function(a,b){var c=a.text();if(""!=c&&(c=c.match(this.expPattern),null!=c&&0!=c.length))for(var d,e,f,k,m=0;m<c.length;m++)if(e=c[m],!(""==e||null==e||3>=e.length)){e=e.substring(2,e.length-1);d=e.match(this.refPattern);for(var l=0;l<d.length;l++)e=d[l],""!=e&&null!=e&&(e=e.split("."),3>e.length||"$this"!=e[0]||(e=String(e[1]),f=this.entityXml.xpath('property[@name \x3d "'+e+'"]')[0],js.isNull(f)||"relation"!=
f.attr("type")||(k=entity[e+"_id"],0<k&&b.push({target:entity,fieldName:e,entityUID:f.attr("entityUID"),entityId:k}))))}};this.hasEntityUnload=function(){for(var a in this.entityMap)if(null==this.entityMap[a])return!0;return!1};this.onFileLoaded=function(a){if(a.isLoaded&&"getEntity"==a.option.asyncName){var b=a.option.asyncData;wos.Remoting.call("DynamicFormService.getEntity",[b.entityId,a.fileXml.attr("name")],this,new wos.events.AsyncOption("getEntity",b))}};this.onRemotingCallback=function(a){var b,
c;switch(a.option.asyncName){case "queryComplete":this.isQueryCompleted=!0;this.hasEntityUnload()||f.Timer.callLater(0,function(){this._reportControl.fireEvent("postQuery")},this);break;case "queryDS":b=a.option.asyncData;this._dataSourceMap[b.attr("name")]=f.app.XmlQuery.convertResultSet(a.result);break;case "scriptQueryDS":b=a.option.asyncData.queryDS;c=a.option.asyncData.headXml;this._dataSourceMap[b.attr("name")]=f.app.XmlQuery.convertResultSet(a.result,c);break;case "PivotTableDS":b=a.option.asyncData;
this._dataSourceMap[b.table]=f.app.XmlQuery.convertResultSet(a.result,b.headXml);break;case "getEntity":b=a.option.asyncData;delete this.entityMap[b.entityUID];b.target[b.fieldName]=a.result;!0!=this.isQueryCompleted||this.hasEntityUnload()||f.Timer.callLater(0,function(){this._reportControl.fireEvent("postQuery")},this);break;case "getMasterEntity":this.entity=a.result,this._dataSourceMap.$this=this.entity,this._dataSourceMap["this"]=this.entity}};js.$public.generateReport=function(){wos.Desktop.openWaitingBox();
wos.Desktop.getWaitingBox().setMessage("\u6b63\u5728\u751f\u6210\u6587\u6863\uff0c\u8bf7\u7a0d\u5019...");try{var a,b,c;a=this.templateXml.xpath("dataSource/Entity");for(c=0;c<a.length;c++)b=a[c],this.calcEntityExpression(b);a=this.templateXml.xpath("dataSource/other");for(c=0;c<a.length;c++)b=a[c],this.calcEntityExpression(b);a=this.templateXml.xpath("dataSource/xmlQuery");for(c=0;c<a.length;c++)b=a[c],this.calcQueryDSExpression(b);a=this.templateXml.xpath("dataSource/customerDS");for(c=0;c<a.length;c++)b=
a[c],this.calcCustomerDSExpression(b);a=this.templateXml.xpath("dataSource/Entity");for(c=0;c<a.length;c++)b=a[c],this.doDictionary(b);return this.generateDocument()}catch(d){throw d;}finally{wos.Desktop.closeWaitingBox()}return new f.Xml("\x3cDocument /\x3e")};this.calcEntityExpression=function(a){var b=this._dataSourceMap[a.attr("name")];if(!js.isNull(b)){var c,d;a=a.children("field");for(var e=0;e<a.length;e++)d=a[e],c=d.attr("calcexp"),""!=c&&(c=this._expParser.calculate(c),c.state==wos.expression.ExpressionResult.CALCULATED&&
("date"==js.type(c.value)?b[d.attr("name")]=this.formatDate(c.value):b[d.attr("name")]=c.value))}};this.doDictionary=function(a){var b=this._dataSourceMap[a.attr("name")];if(!js.isNull(b)){var c,d,e;d=a.children("field");for(var f=0;f<d.length;f++)e=d[f],a=e.attr("valueProvider"),c=b[e.attr("name")],""==a||js.isNull(c)||(c=wos.DictionaryLoader.getValueItem(a,c),null!=c&&(b[e.attr("name")]=c.label))}};js.$public.getRecordMap=function(a){var b,c,d={},e;for(b in a)c=a[b],e=f.app.XmlQuery.splitRecordKey(b),
2!=e.length?d[b]=c:(null==d[e[0]]&&(d[e[0]]={}),d[e[0]][e[1]]=c);return d};this.calcQueryDSExpression=function(a){var b=this._dataSourceMap[a.attr("name")];if(!js.isNull(b)){var c,d,e,g,k,m,l,p,q;q=a.children("select")[0].children();for(var s=0;s<q.length;s++){l=q[s];m=l.children("field");for(var r=0;r<m.length;r++)if(p=m[r],a=p.attr("calcexp"),d="","Entity"==l.name()&&(e=f.app.Workspace.instance().getLoadedFile(l.attr("uid")),js.isNull(e)||(l=e,e=l.xpath('property[@uid \x3d "'+p.attr("uid")+'"]')[0],
js.isNull(e)||(d=e.attr("valueProvider")))),""!=a||""!=d){""!=d&&(g=wos.DictionaryLoader.getValueList(d));for(var t=0;t<b.length;t++)e="otherField"==p.attr("fieldType")?l.attr("name")+f.app.XmlQuery.NAME_SPLIT+p.attr("alias"):l.attr("name")+f.app.XmlQuery.NAME_SPLIT+p.attr("name"),k=this.getRecordMap(b[t]),""!=a&&(this.workingDS[l.attr("name")]=k[l.attr("name")],c=this._expParser.calculate(a),this.workingDS={},c.state==wos.expression.ExpressionResult.CALCULATED&&("date"==js.type(c.value)?b[t][e]=
this.formatDate(c.value):b[t][e]=c.value)),c=b[t][e],""!=d&&null!=c&&(-1!=d.indexOf("!rela:")&&(g=wos.DictionaryLoader.getRelationValueList(d,k[l.attr("name")])),c=wos.DictionaryLoader.getValueItem(g,c),null!=c&&(b[t][e+"_label"]=c.label))}}}};this.calcCustomerDSExpression=function(a){var b=this._dataSourceMap[a.attr("name")];if(!js.isNull(b)){var c,d,e,f;e=a.children("field");for(var k=0;k<e.length;k++)if(f=e[k],d=f.attr("calcexp"),""!=d)for(var m=0;m<b.length;m++)this.workingDS[a.attr("name")]=
b[m],c=this._expParser.calculate(d),this.workingDS={},c.state==wos.expression.ExpressionResult.CALCULATED&&("date"==js.type(c.value)?b[m][f.attr("name")]=this.formatDate(c.value):b[m][f.attr("name")]=c.value)}};this.formatDate=function(a){return 0==a.getHours()&&0==a.getMinutes()&&0==a.getSeconds()?DateUtil.format(a,"YYYY-MM-DD"):DateUtil.format(a,"YYYY-MM-DD HH:MI:SS")};js.$public.generateBlankDocument=function(){var a,b=this.templateXml.children("Document")[0].copy(),c,d={},e;for(a=0;a<this.pivotTableList.length;a++)d[this.pivotTableList[a].table]=
this.pivotTableList[a];b.name("document");var f=b.children("text");for(a=0;a<f.length;a++)c=f[a],this.doText(c);f=b.children("table");for(a=0;a<f.length;a++)c=f[a],e=d[c.attr("name")],js.isNull(e)&&this.doTable(b,c);return b};this.generateDocument=function(){var a,b=this.templateXml.children("Document")[0].copy(),c,d={},e;for(a=0;a<this.pivotTableList.length;a++)d[this.pivotTableList[a].table]=this.pivotTableList[a];b.name("document");var g=b.children("text");for(a=0;a<g.length;a++)c=g[a],this.doText(c);
g=b.children("table");for(a=0;a<g.length;a++)c=g[a],e=d[c.attr("name")],js.isNull(e)?this.doTable(b,c):this.doPivotTable(b,c,e);g=b.children("PivotTable");for(a=0;a<g.length;a++)d=g[a],e=f.app.report.PivotTable.getPivotData(d,this._dataSourceMap),c=b.append("table"),c.attr("x",d.attr("x")),c.attr("y",d.attr("y")),c.attr("width",d.attr("width")),c.attr("height",d.attr("height")),c.append("tr").append("td"),this.doPivotTable(b,c,e);g=b.children("image");for(a=0;a<g.length;a++)c=g[a],this.doImage(c);
return b};this.doText=function(a){var b=a.text();if(""==b)return!1;var c=this,b=b.replace(this.expPattern,function(){return c.expReplaceFunction.apply(c,Array.prototype.slice.call(arguments,0))});b!=a.text()&&a.text(b);return!0};this.doImage=function(a){var b=a.attr("dataSource");if(js.isNull(b)||""==b)b=a.attr("url");var c=this,b=b.replace(this.expPattern,function(){return c.expReplaceFunction.apply(c,Array.prototype.slice.call(arguments,0))});return""!=b&&b!=a.attr("url")?(a.attr("url",b),!0):!1};
this.expReplaceFunction=function(a){var b=null;if(""==a||null==a||3>=a.length)return a;a=a.substring(2,a.length-1);a=a.replace(/&quot;/g,'"');a=a.replace(/&amp;/g,"\x26");a=a.replace(/&lt;/g,"\x3c");a=a.replace(/&gt;/g,"\x3e");if("page.num"==a)return'\x3cspan class\x3d"qs-report-val page-num"\x3e\x3c/span\x3e';if("page.count"==a)return'\x3cspan class\x3d"qs-report-val page-count"\x3e\x3c/span\x3e';a=this._expParser.calculate(a);a.state==wos.expression.ExpressionResult.CALCULATED&&(b=a.value);return null==
b?"":"date"==js.type(b)?this.formatDate(b):b};this.doTable=function(a,b){var c,d,e,g,k;d=new f.app.table.XmlTable(b);e=b.xpath("tr/td");for(c=0;c<e.length;c++)this.doText(e[c]);g=f.app.report.FillArea.getFillAreas(d);var m=l.JSONPath({data:this._dataSourceMap});for(c=0;c<g.length;c++)k=g[c],e=m.query("$."+k.dataSource())[0],"array"==js.type(e)&&(k.generator=this,k.fillData(e));this.tableMap[b.attr("uid")]=d};this.doPivotTable=function(a,b,c){a=null;a=null!=c.sql?this._dataSourceMap[c.table]:c.recordSet;
if(!js.isNull(a)){var d=new f.app.table.XmlTable(b);oldHeight=d.height;baseY=parseInt(b.attr("y"))+oldHeight;(new f.app.report.PivotTable(c.table,c.xPivots,c.yPivots,c.dataField,a,c.style)).generate(d);this.tableMap[b.attr("uid")]=d}};js.$public.getCondition=function(a){var b=js.clone(this._condition),c,d=/[\u4e00-\u9fa5]/;for(c in this._condition)null==c.match(d)&&null==b[c]&&null!=this._condition[c]&&(b[c]=this._condition[c]);for(var e=a.xpath("where//exp"),f,k,d=0;d<e.length;d++)f=e[d],"val"==
f.attr("rightType")&&(k=f.attr("right"),c=null,k=this._expParser.calculate(k),k.state==wos.expression.ExpressionResult.CALCULATED&&(c=k.value),null!=c&&(f.has("uid")?b[f.attr("uid")]=c:(k=f.attr("leftEntity")+"_"+f.attr("leftField"),b[k]=c))),"val"==f.attr("rightType2")&&(k=f.attr("right2"),c=null,k=this._expParser.calculate(k),k.state==wos.expression.ExpressionResult.CALCULATED&&(c=k.value),null!=c&&(f.has("uid")?b[f.attr("uid")+"2"]=c:(k=f.attr("leftEntity")+"_"+f.attr("leftField")+"2",b[k]=c)));
e=this.addtionalConditionMap[a.attr("name")];if("array"==js.type(e))for(d=0;d<e.length;d++)a=e[d],"val"==a.rightType&&(k=String(a.right),c=null,k=this._expParser.calculate(k),k.state==wos.expression.ExpressionResult.CALCULATED&&(c=k.value),null!=c&&(null!=a.uid&&""!=a.uid?b[a.uid]=c:(k=String(a.leftEntity)+"_"+String(a.leftField),b[k]=c))),null!=a.rightType2&&"val"==a.rightType2&&(k=String(a.right2),c=null,k=this._expParser.calculate(k),k.state==wos.expression.ExpressionResult.CALCULATED&&(c=k.value),
null!=c&&(0<a.uid.length()?b[a.uid+"2"]=c:(k=String(a.leftEntity)+"_"+String(a.leftField)+"2",b[k]=c)));return b};js.$public.getVariableValue=function(a,b){switch(a){case "this":case "$this":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._dataSourceMap[a]);case "condition":case "$condition":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._reportControl.condition());case "openParameter":case "$openParameter":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,
this._reportControl.getOpenParameter());case "page":case "$page":return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._page);default:if(!js.isNull(this._expValue[a]))return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,this._expValue[a])}var c;c=this.workingDS[a];if(js.isNull(c))c=this._dataSourceMap[a];else return new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,c);return js.isNull(c)?wos.expression.ExpressionResult.InvalideResult:
new wos.expression.ExpressionResult(wos.expression.ExpressionResult.CALCULATED,c)};js.$public.getFunctionValue=function(a,b,c){return wos.expression.ExpressionResult.InvalideResult}})})(qs,jQuery);(function(f,l){js.$class("qs.app.report.ReportView",f.ui.Control,function(){f.events.register("link",this);js.$static.LINK_EVENT="link";this._autosize=!1;this._breakPage=!0;this._onlyShowContent=!1;this._showPageNo=!0;this._editable=!1;this._lenUnit="px";this._pageWidth=800;this._pageHeight=1132;this.uidTextMap={};this.uidTableMap={};this._pages=[];this._items=this._$content=this._report=null;this.diffY=this.diffX=0;this._documentXml=null;this.initialize=function(){this.$super()};js.$public.documentXml=
function(a){this._documentXml=a;this.callAfterRendered(function(){this._report=this.findAncestor(f.app.ReportControl);null!=this._$content&&(this._$content.empty(),this._$content.html('\x3cdiv class\x3d"qs-report-page" /\x3e'),this._pages=[],this._items=[],this._pages[0]=this._$content.children(".qs-report-page"));this.load(this._documentXml)})};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-report-view"\x3e','\x3cdiv class\x3d"qs-report-content"\x3e','\x3cdiv class\x3d"qs-report-page" /\x3e',
"\x3c/div\x3e","\x3c/div\x3e")};js.$public.print=function(){var a=window.open();self.focus();a.document.open();var b=StringUtil.join("\x3chtml\x3e","\x3chead\x3e","\x3ctitle\x3e\u6253\u5370\u9884\u89c8\x3c/title\x3e",'\x3clink href\x3d"',wos.Desktop.getRelativeUrl(),'applications/qsweb/css/print.css" rel\x3d"stylesheet"\x3e',"\x3c/head\x3e","\x3cscript\x3e","function onLoad(){","window.print();","window.close();","}","\x3c/script\x3e",'\x3cbody onload\x3d"onLoad()"\x3e',this.contentHtml(),"\x3c/body\x3e",
"\x3c/html\x3e");a.document.write(b);a.document.close()};js.$public.contentHtml=function(a){if(void 0===a){for(var b,c=0;c<this._items.length;c++)b=this._items[c],"chart"==b.type&&b.chart&&(b.$chartImage&&b.$chartImage.remove(),b.$chartImage=l(b.chart.getImage()),isNaN(b.x)||b.$chartImage.css("left",b.x+this.diffX),isNaN(b.y)||b.$chartImage.css("top",b.y+this.diffY),isNaN(b.width)||b.$chartImage.width(b.width),isNaN(b.height)||b.$chartImage.height(b.height),b.$chartImage.css("position","absolute"),
b.$el.css("display","none"),b.$el.parent().append(b.$chartImage));a=this._$content.html();for(c=0;c<this._items.length;c++)b=this._items[c],"chart"==b.type&&b.chart&&(b.$chartImage&&(b.$chartImage.remove(),b.$chartImage=null),b.$el.css("display",""));return a}this._$content.html(a)};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);var c=a.find(".qs-report-view");0<b.classes.length&&c.addClass(b.classes);this._$content=c.children(".qs-report-content");
this._pages[0]=this._$content.children(".qs-report-page");this.bindEvent("click",function(a){a=l(a.target);if(a.is(".qs-report-linkarea")){var b=a.attr("url");js.isNull(b)||""==b||this.dispatchEvent("link",{href:b})}a=a.closest("td.qs-link",this._$element);0<a.length&&(b=a.attr("href"),js.isNull(b)||""==b||this.dispatchEvent("link",{href:b}))},c);this.invalidateSize()};js.$public.autosize=function(a){if(void 0===a)return this._autosize;this._autosize=a};js.$public.breakPage=function(a){if(void 0===
a)return this._breakPage;this._breakPage=a};js.$public.onlyShowContent=function(a){if(void 0===a)return this._onlyShowContent;this._onlyShowContent=a};js.$public.showPageNo=function(a){if(void 0===a)return this._showPageNo;this._showPageNo=a};js.$public.editable=function(a){if(void 0===a)return this._editable;this._editable=a};this.createItem=function(a,b){var c=l(b),d=parseInt(a.attr("x")),e=parseInt(a.attr("y")),f=parseInt(a.attr("width")),k=parseInt(a.attr("height"));c.addClass("qs-report-item");
isNaN(d)||c.css("left",d+this.diffX);isNaN(e)||c.css("top",e+this.diffY);isNaN(f)||c.width(f);isNaN(k)||c.height(k);c={xml:a,x:d,y:e,width:f,height:k,$el:c};"true"==a.attr("fixedY")?c.fixedY=!0:c.fixedY=!1;return c};this.createImage=function(a){var b=this.createItem(a,'\x3cimg class\x3d"qs-report-image" /\x3e');a=a.attr("url");var c=a.indexOf(":");-1!=c&&(a="docroot/attachments/"+a.substr(c+1));b.$el.attr("src",wos.Desktop.getRelativeUrl()+a);b.type="image";return b};this.createTable=function(a){var b=
this.createItem(a,'\x3cdiv class\x3d"qs-report-table" /\x3e'),c=this._tableMap[a.attr("uid")];js.isNull(c)&&(c=new f.app.table.XmlTable(a));a=c.generateHtml();b.$el.html(a);b.type="table";b.table=c;return b};this.createText=function(a){var b=this.createItem(a,'\x3cdiv class\x3d"qs-report-text" /\x3e');a=a.text();a=a.replace(/font\-size:(\d+);/ig,function(a,b){return"font-size:"+b+"px;"});b.$el.html(a);b.$el.find("font").each(function(){var a=l(this),b=parseInt(a.attr("size"));7<b&&(a.attr("size",
""),a.css("font-size",b+"px"))});b.type="text";return b};this.createLinkarea=function(a){var b=this.createItem(a,'\x3cdiv class\x3d"qs-report-linkarea" /\x3e');b.$el.attr("url",a.attr("url"));b.type="linkarea";return b};this.createPieChart=function(a){var b={tooltip:{trigger:"item",formatter:"{a} \x3cbr/\x3e{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:[]},toolbox:{show:!0,feature:{restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"",type:"pie",radius:"75%",center:["50%",
"50%"],data:[]}]},c=this._dsMap[a.attr("dataProvider")];if("array"==js.type(c)){var d=a.xpath("series/PieSeries")[0];if(!js.isNull(d)){var e=d.attr("displayLabel");a=StringUtil.replace(d.attr("displayName"),".",f.app.XmlQuery.NAME_SPLIT);d=StringUtil.replace(d.attr("field"),".",f.app.XmlQuery.NAME_SPLIT);b.series[0].name=e;for(var g=[],k=[],m=0;m<c.length;m++)e=c[m],"string"==js.type(e[a+"_label"])?(g.push(e[a+"_label"]),k.push({value:e[d],name:e[a+"_label"]})):void 0!==e[a]&&(g.push(e[a]),k.push({value:e[d],
name:e[a]}));b.legend.data=g;b.series[0].data=k}}return b};this.createSeries=function(a,b){var c=a.name(),d=StringUtil.replace(a.attr(b),".",f.app.XmlQuery.NAME_SPLIT),e=a.attr("displayLabel");if("BarSeries"==c)return{series:{name:e,type:"bar",data:[]},dataField:d};if("ColumnSeries"==c)return{series:{name:e,type:"bar",data:[],markPoint:{data:[{type:"max",name:"\u6700\u5927\u503c"},{type:"min",name:"\u6700\u5c0f\u503c"}]},markLine:{data:[{type:"average",name:"\u5e73\u5747\u503c"}]}},dataField:d};if("LineSeries"==
c)return{series:{name:e,type:"line",data:[]},dataField:d}};this.createNormalChart=function(a){var b={tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:[]},calculable:!0,xAxis:[],yAxis:[],series:[]},c,d,e,g=a.xpath("verticalAxis/CategoryAxis")[0];js.isNull(g)?(g=a.xpath("horizontalAxis/CategoryAxis")[0],js.isNull(g)||(b.xAxis.push({type:"category",data:[]}),b.yAxis.push({type:"value",splitArea:{show:!0}}),c=StringUtil.replace(g.attr("categoryField"),
".",f.app.XmlQuery.NAME_SPLIT),e=b.xAxis[0].data,d="yField")):(b.yAxis.push({type:"category",data:[]}),b.xAxis.push({type:"value",splitArea:{show:!0}}),c=StringUtil.replace(g.attr("categoryField"),".",f.app.XmlQuery.NAME_SPLIT),e=b.yAxis[0].data,d="xField");if(js.isNull(g))return null;g=a.children("series")[0];if(js.isNull(g))return null;for(var k=g.children(),g=[],m,l=0;l<k.length;l++)m=this.createSeries(k[l],d),g.push(m),b.legend.data.push(m.series.name),b.series.push(m.series);a=this._dsMap[a.attr("dataProvider")];
if("array"==js.type(a))for(l=0;l<a.length;l++)for(d=a[l],e.push(d[c]),k=0;k<g.length;k++)g[k].series.data.push(d[g[k].dataField]);return b};this.createChart=function(a,b){var c=this.createItem(a,'\x3cdiv class\x3d"qs-report-chart" /\x3e');c.type="chart";var d=null;switch(a.attr("type")){case "ColumnChart":case "BarChart":case "LineChart":d=this.createNormalChart(a);break;case "PieChart":d=this.createPieChart(a)}b.append(c.$el);if(null==d||void 0==d)return c;var e=echarts.init(c.$el[0]);e.setOption(d);
c.chart=e;return c};this.setPageSize=function(a,b,c,d){"mm"==d?(a.css("width",b+"mm"),a.css("height",c+"mm")):(a.width(b),a.height(c))};js.$public.load=function(a,b,c,d){b=js.param(b,{});c=js.param(c,{});d=js.param(d,!1);this._documentXml=a;this._report=this.findAncestor(f.app.ReportControl);!1==d?(this._$content.empty(),this._$content.html('\x3cdiv class\x3d"qs-report-page" /\x3e'),this._pages=[],this._items=[],this._pages[0]=this._$content.children(".qs-report-page")):(this._pages=[],this._items=
[],this._pages[0]=l('\x3cdiv class\x3d"qs-report-page" /\x3e'),this._$content.append('\x3cdiv class\x3d"qs-break-page" /\x3e'),this._$content.append(this._pages[0]));this._tableMap=c;this._dsMap=b;this.uidTextMap={};this.uidTableMap={};if(!js.isNull(a)){c=b=0;a.has("width")&&(b=parseInt(a.attr("width")));a.has("height")&&(c=parseInt(a.attr("height")));this._lenUnit=a.attr("lenUnit");!isNaN(b)&&!isNaN(c)&&0<b&&0<c?(this._pageWidth=b,this._pageHeight=c):(this._pageWidth=800,this._pageHeight=1132);!0!=
this._autosize&&this.setPageSize(this._pages[0],this._pageWidth,this._pageHeight,this._lenUnit);this._onlyShowContent?this._$element.children(".qs-report-view").addClass("qs-report-nopage"):(b=this.findAncestor(f.ui.ScrollView),js.isNull(b)||b.$element().addClass("qs-report-scrollview"));var e;b=a.children();this._items=[];for(c=0;c<b.length;c++){d=b[c];a=null;e=d.name();switch(e){case "image":a=this.createImage(b[c]);break;case "table":a=this.createTable(d);d.has("uid")&&(this.uidTableMap[d.attr("uid")]=
a);break;case "text":a=this.createText(d);d.has("uid")&&(this.uidTextMap[d.attr("uid")]=a);break;case "linkarea":a=this.createLinkarea(d);break;case "chart":a=this.createChart(d,this._pages[0]),this._items.push(a)}null!=a&&"chart"!=e&&(this._pages[0].append(a.$el),this._items.push(a),"table"==e&&(d=a.$el.children("table"),a.$el.width()<d.width()&&(a.width=d.width(),a.$el.width(a.width)),a.$el.height()<d.height()&&(a.height=d.height(),a.$el.height(a.height))))}this._pages[0].find("td.equation span").mathquill();
this._items=ArrayUtil.sortOn(this._items,"y");!0!=this._autosize&&!0==this._breakPage?this.doBreakPage(this._items):this.doFitPage(this._items);this._report.invalidateSize(!0)}};this.getPage=function(a){var b=this._pages[a];if(!js.isNull(b))return b;for(var c=this._pages.length;c<=a;c++)this._$content.append(l('\x3cdiv class\x3d"qs-break-page" /\x3e')),b=l('\x3cdiv class\x3d"qs-report-page" /\x3e'),!0!=this._autosize&&this.setPageSize(b,this._pageWidth,this._pageHeight,this._lenUnit),this._$content.append(b),
this._pages[c]=b;return this._pages[a]};this.getTableHtml=function(a,b,c,d,e){e=js.param(e,!0);var f=[];if(e||0==c){f.push("\x3ctable ");for(var k=0;k<b.attributes.length;k++)f.push(b.attributes[k].nodeName),f.push('\x3d"'),f.push(b.attributes[k].nodeValue),f.push('" ');f.push("\x3e")}for(var m=[],k=c;k<=d;k++){hasRowSpan=!1;for(var l=m.length=0,p,q=0;q<a.colCount();q++)p=a.rows[k][q],p.colIndex()==q&&(p.rowIndex()<c?k==c&&(m.push('\x3ctd colSpan\x3d"'),m.push(p.colSpan()),m.push('" rowSpan\x3d"'),
m.push(p.rowSpan()-(c-p.rowIndex())),m.push('" style\x3d"'),m.push(p.getHtmlStyle()),m.push('" \x3e'),m.push(p.text()),m.push("\x3c/td\x3e")):(b.rows[k].cells.length>l&&m.push(b.rows[k].cells[l].outerHTML),l++));f.push("\x3ctr ");for(q=0;q<b.rows[k].attributes.length;q++)f.push(b.rows[k].attributes[q].nodeName),f.push('\x3d"'),f.push(b.rows[k].attributes[q].nodeValue),f.push('" ');f.push("\x3e");f.push(m.join(""));f.push("\x3c/tr\x3e")}(e||d==b.rows.length-1)&&f.push("\x3c/table\x3e");return f.join("")};
this.findTableRow=function(a,b,c){for(var d=0,e=a.rows.length;c<e;c++)if(d+=a.rows[c].offsetHeight,d>b)return 0==c?0:c-1;return-1};this.fixTableTopBorder=function(a){if(!js.isNull(a)){a=a.rows[0];for(var b=0;b<a.cells.length;b++)a.cells[b].style.borderWidth=0==b?"1px 1px 1px 1px":"1px 1px 1px 0px"}};this.doFitPage=function(a){for(var b,c,d,e=0,f=0,k=0;k<a.length;k++)if(b=a[k],"table"==b.type){c=b.y;c+=b.height;table=b.$el.children("table")[0];d=table.offsetHeight-b.height;if(0<d)for(var m,l=k+1;l<
a.length;l++)m=a[l],m.y>c&&!0!=m.fixedY&&(m.y+=d);e=Math.max(b.x+table.offsetWidth,e);f=Math.max(b.y+table.offsetHeight,f)}else b.$el.css("top",b.y),e=Math.max(b.x+b.$el.width(),e),f=Math.max(b.y+b.$el.height(),f);if(this._autosize){a=parseInt(this._documentXml.attr("paddingRight"));if(isNaN(a)||10>a)a=30;b=parseInt(this._documentXml.attr("paddingBottom"));if(isNaN(b)||10>b)b=50;f+=b;this._pages[0].width(e+a);this._pages[0].height(f)}};this.doBreakPage=function(a){var b,c,d;b=parseInt(this._documentXml.attr("height"));
if(isNaN(b)||300>b)b=1132;c=parseInt(this._documentXml.attr("paddingTop"));if(isNaN(c)||10>c)c=50;d=parseInt(this._documentXml.attr("paddingBottom"));if(isNaN(d)||10>d)d=50;d=b-c-d;var e,f,k,m,n,p,q,s;for(b=0;b<a.length;b++)if(q=a[b],q.$el.css("top",q.y),"table"==q.type){k=q.$el.children("table")[0];var r=0;q.fixedY&&(r=f-e*d);f=q.y;n=f+q.height;e=Math.floor((f-c)/d);0>e&&(e=0);s=this.getPage(e);q.pageNo=e;q.$page=s;m=!1;e<Math.floor((f+k.offsetHeight-c)/d)&&(m=!0);!m&&0<e&&(q.$el.remove(),s.append(q.$el),
q.y=f-e*d,q.$el.css("top",q.y));if(m){m=q.height;p=0;childTables=[];p=k.rows.length;var t=0,v,z=v=0,A=0,B=0,y,u="",D="";if(q.xml.has("headRow")){v=parseInt(q.xml.attr("headRow"));isNaN(v)&&(v=0);for(s=0;s<v;s++)A+=k.rows[s].offsetHeight;0<v&&(u=this.getTableHtml(q.table,k,0,v-1,!1))}if(q.xml.has("tailRow")){z=parseInt(q.xml.attr("tailRow"));isNaN(z)&&(z=0);for(s=0;s<z;s++)B+=k.rows[p-s-1].offsetHeight;0<z&&(D=this.getTableHtml(q.table,k,p-z,p-1,!1))}for(;t<p;)if(s=this.getPage(e),v=0==e?d-B+c-f:0==
t?d-B+c+e*d-f:q.fixedY?d-A-B-r+c:d-A-B,v=this.findTableRow(k,v,t),-1==v||v>=p-z){q.$el.remove();if(0==t)0<e&&(s.append(q.$el),q.y=f-e*d,q.$el.css("top",q.y));else{y=this.getTableHtml(q.table,k,t,p-1,!1);0<t&&(y=""!=u?u+y:"\x3ctable\x3e"+y);var C=l('\x3cdiv class\x3d"qs-report-item qs-report-table" /\x3e');C.html(y);C.css("left",q.x);q.fixedY?C.css("top",r):C.css("top",c);s.append(C);""==u&&this.fixTableTopBorder(C.children("table")[0]);childTables.push({$table:C,y:c,height:C.height()})}break}else y=
this.getTableHtml(q.table,k,t,v,!1),0==t?y=""!=D?y+D:y+"\x3c/table\x3e":(0<t&&(y=""!=u?u+y:"\x3ctable\x3e"+y),v<p-1&&(y=""!=D?y+D:y+"\x3c/table\x3e")),C=l('\x3cdiv class\x3d"qs-report-item qs-report-table" /\x3e'),C.html(y),C.css("left",q.x),y={$table:C},0==t?(C.css("top",f-e*d),y.y=f-e*d):(C.css("top",c),y.y=c),s.append(C),""==u&&this.fixTableTopBorder(C.children("table")[0]),y.height=C.height(),childTables.push(y),e++,t=v+1;if(1>=childTables.length)continue;k=0;1<childTables.length&&(k+=d+c-childTables[0].y);
for(s=1;s<childTables.length-1;s++)k+=d;k+=childTables[childTables.length-1].height;p=k-m}else p=k.offsetHeight-q.height;if(0<p)for(s=b+1;s<a.length;s++)k=a[s],k.y>n&&!0!=k.fixedY&&(k.y+=p)}else f=q.y,e=Math.floor((f-c)/d),0>e&&(e=0),s=this.getPage(e),q.pageNo=e,q.$page=s,0<e&&(q.$el.remove(),s.append(q.$el),q.y=f-e*d,q.$el.css("top",q.y));c=this._pages.length;for(b=0;b<this._pages.length;b++){e=this._pages[b].find("span.qs-report-val");for(s=0;s<e.length;s++)f=l(e[s]),f.hasClass("page-num")?f.html(b+
1):f.hasClass("page-count")&&f.html(c);!0==this._showPageNo&&(e='\x3cdiv class\x3d"qs-report-pageno"\x3e'+(b+1)+"/"+c+"\x3c/div\x3e",this._pages[b].append(e))}for(b=0;b<a.length;b++)q=a[b],this._editable&&(q.$el.attr("contenteditable",!0),q.$el.bind("mousedown",function(a){!0!=a.ctrlKey&&(a.stopImmediatePropagation(),a.stopPropagation())}),q.$el.draggable({start:function(a,b){if(!0!=a.ctrlKey)return!1;b.helper.addClass("qs-report-dragging")},stop:function(a,b){b.helper.removeClass("qs-report-dragging")}}),
"table"==q.type&&q.$el.find("table").tabeResize({moveable:!1}))}})})(qs,jQuery);
(function(f,l){js.$class("qs.ext.TableEditor",f.ui.Control,function(){this.$table=null;this.initialize=function(a,b){b=l.extend({moveable:!0},b);this.$super(b);this.$table=a;a.addClass("qs-editing-table");this.bindEvent("mousedown",this.onMouseDown,a);this.bindEvent("mousemove",this.onMouseMove,a);this.bindEvent("mouseup",this.onMouseUp,a);this.bindEvent("mouseleave",this.onMouseLeave,a);this._detect=null;this.initTable()};this.initTable=function(){for(var a,b,c=0;c<this.$table[0].rows.length;c++){a=
this.$table[0].rows[c];$row=l(a);$row.attr("height",$row.height());$row.css("height","");for(var d=0;d<a.cells.length;d++)b=a.cells[d],b=l(b),b.attr("width",b.width()),b.css("width","")}this.$table.removeAttr("width");this.$table.css("width","")};this.move=function(a,b){this._detect.pos||(this._detect.pos=this.$table.position());this.$table.css({left:this._detect.pos.left+a-this._detect.x,top:this._detect.pos.top+b-this._detect.y})};this.colResize=function(a,b){this._detect.width||(this._detect.width=
parseInt(this._detect.$col.attr("width")));var c=a-this._detect.x,c=Math.max(5,this._detect.width+c),d=parseInt(this._detect.$col.attr("width")),c=c-d;if(0!=c){var e=this._detect.$col.position();e.width=d;for(var f,k,m,n=0;n<this.$table[0].rows.length;n++){f=this.$table[0].rows[n];for(var p=0;p<f.cells.length;p++)k=f.cells[p],m=l(k),k=m.position(),k.width=parseInt(m.attr("width")),k.left<=e.left&&k.width+k.left>=e.left+e.width&&m.attr("width",d+c)}}};this.rowResize=function(a,b){this._detect.height||
(this._detect.height=this._detect.$row.outerHeight());var c=b-this._detect.y,c=Math.max(5,this._detect.height+c),d=this._detect.$row.outerHeight(),c=c-d;0!=c&&this._detect.$row.attr("height",d+c)};this.onMouseDown=function(a){var b=this.detect(a.pageX,a.pageY);"none"!=b.action&&(b.x=a.pageX,b.y=a.pageY,this._detect=b,this.setCapture(this.$table))};this.onMouseMove=function(a){if(null!=this._detect)return"col-resize"==this._detect.action?this.colResize(a.pageX,a.pageY):"row-resize"==this._detect.action?
this.rowResize(a.pageX,a.pageY):"move"==this._detect.action&&this.move(a.pageX,a.pageY),!1;a=this.detect(a.pageX,a.pageY);"col-resize"==a.action?this.$table.css("cursor","col-resize"):"row-resize"==a.action?this.$table.css("cursor","row-resize"):"move"==a.action?this.$table.css("cursor","move"):this.$table.css("cursor","")};this.onMouseUp=function(a){this._detect=null;this.releaseCapture(this.$table)};this.onMouseLeave=function(a){this.$table.css("cursor","")};this.detect=function(a,b){var c={action:"none"},
d,e,f,k,m;if(!0==this.options().moveable&&"absolute"==this.$table.css("position")&&(d=this.$table.offset(),b<=d.top+3||a<=d.left+3))return c.action="move",c;for(var n=0;n<this.$table[0].rows.length;n++){e=l(this.$table[0].rows[n]);d=e.offset();m=e.outerHeight();for(var p=0;p<e[0].cells.length;p++)if(f=l(e[0].cells[p]),d=f.offset(),k=f.outerWidth(),a>=d.left+k-3&&a<=d.left+k+3)return c.$row=e,c.rowIndex=n,c.$col=f,c.colIndex=p,c.action="col-resize",c;if(b>=d.top+m-3&&b<=d.top+m+3){c.$row=e;c.rowIndex=
n;c.action="row-resize";break}}return c}});l.fn.tabeResize=function(a){return this.each(function(){var b=l(this);b.is("table")&&new f.ext.TableEditor(b,a)})}})(qs,jQuery);(function(f,l){js.$class("qs.app.report.ReportDocumentService",f.events.EventDispatcher,function(){this.reportControl=null;js.$static._instance=null;this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$static.instance=function(){null==f.app.report.ReportDocumentService._instance&&(f.app.report.ReportDocumentService._instance=new f.app.report.ReportDocumentService);return f.app.report.ReportDocumentService._instance};js.$public.update=
function(a,b,c,d,e){var f=wos.MD5(d),k=new wos.events.AsyncOption("updateReport");k.showWaitingBox=!1;var m={};m.id=a;m.name=c;m.report_uid=b;m.condition_md5=f;m.content_xml=this.getContentXml(b,c,d,e).toString();wos.Remoting.call("DynamicEntityService.modifyEntity",["ReportFile",m,null],this,k)};js.$public.create=function(a,b,c,d){var e=wos.MD5(c),f=new wos.events.AsyncOption("createReport");f.showWaitingBox=!1;var k={};k.name=b;k.report_uid=a;k.condition_md5=e;k.content_xml=this.getContentXml(a,
b,c,d).toString();wos.Remoting.call("DynamicEntityService.createEntity",["ReportFile",k,null],this,f)};js.$public.save=function(a,b,c,d){var e=wos.MD5(c),f={};f.uid=a;f.md5=e;f.name=b;f.queryCondition=c;f.reportHtml=d;b=new wos.events.AsyncOption("FindReport",f);b.showWaitingBox=!1;wos.Remoting.call("QueryService.executeSQLQuery",[null,"select id from DYNA_ReportFile where report_uid\x3d'"+a+"' and condition_md5\x3d'"+e+"'",0,1],this,b)};js.$public.remove=function(a){var b=new wos.events.AsyncOption("DynamicEntityService.removeEntity");
b.showWaitingBox=!1;wos.Remoting.call("DynamicEntityService.removeEntity",[a,"ReportFile",null],this,b)};this.getContentXml=function(a,b,c,d){var e=new f.Xml(StringUtil.join('\x3cReport Name\x3d"" Uid\x3d""\x3e',"\x3cCondition\x3e\x3c/Condition\x3e","\x3cDataSource\x3e",'\x3cData Name\x3d"" Uid\x3d""\x3e\x3c/Data\x3e',"\x3c/DataSource\x3e","\x3cContent\x3e","\x3c/Content\x3e","\x3c/Report\x3e"));e.attr("Name",b);e.attr("Uid",a);e.children("Condition")[0].text(c);e.children("Content")[0].text(d);return e};
this.onRemotingCallback=function(a){var b=null,c=null,d=null,e=null,g=null;switch(a.option.asyncName){case "FindReport":var k=!1;"array"==js.type(a.result)&&0==a.result.length&&(k=!0);var m=null,g=a.option.asyncData,b=g.uid,c=g.name,e=g.md5,d=g.queryCondition,g=g.reportHtml,l=null;k?(m=new wos.events.AsyncOption("DynamicEntityService.createEntity"),m.showWaitingBox=!1,l={},l.name=c,l.report_uid=b,l.condition_md5=e,l.content_xml=this.getContentXml(b,c,d,g).toString(),wos.Remoting.call("DynamicEntityService.createEntity",
["ReportFile",l,null],this,m)):(m=new wos.events.AsyncOption("DynamicEntityService.modifyEntity"),m.showWaitingBox=!1,l={},l.id=a.result[0],l.name=c,l.content_xml=this.getContentXml(b,c,d,g).toString(),wos.Remoting.call("DynamicEntityService.modifyEntity",["ReportFile",l,null],this,m));break;case "updateReport":case "createReport":null!=this.reportControl&&(this.reportControl.savedReport=a.result),f.ui.MessageBox.show("\u62a5\u8868\u4fdd\u5b58\u6210\u529f.","\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Info)}}})})(qs,
jQuery);(function(f,l){function a(a){var b=parseInt(a.attr("width"));0<=b&&a.attr("width",b);b=parseInt(a.attr("height"));0<=b&&a.attr("height",b);b=parseInt(a.css("width"));0<b&&a.css("width",b*c+"pt");b=parseInt(a.css("height"));0<b&&a.css("height",0.72*b+"pt")}function b(b,f){var m=b.children(".qs-report-item");m.sort(function(a,b){var c=parseInt(l(a).css("top")),d=parseInt(l(b).css("top"));return c>d?1:c<d?-1:0});m.each(function(){var b=l(this);if(b.is(".qs-report-table")){var g=parseInt(b.css("left"))+
d,m=parseInt(b.css("top"))+e,s=b.width(),r=b.height(),t=l(b.children("table")[0]).clone();t.attr({border:1,cellspacing:0,cellpadding:0});t.attr("style",StringUtil.join("border-collapse : collapse;","border : none;","mso-border-alt : solid windowtext .5pt;","mso-table-anchor-vertical : page;","mso-table-anchor-horizontal : page;","mso-table-top : ",m*c,"pt;","mso-table-left: ",g*c,"pt;","mso-position-horizontal-relative : page;","mso-position-vertical   : absolute;","mso-position-horizontal : absolute;",
"mso-position-vertical-relative : page;","position : absolute;","left : ",g,"px;","top  : ",m,"px;","width: ",s*c,"pt;","height:",r*c,"pt;"));t.find("tr").each(function(){a(l(this))});t.find("td").each(function(){var b=l(this),c=b.border(),d={};d["border-top"]=0==c.top?"none":"solid windowtext "+0.5*c.top+"pt";d["border-left"]=0==c.left?"none":"solid windowtext "+0.5*c.left+"pt";d["border-right"]=0==c.right?"none":"solid windowtext "+0.5*c.right+"pt";d["border-bottom"]=0==c.bottom?"none":"solid windowtext "+
0.5*c.bottom+"pt";b.css(d);a(b)})}else g=parseInt(b.css("left"))+d,m=parseInt(b.css("top"))+e,t=l("\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),t.find("tr td").append(b.clone()),t.attr({border:0,cellspacing:0,cellpadding:0}),t.attr("style",StringUtil.join("border-collapse : collapse;","border : none;","mso-border-alt : solid windowtext .5pt;","mso-table-anchor-vertical : page;","mso-table-anchor-horizontal : page;","mso-table-top : ",m*c,"pt;","mso-table-left: ",g*c,"pt;",
"mso-position-horizontal-relative : page;","mso-position-vertical   : absolute;","mso-position-horizontal : absolute;","mso-position-vertical-relative : page;","position : absolute;","left : ",g,"px;","top  : ",m,"px;"));t.find(".mathquill-rendered-math .selectable").remove();f.append(t)});b.children(".qs-report-pageno").each(function(){var a=l(this),b=a.position(),g=b.left+d,b=b.top+e,m=l("\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");m.find("tr td").append(a.clone());m.attr({border:0,
cellspacing:0,cellpadding:0});m.attr("style",StringUtil.join("border-collapse : collapse;","border : none;","mso-table-anchor-vertical : page;","mso-table-anchor-horizontal : page;","mso-table-top : ",b*c,"pt;","mso-table-left: ",g*c,"pt;","mso-position-horizontal-relative : page;","mso-position-vertical   : absolute;","mso-position-horizontal : absolute;","mso-position-vertical-relative : page;","position : absolute;","top : ",b,"px;","left: ",g,"px;"));f.append(m)})}var c=0.748,d=0,e=0;js.$class("qs.app.ReportExporter",
function(){this.initialize=function(){};js.$static.exportExcel=function(a){a=a[0].innerHTML;a=l("\x3cdiv\x3e"+a+"\x3c/div\x3e");a.find(".mathquill-rendered-math .selectable").remove();a.find(".qs-report-pageno").empty();a=a.html();a=a.replace(/(&nbsp;){2,100000}/g,function(a){return a.substr(0,6*Math.floor(a.length/6/2))});a=function(a,b){return a.replace(/{(\w+)}/g,function(a,c){return b[c]})}('\x3chtml xmlns:o\x3d"urn:schemas-microsoft-com:office:office" xmlns:x\x3d"urn:schemas-microsoft-com:office:excel" xmlns\x3d"http://www.w3.org/TR/REC-html40"\x3e\x3chead\x3e\x3cmeta charset\x3d"utf-8"\x3e\x3c!--[if gte mso 9]\x3e\x3cxml\x3e\x3cx:ExcelWorkbook\x3e\x3cx:ExcelWorksheets\x3e\x3cx:ExcelWorksheet\x3e\x3cx:Name\x3e{worksheet}\x3c/x:Name\x3e\x3cx:WorksheetOptions\x3e\x3cx:DisplayGridlines/\x3e\x3c/x:WorksheetOptions\x3e\x3c/x:ExcelWorksheet\x3e\x3c/x:ExcelWorksheets\x3e\x3c/x:ExcelWorkbook\x3e\x3c/xml\x3e\x3c![endif]--\x3e\x3c/head\x3e\x3cbody\x3e\x3ctable\x3e{table}\x3c/table\x3e\x3c/body\x3e\x3c/html\x3e',
{worksheet:"Worksheet",table:a});var b=wos.Desktop.getAbsoluteUrl("/pages/core/post_export.jsp");l("body").append('\x3cform id\x3d"export_report_form" action\x3d"'+b+'" method\x3d"post" target\x3d"_blank"\x3e\x3cinput type\x3d"hidden" id\x3d"export_report_data" name\x3d"data" /\x3e\x3c/form\x3e');l("#export_report_data").val(a);l("#export_report_form").submit().remove()};js.$static.exportWord=function(d){var e=l("\x3cdiv\x3e\x3c/div\x3e"),f=0,n=0;d.children(".qs-report-page").each(function(){var a=
l(this);if(0==f||0==n){var d=parseInt(a.width());0<d&&(f=d*c);d=parseInt(a.height());0<d&&(n=d*c)}e.append("\x3cp class\x3dMsoNormal\x3e\x3cspan lang\x3dEN-US\x3e\x3co:p\x3e\x26nbsp;\x3c/o:p\x3e\x3c/p\x3e");d=l("\x3cp class\x3dMsoNormal\x3e\x3c/p\x3e");e.append(d);for(var g=0;53>g;g++)e.append("\x3cp class\x3dMsoNormal\x3e\x3cspan lang\x3dEN-US\x3e\x3co:p\x3e\x26nbsp;\x3c/o:p\x3e\x3c/p\x3e");b(a,d)});e.find("img").each(function(){a(l(this))});d='\x3cdiv class\x3d"WordSection" style\x3d"layout-grid:15.6pt"\x3e'+
e.html()+"\x3c/div\x3e";e.remove();d=d.replace(/(&nbsp;){2,100000}/g,function(a){return a.substr(0,6*Math.floor(a.length/6/2))});0==f&&(f=595.3);0==n&&(n=841.9);var p=wos.Desktop.getAbsoluteUrl("/pages/core/post_export.jsp"),p=StringUtil.join('\x3cform id\x3d"export_report_form" action\x3d"',p,'" method\x3d"post" target\x3d"_blank"\x3e','\x3cinput type\x3d"hidden" id\x3d"export_report_data" name\x3d"data" /\x3e','\x3cinput type\x3d"hidden" name\x3d"file" value\x3d"report.doc"/\x3e','\x3cinput type\x3d"hidden" name\x3d"pageWidth" value\x3d"',
f,'"/\x3e','\x3cinput type\x3d"hidden" name\x3d"pageHeight" value\x3d"',n,'"/\x3e',"\x3c/form\x3e");l("body").append(p);l("#export_report_data").val(d);l("#export_report_form").submit().remove()}})})(qs,jQuery);(function(f,l){function a(a,c,d,e,f){a=15*f.level()+"px";return StringUtil.join('\x3cspan class\x3d"qs-data-group-toggle ',f.isExpanded()?"expanded":"collapsed",'" ','style\x3d"margin-left:',a,'"\x3e',"\x3c/span\x3e",'\x3cspan class\x3d"qs-data-group-title"','level\x3d"',f.level(),'"\x3e',f.$group_label||"","\x26nbsp;",'\x3cspan class\x3d"qs-data-group-count"\x3e',"("+f.childrenCount()+")","\x3c/span\x3e","\x26nbsp;",f.$html_status||"","\x3c/span\x3e")}js.$class("qs.app.data.DataView",f.events.EventDispatcher,
function(){js.$static.REQUEST_PAGE_EVENT="RequestPage";js.$static.ROW_COUNT_CHANGED_EVENT="RowCountChanged";js.$static.ROWS_CHANGED_EVENT="RowsChanged";this._count=0;this._idKeys=[];this._pageSize=100;this._pageTimeout=1E4;this._pages=[];this._loadingPages=[];this._groups=[];this.initialize=function(a,c,d){this.$super();c=js.param(c,100);d=js.param(d,1E4);this._idKeys=a;this._pageSize=c;this._pageTimeout=d};js.$public.isItemEquals=function(a,c){if(null==this._idKeys||0==this._idKeys.Length)return js.equals(a,
c);if(!(null!=a&&void 0!=a||null!=c&&void 0!=c))return!0;if(null==a||void 0==a||null==c||void 0==c)return!1;for(var d in this._idKeys)if(a[d]!=c[d])return!1;return!0};js.$public.pageSize=function(){return this._pageSize};js.$public.pageTimeout=function(){return this._pageTimeout};js.$public.count=function(a,c){if(void 0===a)return-1==this._count?0:this._count;c=js.param(c,!0);var d={};d.oldValue=this._count;d.newValue=a;var e=parseInt(a);this._count=0<=e?e:0;!0==c&&this.clear();this.dispatchEvent(f.app.data.DataView.ROW_COUNT_CHANGED_EVENT,
d)};js.$public.getLength=function(){return-1==this._count?0:this._count};js.$public.getItem=function(a){if(0>a||a>=this._count)return{};if(this.isGrouping()){for(var c=0,d,e=0;e<this._groups.length;e++){d=this._groups[e];if(a==c)return d;if(d.isExpanded()){if(a<=c+d.childrenCount())return d.getChildAt(a-c-1);c+=d.childrenCount()+1}else c+=1}return{}}c=this.loadPage(a);a-=c.itemsStart;a>this._pageSize/2&&c.DB_Start+c.DB_Count<this.count()&&this.requestNextPage(c);a<this._pageSize/2&&0<c.DB_Start&&
this.requestPrevPage(c);this.cleanUpPages();js.isNull(c.items)&&this.putEmptyItems(c);return 0>a||a>=c.items.length?{}:c.items[a]};js.$public.getItemMetadata=function(b){b=this.getItem(b);return js.instanceOf(b,f.app.data.GroupData)?{selectable:!1,focusable:!0,cssClasses:"qs-data-group",columns:{0:{colspan:"*",formatter:a,editor:null}}}:null};this.putEmptyItems=function(a){a.items=[];for(var c=0;c<a.itemsCount;c++)a.items[c]={}};js.$public.add=function(a){this.insert(0,a)};js.$public.contains=function(a){if(this.isGrouping()){if(js.instanceOf(a,
f.app.data.GroupData))return-1!=this._groups.indexOf(a);for(var c=0;c<this._groups.length;c++)if(this._groups[c].containsChildren(a))return!0}else for(var d,c=0;c<this._pages.length;c++)if(d=this._pages[c],!js.isNull(d.items)&&-1!=d.items.indexOf(a))return!0;return!1};js.$public.clear=function(){for(var a,c=0;c<this._pages.length;c++)a=this._pages[c],a.nextPage=null,a.prevPage=null,js.isNull(a.items)||(a.items.length=0);js.isNull(this._groups)||(this._groups.length=0);this._groups=null;this._pages.length=
0;this._loadingPages.length=0};js.$public.indexOf=function(a){if(this.isGrouping())for(var c=0,d,e,f=0;f<this._groups.length;f++){e=this._groups[f];if(a==e)return c;if(e.isExpanded()){d=e.indexOfChildren(a);if(-1!=d)return c+d+1;c+=e.childrenCount()+1}else c+=1}else for(f=0;f<this._pages.length;f++)if(c=this._pages[f],!js.isNull(c.items)&&(d=c.items.indexOf(a),-1!=d))return c.itemsStart+d;return-1};js.$public.insert=function(a,c){if(this.isGrouping())for(var d=0,e,g=0;g<this._groups.length;g++){e=
this._groups[g];if(a==d){js.instanceOf(c,f.app.data.GroupData)?this.insertGroup(this._groups.indexOf(e),c):this.insertGroupChild(e,0,c);break}if(e.isExpanded()){if(a<=d+e.childrenCount()){this.insertGroupChild(e,a-d-1,c);break}d+=e.childrenCount()+1}else d+=1}else{d=this.loadPage(a);if(js.isNull(d.items))this.putEmptyItems(d),a-d.itemsStart<d.items.length?d.items[a-d.itemsStart]=c:(d.items.push(c),d.DB_Count++,d.itemsCount++);else for(d.items.splice(a-d.ItemsStart,0,c),d.itemsCount++,g=this._pages.indexOf(d)+
1;g<this._pages.length;g++)this._pages[g].itemsStart++;this.count(this._count+1,!1)}};js.$public.removeAt=function(a){if(this.isGrouping())for(var c=0,d,e=0;e<this._groups.length;e++){d=this._groups[e];if(a==c){this.removeGroup(d);break}if(d.isExpanded()){if(a<=c+d.childrenCount()){this.removeGroupChild(d,a-c-1);break}c+=d.childrenCount()+1}else c+=1}else if(c=this.loadPage(a),!js.isNull(c.items)){c.items.splice(a-c.itemsStart,1);c.itemsCount--;for(e=this._pages.indexOf(c)+1;e<this._pages.length;e++)this._pages[e].itemsStart--;
this.count(this._count-1,!1)}};js.$public.remove=function(a){if(this.isGrouping()){for(var c,d=0;d<this._groups.length;d++)if(c=this._groups[d],c.containsChildren(a)&&c.removeChild(a))return c.isExpanded()&&this.count(this._count-1,!1),!0;return!1}a=this.indexOf(a);if(-1==a)return!1;this.removeAt(a);return!0};js.$public.cleanUpPages=function(){for(var a,c=this._loadingPages.length-1;0<=c;c--)a=this._loadingPages[c],0<a.loadTime&&(new Date).getTime()-a.loadTime>this._pageTimeout&&(a=this._pages.indexOf(a),
-1!=a&&this._pages.splice(a,1),this._loadingPages.splice(c,1))};js.$public.findItems=function(a,c){var d=[];if(this.isGrouping())for(var e,f=0;f<this._groups.length;f++)e=this._groups[f],e.findChildren(a,c,d);else for(var k,f=0;f<this._pages.length;f++)if(k=this._pages[f],!js.isNull(k.items))for(var m,l=0;l<k.items.length;l++)m=k.items[l],e=m[a],c==e&&d.push(m);return d};js.$public.findItemIndexes=function(a,c){var d=[];if(this.isGrouping())for(var e=0,f,k=0;k<this._groups.length;k++)f=this._groups[k],
f.isExpanded()?(f.findChildrenIndexes(a,c,d,e+1),e+=f.childrenCount()+1):e+=1;else for(var m,k=0;k<this._pages.length;k++)if(e=this._pages[k],!js.isNull(e.items))for(f=0;f<e.items.length;f++)m=e.items[f],m=m[a],js.isNull(c),c==m&&d.push(e.itemsStart+f);return d};this.loadPage=function(a){for(var c=Math.floor(a/this._pageSize),d,e=null,g=this._pages.length-1;0<=g;g--){d=this._pages[g];if(d.itemsStart<=a&&d.itemsStart+d.itemsCount>a)return d;if(d.itemsStart+d.itemsCount<=a)return a={},a.itemsStart=
c*this._pageSize,a.itemsCount=this._pageSize,a.DB_Start=a.itemsStart,a.DB_Count=this._pageSize,a.loadTime=(new Date).getTime(),a.itemsStart-(d.itemsStart+d.itemsCount)<this._pageSize/3&&(d.nextPage=a,a.prevPage=d),!js.isNull(e)&&e.itemsStart-(a.itemsStart+a.itemsCount)<this._pageSize/3&&(a.nextPage=e,e.prevPage=a),js.isNull(a.prevPage)||(a.itemsStart=a.prevPage.itemsStart+a.prevPage.itemsCount,a.DB_Start=a.prevPage.DB_Start+a.prevPage.DB_Count),js.isNull(a.nextPage)||(a.itemsCount=a.nextPage.itemsStart-
a.itemsStart,a.DB_Count=a.nextPage.DB_Start-a.DB_Start),this._pages.splice(g+1,0,a),a.itemsStart+a.itemsCount>this.count()&&(a.itemsCount=this.count()-a.itemsStart,a.DB_Count=this.count()-a.DB_Start),0<a.DB_Count&&(c={},c.DB_Start=a.DB_Start,c.DB_Count=a.DB_Count,this.dispatchEvent(f.app.data.DataView.REQUEST_PAGE_EVENT,c)),a;e=d}d={};d.itemsStart=c*this._pageSize;d.itemsCount=this._pageSize;d.DB_Start=d.itemsStart;d.DB_Count=this._pageSize;d.loadTime=(new Date).getTime();0<this._pages.length&&(e=
this._pages[0],!js.isNull(e)&&e.itemsStart-(d.itemsStart+d.itemsCount)<this._pageSize/3&&(d.nextPage=e,e.prevPage=d,d.itemsCount=e.itemsStart-d.itemsStart,d.DB_Count=e.DB_Start-d.DB_Start));this._pages.splice(0,0,d);d.itemsStart+d.itemsCount>this.count()&&(d.itemsCount=this.count()-d.itemsStart,d.DB_Count=this.count()-d.DB_Start);0<d.DB_Count&&(c={},c.DB_Start=d.DB_Start,c.DB_Count=d.DB_Count,this.dispatchEvent(f.app.data.DataView.REQUEST_PAGE_EVENT,c));return d};this.requestNextPage=function(a){if(js.isNull(a.nextPage)){var c=
{};c.itemsStart=a.itemsStart+a.itemsCount;c.itemsCount=this._pageSize;c.DB_Start=a.DB_Start+a.DB_Count;c.DB_Count=this._pageSize;c.loadTime=(new Date).getTime();var d=this._pages.indexOf(a);if(d>=this._pages.length-1)c.itemsStart+c.itemsCount>this.count()&&(c.itemsCount=this.count()-c.itemsStart,c.DB_Count=this.count()-c.DB_Start);else{var e=this._pages[d+1];e.itemsStart-(c.itemsStart+c.itemsCount)<this._pageSize/3&&(c.nextPage=e,e.prevPage=c,c.itemsCount=e.itemsStart-c.itemsStart,c.DB_Count=e.DB_Start-
c.DB_Start)}this._pages.splice(d+1,0,c);a.nextPage=c;c.prevPage=a;0<c.DB_Count&&(a={},a.DB_Start=c.DB_Start,a.DB_Count=c.DB_Count,this.dispatchEvent(f.app.data.DataView.REQUEST_PAGE_EVENT,a))}};this.requestPrevPage=function(a){if(js.isNull(a.prevPage)){var c={};c.itemsStart=a.itemsStart-this._pageSize;c.itemsCount=this._pageSize;c.DB_Start=a.DB_Start-this._pageSize;c.DB_Count=this._pageSize;c.loadTime=(new Date).getTime();var d=this._pages.indexOf(a);if(0==d)0>c.itemsStart&&(c.itemsStart=0,c.itemsCount=
a.itemsStart,c.DB_Start=0,c.DB_Count=a.DB_Start);else{var e=this._pages[d-1];c.itemsStart-(e.itemsStart+e.itemsCount)<this._pageSize/3&&(e.nextPage=c,c.prevPage=e,c.itemsStart=e.itemsStart+e.itemsCount,c.DB_Start=e.DB_Start+e.DB_Count)}this._pages.splice(d,0,c);a.prevPage=c;c.nextPage=a;0<c.DB_Count&&(a={},a.DB_Start=c.DB_Start,a.DB_Count=c.DB_Count,this.dispatchEvent(f.app.data.DataView.REQUEST_PAGE_EVENT,a))}};js.$public.putItems=function(a,c,d){if(this.isGrouping()){if(!js.isNull(d)){d.putChildren(a,
c);var e={beginRow:0,endRow:-1};this.dispatchEvent(f.app.data.DataView.ROWS_CHANGED_EVENT,e)}}else for(e=this._pages.length-1;0<=e;e--)if(d=this._pages[e],d.DB_Start==a){if(js.isNull(d.items)||d.items.length<c.length)d.items=c;else for(e=0;e<c.length;e++)js.copy(c[e],d.items[e]);e={};e.beginRow=a;e.endRow=a+c.length;this.dispatchEvent(f.app.data.DataView.ROWS_CHANGED_EVENT,e);a=this._loadingPages.indexOf(d);-1!=a&&this._loadingPages.splice(a,1);break}};js.$public.isGrouping=function(){return!js.isNull(this._groups)&&
0<this._groups.length?!0:!1};js.$public.groups=function(a){if(void 0===a)return this._groups;this.clear();if("array"!=js.type(a))this.count(0);else{for(var c=0,d,e=0;e<a.length;e++)d=a[e],c=d.isExpanded()?c+(d.childrenCount()+1):c+1;this.count(c);this._groups=a;this.dispatchEvent(f.app.data.DataView.ROWS_CHANGED_EVENT,{beginRow:0,endRow:-1})}};js.$public.insertGroup=function(a,c){0<=a&&a<=this._groups.length&&(this._groups.splice(a,0,c),c.isExpanded()?this.count(this._count+c.childrenCount()+1,!1):
this.count(this._count+1,!1))};js.$public.removeGroup=function(a){var c=this._groups.indexOf(a);-1!=c&&(this._groups.splice(c,1),a.isExpanded()?this.count(this._count-(a.childrenCount()+1),!1):this.count(this._count-1,!1))};js.$public.getGroupAt=function(a){return 0<=a&&a<this._groups.length?this._groups[a]:null};js.$public.findGroups=function(a,c){var d=[];if(this.isGrouping())for(var e,f,k=0;k<this._groups.length;k++)f=this._groups[k],e=f[a],c==e&&d.push(f);return d};js.$public.insertGroupChild=
function(a,c,d){a.insertChild(c,d);a.isExpanded()&&this.count(this._count+1,!1);c=this.indexOf(a);this.updateRows(c,c)};js.$public.removeGroupChild=function(a,c){a.removeChildAt(c);a.isExpanded()&&this.count(this._count-1,!1);c=this.indexOf(a);this.updateRows(c,c)};js.$public.expandGroup=function(a){this.count(this._count+a.childrenCount(),!1);this.updateRows(0,this.count()-1)};js.$public.closeGroup=function(a){this.count(this._count-a.childrenCount(),!1);this.updateRows(0,this.count()-1)};js.$public.updateRows=
function(a,c){a=js.param(a,0);c=js.param(c,-1);var d={};d.beginRow=a;d.endRow=c;this.dispatchEvent(f.app.data.DataView.ROWS_CHANGED_EVENT,d)};js.$public.requestChildrenPage=function(a,c,d){if(0<d){var e={};e.DB_Start=c;e.DB_Count=d;e.group=a;this.dispatchEvent(f.app.data.DataView.REQUEST_PAGE_EVENT,e)}};js.$protected.onGroupClick=function(a,c){var d=l(a.target),e=c.group;d.hasClass("qs-data-group-toggle")&&e.isExpanded(!e.isExpanded())}})})(qs,jQuery);(function(f,l){js.$interface("qs.app.data.IGroupingProvider",function(){js.$public.refresh=function(a,b,c){};js.$public.setQueryResult=function(a,b){};js.$public.fetchChildren=function(a,b,c){};js.$public.group=function(a,b){};js.$public.insert=function(a,b){};js.$public.insertAt=function(a,b,c){};js.$public.remove=function(a,b){}});js.$class("qs.app.data.GroupingProvider",f.events.EventDispatcher,[f.app.data.IGroupingProvider],function(){this._queryControl=this._dataView=this._propertyXml=this._entityXml=
null;this.initialize=function(){this.$super()};js.$public.groupingEntity=function(a){if(void 0===a)return this._entityXml;this._entityXml=a};js.$public.groupingProperty=function(a){if(void 0===a)return this._propertyXml;this._propertyXml=a};js.$public.dataView=function(a){if(void 0===a)return this._dataView;this._dataView=a};js.$public.queryControl=function(a){if(void 0===a)return this._queryControl;this._queryControl=a};js.$public.refresh=function(a,b,c){};js.$public.setQueryResult=function(a,b){};
js.$public.fetchChildren=function(a,b,c){};js.$public.addNewChild=function(a){var b=this._dataView.findGroups("$is_new_children_group",!0);0==b.length?(b=new f.app.data.GroupData(this._dataView,!0),b.isRequestDB(!1),b.insertChild(0,a),b.$group_label="\u6700\u65b0\u6dfb\u52a0",b.$children_count="("+b.childrenCount()+")",b.$is_new_children_group=!0,this._dataView.insertGroup(0,b)):(b=b[0],this._dataView.insertGroupChild(b,0,a))};js.$public.group=function(a,b){};js.$public.insert=function(a,b){};js.$public.insertAt=
function(a,b,c){};js.$public.remove=function(a,b){}})})(qs,jQuery);(function(f,l){var a=new Date(0);js.$class("qs.app.data.DateGroupingProvider",f.app.data.GroupingProvider,function(){this._timePhaseBegin=this._timePhases=null;this._sundayFirst=!1;this._init_dataset=this._queryXml=this._current_condition=this._current_add_conditions=null;this._total_count=0;this._recordSetHeadXml=null;this.initialize=function(a){a=js.param(a,!1);this.$super();this._sundayFirst=a;this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};this.getWeekString=
function(a){return"\u5468"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d"[a.getDay()]};this.initTimePhases=function(){var a=new Date;1<=a.getMonth()?this._timePhaseBegin=new Date(a.getFullYear(),a.getMonth()-1,1):this._timePhaseBegin=new Date(a.getFullYear()-1,11,1);this._timePhases=[];var c,d=new Date(a.getFullYear(),a.getMonth(),a.getDate());c={};c.name=StringUtil.join("\u4eca\u5929(",DateUtil.format(a,"MM\u6708dd\u65e5 "),this.getWeekString(a),")");c.begin=d;c.end=new Date(d.getTime()+864E5);c.data=
[];this._timePhases.push(c);var e=d,f=new Date(d.getTime()-864E5);1<d.getDate()&&this.getWeekDay(f)<this.getWeekDay(a)&&(c={},c.name=StringUtil.join("\u6628\u5929(",DateUtil.format(f,"MM\u6708dd\u65e5 "),this.getWeekString(f),")"),c.begin=f,c.end=new Date(d.getTime()),c.data=[],this._timePhases.push(c),e=f);c=this.getWeekDay(d);var k=new Date(f.getTime()-864E5),a=new Date(d.getTime()-864E5*(c-1));2<d.getDate()&&(3==c?(c={},c.name=StringUtil.join("\u524d\u5929(",DateUtil.format(k,"MM\u6708dd\u65e5 "),
this.getWeekString(k),")"),c.begin=k,c.end=f,c.data=[],this._timePhases.push(c),e=k):3<c&&(c={},k=new Date(f.getTime()-1E3),k=StringUtil.join("\u4e24\u5929\u524d(",DateUtil.format(a,"MM\u6708dd\u65e5 "),this.getWeekString(a)," \u2014\u2014 ",DateUtil.format(k,"MM\u6708dd\u65e5 "),this.getWeekString(k),")"),c.name=k,c.begin=a,c.end=f,c.data=[],this._timePhases.push(c),e=a));f=new Date(a.getTime()-6048E5);if(f.getMonth()==d.getMonth()||(new Date(a.getTime()-1E3)).getMonth()==d.getMonth())c={},k=new Date(e.getTime()-
1E3),k=StringUtil.join("\u4e0a\u5468(",DateUtil.format(f,"MM\u6708dd\u65e5 "),this.getWeekString(f)," \u2014\u2014 ",DateUtil.format(k,"MM\u6708dd\u65e5 "),this.getWeekString(k),")"),c.name=k,c.begin=f,c.end=e,c.data=[],this._timePhases.push(c),e=f;d=new Date(d.getFullYear(),d.getMonth(),1);d.getTime()<e.getTime()&&(c={},k=new Date(e.getTime()-1E3),k=StringUtil.join("\u4e24\u5468\u524d(",DateUtil.format(d,"MM\u6708dd\u65e5 "),this.getWeekString(d)," \u2014\u2014 ",DateUtil.format(k,"MM\u6708dd\u65e5 "),
this.getWeekString(k),")"),c.name=k,c.begin=d,c.end=e,c.data=[],this._timePhases.push(c),e=d);c={};k=new Date(e.getTime()-1E3);k=StringUtil.join("\u4e0a\u4e2a\u6708(",DateUtil.format(this._timePhaseBegin,"MM\u6708dd\u65e5 "),this.getWeekString(this._timePhaseBegin)," \u2014\u2014 ",DateUtil.format(k,"MM\u6708dd\u65e5 "),this.getWeekString(k),")");c.name=k;c.begin=this._timePhaseBegin;c.end=e;c.data=[];this._timePhases.push(c)};this.getWeekDay=function(a){if(this._sundayFirst)return a.getDay()+1;switch(a.getDay()){case 1:return 1;
case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 0:return 7}return 0};this.applyTimePhase=function(b,c){var d,e={data:[]};e.begin=a;e.end=a;e.name="\u672a\u77e5\u65f6\u95f4";for(var f,k,m=0;m<b.length;m++){k=b[m];d=k[c];f=!1;if("date"==js.type(d))for(var l,p=0;p<this._timePhases.length;p++)if(l=this._timePhases[p],d.getTime()>=l.begin.getTime()&&d.getTime()<l.end.getTime()){l.data.push(k);f=!0;break}!0!=f&&e.data.push(k)}0<e.data.length&&this._timePhases.push(e)};
this.findTimePhase=function(a){for(var c,d=0;d<this._timePhases.length;d++)if(c=this._timePhases[d],a.getTime()>=c.begin.getTime()&&a.getTime()<c.end.getTime())return c;return null};this.findGroup=function(a,c){for(var d=0;d<a.length;d++)if(!((void 0).$begin_time&&c.begin.getTime()!=(void 0).$begin_time.getTime()||(void 0).$end_time&&c.end.getTime()!=(void 0).$end_time.getTime()||c.begin.getTime()!=(void 0).$begin_time.getTime()||c.end.getTime()!=(void 0).$end_time.getTime()))return;return null};
this.addToGroup=function(b){var c=f.app.XmlQuery.getRecordName(this._entityXml,this._propertyXml),d=b[c],e;e=c=null;if("date"==js.type(d))if(c=this.findTimePhase(d),js.isNull(c))d=this._dataView.findGroups("$group_label","\u672a\u77e5\u65f6\u95f4"),!js.isNull(d)&&0<d.length?(e=d[0],e.insertChild(0,b)):(e=new f.app.data.GroupDate(this._dataView,!0),e.isRequestDB(!1),e.insertChild(0,b),e.$group_label="\u672a\u77e5\u65f6\u95f4",e.$children_count="("+e.childrenCount()+")",this._dataView.insertGroup(0,
e));else{d=this._dataView.groups();e=this.findGroup(d,c);var g=0;if(js.isNull(e)){for(var k,m=0;m<d.length;m++)if(k=d[m],!js.isNull(k.$end_time)&&(e=k.$end_time,e!=a&&c.begin.getTime()>=e.getTime())){g=d.indexOf(k);break}e=new f.app.data.GroupData(this._dataView,!0);e.isRequestDB(!1);e.insertChild(0,b);e.childrenCount(1);e.$begin_time=c.begin;e.$end_time=c.end;e.$group_label=c.name;e.$children_count="("+e.childrenCount()+")";this._dataView.insertGroup(g,e)}else this._dataView.insertGroupChild(e,0,
b)}else d=this._dataView.findGroups("$group_label","\u672a\u77e5\u65f6\u95f4"),!js.isNull(d)&&0<d.length?(e=d[0],e.insertChild(0,b)):(e=new f.app.data.GroupData(this._dataView,!0),e.isRequestDB(!1),e.insertChild(0,b),e.$group_label="\u672a\u77e5\u65f6\u95f4",e.$children_count="("+e.childrenCount()+")",this._dataView.insertGroup(0,e))};js.$public.refresh=function(a,c,d){this._queryXml=a;this._current_add_conditions=c;this._current_condition=d;this._init_dataset=null;this._total_count=0;this.initTimePhases();
a={};a.leftEntity=this._entityXml.attr("name");a.leftField=this._propertyXml.attr("name");a.type=7;a.valueType=7;a.option=!1;a.uid="gp_adcond_1";a.right="_begin_time_";a.rightType="param";var e=js.clone(c),f=js.clone(d);e.push(a);f[a.uid]=this._timePhaseBegin;f._begin_time_=this._timePhaseBegin;f.$orderBy$=this._entityXml.attr("name")+","+this._propertyXml.attr("name")+",desc";wos.Remoting.beginBatchCall();wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),e,f,0,-1],this,new wos.events.AsyncOption("Init_Data"));
wos.Remoting.call("QueryService.getResultCount",[this._queryXml.attr("uid"),c,d],this,new wos.events.AsyncOption("Total_Count"));wos.Remoting.endBatchCall(this,new wos.events.AsyncOption("Init_Refresh"))};js.$public.setQueryResult=function(a,c){if(!js.isNull(c)&&!js.isNull(c.asyncData)){var d=c.asyncData;if(!0==d.IsInGrouping){var e=d.operation;if(js.isNull(a)){var f=d.resultSet;js.isNull(f)||(a=f)}switch(e){case "Init_Refresh":this.init_Refresh(a);break;case "FetchChildren":d=d.page,js.isNull(d)||
js.isNull(d.group)||d.group.putChildren(d.start,a)}}}};js.$public.fetchChildren=function(b,c,d){if(!0!=b.$is_new_children_group){var e=js.clone(this._current_add_conditions),f=js.clone(this._current_condition),k,m=a,l=a;b.$begin_time&&(m=b.$begin_time);b.$end_time&&(l=b.$end_time);m!=a&&(k={},k.leftEntity=this._entityXml.attr("name"),k.leftField=this._propertyXml.attr("name"),k.type=7,k.valueType=7,k.option=!1,k.uid="gp_adcond_1",k.right="_begin_time_",k.rightType="param",e.push(k),f[k.uid]=m,f._begin_time_=
m);l!=a&&(k={},k.leftEntity=this._entityXml.attr("name"),k.leftField=this._propertyXml.attr("name"),k.type=13,k.valueType=7,k.option=!1,k.uid="gp_adcond_2",k.right="_end_time_",k.rightType="param",e.push(k),f[k.uid]=l,f._end_time_=l);f.$orderBy$=this._entityXml.attr("name")+","+this._propertyXml.attr("name")+",desc";k={};k.group=b;k.start=c;k.size=d;wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),e,f,c,d],this,new wos.events.AsyncOption("FetchChildren",k))}};js.$public.addNewChild=
function(a){this.addToGroup(a)};this.init_Refresh=function(a){var c=[],d;if(!js.isNull(a)&&0<a.length){this.applyTimePhase(a,f.app.XmlQuery.getRecordName(this._entityXml,this._propertyXml));for(var e,g=0;g<this._timePhases.length;g++)e=this._timePhases[g],0<e.data.length&&(d=new f.app.data.GroupData(this._dataView,!0),d.setChildren(e.data),d.$begin_time=e.begin,d.$end_time=e.end,d.$group_label=e.name,d.$children_count="("+d.childrenCount()+")",c.push(d));d=new f.app.data.GroupData(this._dataView,
!1);js.isNull(a)?d.childrenCount(this._total_count):d.childrenCount(this._total_count-a.length);a=new Date(this._timePhaseBegin.getTime()-1E3);a=StringUtil.join("\u4e00\u4e2a\u6708\u4ee5\u524d(\u622a\u6b62",DateUtil.format(a,"MM\u6708dd\u65e5"),")");d.$group_label=a;d.$children_count="("+d.childrenCount()+")";d.$end_time=this._timePhaseBegin;c.push(d)}this._dataView.groups(c)};this.cb_Init_Refresh=function(){if(!js.isNull(this._init_dataset)){var a=null;0<this._init_dataset.length&&"string"==js.type(this._init_dataset[0])&&
0==this._init_dataset[0].indexOf("\x3chead\x3e")&&(a=new f.Xml(this._init_dataset[0]));var a=f.app.XmlQuery.convertResultSet(this._init_dataset,a),c={IsInGrouping:!0,operation:"Init_Refresh"};c.resultSet=a;var d={};d.recordSet=a;this._queryControl.fireQueryEvent("postQuery",d,c)}};this.cb_FetchChildren=function(a,c){0<a.length&&"string"==js.type(a[0])&&0==a[0].indexOf("\x3chead\x3e")&&(this._recordSetHeadXml=new f.Xml(a[0]));var d=f.app.XmlQuery.convertResultSet(a,this._recordSetHeadXml),e={};e.recordSet=
d;var g={IsInGrouping:!0};g.resultSet=d;g.operation="FetchChildren";g.page=c;this._queryControl.fireQueryEvent("postQuery",e,g)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "Init_Data":this._init_dataset=a.result;break;case "Total_Count":this._total_count=NumberUtil.toInt(a.result);break;case "Init_Refresh":this.cb_Init_Refresh();break;case "FetchChildren":this.cb_FetchChildren(a.result,a.option.asyncData)}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.data.DictionaryGroupingProvider",f.app.data.GroupingProvider,function(){this._queryXml=this._current_condition=this._current_add_conditions=null;this._dictType="";this._recordSetHeadXml=null;this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.refresh=function(a,b,c){this._current_add_conditions=b;this._current_condition=c;this._queryXml=a;this._dictType=this.groupingProperty().attr("valueProvider");
var d=[],e=[],f=this.groupingEntity().attr("name")+"."+this.groupingProperty().attr("name");d.push("count:*");d.push("select:"+f);var k=a.xpath("StatSetting/Stat");if(0<k.length)for(var m,l=0;l<k.length;l++)m=k[l],d.push("sum:"+m.attr("stat_prop"));e.push(f);wos.Remoting.call("QueryService.executeStatQuery",[a.attr("uid"),b,c,d,e],this,new wos.events.AsyncOption("Init_Refresh"))};js.$public.setQueryResult=function(a,b){if(!js.isNull(b)&&!js.isNull(b.asyncData)){var c=b.asyncData;if(!0==c.IsInGrouping){var d=
c.operation;if(js.isNull(a)){var e=c.resultSet;js.isNull(e)||(a=e)}switch(d){case "Init_Refresh":this.init_Refresh(a);break;case "FetchChildren":c=c.page,js.isNull(c)||js.isNull(c.group)||c.group.putChildren(c.start,a)}}}};js.$public.addNewChild=function(a){var b=f.app.XmlQuery.getRecordName(this.groupingEntity(),this.groupingProperty()),c=a[b],d=this._dataView.findGroups("$group_value",c);0==d.length?(d=new f.app.data.GroupData(this._dataView,!0),d.isRequestDB(!1),d.insertChild(0,a),js.isNull(a[b])?
d.$group_label="\u672a\u8bbe\u7f6e\u503c":(a=wos.DictionaryLoader.getValueItem(dictType,c),js.isNull(a)?d.$group_label=c:d.$group_label=a.label),d.$group_value=c,d.$children_count="("+d.childrenCount()+")",this._dataView.insertGroup(0,d)):(d=d[0],this._dataView.insertGroupChild(d,0,a))};js.$public.fetchChildren=function(a,b,c){if(!0!=a.$is_new_children_group){var d=js.clone(this._current_add_conditions),e=js.clone(this._current_condition),f=a.$group_value,k;k={};k.leftEntity=this._entityXml.attr("name");
k.leftField=this._propertyXml.attr("name");"string"==this._propertyXml.attr("type")?k.valueType=1:"long"==this._propertyXml.attr("type")&&(k.valueType=3);k.option=!1;k.uid="gp_adcond_1";js.isNull(f)?k.type=24:(k.type=5,k.right="_dict_value_",k.rightType="param",e[k.uid]=f,e._dict_value_=f);d.push(k);f={};f.group=a;f.start=b;f.size=c;wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),d,e,b,c],this,new wos.events.AsyncOption("FetchChildren",f))}};this.getGroupStat=function(a,
b,c){c-=1;for(var d="",e,f,k,m=0;m<b.length;m++)if(k=b[m],c++,e=k.text(),k=k.attr("stat_prop").split("."),k=this._queryControl.getEntityProperty(k[0],k[1]),!js.isNull(k)&&!js.isNull(a[c])){f=a[c];if("long"==k.attr("type")&&"true"==k.attr("currency"))f=NumberUtil.toNumber(a[c])/100;else if("double"==k.attr("type")){var l=NumberUtil.toNumber(a[c]);isNaN(l)||("true"==k.attr("currency")?f=l:(f=k.attr("fraction"),f=""==f?2:parseInt(f),isNaN(f)&&(f=2),f=l.toFixed(f)))}if(js.isNull(e)||""==e)e=k.attr("label")+
" : ${stat_value} ";e=e.replace("${stat_value}",f);d+=e+" "}return d};this.init_Refresh=function(a){var b=[],c;if(!js.isNull(a)&&0!=a.length){for(var d=this._queryXml.xpath("StatSetting/Stat"),e,g,k,m="",l={},p=0;p<a.length;p++)c=a[p],g=NumberUtil.toInt(c[0]),k=c[1],e=this.getGroupStat(c,d,2),c=new f.app.data.GroupData(this._dataView,!1),c.childrenCount(g),js.isNull(k)?(c.$group_label="\u672a\u8bbe\u7f6e\u503c",c.$html_status=e,c.$group_value=k,c.$children_count="("+c.childrenCount()+")",b.push(c)):
(m="",g=wos.DictionaryLoader.getValueItem(this._dictType,k),m=js.isNull(g)?m+k:m+g.label,c.$group_label=m,c.$html_status=e,c.$group_value=k,c.$children_count="("+c.childrenCount()+")",l[k.toString()]=c);a=wos.DictionaryLoader.getValueList(this._dictType);for(p=0;p<a.length;p++)g=a[p],js.isNull(g)||(c=l[g.value.toString()],js.isNull(c)&&(c=new f.app.data.GroupData(this._dataView,!1),c.childrenCount(0),c.$group_label=g.label,c.$group_value=g.value,c.$children_count="("+c.childrenCount()+")"),b.push(c))}this._dataView.groups(b)};
this.cb_FetchChildren=function(a,b){0<a.length&&"string"==js.type(a[0])&&0==a[0].indexOf("\x3chead\x3e")&&(this._recordSetHeadXml=new f.Xml(a[0]));var c=f.app.XmlQuery.convertResultSet(a,this._recordSetHeadXml),d={};d.recordSet=c;var e={IsInGrouping:!0};e.resultSet=c;e.operation="FetchChildren";e.page=b;this._queryControl.fireQueryEvent("postQuery",d,e)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "Init_Refresh":this.init_Refresh(a.result);break;case "FetchChildren":this.cb_FetchChildren(a.result,
a.option.asyncData)}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.data.EntityGroupingProvider",f.app.data.GroupingProvider,function(){this._recordSetHeadXml=this._queryXml=this._current_condition=this._current_add_conditions=null;this.labelField=this.idField="";this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.refresh=function(a,b,c){this._current_add_conditions=b;this._current_condition=c;this._queryXml=a;a=[];var d=[];this._idField=this.groupingEntity().attr("name")+
"."+this.groupingProperty().attr("name")+"_id";this._labelField=this.groupingEntity().attr("name")+"."+this.groupingProperty().attr("name")+"_label";a.push("count:*");a.push("select:"+this._idField);a.push("select:"+this._labelField);var e=this._queryXml.xpath("StatSetting/Stat");if(0<e.length)for(var f,k=0;k<e.length;k++)f=e[k],a.push("sum:"+f.attr("stat_prop"));d.push(idField);d.push(labelField);wos.Remoting.call("QueryService.executeStatQuery",[this._queryXml.attr("uid"),b,c,a,d],this,new wos.events.AsyncOption("Init_Refresh"))};
js.$public.setQueryResult=function(a,b){if(!js.isNull(b)&&!js.isNull(b.asyncData)){var c=b.asyncData;if(!0==c.IsInGrouping){var d=c.operation;if(js.isNull(a)){var e=c.resultSet;js.isNull(e)||(a=e)}switch(d){case "Init_Refresh":this.init_Refresh(a);break;case "FetchChildren":c=c.page,js.isNull(c)||js.isNull(c.group)||c.group.putChildren(c.start,a)}}}};js.$public.fetchChildren=function(a,b,c){if(!0!=a.$is_new_children_group){var d=js.clone(this._current_add_conditions),e=js.clone(this._current_condition),
f=a.$group_value,k;k={};k.leftEntity=this._entityXml.attr("name");k.leftField=this._propertyXml.attr("name")+"_id";k.valueType=3;k.option=!1;k.uid="gp_adcond_1";js.isNull(f)?k.type=24:(k.type=5,k.right="_value_",k.rightType="param",e[k.uid]=f,e._value_=f);d.push(k);f={};f.group=a;f.start=b;f.size=c;wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),d,e,b,c],this,new wos.events.AsyncOption("FetchChildren",f))}};this.statMerge=function(a,b,c){for(var d=[],e=a[0].length,f={},k,
m,l,p,q,s=0;s<a.length;s++)if(k=a[s],l=js.isNull(k[b])?"0":k[b],js.isNull(f[l]))f[l]=k;else{m=f[l];for(var r=0;r<e;r++)r!=b&&(r==c?"0"==l?m[c]="\u672a\u8bbe\u7f6e\u503c":(p=k[c],q=m[c],p=js.isNull(p)||""==p?q:p,m[c]=p):(p=null!=k[r]?parseFloat(k[r]):0,q=null!=m[r]?parseFloat(m[r]):0,m[r]=p+q))}for(var t in f)a=f[t],"array"==js.type(a)&&d.push(a);return d};this.getGroupStat=function(a,b,c){c-=1;for(var d="",e,f,k,m=0;m<b.length;m++)if(k=b[m],c++,e=k.text(),k=k.attr("stat_prop").split("."),k=this._queryControl.getEntityProperty(k[0],
k[1]),!js.isNull(k)&&!js.isNull(a[c])){f=a[c];if("long"==k.attr("type")&&"true"==k.attr("currency"))f=NumberUtil.toInt(a[c])/100;else if("double"==k.attr("type")){var l=NumberUtil.toNumber(a[c]);isNaN(l)||("true"==k.attr("currency")?f=l:(f=k.attr("fraction"),f=""==f?2:parseInt(f),isNaN(f)&&(f=2),f=l.toFixed(f)))}if(js.isNull(e)||""==e)e=k.attr("label")+" : ${stat_value} ";e=e.replace("${stat_value}",f);d+=e+" "}return d};this.init_Refresh=function(a){var b=[],c;if(!js.isNull(a)&&0!=a.length){a=this.statMerge(a,
1,2);for(var d=this._queryXml.xpath("StatSetting/Stat"),e,g,k,m=0;m<a.length;m++)k=a[m],g=NumberUtil.toInt(k[0]),e=this.getGroupStat(k,d,3),c=new f.app.data.GroupData(this._dataView,!1),c.childrenCount(g),js.isNull(k[2])?c.$group_label="\u672a\u8bbe\u7f6e\u503c":c.$group_label=k[2],c.$html_status=e,c.$group_value=k[1],c.$children_count="("+c.childrenCount()+")",b.push(c)}this._dataView.groups(b)};this.cb_FetchChildren=function(a,b){0<a.length&&"string"==js.type(a[0])&&0==a[0].indexOf("\x3chead\x3e")&&
(this._recordSetHeadXml=new f.Xml(a[0]));var c=f.app.XmlQuery.convertResultSet(a,this._recordSetHeadXml),d={};d.recordSet=c;var e={IsInGrouping:!0};e.resultSet=c;e.operation="FetchChildren";e.page=b;this._queryControl.fireQueryEvent("postQuery",d,e)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "Init_Refresh":this.init_Refresh(a.result);break;case "FetchChildren":this.cb_FetchChildren(a.result,a.option.asyncData)}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.data.PrincipalGroupingProvider",f.app.data.GroupingProvider,function(){this._recordSetHeadXml=this._queryXml=this._current_condition=this._current_add_conditions=null;this.labelField=this.idField="";this.initialize=function(){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.refresh=function(a,b,c){this._current_add_conditions=b;this._current_condition=c;this._queryXml=a;a=[];var d=[];this._idField=this.groupingEntity().attr("name")+
"."+this.groupingProperty().attr("name")+"_id";this._labelField=this.groupingEntity().attr("name")+"."+this.groupingProperty().attr("name")+"_name";a.push("count:*");a.push("select:"+this._idField);a.push("select:"+this._labelField);var e=this._queryXml.xpath("StatSetting/Stat");if(0<e.length)for(var f,k=0;k<e.length;k++)f=e[k],a.push("sum:"+f.attr("stat_prop"));d.push(idField);d.push(labelField);wos.Remoting.call("QueryService.executeStatQuery",[this._queryXml.attr("uid"),b,c,a,d],this,new wos.events.AsyncOption("Init_Refresh"))};
js.$public.setQueryResult=function(a,b){if(!js.isNull(b)&&!js.isNull(b.asyncData)){var c=b.asyncData;if(!0==c.IsInGrouping){var d=c.operation;if(js.isNull(a)){var e=c.resultSet;js.isNull(e)||(a=e)}switch(d){case "Init_Refresh":this.init_Refresh(a);break;case "FetchChildren":c=c.page,js.isNull(c)||js.isNull(c.group)||c.group.putChildren(c.start,a)}}}};js.$public.fetchChildren=function(a,b,c){if(!0!=a.$is_new_children_group){var d=js.clone(this._current_add_conditions),e=js.clone(this._current_condition),
f=a.$group_value,k;k={};k.leftEntity=this._entityXml.attr("name");k.leftField=this._propertyXml.attr("name")+"_id";k.valueType=3;k.option=!1;k.uid="gp_adcond_1";js.isNull(f)?k.type=24:(k.type=5,k.right="_value_",k.rightType="param",e[k.uid]=f,e._value_=f);d.push(k);f={};f.group=a;f.start=b;f.size=c;wos.Remoting.call("QueryService.executeQuery",[this._queryXml.attr("uid"),d,e,b,c],this,new wos.events.AsyncOption("FetchChildren",f))}};this.statMerge=function(a,b,c){for(var d=[],e=a[0].length,f={},k,
m,l,p,q,s=0;s<a.length;s++)if(k=a[s],l=js.isNull(k[b])?"0":k[b],js.isNull(f[l]))f[l]=k;else{m=f[l];for(var r=0;r<e;r++)r!=b&&(r==c?"0"==l?m[c]="\u672a\u8bbe\u7f6e\u503c":(p=k[c],q=m[c],p=js.isNull(p)||""==p?q:p,m[c]=p):(p=null!=k[r]?parseFloat(k[r]):0,q=null!=m[r]?parseFloat(m[r]):0,m[r]=p+q))}for(var t in f)a=f[t],"array"==js.type(a)&&d.push(a);return d};this.getGroupStat=function(a,b,c){c-=1;for(var d="",e,f,k,m=0;m<b.length;m++)if(k=b[m],c++,e=k.text(),k=k.attr("stat_prop").split("."),k=this._queryControl.getEntityProperty(k[0],
k[1]),!js.isNull(k)&&!js.isNull(a[c])){f=a[c];if("long"==k.attr("type")&&"true"==k.attr("currency"))f=NumberUtil.toInt(a[c])/100;else if("double"==k.attr("type")){var l=NumberUtil.toNumber(a[c]);isNaN(l)||("true"==k.attr("currency")?f=l:(f=k.attr("fraction"),f=""==f?2:parseInt(f),isNaN(f)&&(f=2),f=l.toFixed(f)))}if(js.isNull(e)||""==e)e=k.attr("label")+" : ${stat_value} ";e=e.replace("${stat_value}",f);d+=e+" "}return d};this.init_Refresh=function(a){var b=[],c;if(!js.isNull(a)&&0!=a.length){a=this.statMerge(a,
1,2);for(var d=this._queryXml.xpath("StatSetting/Stat"),e,g,k,m=0;m<a.length;m++)k=a[m],g=NumberUtil.toInt(k[0]),e=this.getGroupStat(k,d,3),c=new f.app.data.GroupData(this._dataView,!1),c.childrenCount(g),js.isNull(k[2])?c.$group_label="\u672a\u8bbe\u7f6e\u503c":c.$group_label=k[2],c.$html_status=e,c.$group_value=k[1],c.$children_count="("+c.childrenCount()+")",b.push(c)}this._dataView.groups(b)};this.cb_FetchChildren=function(a,b){0<a.length&&"string"==js.type(a[0])&&0==a[0].indexOf("\x3chead\x3e")&&
(this._recordSetHeadXml=new f.Xml(a[0]));var c=f.app.XmlQuery.convertResultSet(a,this._recordSetHeadXml),d={};d.recordSet=c;var e={IsInGrouping:!0};e.resultSet=c;e.operation="FetchChildren";e.page=b;this._queryControl.fireQueryEvent("postQuery",d,e)};this.onRemotingCallback=function(a){switch(a.option.asyncName){case "Init_Refresh":this.init_Refresh(a.result);break;case "FetchChildren":this.cb_FetchChildren(a.result,a.option.asyncData)}}})})(qs,jQuery);(function(f,l){js.$class("qs.app.data.GroupData",function(){this._dataView=null;this._pageSize=100;this._pageTimeout=1E4;this._childrenCount=0;this._isExpanded=!1;this._pages=[];this._loadingPages=[];this._level=0;this._isRequestDB=!0;this.initialize=function(a,b){b=js.param(b,!1);this._dataView=a;this._pageSize=a.pageSize();this._pageTimeout=a.pageTimeout();this._isExpanded=b;this.$is_group=!0};js.$public.level=function(a){if(void 0===a)return this._level;this._level=a};js.$public.childrenCount=
function(a){if(void 0===a)return this._childrenCount;this._childrenCount=a};js.$public.isExpanded=function(a){if(void 0===a)return this._isExpanded;a!=this._isExpanded&&(this._isExpanded=a,js.isNull(this._dataView)||(!0==this._isExpanded?this._dataView.expandGroup(this):this._dataView.closeGroup(this)))};js.$public.isRequestDB=function(a){if(void 0===a)return this._isRequestDB;this._isRequestDB=a};js.$public.getChildAt=function(a){if(0>a||a>=this._childrenCount)return{};var b=this.loadPage(a);a-=
b.itemsStart;a>this._pageSize/2&&b.DB_Start+b.DB_Count<this._childrenCount&&this.requestNextPage(b);a<this._pageSize/2&&0<b.DB_Start&&this.requestPrevPage(b);this.cleanUpPages();js.isNull(b.items)&&this.putEmptyItems(b);return 0>a||a>=b.items.length?{}:b.items[a]};js.$public.containsChildren=function(a){for(var b,c=0;c<this._pages.length;c++)if(b=this._pages[c],!js.isNull(b.items)&&-1!=b.items.indexOf(a))return!0;return!1};js.$public.indexOfChildren=function(a){for(var b,c=0;c<this._pages.length;c++)if(b=
this._pages[c],!js.isNull(b.items)){var d=b.items.indexOf(a);if(-1!=d)return b.itemsStart+d}return-1};js.$public.insertChild=function(a,b){var c=this.loadPage(a);if(js.isNull(c.items))this.putEmptyItems(c),a-c.itemsStart<c.items.length?c.items[a-c.itemsStart]=b:(c.items.push(b),c.DB_Count++,c.itemsCount++);else for(c.items.splice(a-c.itemsStart,0,b),c.itemsCount++,c=this._pages.indexOf(c)+1;c<this._pages.length;c++)this._pages[c].itemsStart++;js.instanceOf(b,f.app.data.GroupData)&&b.level(this._level+
1);this.childrenCount(this._childrenCount+1)};js.$public.removeChild=function(a){for(var b,c,d=0;d<this._pages.length;d++)if(b=this._pages[d],!js.isNull(b.items)&&(c=b.items.indexOf(a),-1!=c)){b.items.splice(c,1);b.itemsCount--;for(a=this._pages.indexOf(b)+1;a<this._pages.length;a++)this._pages[a].itemsStart--;this.childrenCount(this._childrenCount-1);return!0}return!1};js.$public.removeChildAt=function(a){a=this.getChildAt(a);return js.isNull(a)?!1:this.removeChild(a)};js.$public.findChildren=function(a,
b,c){for(var d,e,f,k=0;k<this._pages.length;k++)if(e=this._pages[k],!js.isNull(e.items))for(var m=0;m<e.items.length;m++)f=e.items[m],d=f[a],b==d&&c.push(f)};js.$public.findChildrenIndexes=function(a,b,c,d){d=js.param(d,0);for(var e,f=0;f<this._pages.length;f++)if(page=this._pages[f],!js.isNull(page.items))for(var k=0;k<page.items.length;k++)e=page.items[k],e=e[a],b==e&&c.push(page.itemsStart+k+d)};this.putEmptyItems=function(a){a.items=[];for(var b=0;b<a.itemsCount;b++)a.items.push({})};js.$public.cleanUpPages=
function(){for(var a,b=this._loadingPages.length-1;0<=b;b--)a=this._loadingPages[b],0<a.loadTime&&(new Date).getTime()-a.loadTime>this._pageTimeout&&(a=this._pages.indexOf(a),-1!=a&&this._pages.splice(a,1),this._loadingPages.splice(b,1))};this.loadPage=function(a){for(var b=Math.floor(a/this._pageSize),c,d=null,e=this._pages.length-1;0<=e;e--){c=this._pages[e];if(c.itemsStart<=a&&c.itemsStart+c.itemsCount>a)return c;if(c.itemsStart+c.itemsCount<=a)return a={},a.itemsStart=b*this._pageSize,a.itemsCount=
this._pageSize,a.DB_Start=a.itemsStart,a.DB_Count=this._pageSize,a.loadTime=(new Date).getTime(),a.itemsStart-(c.itemsStart+c.itemsCount)<this._pageSize/3&&(c.nextPage=a,a.prevPage=c),!js.isNull(d)&&d.itemsStart-(a.itemsStart+a.itemsCount)<this._pageSize/3&&(a.nextPage=d,d.prevPage=a),js.isNull(a.prevPage)||(a.itemsStart=a.prevPage.itemsStart+a.prevPage.itemsCount,a.DB_Start=a.prevPage.DB_Start+a.prevPage.DB_Count),js.isNull(a.nextPage)||(a.itemsCount=a.nextPage.itemsStart-a.itemsStart,a.DB_Count=
a.nextPage.DB_Start-a.DB_Start),this._pages.splice(e+1,0,a),a.itemsStart+a.itemsCount>this._childrenCount&&(a.itemsCount=this._childrenCount-a.itemsStart,a.DB_Count=this._childrenCount-a.DB_Start),this.isRequestDB()&&this._dataView.requestChildrenPage(this,a.DB_Start,a.DB_Count),a;d=c}c={};c.itemsStart=b*this._pageSize;c.itemsCount=this._pageSize;c.DB_Start=c.itemsStart;c.DB_Count=this._pageSize;c.loadTime=(new Date).getTime();0<this._pages.length&&(d=this._pages[0],!js.isNull(d)&&d.itemsStart-(c.itemsStart+
c.itemsCount)<this._pageSize/3&&(c.nextPage=d,d.prevPage=c,c.itemsCount=d.itemsStart-c.itemsStart,c.DB_Count=d.DB_Start-c.DB_Start));this._pages.splice(0,0,c);c.itemsStart+c.itemsCount>this._childrenCount&&(c.itemsCount=this._childrenCount-c.itemsStart,c.DB_Count=this._childrenCount-c.DB_Start);this.isRequestDB()&&this._dataView.requestChildrenPage(this,c.DB_Start,c.DB_Count);return c};this.requestNextPage=function(a){if(js.isNull(a.nextPage)){var b={};b.itemsStart=a.itemsStart+a.itemsCount;b.itemsCount=
this._pageSize;b.DB_Start=a.DB_Start+a.DB_Count;b.DB_Count=this._pageSize;b.loadTime=(new Date).getTime();var c=this._pages.indexOf(a);if(c>=this._pages.length-1)b.itemsStart+b.itemsCount>this._childrenCount&&(b.itemsCount=this._childrenCount-b.itemsStart,b.DB_Count=this._childrenCount-b.DB_Start);else{var d=this._pages[c+1];d.itemsStart-(b.itemsStart+b.itemsCount)<this._pageSize/3&&(b.nextPage=d,d.prevPage=b,b.itemsCount=d.itemsStart-b.itemsStart,b.DB_Count=d.DB_Start-b.DB_Start)}this._pages.splice(c+
1,0,b);a.nextPage=b;b.prevPage=a;this.isRequestDB()&&this._dataView.requestChildrenPage(this,b.DB_Start,b.DB_Count)}};this.requestPrevPage=function(a){if(js.isNull(a.prevPage)){var b={};b.itemsStart=a.itemsStart-this._pageSize;b.itemsCount=this._pageSize;b.DB_Start=a.DB_Start-this._pageSize;b.DB_Count=this._pageSize;b.loadTime=(new Date).getTime();var c=this._pages.indexOf(a);if(0==c)0>b.itemsStart&&(b.itemsStart=0,b.itemsCount=a.itemsStart,b.DB_Start=0,b.DB_Count=a.DB_Start);else{var d=this._pages[c-
1];b.itemsStart-(d.itemsStart+d.itemsCount)<this._pageSize/3&&(d.nextPage=b,b.prevPage=d,b.itemsStart=d.itemsStart+d.itemsCount,b.DB_Start=d.DB_Start+d.DB_Count)}this._pages.splice(c,0,b);a.prevPage=b;b.nextPage=a;this.isRequestDB()&&this._dataView.requestChildrenPage(this,b.DB_Start,b.DB_Count)}};js.$public.putChildren=function(a,b){for(var c,d=this._pages.length-1;0<=d;d--)if(c=this._pages[d],c.DB_Start==a){js.isNull(c.items)&&(c.items=[]);for(d=0;d<b.length;d++)c.items[d]=b[d],js.instanceOf(b[d],
f.app.data.GroupData)&&b[d].level(this._level+1);c=this._loadingPages.indexOf(c);-1!=c&&this._loadingPages.splice(c,1);null!=this._dataView&&this._dataView.updateRows();break}};js.$public.setChildren=function(a){this._pages.length=0;var b={itemsStart:0};b.itemsCount=a.length;b.DB_Start=0;b.DB_Count=a.length;b.loadTime=(new Date).getTime();b.items=a;for(var c=0;c<b.items.length;c++)js.instanceOf(b.items[c],f.app.data.GroupData)&&b.items[c].level(this._level+1);this._pages.push(b);this._childrenCount=
a.length}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow xmlns:app\x3d"qs.app" width\x3d"400" height\x3d"209" title\x3d"\u4efb\u52a1\u63a5\u7ba1\u6216\u8f6c\u4ea4" resizable\x3d"false"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" columns\x3d"[70,\'*\',70,\'*\']" rows\x3d"[25,25,\'*\',30]" hGap\x3d"2" vGap\x3d"2"\x3e','\x3cLabel text\x3d"\u4efb\u52a1\u540d\u79f0:" layout\x3d"{rowIndex : 0, colIndex : 0, hAlign : \'left\'}" /\x3e','\x3cTextInput name\x3d"txtTaskName" layout\x3d"{rowIndex : 0, colIndex : 1, width:\'*\'}" readonly\x3d"true"/\x3e',
'\x3cLabel text\x3d"\u539f\u6267\u884c\u4eba:" layout\x3d"{rowIndex : 0, colIndex : 2, hAlign : \'left\'}" /\x3e','\x3cTextInput name\x3d"txtOldExecutor" layout\x3d"{rowIndex : 0, colIndex : 3, width:\'*\'}" readonly\x3d"true"/\x3e','\x3cLabel text\x3d"\u52a8\u4f5c:" layout\x3d"{rowIndex : 1, colIndex : 0, hAlign : \'left\'}" /\x3e','\x3cComboBox name\x3d"cmbAction" change\x3d"onActionChange" layout\x3d"{rowIndex : 1, colIndex : 1, width:\'*\'}"/\x3e','\x3cLabel text\x3d"\u65b0\u6267\u884c\u4eba:" name\x3d"lbTarget" layout\x3d"{rowIndex : 1, colIndex : 2, hAlign : \'left\'}" /\x3e',
'\x3capp:PrincipalSelectField name\x3d"psTarget" layout\x3d"{rowIndex : 1, colIndex : 3, width:\'*\'}" /\x3e','\x3cLabel text\x3d"\u8bf4\u660e:" layout\x3d"{height : 24, rowIndex : 2, colIndex : 0, hAlign : \'left\'}" /\x3e','\x3cTextArea name\x3d"txtNote" layout\x3d"{rowIndex : 2, colIndex : 1, colSpan : 3}"/\x3e','\x3cHLayout layout\x3d"{rowIndex : 3, colSpan : 4, hAlign : \'right\', innerLayout:{height : 24, vAlign : \'bottom\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e','\x3cButton name\x3d"btnOK" width\x3d"70" text\x3d"\u786e\u5b9a" click\x3d"onOK" options\x3d"{isDefault:true}" icon\x3d"images/icons/ok.png"/\x3e',
'\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.workflow.DeliverWorkItemWindow",f.ui.Window,function(){this._taskEntity=null;this._actions=[{label:"\u8f6c\u4ea4",value:"deliver"},{label:"\u63a5\u7ba1",value:"take_over"}];this._mode="";this.initialize=function(b){this.$super(b);this.qxml(a);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);
this.cmbAction.dataProvider(this._actions);this.cmbAction.value("take_over");this.btnOK.enabled(!1)};this.onActionChange=function(a){"deliver"==this.cmbAction.value()?(this.lbTarget.visible(!0),this.psTarget.visible(!0)):(this.lbTarget.visible(!1),this.psTarget.visible(!1))};js.$public.mode=function(a){if(void 0===a)return this._mode;this._mode=a;"deliver"==this._mode?(this.cmbAction.value("deliver"),this.cmbAction.enabled(!1)):this.cmbAction.value("take_over")};js.$public.setTaskEntity=function(a){this._taskEntity=
a;this.txtOldExecutor.value(this._taskEntity.WF_ProcessorPrinName);wos.Remoting.call("WorkflowService.getWorkItem",[this._taskEntity.WF_WorkItemId],this,new wos.events.AsyncOption("getWorkItem",null))};js.$public.setWorkItem=function(a,c,d,e){this.workItemId=a;this._taskEntity=d;this.entityName=e;this.txtOldExecutor.value(c);0<a&&wos.Remoting.call("WorkflowService.getWorkItem",[a],this,new wos.events.AsyncOption("getWorkItem",null))};this.cb_getWorkItem=function(a){if(!js.isNull(a)){if(a.state!=f.app.workflow.TaskList.NONE_PROCESSED_TASK_STATE)throw Error("\u5de5\u4f5c\u9879\u5df2\u7ecf\u88ab\u5904\u7406\uff0c\u65e0\u987b\u63a5\u7ba1\u6216\u8f6c\u4ea4\u3002");
this.txtTaskName.value(a.name);this.btnOK.enabled(!0)}};this.onRemotingCallback=function(a,c){switch(a.option.asyncName){case "getWorkItem":this.cb_getWorkItem(a.result);break;case "deliverWorkItem":var d=this._taskEntity.$type$,e=a.option.asyncData.principal;this._taskEntity.WF_ProcessorPrinId=e.id;this._taskEntity.WF_ProcessorPrinName=e.name;delete this._taskEntity.$type$;wos.Remoting.call("DynamicEntityService.modifyEntity",[d,this._taskEntity,null],this,new wos.events.AsyncOption("modifyEntity",
null));break;case "modifyEntity":wos.Desktop.instance().dispatchEvent("ime.WorkItem",{action:"refresh"}),wos.Desktop.instance().dispatchEvent("ime.DynamicEntity",{action:"edit",param:a.result}),this.close()}};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);this.invalidateSize(!0)};this.onOK=function(){var a;if("deliver"==this.cmbAction.selectedItem().value){if(a=this.psTarget.principal(),js.isNull(a)){f.ui.MessageBox.show("\u8bf7\u9009\u62e9\u8981\u8f6c\u4ea4\u7684\u7528\u6237",
"\u63d0\u793a");return}}else a=wos.Desktop.getAttribute("loginInfo"),a={id:a.principalId,name:a.principalName};wos.Remoting.call("WorkflowService.deliverWorkItem",[this._taskEntity.WF_WorkItemId,a.id,this.txtNote.value()],this,new wos.events.AsyncOption("deliverWorkItem",{principal:a}))};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow width\x3d"594" height\x3d"294" title\x3d"\u5de5\u4f5c\u6d41\u65e5\u5fd7\u6570\u636e" resizable\x3d"false"\x3e','\x3cGridLayout width\x3d"100%" height\x3d"100%" padding\x3d"2" columns\x3d"[\'*\']" rows\x3d"[\'*\',30]" hGap\x3d"2" vGap\x3d"2"\x3e','\x3cDataGrid name\x3d"dgLog"\x3e',"\x3c/DataGrid\x3e",'\x3cHLayout layout\x3d"{rowIndex : 1, hAlign : \'right\', innerLayout:{height : 24, vAlign : \'bottom\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%" \x3e',
'\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.workflow.FlowLogWindow",f.ui.Window,function(){this._logs=[];this.initialize=function(b){this.$super(b);this.qxml(a);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.dgLog.columns([{id:"executorName",name:"\u6267\u884c\u4eba",field:"executorName"},{id:"taskName",name:"\u4efb\u52a1\u540d\u79f0",
field:"taskName"},{id:"submiteMode",name:"\u63d0\u4ea4\u65b9\u5f0f",field:"submiteMode"},{id:"executeTime",name:"\u6267\u884c\u65f6\u95f4",field:"executeTime",formatter:function(a,b,c,k,m){return null==c?"":"date"==f.type(c)?DateUtil.format(c,"yyyy-MM-dd HH:mm:ss"):c}},{id:"submitTargetName",name:"\u63d0\u4ea4\u76ee\u6807",field:"submitTargetName"},{id:"submitNote",name:"\u63d0\u4ea4\u5907\u6ce8",field:"submitNote"}])};js.$public.setActivityLog=function(a){this._logs=a;this.callAfterRendered(function(){this.dgLog.dataProvider(this._logs)})};
js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:""},this._options,b);this.$super(a,b);this.invalidateSize(!0)};js.$public.open=function(a,b){js.isNull(b)||(wos.Remoting.call("WorkflowService.getActivityLog",[b],this),this.showDialog())};this.onCancel=function(){this.close()};this.onRemotingCallback=function(a,b){switch(a.option.asyncName){case "WorkflowService.getActivityLog":this.setActivityLog(a.result)}}});var b=new f.Xml(StringUtil.join('\x3cWindow width\x3d"400" height\x3d"300" title\x3d"\u5de5\u4f5c\u6d41\u6d3b\u52a8\u65e5\u5fd7" resizable\x3d"true" options\x3d"{maximizable:true}"\x3e',
'\x3cScrollView draggable\x3d"true"\x3e','\x3cHtml name\x3d"viewer" options\x3d"{classes:\'flowview\'}"\x3e','\x3ccanvas class\x3d"conn_layer"\x3e\x3c/canvas\x3e','\x3cdiv class\x3d"swimlanes"\x3e\x3c/div\x3e','\x3cdiv class\x3d"node_layer"\x3e\x3c/div\x3e',"\x3c/Html\x3e","\x3c/ScrollView\x3e","\x3c/Window\x3e"));js.$class("qs.app.workflow.FlowViewWindow",f.ui.Window,function(){this._nodeMap={};this._connMap={};this.initialize=function(a){this.$super(a);this.qxml(b);this.addEventListener(wos.events.CallbackEvent.CALLBACK,
this.onRemotingCallback);this.addEventListener(wos.events.FileLoadEvent.FILE_LOAD,this.onFileLoaded)};js.$public.updateSize=function(a,b){if(this.isRendered()){this.$super(a,b);var e=Math.max(0,(a-this.viewer.width())/2);this.viewer.left(e)}};js.$public.render=function(a,b){"undefined"==typeof b&&(b={});b=l.extend({classes:"flowview-window"},this._options,b);this.$super(a,b);var e=this.viewer.$element();this._$swimlanes=e.children(".swimlanes");this._conn_layer=e.children(".conn_layer")[0];this._$node_layer=
e.children(".node_layer");this.invalidateSize(!0)};js.$public.open=function(a,b){if(!js.isNull(b)){this.showDialog();var e=this._$element.find(".win-titlebar"),g=l('\x3cdiv class\x3d"title-button logview" title\x3d"\u67e5\u770b\u6d41\u7a0b\u65e5\u5fd7\u660e\u7ec6"\x3e\x3c/div\x3e');e.append(g);this.bindEvent("click",function(){var a=new f.app.workflow.FlowLogWindow;a.setActivityLog(this._activityLog);a.showDialog()},g);e={};js.isNull(a)||""==a?e.processId=b:e.definitionName=a;wos.FileLoader.loadFile("/pages/workflow/wfdefinition.jsp",
e,this,new wos.events.AsyncOption("defXml"));wos.Remoting.call("WorkflowService.getActivityLog",[b],this);wos.Remoting.call("WorkflowService.getProcessTrace",[b],this)}};this.generateView=function(a){var b=a.xpath("diagram/swimlanes/swimlane");this._maxWidth=0;this._maxHeight=500;for(var e=0;e<b.length;e++)this.drawSwimlanes(b[e]),this._maxWidth+=parseInt(b[e].attr("width"))+4;b=a.xpath("node");for(e=0;e<b.length;e++)this.loadNode(b[e]);b=a.xpath("diagram/node");for(e=0;e<b.length;e++)this.drawNode(b[e]);
b=a.xpath("transition");for(e=0;e<b.length;e++)this.loadConnection(b[e]);for(var g=this._conn_layer.getContext("2d"),b=a.xpath("diagram/connection"),e=0;e<b.length;e++)this.drawConnection(b[e],g);a=l(this._conn_layer);a.width(this._maxWidth+50);a.height(this._maxHeight+100);this._conn_layer.width=this._maxWidth+50;this._conn_layer.height=this._maxHeight+100;this.viewer.width(this._maxWidth);this.viewer.height(this._maxHeight+50);this.width(Math.min(f.ui.windowWidth()-20,this._maxWidth+100));this.height(Math.min(f.ui.windowHeight()-
20,this._maxHeight+100));this.centerScreen()};this.drawSwimlanes=function(a){a=StringUtil.join('\x3cdiv class\x3d"swimlane" style\x3d"width:',a.attr("width"),'px"\x3e','\x3cdiv class\x3d"header"\x3e','\x3cspan class\x3d"icon ',a.attr("type"),'"\x3e\x26nbsp;\x3c/span\x3e','\x3cspan class\x3d"text"\x3e',a.attr("name"),"\x3c/span\x3e","\x3c/div\x3e","\x3c/div\x3e");this._$swimlanes.append(a)};this.loadNode=function(a){var b={};b.id=a.attr("id");b.name=a.attr("name");b.type=a.attr("task_type");switch(b.type){case "HumanStartTask":b.typeName=
"\u4eba\u5de5\u8d77\u59cb\u4efb\u52a1";break;case "StartTask":b.typeName="\u901a\u7528\u8d77\u59cb\u4efb\u52a1";break;case "HumanTask":b.typeName="\u4eba\u5de5\u5904\u7406\u4efb\u52a1";break;case "MessageSendTask":b.typeName="\u6d88\u606f\u53d1\u9001\u4efb\u52a1";break;case "EndTask":b.typeName="\u7ed3\u675f\u4efb\u52a1";break;case "AutoTask":b.typeName="\u81ea\u52a8\u5904\u7406\u4efb\u52a1";break;case "ANDJoin":b.typeName="\u540c\u6b65\u805a\u5408";break;case "ORJoin":b.typeName="\u9009\u62e9\u805a\u5408";
break;case "ANDSplit":b.typeName="\u5e76\u884c\u53d1\u6563";break;case "ORSplit":b.typeName="\u9009\u62e9\u53d1\u6563";break;case "SubProcessTask":b.typeName="\u5b50\u6d41\u7a0b"}this._nodeMap[b.id]=b;this._nodeMap[b.name]=b};this.drawNode=function(a){var b=this._nodeMap[a.attr("id")];if(!js.isNull(b)){var e=a.attr("x"),f=a.attr("y"),k=a.attr("width");a=a.attr("height");var m=StringUtil.join('\x3cdiv class\x3d"node ',b.type,'" style\x3d"width:',k,"px; height:",a,"px; left:",e,"px; top:",f,'px"\x3e',
'\x3cdiv class\x3d"type"\x3e','\x3cspan class\x3d"icon"\x3e\x26nbsp\x3c/span\x3e','\x3cspan class\x3d"text"\x3e',b.typeName,"\x3c/span\x3e","\x3c/div\x3e",'\x3cdiv class\x3d"name"\x3e',b.name,"\x3c/div\x3e","\x3c/div\x3e"),m=l(m);this._$node_layer.append(m);this._maxWidth=Math.max(this._maxWidth,parseInt(e)+parseInt(k));this._maxHeight=Math.max(this._maxHeight,parseInt(f)+parseInt(a)+50);b.$element=m}};this.loadConnection=function(a){var b={};b.id=a.attr("id");b.name=a.attr("name");b.sourceNode=a.attr("sourceNode");
b.targetNode=a.attr("targetNode");b.label=b.name;b.lineColor="#707070";b.textColor="#000000";this._connMap[b.id]=b};this.drawPath=function(a,b,e,f,k){e.beginPath();e.lineWidth="2";e.strokeStyle=f;e.fillStyle=f;for(var m=0,l=0;l<a.length;l++)0==l?e.moveTo(a[l].x,a[l].y):(e.lineTo(a[l].x,a[l].y),m+=Math.abs(a[l].x-a[l-1].x)+Math.abs(a[l].y-a[l-1].y));e.stroke();var p=0,m=m/2;e.fillStyle=k;for(l=1;l<a.length;l++){k=Math.abs(a[l].x-a[l-1].x)+Math.abs(a[l].y-a[l-1].y);if(p+k>m){k=e.measureText(b);a[l].x==
a[l-1].x?a[l].y>a[l-1].y?e.fillText(b,a[l].x-k.width/2,a[l-1].y+(m-p)):e.fillText(b,a[l].x-k.width/2,a[l-1].y-(m-p)):a[l].x>a[l-1].x?e.fillText(b,a[l-1].x+(m-p)-k.width/2,a[l].y-5):e.fillText(b,a[l-1].x-(m-p)-k.width/2,a[l].y-5);break}p+=k}2>a.length||(e.fillStyle=f,b=a[a.length-2],a=a[a.length-1],b.x==a.x?(b.y>a.y?(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(a.x-4,a.y),e.lineTo(a.x,a.y-7)):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(a.x-4,a.y),e.lineTo(a.x,a.y+7)),e.lineTo(a.x+4,a.y),e.closePath(),e.fill(),
e.stroke()):b.y==a.y&&(b.x>a.x?(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(a.x,a.y-4),e.lineTo(a.x-7,a.y)):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(a.x,a.y-4),e.lineTo(a.x+7,a.y)),e.lineTo(a.x,a.y+4),e.closePath(),e.fill(),e.stroke()))};this.drawConnection=function(a,b){var e=this._connMap[a.attr("id")];if(!js.isNull(e)){e.path=[];for(var f=a.xpath("point"),k,m,l=0;l<f.length;l++)k=parseInt(f[l].attr("x")),m=parseInt(f[l].attr("y")),e.path.push({x:k,y:m}),this._maxWidth=Math.max(this._maxWidth,k+20),
this._maxHeight=Math.max(this._maxHeight,m+20);this.drawPath(e.path,e.label,b,e.lineColor,e.textColor)}};this.onCancel=function(){this.close()};this.onFileLoaded=function(a){!1==a.isLoaded?f.ui.MessageBox.show(a.option.asyncName+"\u6587\u4ef6\u88c5\u8f7d\u5931\u8d25\uff01\n"+a.message,"\u9519\u8bef"):"defXml"==a.option.asyncName&&(this._defXml=new f.Xml(a.content),this.generateView(this._defXml),js.isNull(this._activityLog)||js.isNull(this._traceXml)||this.generateTrace(),this.invalidateSize(!0))};
this.findConnection=function(a,b){var e,f;for(f in this._connMap)if(e=this._connMap[f],!js.isNull(e)&&e.sourceNode==a&&e.targetNode==b)return e;return null};this.generateTrace=function(){var a=this._traceXml.xpath("activity"),b,e,f=0,k,m,l,p;k=null;for(e=0;e<a.length;e++)b=a[e],m=this._nodeMap[b.attr("task")],js.isNull(m)||("Successed"==b.attr("result")&&(p=m.logs,js.isNull(p)&&(p=[],m.logs=p),l={},l.time=b.attr("time"),l.user=b.attr("contextUserName"),p.push(l),0!=e&&"Successed"==a[e-1].attr("result")&&
(l=this.findConnection(k.id,m.id),js.isNull(l)||(l.lineColor="red",l.textColor="red",l.thickness=2,l.executed=!0,js.isNull(l.exeOrder)?l.exeOrder=f+":"+b.attr("contextUserName"):l.exeOrder+=","+f+":"+b.attr("contextUserName"),l.label=l.exeOrder+" "+l.name)),k=m,f++),js.isNull(k)||k==m||(l=this.findConnection(k.id,m.id),null!=l&&(l.lineColor="red",l.textColor="red",l.thickness=2,l.executed=!0,js.isNull(l.exeOrder)?l.exeOrder=f+":"+b.attr("contextUserName"):l.exeOrder+=","+f+":"+b.attr("contextUserName"),
l.label=l.exeOrder+" "+l.name)));for(e=this._activityLog.length-1;0<=e;e--)if(l=this._activityLog[e],m=this._nodeMap[l.taskName],!js.isNull(m)&&!js.isNull(m.logs))for(p=0;p<m.logs.length;p++)js.isNull(m.logs[p].submitNote)&&(js.isNull(l.submitNote)?m.logs[p].submitNote="":m.logs[p].submitNote=l.submitNote);e=this._traceXml.xpath('activity[@result \x3d "HumanWork"]');for(a=0;a<e.length;a++)if(b=e[a],!(0<this._traceXml.xpath('activity[@task \x3d "'+b.attr("task")+'" and @result \x3d "Successed"]').length||
(m=this._nodeMap[b.attr("taskName")],js.isNull(m)))){p=m.logs;js.isNull(p)&&(p=[],m.logs=p);l={};l.user=b.attr("workerName");p.push(l);m.$element.addClass("current");for(var q in this._connMap)l=this._connMap[q],l.sourceNode==m.id&&(l.lineColor="green",l.thickness=2)}for(var s in this._nodeMap)if(m=this._nodeMap[s],!js.isNull(m)&&!js.isNull(m.logs)&&isNaN(parseInt(s))){l="";for(e=0;e<m.logs.length;e++)0<l.length&&(l+="-------------------------------\n"),js.isNull(m.logs[e].user)&&(m.logs[e].user=
""),js.isNull(m.logs[e].time)&&(m.logs[e].time=""),js.isNull(m.logs[e].submitNote)&&(m.logs[e].submitNote=""),l+="\u6267\u884c\u8005\u3000\uff1a"+m.logs[e].user+"\n",l+="\u6267\u884c\u65f6\u95f4\uff1a"+m.logs[e].time+"\n",l+="\u63d0\u4ea4\u5907\u6ce8\uff1a"+m.logs[e].submitNote+"\n";js.isNull(m.$element)||m.$element.attr("title",l)}m=this._conn_layer.getContext("2d");m.clearRect(0,0,this._conn_layer.width,this._conn_layer.height);for(q in this._connMap)l=this._connMap[q],!0!=l.executed&&this.drawPath(l.path,
l.label,m,l.lineColor,l.textColor);for(q in this._connMap)l=this._connMap[q],!0==l.executed&&this.drawPath(l.path,l.label,m,l.lineColor,l.textColor)};this.onRemotingCallback=function(a,b){switch(a.option.asyncName){case "WorkflowService.getActivityLog":this._activityLog=a.result;break;case "WorkflowService.getProcessTrace":this._traceXml=new f.Xml(a.result)}js.isNull(this._defXml)||js.isNull(this._activityLog)||js.isNull(this._traceXml)||this.generateTrace()}})})(qs,jQuery);(function(f,l){js.$class("qs.app.workflow.TaskList",f.ui.Control,function(){js.$static.WORKITEM_FINISHED=0;js.$static.WORKITEM_ERROR=1;js.$static.WORKITEM_CANCELED=2;js.$static.WORKITEM_DELIVERED=3;js.$static.WORKITEM_PROCESSING=4;js.$static.WORKITEM_SUSPENDED=5;js.$static.NONE_PROCESSED_TASK_STATE=4;this._gorups={};this._scrollViews=[];var a;this.initialize=function(b){this.$super(b);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback);this.callAfterRendered(function(){this.refresh()});
a=this};this.refresh=function(){wos.Remoting.call("WorkflowService.getWorkingList",[null,4,0,0,1E3],this,new wos.events.AsyncOption("getWorkingList",null))};js.$protected.template=function(a){return StringUtil.join('\x3cdiv class\x3d"qs-task"\x3e',"\x3c/div\x3e")};js.$public.updateSize=function(a,c){this.$super();this.isRendered()};js.$public.render=function(a,c){"undefined"==typeof c&&(c={});c=l.extend({classes:""},this._options,c);this.$super(a,c);0<c.classes.length&&$label.addClass(c.classes);
this.invalidateSize(!0)};this.taskRenderer=function(a){return l(StringUtil.join('\x3cdiv class\x3d"qs-task-item"\x3e','\x3cdiv class\x3d"task-content task_',a.id,'"\x3e','\x3cdiv class\x3d"title" title\x3d"',a.processName,'"\x3e',a.processName,"\x3c/div\x3e",'\x3cdiv class\x3d"from_user"\x3e',a.prevWorkerName,"\x3c/div\x3e",'\x3cdiv class\x3d"datetime"\x3e',DateUtil.format(a.createTime,"yyyy-MM-dd HH:mm:ss"),"\x3c/div\x3e",'\x3cdiv class\x3d"actions"\x3e','\x3cspan class\x3d"action do_process"\x3e\u5904\u7406\x3c/span\x3e',
'\x3cspan class\x3d"action do_forward"\x3e\u8f6c\u53d1\x3c/span\x3e','\x3cspan class\x3d"action do_diagram"\x3e\u67e5\u770b\u6d41\u7a0b\u56fe\x3c/span\x3e',"\x3c/div\x3e","\x3c/div\x3e",'\x3cdiv class\x3d"task-photo"\x3e\x3cimg width\x3d"60" src\x3d"images/login.png"\x3e\x3c/img\x3e\x3c/div\x3e',"\x3c/div\x3e"))};this.acceptTaskRenderer=function(a){return l(StringUtil.join('\x3cdiv class\x3d"qs-task-item"\x3e','\x3cdiv class\x3d"task-content task_',a.id,'"\x3e','\x3cdiv class\x3d"title accept" title\x3d"',
a.processName,'"\x3e',a.processName,"\x3c/div\x3e",'\x3cdiv class\x3d"from_user"\x3e',a.prevWorkerName,"\x3c/div\x3e",'\x3cdiv class\x3d"datetime"\x3e',DateUtil.format(a.createTime,"yyyy-MM-dd HH:mm:ss"),"\x3c/div\x3e",'\x3cdiv class\x3d"actions"\x3e','\x3cspan class\x3d"action do_accept"\x3e\u63a5\u53d7\x3c/span\x3e',"\x3c/div\x3e","\x3c/div\x3e",'\x3cdiv class\x3d"task-photo"\x3e\x3cimg width\x3d"60" src\x3d"images/login.png"\x3e\x3c/img\x3e\x3c/div\x3e',"\x3c/div\x3e"))};this.cb_getWorkingList=
function(b){if(b||0!=b.length){for(var c=[],d=b.length,e=0;e<d;e++){var g=b[e];if(0<parseInt(g.pendingTaskId))c.push(g);else{var k=g.name;this._gorups[k]||(this._gorups[k]=[]);this._gorups[k].push(g)}}if(0!=this._gorups.length){b=[];for(k in this._gorups){d=this._gorups[k];g={};g.label=k;g.counter=d.length;for(var e=new f.ui.ScrollView,m=l("\x3cdiv\x3e\x3c/div\x3e"),n=d.length,p=0;p<n;p++){var q=d[p],s=this.taskRenderer(q);s.data("workItem",q);m.append(s)}e.content(m);g.content=e;this._scrollViews.push(e);
b.push(g)}if(0<c.length){g={label:"\u7b49\u5f85\u63a5\u53d7\u7684\u4efb\u52a1"};g.counter=c.length;e=new f.ui.ScrollView;m=l("\x3cdiv\x3e\x3c/div\x3e");for(p=0;p<c.length;p++)q=c[p],s=this.acceptTaskRenderer(q),s.data("workItem",q),m.append(s);e.content(m);g.content=e;this._scrollViews.push(e);b.splice(0,0,g)}var c=this._$element.children(".qs-task"),r=new f.ui.Accordion;r.items(b);r.render(c,{classes:"qs-task-list"});this.bindEvent("click",this.doAction,c);f.Timer.callLater(100,function(){for(var b=
a._scrollViews.length,c=0;c<b;c++){var d=a.outerWidth()-2,e=a.outerHeight()-2,e=e-(30*b-2);a._scrollViews[c].outerSize({width:d,height:e})}r.selectedIndex(0)})}}};this.acceptHandler=function(a){a==f.ui.MessageBox.Yes&&wos.Remoting.call("WorkflowService.acceptTask",[this._workItem.processInstanceId,this._workItem.pendingTaskId],this,new wos.events.AsyncOption("acceptTask",null))};this.doAction=function(a){a=l(a.target);var c=a.closest(".qs-task-item",this._$element).data("workItem");a.is(".title.accept")||
a.is(".do_accept")?(this._workItem=c,f.ui.MessageBox.show('\u786e\u5b9a\u63a5\u53d7\u4efb\u52a1"'+c.processName+'"\u5417?',"\u63d0\u793a",f.ui.MessageBox.YesNo,f.ui.MessageBox.Question,this.acceptHandler,this)):a.is(".title")||a.is(".do_process")?wos.Remoting.call("WorkflowService.getWorkflowData",[c.id],this,new wos.events.AsyncOption("openTaskWindow",null)):a.is(".do_forward")?wos.Remoting.call("DynamicEntityService.getEntity",[c.entityId,c.entityUID],this,new wos.events.AsyncOption("deliverWork",
null)):a.is(".do_diagram")&&(new f.app.workflow.FlowViewWindow).open(null,c.processInstanceId)};this.openTask=function(a){if(!js.isNull(a)){var c=a.WorkItem;if(c.state!=f.app.workflow.TaskList.WORKITEM_PROCESSING){a="";switch(c.state){case f.app.workflow.TaskList.WORKITEM_FINISHED:a="\u6b64\u5de5\u4f5c\u9879\u5df2\u7ecf\u5b8c\u6210\u5904\u7406\uff0c\u4e0d\u80fd\u518d\u6b21\u6267\u884c\u3002";break;case f.app.workflow.TaskList.WORKITEM_ERROR:a="\u5de5\u4f5c\u6d41\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u3002";
break;case f.app.workflow.TaskList.WORKITEM_CANCELED:a="\u6b64\u5de5\u4f5c\u9879\u5df2\u88ab\u53d6\u6d88\u3002";break;case f.app.workflow.TaskList.WORKITEM_DELIVERED:a="\u6b64\u5de5\u4f5c\u9879\u5df2\u88ab\u8f6c\u4ea4\u5176\u4ed6\u7528\u6237\u6267\u884c\u3002";break;case f.app.workflow.TaskList.WORKITEM_SUSPENDED:a="\u6b64\u5de5\u4f5c\u9879\u5df2\u6682\u505c\u3002";break;default:a="\u5de5\u4f5c\u9879\u72b6\u6001\u9519\u8bef\u3002"}f.ui.MessageBox(a,"\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Info)}else{var d=
"WF_taskId_"+c.taskId,e=wos.Desktop.getAttribute(d);js.isNull(e)&&(e=a.Task);null!=e&&(wos.Desktop.setAttribute(d,e),e={WF_mode:"HumanSubmit"},e.WF_taskKey=d,e.WF_processName=c.processName,e.WF_processId=c.processInstanceId,e.WF_workItemId=c.id,e.WF_workItem=c,e.WF_data=a,wos.Desktop.openALink("ime.TaskList",c.action,e))}}};this.cb_deliverWork=function(a){if(!js.isNull(a)){if(js.isNull(a.WF_WorkItemId)||0==a.WF_WorkItemId)throw Error("\u65e0\u6cd5\u83b7\u53d6\u4e0e\u5de5\u4f5c\u8868\u5bf9\u5e94\u7684\u5de5\u4f5c\u9879\u3002");
var c=new f.app.workflow.DeliverWorkItemWindow;c.setTaskEntity(a);c.showDialog()}};this.onRemotingCallback=function(a,c){switch(a.option.asyncName){case "getWorkingList":this.cb_getWorkingList(a.result);break;case "openTaskWindow":this.openTask(a.result);break;case "deliverWork":this.cb_deliverWork(a.result);break;case "acceptTask":f.ui.MessageBox.show("\u4efb\u52a1\u5df2\u6210\u529f\u63a5\u53d7\u3002","\u63d0\u793a"),this.refresh()}}});wos.Desktop.instance().addEventListener("WidgetAction",function(a,
b){var c=b.data;if(!js.isNull(c)&&"task"==c.action){var c=QSWeb.instance().getWidget(c.id),d=c.counter();if(!js.isNull(d)&&0!=d){var d=c._$element.offset(),e=new f.app.workflow.TaskList;f.ui.popup.show(e,{x:d.left,y:d.top+c.outerHeight()+4,width:300,height:450,classes:"qs-ani-fadein",$relative:c})}}});wos.Desktop.instance().addEventListener(wos.Desktop.READY_EVENT,function(a,b){"ready"==a.name()&&(wos.Desktop.instance().dispatchEvent("ime.WorkItem",{action:"refresh"}),setInterval(function(){wos.Desktop.instance().dispatchEvent("ime.WorkItem",
{action:"refresh"})},3E5))});wos.Desktop.instance().addEventListener("ime.WorkItem",function(a,b){js.isNull(b)||"completed"!=b.action&&"refresh"!=b.action||wos.Remoting.call("WorkflowService.getWorkingListSize",[null,4,0],f.app.workflow.TaskManager.instance())});js.$class("qs.app.workflow.TaskManager",f.events.EventDispatcher,function(){js.$static._instance=null;this.initialize=function(a){this.$super();this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$static.instance=
function(){null==f.app.workflow.TaskManager._instance&&(f.app.workflow.TaskManager._instance=new f.app.workflow.TaskManager);return f.app.workflow.TaskManager._instance};this.onRemotingCallback=function(a,b){switch(a.option.asyncName){case "WorkflowService.getWorkingListSize":var c=QSWeb.instance().getWidget("workflow_task");c&&(c.counter(a.result),c=c.$element().find(".qs-counter"),c.css("animation","none"),c.css("animation","flash linear 0.8s 5"))}}});f.app.workflow.TaskManager.instance()})(qs,
jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow title\x3d"\u8bbe\u7f6e\u89d2\u8272" width\x3d"500" height\x3d"400" resizable\x3d"false"\x3e','\x3cGridLayout columns\x3d"[70, \'*\', 70, \'*\']" rows\x3d"[25, \'*\', 30]" hGap\x3d"3" vGap\x3d"3" width\x3d"100%" height\x3d"100%" padding\x3d"2"\x3e','\x3cLabel text\x3d"\u7528\u6237\u540d\u79f0:" layout\x3d"{rowIndex:0, colIndex:0}"/\x3e','\x3cTextInput name\x3d"txtUserName" layout\x3d"{rowIndex:0, colIndex:1}" readonly\x3d"true"/\x3e','\x3cLabel text\x3d"\u767b\u5165\u5e10\u53f7:" layout\x3d"{rowIndex:0, colIndex:2}" /\x3e',
'\x3cTextInput name\x3d"txtLoginId" layout\x3d"{rowIndex:0, colIndex:3}" readonly\x3d"true"/\x3e','\x3cDataGrid name\x3d"grid" layout\x3d"{rowIndex:1, colSpan:4}" options\x3d"{selectActiveRow:false}"/\x3e','\x3cHLayout layout\x3d"{rowIndex:2, colSpan:4, hAlign:\'right\', innerLayout:{height:24, vAlign:\'bottom\'}}" hGap\x3d"5" padding\x3d"2" width\x3d"100%"\x3e','\x3cButton width\x3d"70" text\x3d"\u786e\u5b9a" click\x3d"onOK" options\x3d"{isDefault:true}" icon\x3d"images/icons/ok.png"/\x3e','\x3cButton width\x3d"70" text\x3d"\u53d6\u6d88" click\x3d"onCancel" icon\x3d"images/icons/cancel.png"/\x3e',
"\x3c/HLayout\x3e","\x3c/GridLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.SetRoleWindow",f.ui.Window,function(){this.principalId=0;this.loginId=this.userName="";this.userRoles=[];this.initialize=function(b){this.$super();this.qxml(a);this.principalId=Number(b);this.grid.columns([{id:"select",name:"",field:"$selected",header:{checkbox:!0}},{id:"name",name:"\u540d\u79f0",field:"name",width:200},{id:"note",name:"\u5907\u6ce8",field:"note",width:266}]);this.addEventListener(wos.events.CallbackEvent.CALLBACK,
this.onRemotingCallback);wos.Remoting.call("PrincipalService.getPrincipal",[this.principalId],this);wos.Remoting.call("RoleService.getAllRoles",[],this)};js.$public.render=function(a,c){this.$super(a,c);this.invalidateSize(!0)};this.findRole=function(a){for(var c=this.grid.dataProvider(),d=c.length,e=0;e<d;e++)if(a==c[e].id)return c[e];return null};this.onOK=function(){for(var a=[],c=this.grid.dataProvider(),d=c.length,e=0;e<d;e++)!0==c[e].$selected&&a.push(c[e].id);d=this.userRoles.length;for(c=
0;c<d;c++)this.findRole(this.userRoles[c])||a.push(this.userRoles[c]);wos.Remoting.call("PrincipalService.setRoles",[this.principalId,a],this)};this.onRemotingCallback=function(a,c){var d=a.result;switch(a.option.asyncName){case "PrincipalService.getPrincipal":js.isNull(d)||(this.txtUserName.text(d.name),this.txtLoginId.text(d.loginId));break;case "RoleService.getAllRoles":if(!js.isNull(d)){for(var e=d.length,f=[],k=0;k<e;k++){var l=d[k];if(!(0<l.systemPermission)){var n={};n.id=l.id;n.name=l.name;
n.note=l.note;f.push(n)}}this.grid.dataProvider(f);wos.Remoting.call("PrincipalService.getRoles",[this.principalId],this)}break;case "PrincipalService.getRoles":if(!js.isNull(d)){e=d.length;for(k=0;k<e;k++)l=d[k],this.userRoles.push(l.id);e=this.userRoles.length;for(k=0;k<e;k++)if(d=this.findRole(this.userRoles[k]))d.$selected=!0;d=[];l=this.grid.dataProvider();e=l.length;for(k=0;k<e;k++)!0==l[k].$selected&&d.push(k);this.grid.setSelectedRows(d);this.grid.invalidate()}break;case "PrincipalService.setRoles":this.close()}};
this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cWindow title\x3d"\u8bbe\u7f6e\u5bc6\u7801" width\x3d"250" height\x3d"120" resizable\x3d"false"\x3e','\x3cVLayout width\x3d"100%" vGap\x3d"5" padding\x3d"2"\x3e','\x3cGridLayout columns\x3d"[\'auto\', \'*\']" width\x3d"100%" rows\x3d"[25, 25]" hGap\x3d"3" vGap\x3d"3" innerAlign\x3d"{hAlign:\'left\', vAlign:\'middle\'}"\x3e','\x3cLabel text\x3d"\u65b0\u5bc6\u7801:" /\x3e','\x3cLabel text\x3d"\u786e\u8ba4\u5bc6\u7801:" layout\x3d"{rowIndex:1}" /\x3e',
'\x3cTextInput name\x3d"txtPassword" password\x3d"true" layout\x3d"{colIndex:1}" /\x3e','\x3cTextInput name\x3d"txtPassword2" password\x3d"true" layout\x3d"{colIndex:1, rowIndex:1}" /\x3e',"\x3c/GridLayout\x3e",'\x3cHLayout width\x3d"100%" hGap\x3d"10" height\x3d"24" hAlign\x3d"right" innerLayout\x3d"{height:\'100%\'}"\x3e','\x3cButton text\x3d"\u786e\u5b9a" width\x3d"70" click\x3d"onOK" options\x3d"{isDefault:true}" /\x3e','\x3cButton text\x3d"\u53d6\u6d88" width\x3d"70" click\x3d"onCancel" /\x3e',
"\x3c/HLayout\x3e","\x3c/VLayout\x3e","\x3c/Window\x3e"));js.$class("qs.app.SetPasswordWindow",f.ui.Window,function(){this.principalId=0;this.initialize=function(b){this.$super();this.qxml(a);this.principalId=Number(b);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.render=function(a,c){this.$super(a,c);this.invalidateSize(!0)};this.onOK=function(){var a=StringUtil.trim(this.txtPassword.text()),c=StringUtil.trim(this.txtPassword2.text());""==a?f.ui.MessageBox.show("\u8bf7\u8f93\u5165\u5bc6\u7801",
"\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Info):a!=c?f.ui.MessageBox.show("\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u8f93","\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Error):6>a.length?f.ui.MessageBox.show("\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e6\u4f4d","\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Info):16<a.length?f.ui.MessageBox.show("\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e16\u4f4d","\u63d0\u793a",f.ui.MessageBox.OK,f.ui.MessageBox.Info):wos.Remoting.call("PrincipalService.setPassword",
[this.principalId,a],this)};this.onRemotingCallback=function(a,c){switch(a.option.asyncName){case "PrincipalService.setPassword":this.close()}};this.onCancel=function(){this.close()}})})(qs,jQuery);(function(f,l){var a=new f.Xml(StringUtil.join('\x3cContainer xmlns:app\x3d"qs.app" padding\x3d"{top:1, left:2, right:2, bottom:1}"\x3e','\x3cHLayout width\x3d"100%" height\x3d"100%" hGap\x3d"0" innerLayout\x3d"{height:\'100%\'}"\x3e','\x3cScrollView width\x3d"200"\x3e','\x3capp:NavigateBar name\x3d"navBar" selectChange\x3d"onMenuSelectChange"/\x3e',"\x3c/ScrollView\x3e","\x3cHSplitter /\x3e",'\x3capp:Page name\x3d"page" layout\x3d"{width:\'100%\'}"/\x3e','\x3cTabView name\x3d"pageTab" layout\x3d"{width:\'100%\'}" closeable\x3d"true" visible\x3d"false" options\x3d"{classes:\'app-tab\'}"\x3e',
"\x3c/TabView\x3e","\x3c/HLayout\x3e","\x3c/Container\x3e"));js.$class("qs.app.SecurityManager",f.ui.Container,[f.app.IPage],function(){this.initialize=function(){this.$super();this.qxml(a);this.addEventListener(wos.events.CallbackEvent.CALLBACK,this.onRemotingCallback)};js.$public.render=function(a,c){this.$super(a,c);this.invalidateSize(!0)};this.onRemotingCallback=function(a,c){}});js.$class("qs.app.AdminALinkHandler",f.events.EventDispatcher,[wos.IALinkHandler],function(){this.initialize=function(){this.$super()};
js.$static.register=function(){wos.Desktop.registerALinkHandler("ime.Admin",new f.app.AdminALinkHandler)};js.$public.handleALink=function(a){null==a.param&&(a.param={});if("PasswordForm"==a.form){var c=a.param.principalId;js.isNull(c)&&(a=a.param.ctxEntity,js.isNull(a)||(c=a.operator_id));js.isNull(c)||isNaN(parseInt(c))?f.ui.MessageBox.show("\u672a\u6307\u5b9a\u91cd\u8bbe\u5bc6\u7801\u7684\u64cd\u4f5c\u5458","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error):(c=new f.app.SetPasswordWindow(c),
c.show())}else"SetRoleForm"==a.form&&(c=a.param.principalId,js.isNull(c)&&(a=a.param.ctxEntity,js.isNull(a)||(c=a.operator_id)),js.isNull(c)||isNaN(parseInt(c))?f.ui.MessageBox.show("\u672a\u6307\u5b9a\u8bbe\u7f6e\u89d2\u8272\u7684\u64cd\u4f5c\u5458","\u9519\u8bef",f.ui.MessageBox.OK,f.ui.MessageBox.Error):(c=new f.app.SetRoleWindow(c),c.show()))}});f.app.AdminALinkHandler.register()})(qs,jQuery);